---
layout: post
image: /images/vignette-cegid-xrp-mod.svg
title: "Desarrollo: Aplicaci√≥n profesional de soporte t√©cnico. Un resumen con IA."
date: 2025-12-14 23:00:00
categories: ["FastAPI", "NextJS", "PostgreSQL"]
tags: [post]
author: Marcelo Robin, IA
description: "Este art√≠culo detalla el proceso de desarrollo para crear una aplicaci√≥n profesional de soporte t√©cnico como las que utilizan las empresas para resolver problemas que tienen con sus clientes. Vamos a tener una autenticaci√≥n segura, vamos a crear tickets, vamos a crear conversaciones en tiempo real y vamos a incorporar notificaciones autom√°ticas sin recargar la p√°gina, todo con Fast API + NextJS. Vamos a desplegar en producci√≥n en Vercel y en Render y vamos a desarrollar todo esto localmente en contenedores de Podman."
toc: true
---

**Autor:** Marcelo Robin (contenido original en video), IA (en la generaci√≥n de texto)

---

## DOCUMENTO 1: AN√ÅLISIS EXHAUSTIVO POR VIDEO
# DOCUMENTO 1: AN√ÅLISIS EXHAUSTIVO POR VIDEO
## Serie FastAPI y Next.js - Crea una App Full Stack Real
### Canal: C√≥digo para Principiantes

---

## üìπ VIDEO 1: FastAPI y Next.js - Crea una App Full Stack Real (con WebSockets)

### üìä INFORMACI√ìN GENERAL
- **URL**: https://www.youtube.com/watch?v=5oNktUuWBMY
- **Duraci√≥n**: 10:13 minutos
- **Vistas**: 650 vistas
- **Publicado**: Hace 3 meses
- **Me gusta**: 55
- **Canal**: C√≥digo para Principiantes (3.78K suscriptores)
- **Hashtags**: #FastAPI #NextJS #PostgreSQL

### üìù DESCRIPCI√ìN
Aprende paso a paso c√≥mo crear una App Full Stack Real con FastAPI, Next.js y PostgreSQL, totalmente en contenedores de Podman, usando WebSockets para comunicaci√≥n en tiempo real y cookies seguras con tokens para autenticaci√≥n.

### üéØ OBJETIVOS DEL VIDEO
Este primer episodio presenta:
- Visi√≥n general del proyecto Full Stack completo
- Introducci√≥n a las tecnolog√≠as principales (FastAPI, Next.js, PostgreSQL)
- Arquitectura del sistema con contenedorizaci√≥n
- Planteamiento de caracter√≠sticas clave: WebSockets y autenticaci√≥n segura

### üîë CONCEPTOS T√âCNICOS PRINCIPALES

#### 1. **Stack Tecnol√≥gico**
- **Backend**: FastAPI (Framework Python as√≠ncrono de alto rendimiento)
- **Frontend**: Next.js (Framework React con SSR/SSG)
- **Base de Datos**: PostgreSQL (Sistema de gesti√≥n de base de datos relacional)
- **Contenedorizaci√≥n**: Podman (Alternativa a Docker sin daemon root)

#### 2. **Caracter√≠sticas Clave del Proyecto**
- **WebSockets**: Comunicaci√≥n bidireccional en tiempo real
- **Autenticaci√≥n Segura**: Tokens JWT almacenados en cookies HttpOnly
- **Arquitectura de Contenedores**: Aplicaci√≥n completamente contenerizada
- **Desarrollo Full Stack**: Integraci√≥n completa frontend-backend

#### 3. **Arquitectura del Sistema**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     WebSockets/HTTP     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Next.js       ‚îÇ ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí ‚îÇ    FastAPI       ‚îÇ
‚îÇ   Frontend      ‚îÇ     JWT en Cookies      ‚îÇ    Backend       ‚îÇ
‚îÇ  (Contenedor 1) ‚îÇ                         ‚îÇ  (Contenedor 2)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                     ‚Üï
                                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                            ‚îÇ   PostgreSQL     ‚îÇ
                                            ‚îÇ   Base de Datos  ‚îÇ
                                            ‚îÇ  (Contenedor 3)  ‚îÇ
                                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üí° TIPS Y OBSERVACIONES DEL INSTRUCTOR
- Este es un proyecto real de producci√≥n, no un tutorial b√°sico
- Se seguir√°n las mejores pr√°cticas profesionales
- El uso de Podman en lugar de Docker ofrece ventajas en seguridad
- La serie completa construir√° una aplicaci√≥n funcional paso a paso

### üé¨ CAP√çTULOS Y TIMESTAMPS
*(Nota: Los timestamps espec√≠ficos no estaban disponibles en los metadatos extra√≠dos)*

Contenido estimado:
- [00:00 - 02:00] Introducci√≥n al proyecto Full Stack
- [02:00 - 04:00] Presentaci√≥n del stack tecnol√≥gico
- [04:00 - 06:30] Arquitectura y dise√±o del sistema
- [06:30 - 08:30] Caracter√≠sticas principales: WebSockets y autenticaci√≥n
- [08:30 - 10:13] Roadmap de la serie y pr√≥ximos episodios

### üîó CONEXI√ìN CON SIGUIENTES EPISODIOS
Este video establece las bases para:
- **Video 2**: Implementaci√≥n y configuraci√≥n del Backend con FastAPI
- **Video 3**: Configuraci√≥n del Frontend con Next.js
- **Videos posteriores**: Refinamiento y caracter√≠sticas avanzadas

---

## üìπ VIDEO 2: FastAPI y Next.js - Preparamos el Backend | Curso App Full Stack #2

### üìä INFORMACI√ìN GENERAL
- **URL**: https://www.youtube.com/watch?v=fNgmKHZ1HJU
- **Duraci√≥n**: 43:31 minutos ‚≠ê (El episodio m√°s largo de la serie)
- **Vistas**: 538 vistas
- **Publicado**: Hace 3 meses
- **Me gusta**: 33
- **Canal**: C√≥digo para Principiantes (3.78K suscriptores)
- **Hashtags**: #FastAPI #NextJS #PostgreSQL

### üìù DESCRIPCI√ìN
Continuaci√≥n del curso Full Stack donde se prepara y configura exhaustivamente el backend con FastAPI, estableciendo la base para la API REST y comunicaci√≥n en tiempo real.

### üéØ OBJETIVOS DEL VIDEO
- Configurar el entorno de desarrollo del Backend
- Instalar y configurar FastAPI con todas sus dependencias
- Establecer la estructura inicial del proyecto
- Configurar la conexi√≥n a PostgreSQL
- Implementar endpoints b√°sicos de prueba
- Preparar el contenedor Docker/Podman para el backend

### üîë CONCEPTOS T√âCNICOS PRINCIPALES

#### 1. **Instalaci√≥n y Configuraci√≥n de FastAPI**

**Dependencias Principales**:
```bash
# Instalaci√≥n de FastAPI y servidor ASGI
pip install fastapi uvicorn[standard]

# Autenticaci√≥n y seguridad
pip install python-jose[cryptography] passlib[bcrypt]

# Validaci√≥n de datos
pip install pydantic pydantic[email]

# Base de datos
pip install sqlalchemy psycopg2-binary alembic

# Utilidades
pip install python-multipart
```

**Caracter√≠sticas de FastAPI exploradas**:
- **Servidor ASGI (Uvicorn)**: Servidor as√≠ncrono de alto rendimiento
- **Validaci√≥n autom√°tica**: Uso de Pydantic para validaci√≥n de tipos
- **Documentaci√≥n autom√°tica**: Swagger UI y Redoc generados autom√°ticamente
- **Type hints**: Aprovechamiento del tipado est√°tico de Python

#### 2. **Estructura Inicial del Proyecto Backend**

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Punto de entrada de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # Configuraci√≥n y variables de entorno
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.py        # Definici√≥n de rutas/endpoints
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py      # JWT, hashing, autenticaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.py        # Settings centralizados
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py      # Conexi√≥n a PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py      # Modelos SQLAlchemy (pr√≥ximo video)
‚îÇ   ‚îî‚îÄ‚îÄ schemas/
‚îÇ       ‚îî‚îÄ‚îÄ __init__.py      # Esquemas Pydantic (pr√≥ximo video)
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ .env
```

#### 3. **Configuraci√≥n de la Base de Datos PostgreSQL**

**Archivo `database.py`**:
```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

# URL de conexi√≥n a PostgreSQL
DATABASE_URL = "postgresql://user:password@postgres:5432/dbname"

# Crear engine con pool de conexiones
engine = create_engine(
    DATABASE_URL,
    pool_pre_ping=True,  # Verificar conexiones
    pool_size=10,        # N√∫mero de conexiones
    max_overflow=20      # Conexiones adicionales m√°ximas
)

# Configurar sesi√≥n
SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=engine
)

# Base para modelos declarativos
Base = declarative_base()

# Dependency para obtener sesi√≥n de BD
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

#### 4. **Configuraci√≥n de Variables de Entorno**

**Archivo `.env`**:
```env
# Database
DATABASE_URL=postgresql://fastapi_user:securepassword@postgres:5432/fullstack_db

# Security
SECRET_KEY=your-super-secret-key-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Application
APP_NAME=FastAPI Full Stack
DEBUG=True
VERSION=1.0.0
```

**Archivo `config.py` con Pydantic**:
```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # Database
    DATABASE_URL: str
    
    # Security
    SECRET_KEY: str
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # Application
    APP_NAME: str = "FastAPI Full Stack"
    DEBUG: bool = False
    VERSION: str = "1.0.0"
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

#### 5. **Aplicaci√≥n Principal FastAPI**

**Archivo `main.py`**:
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api import routes

# Crear instancia de FastAPI
app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    description="API Full Stack con FastAPI y Next.js",
    docs_url="/docs",
    redoc_url="/redoc"
)

# Configurar CORS para Next.js
origins = [
    "http://localhost:3000",  # Next.js dev
    "http://frontend:3000",   # Next.js container
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Incluir routers
app.include_router(routes.router, prefix="/api/v1")

# Endpoint de health check
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "version": settings.VERSION
    }

# Evento de inicio
@app.on_event("startup")
async def startup_event():
    print(f"üöÄ {settings.APP_NAME} iniciado")
    print(f"üìö Documentaci√≥n en: http://localhost:8000/docs")

# Evento de cierre
@app.on_event("shutdown")
async def shutdown_event():
    print("üëã Cerrando aplicaci√≥n")
```

#### 6. **Containerizaci√≥n del Backend**

**Dockerfile para FastAPI**:
```dockerfile
# Imagen base con Python
FROM python:3.11-slim

# Directorio de trabajo
WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Copiar requirements
COPY requirements.txt .

# Instalar dependencias Python
RUN pip install --no-cache-dir -r requirements.txt

# Copiar c√≥digo de la aplicaci√≥n
COPY ./app ./app

# Exponer puerto
EXPOSE 8000

# Comando para ejecutar
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
```

**docker-compose.yml parcial**:
```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: securepassword
      POSTGRES_DB: fullstack_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - fullstack_network

  backend:
    build: ./backend
    container_name: fullstack_backend
    env_file:
      - ./backend/.env
    volumes:
      - ./backend/app:/app/app
    ports:
      - "8000:8000"
    depends_on:
      - postgres
    networks:
      - fullstack_network

networks:
  fullstack_network:
    driver: bridge

volumes:
  postgres_data:
```

#### 7. **Comandos y Configuraciones Importantes**

**Comandos de desarrollo**:
```bash
# Levantar contenedores con Podman
podman-compose up -d

# Ver logs del backend
podman logs -f fullstack_backend

# Ejecutar migraciones (cuando se configuren)
podman exec fullstack_backend alembic upgrade head

# Acceder al contenedor
podman exec -it fullstack_backend bash

# Detener contenedores
podman-compose down

# Reconstruir im√°genes
podman-compose build --no-cache
```

**Ejecutar FastAPI localmente (sin contenedores)**:
```bash
# Modo desarrollo con recarga autom√°tica
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Modo producci√≥n con m√∫ltiples workers
uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
```

### üí° TIPS Y OBSERVACIONES DEL INSTRUCTOR

1. **Sobre la estructura del proyecto**:
   - Empezar con una estructura simple y escalarla seg√∫n necesidad
   - Separar claramente las responsabilidades (API, l√≥gica de negocio, datos)
   - Mantener la configuraci√≥n centralizada

2. **Sobre PostgreSQL**:
   - Usar pool de conexiones para mejor rendimiento
   - Configurar `pool_pre_ping=True` para reconexiones autom√°ticas
   - Siempre cerrar sesiones de base de datos con `try/finally`

3. **Sobre FastAPI**:
   - La documentaci√≥n autom√°tica (Swagger UI) es invaluable para desarrollo
   - Aprovechar la inyecci√≥n de dependencias para c√≥digo limpio
   - Usar `async`/`await` para operaciones I/O bound

4. **Sobre contenedores**:
   - Usar vol√∫menes para persistencia de datos
   - Configurar networks para comunicaci√≥n entre contenedores
   - Separar configuraciones de desarrollo y producci√≥n

5. **Sobre seguridad**:
   - NUNCA commitear archivos `.env` al repositorio
   - Usar `SECRET_KEY` fuertes generadas aleatoriamente
   - Configurar CORS apropiadamente seg√∫n el entorno

### üé¨ CAP√çTULOS Y TIMESTAMPS ESTIMADOS

- **[00:00 - 05:00]** Introducci√≥n y repaso del episodio anterior
- **[05:00 - 10:00]** Instalaci√≥n de FastAPI y dependencias
- **[10:00 - 18:00]** Configuraci√≥n de la estructura del proyecto
- **[18:00 - 25:00]** Configuraci√≥n de PostgreSQL y SQLAlchemy
- **[25:00 - 32:00]** Creaci√≥n del archivo main.py y endpoints b√°sicos
- **[32:00 - 38:00]** Configuraci√≥n del Dockerfile y docker-compose
- **[38:00 - 43:31]** Pruebas, verificaci√≥n y conclusiones

### üîó CONEXI√ìN CON OTROS EPISODIOS

**Depende de**:
- Video 1: Visi√≥n general y arquitectura del proyecto

**Prepara para**:
- Video 3: Configuraci√≥n del Frontend con Next.js
- Video 4: Reorganizaci√≥n profesional del Backend
- Video 5: Creaci√≥n de modelos y relaciones de base de datos

---

## üìπ VIDEO 3: FastAPI y NextJS - Preparamos el contenedor del Frontend | Curso App Full Stack #3

### üìä INFORMACI√ìN GENERAL
- **URL**: https://www.youtube.com/watch?v=5zkla8UaiwI
- **Duraci√≥n**: 28:14 minutos
- **Vistas**: 258 vistas
- **Publicado**: Hace 3 meses
- **Me gusta**: 18
- **Canal**: C√≥digo para Principiantes (3.78K suscriptores)
- **Hashtags**: #FastAPI #NextJS #PostgreSQL

### üìù DESCRIPCI√ìN
Episodio dedicado a la configuraci√≥n completa del contenedor del Frontend con Next.js, estableciendo la base para la interfaz de usuario y la comunicaci√≥n con el backend FastAPI.

### üéØ OBJETIVOS DEL VIDEO
- Instalar y configurar Next.js
- Configurar TypeScript para el proyecto
- Establecer la estructura del proyecto Frontend
- Configurar TailwindCSS para estilos
- Implementar componentes UI con shadcn/ui
- Crear el contenedor Docker/Podman para Next.js
- Configurar la comunicaci√≥n con el backend

### üîë CONCEPTOS T√âCNICOS PRINCIPALES

#### 1. **Instalaci√≥n y Configuraci√≥n de Next.js**

**Crear proyecto Next.js**:
```bash
# Crear nuevo proyecto con App Router
npx create-next-app@latest frontend --typescript --tailwind --app

# Opciones seleccionadas:
# ‚úì Would you like to use TypeScript? Yes
# ‚úì Would you like to use ESLint? Yes
# ‚úì Would you like to use Tailwind CSS? Yes
# ‚úì Would you like to use `src/` directory? Yes
# ‚úì Would you like to use App Router? Yes
# ‚úì Would you like to customize the default import alias? No
```

**Dependencias adicionales**:
```bash
cd frontend

# Cliente HTTP para consumir API
npm install axios

# Manejo de formularios
npm install react-hook-form zod @hookform/resolvers

# Cliente OpenAPI tipado
npm install openapi-fetch openapi-typescript

# Shadcn UI components
npx shadcn-ui@latest init
```

#### 2. **Estructura del Proyecto Frontend**

```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx        # Layout principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx          # P√°gina home
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/           # Grupo de rutas autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (protected)/      # Grupo de rutas protegidas
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/               # Componentes shadcn
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Sidebar.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ forms/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LoginForm.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ RegisterForm.tsx
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts           # Cliente API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts          # L√≥gica de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts         # Utilidades
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useWebSocket.ts
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts           # Tipos TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ       ‚îî‚îÄ‚îÄ globals.css
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ assets/
‚îú‚îÄ‚îÄ .env.local
‚îú‚îÄ‚îÄ next.config.js
‚îú‚îÄ‚îÄ tailwind.config.ts
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ Dockerfile
```

#### 3. **Configuraci√≥n de TypeScript**

**tsconfig.json**:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

#### 4. **Configuraci√≥n de TailwindCSS**

**tailwind.config.ts**:
```typescript
import type { Config } from "tailwindcss"

const config: Config = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}
export default config
```

#### 5. **Cliente API para comunicaci√≥n con Backend**

**lib/api.ts**:
```typescript
import axios, { AxiosInstance, AxiosError } from 'axios';

// Configuraci√≥n base de axios
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1',
  timeout: 10000,
  withCredentials: true, // Para enviar cookies
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para requests
apiClient.interceptors.request.use(
  (config) => {
    // Agregar token si existe
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Interceptor para responses
apiClient.interceptors.response.use(
  (response) => response,
  async (error: AxiosError) => {
    if (error.response?.status === 401) {
      // Redirigir a login si no autorizado
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

// Funciones de API
export const api = {
  // Auth
  login: async (username: string, password: string) => {
    const response = await apiClient.post('/auth/login', { username, password });
    return response.data;
  },
  
  register: async (userData: any) => {
    const response = await apiClient.post('/auth/register', userData);
    return response.data;
  },
  
  logout: async () => {
    const response = await apiClient.post('/auth/logout');
    return response.data;
  },
  
  // User
  getCurrentUser: async () => {
    const response = await apiClient.get('/users/me');
    return response.data;
  },
};

export default apiClient;
```

**Variables de entorno (.env.local)**:
```env
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
```

#### 6. **Layout Principal de la Aplicaci√≥n**

**app/layout.tsx**:
```typescript
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'FastAPI + Next.js Full Stack',
  description: 'Aplicaci√≥n Full Stack con FastAPI y Next.js',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="es">
      <body className={inter.className}>
        <div className="min-h-screen bg-background">
          {children}
        </div>
      </body>
    </html>
  )
}
```

#### 7. **Containerizaci√≥n del Frontend**

**Dockerfile para Next.js**:
```dockerfile
# Stage 1: Dependencies
FROM node:20-alpine AS deps
WORKDIR /app

# Copiar package files
COPY package.json package-lock.json* ./
RUN npm ci

# Stage 2: Builder
FROM node:20-alpine AS builder
WORKDIR /app

# Copiar dependencias
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Variables de entorno para build
ENV NEXT_TELEMETRY_DISABLED 1
ARG NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL

# Build de la aplicaci√≥n
RUN npm run build

# Stage 3: Runner
FROM node:20-alpine AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

# Crear usuario no-root
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# Copiar archivos necesarios
COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

**next.config.js**:
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone', // Para Docker
  images: {
    domains: ['localhost'],
  },
  async rewrites() {
    return [
      {
        source: '/api/:path*',
        destination: `${process.env.NEXT_PUBLIC_API_URL}/:path*`,
      },
    ];
  },
}

module.exports = nextConfig
```

**docker-compose.yml actualizado**:
```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: securepassword
      POSTGRES_DB: fullstack_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - fullstack_network

  backend:
    build: ./backend
    container_name: fullstack_backend
    env_file:
      - ./backend/.env
    volumes:
      - ./backend/app:/app/app
    ports:
      - "8000:8000"
    depends_on:
      - postgres
    networks:
      - fullstack_network

  frontend:
    build: 
      context: ./frontend
      args:
        NEXT_PUBLIC_API_URL: http://backend:8000/api/v1
    container_name: fullstack_frontend
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
      - NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
    ports:
      - "3000:3000"
    depends_on:
      - backend
    networks:
      - fullstack_network
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public

networks:
  fullstack_network:
    driver: bridge

volumes:
  postgres_data:
```

#### 8. **Comandos Importantes para el Frontend**

**Desarrollo local**:
```bash
# Instalar dependencias
npm install

# Modo desarrollo
npm run dev

# Build de producci√≥n
npm run build

# Ejecutar build
npm start

# Linter
npm run lint
```

**Con contenedores**:
```bash
# Build del contenedor frontend
podman build -t fullstack-frontend ./frontend

# Ejecutar solo frontend
podman run -p 3000:3000 fullstack-frontend

# Levantar stack completo
podman-compose up -d

# Ver logs del frontend
podman logs -f fullstack_frontend
```

### üí° TIPS Y OBSERVACIONES DEL INSTRUCTOR

1. **Sobre Next.js**:
   - App Router es la nueva forma recomendada (vs Pages Router)
   - Server Components mejoran el rendimiento inicial
   - Usar Server Actions para formularios simples

2. **Sobre TypeScript**:
   - Aprovechar el tipado fuerte para prevenir errores
   - Generar tipos autom√°ticamente desde OpenAPI del backend
   - Usar interfaces para estructuras de datos complejas

3. **Sobre Tailwind y shadcn/ui**:
   - shadcn/ui provee componentes reutilizables y personalizables
   - Mantener consistencia en el dise√±o usando variables CSS
   - Aprovechar las utilidades de Tailwind para desarrollo r√°pido

4. **Sobre la comunicaci√≥n Frontend-Backend**:
   - Usar `withCredentials: true` para cookies HttpOnly
   - Configurar CORS apropiadamente en ambos lados
   - Manejar errores de red con interceptors de axios

5. **Sobre contenedores**:
   - Multi-stage builds reducen el tama√±o de la imagen final
   - Usar `standalone` output para optimizar el contenedor
   - Separar variables de entorno para build y runtime

### üé¨ CAP√çTULOS Y TIMESTAMPS ESTIMADOS

- **[00:00 - 03:00]** Introducci√≥n y repaso
- **[03:00 - 08:00]** Instalaci√≥n de Next.js y configuraci√≥n inicial
- **[08:00 - 12:00]** Configuraci√≥n de TypeScript y TailwindCSS
- **[12:00 - 18:00]** Estructura del proyecto y componentes b√°sicos
- **[18:00 - 22:00]** Cliente API y comunicaci√≥n con backend
- **[22:00 - 26:00]** Containerizaci√≥n con Docker/Podman
- **[26:00 - 28:14]** Pruebas y conclusiones

### üîó CONEXI√ìN CON OTROS EPISODIOS

**Depende de**:
- Video 1: Arquitectura general
- Video 2: Backend configurado y funcionando

**Prepara para**:
- Video 4: Refinamiento del Backend
- Videos futuros: Implementaci√≥n de caracter√≠sticas (autenticaci√≥n, WebSockets)

---

## üìπ VIDEO 4: FastAPI y NextJS - Reorganizamos profesionalmente el Backend | Curso App Full Stack #4

### üìä INFORMACI√ìN GENERAL
- **URL**: https://www.youtube.com/watch?v=4c1Tw2rb5cE
- **Duraci√≥n**: 16:14 minutos
- **Vistas**: 142 vistas
- **Publicado**: Hace 2 meses
- **Me gusta**: 10
- **Canal**: C√≥digo para Principiantes (3.78K suscriptores)
- **Hashtags**: #FastAPI #NextJS #PostgreSQL

### üìù DESCRIPCI√ìN
Episodio enfocado en la refactorizaci√≥n profesional del backend, aplicando mejores pr√°cticas de arquitectura y organizaci√≥n del c√≥digo para lograr un proyecto escalable y mantenible.

### üéØ OBJETIVOS DEL VIDEO
- Refactorizar la estructura del proyecto backend
- Implementar arquitectura en capas
- Separar responsabilidades (routers, services, repositories)
- Aplicar patrones de dise√±o profesionales
- Mejorar la inyecci√≥n de dependencias
- Preparar el c√≥digo para escalabilidad

### üîë CONCEPTOS T√âCNICOS PRINCIPALES

#### 1. **Arquitectura en Capas Profesional**

La nueva estructura implementa una arquitectura limpia con separaci√≥n clara de responsabilidades:

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ api/                  # CAPA DE PRESENTACI√ìN
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py          # Dependencias compartidas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ router.py    # Router principal v1
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ endpoints/
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ websocket.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/                 # CONFIGURACI√ìN CENTRAL
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py        # Settings con Pydantic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py      # JWT, hashing, tokens
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py    # Excepciones personalizadas
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ db/                   # CAPA DE PERSISTENCIA
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py          # Base class imports
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session.py       # Session management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ init_db.py       # DB initialization
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/               # MODELOS ORM (SQLAlchemy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ task.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ schemas/              # ESQUEMAS PYDANTIC
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ token.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/             # CAPA DE L√ìGICA DE NEGOCIO
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket_service.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ repositories/         # CAPA DE ACCESO A DATOS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py          # CRUD gen√©rico
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_repo.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ project_repo.py
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                # UTILIDADES
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ helpers.py
‚îÇ
‚îú‚îÄ‚îÄ tests/                    # TESTS
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ repositories/
‚îÇ
‚îú‚îÄ‚îÄ alembic/                  # MIGRACIONES
‚îÇ   ‚îú‚îÄ‚îÄ versions/
‚îÇ   ‚îî‚îÄ‚îÄ env.py
‚îÇ
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ alembic.ini
‚îî‚îÄ‚îÄ Dockerfile
```

#### 2. **Patr√≥n Repository para Acceso a Datos**

**repositories/base.py** - Repositorio gen√©rico con operaciones CRUD:
```python
from typing import TypeVar, Generic, Type, Optional, List
from sqlalchemy.orm import Session
from sqlalchemy import select
from app.db.base import Base

ModelType = TypeVar("ModelType", bound=Base)

class BaseRepository(Generic[ModelType]):
    """
    Repositorio base con operaciones CRUD gen√©ricas
    """
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -> Optional[ModelType]:
        """Obtener por ID"""
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(
        self, 
        db: Session, 
        *, 
        skip: int = 0, 
        limit: int = 100
    ) -> List[ModelType]:
        """Obtener m√∫ltiples registros"""
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def create(self, db: Session, *, obj_in: dict) -> ModelType:
        """Crear nuevo registro"""
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(
        self, 
        db: Session, 
        *, 
        db_obj: ModelType, 
        obj_in: dict
    ) -> ModelType:
        """Actualizar registro existente"""
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -> Optional[ModelType]:
        """Eliminar registro"""
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
```

**repositories/user_repo.py** - Repositorio espec√≠fico de usuarios:
```python
from typing import Optional
from sqlalchemy.orm import Session
from app.models.user import User
from app.repositories.base import BaseRepository

class UserRepository(BaseRepository[User]):
    """
    Repositorio para operaciones de usuarios
    """
    def __init__(self):
        super().__init__(User)
    
    def get_by_email(self, db: Session, *, email: str) -> Optional[User]:
        """Obtener usuario por email"""
        return db.query(User).filter(User.email == email).first()
    
    def get_by_username(self, db: Session, *, username: str) -> Optional[User]:
        """Obtener usuario por username"""
        return db.query(User).filter(User.username == username).first()
    
    def is_active(self, user: User) -> bool:
        """Verificar si usuario est√° activo"""
        return user.is_active
    
    def is_superuser(self, user: User) -> bool:
        """Verificar si usuario es superusuario"""
        return user.is_superuser

# Instancia global del repositorio
user_repository = UserRepository()
```

#### 3. **Capa de Servicios (L√≥gica de Negocio)**

**services/user_service.py**:
```python
from typing import Optional, List
from sqlalchemy.orm import Session
from app.repositories.user_repo import user_repository
from app.schemas.user import UserCreate, UserUpdate
from app.models.user import User
from app.core.security import get_password_hash, verify_password
from app.core.exceptions import UserAlreadyExistsException, UserNotFoundException

class UserService:
    """
    Servicio con l√≥gica de negocio de usuarios
    """
    
    def __init__(self):
        self.repo = user_repository
    
    def create_user(self, db: Session, user_in: UserCreate) -> User:
        """
        Crear nuevo usuario con validaciones de negocio
        """
        # Validar que no exista el email
        existing_user = self.repo.get_by_email(db, email=user_in.email)
        if existing_user:
            raise UserAlreadyExistsException("Email ya registrado")
        
        # Validar que no exista el username
        existing_username = self.repo.get_by_username(db, username=user_in.username)
        if existing_username:
            raise UserAlreadyExistsException("Username ya existe")
        
        # Hash de la contrase√±a
        hashed_password = get_password_hash(user_in.password)
        
        # Crear usuario
        user_data = user_in.dict(exclude={'password'})
        user_data['hashed_password'] = hashed_password
        
        return self.repo.create(db, obj_in=user_data)
    
    def authenticate(
        self, 
        db: Session, 
        *, 
        email: str, 
        password: str
    ) -> Optional[User]:
        """
        Autenticar usuario
        """
        user = self.repo.get_by_email(db, email=email)
        if not user:
            return None
        if not verify_password(password, user.hashed_password):
            return None
        if not self.repo.is_active(user):
            return None
        return user
    
    def get_user(self, db: Session, user_id: int) -> User:
        """
        Obtener usuario por ID
        """
        user = self.repo.get(db, id=user_id)
        if not user:
            raise UserNotFoundException(f"Usuario {user_id} no encontrado")
        return user
    
    def get_users(
        self, 
        db: Session, 
        *, 
        skip: int = 0, 
        limit: int = 100
    ) -> List[User]:
        """
        Obtener lista de usuarios
        """
        return self.repo.get_multi(db, skip=skip, limit=limit)
    
    def update_user(
        self, 
        db: Session, 
        *, 
        user_id: int, 
        user_in: UserUpdate
    ) -> User:
        """
        Actualizar usuario
        """
        user = self.get_user(db, user_id)
        update_data = user_in.dict(exclude_unset=True)
        
        if 'password' in update_data:
            update_data['hashed_password'] = get_password_hash(update_data['password'])
            del update_data['password']
        
        return self.repo.update(db, db_obj=user, obj_in=update_data)

# Instancia global del servicio
user_service = UserService()
```

#### 4. **Excepciones Personalizadas**

**core/exceptions.py**:
```python
from fastapi import HTTPException, status

class BaseAPIException(HTTPException):
    """Excepci√≥n base para la API"""
    def __init__(self, detail: str, status_code: int = status.HTTP_400_BAD_REQUEST):
        super().__init__(status_code=status_code, detail=detail)

class UserAlreadyExistsException(BaseAPIException):
    """Usuario ya existe"""
    def __init__(self, detail: str = "El usuario ya existe"):
        super().__init__(detail=detail, status_code=status.HTTP_409_CONFLICT)

class UserNotFoundException(BaseAPIException):
    """Usuario no encontrado"""
    def __init__(self, detail: str = "Usuario no encontrado"):
        super().__init__(detail=detail, status_code=status.HTTP_404_NOT_FOUND)

class InvalidCredentialsException(BaseAPIException):
    """Credenciales inv√°lidas"""
    def __init__(self, detail: str = "Credenciales inv√°lidas"):
        super().__init__(detail=detail, status_code=status.HTTP_401_UNAUTHORIZED)

class InsufficientPermissionsException(BaseAPIException):
    """Permisos insuficientes"""
    def __init__(self, detail: str = "Permisos insuficientes"):
        super().__init__(detail=detail, status_code=status.HTTP_403_FORBIDDEN)
```

#### 5. **Dependencias Compartidas**

**api/deps.py**:
```python
from typing import Generator, Optional
from fastapi import Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from jose import jwt, JWTError
from sqlalchemy.orm import Session
from app.core.config import settings
from app.db.session import SessionLocal
from app.models.user import User
from app.services.user_service import user_service

# OAuth2 scheme
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login")

def get_db() -> Generator:
    """
    Dependency para obtener sesi√≥n de base de datos
    """
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

async def get_current_user(
    db: Session = Depends(get_db),
    token: str = Depends(oauth2_scheme)
) -> User:
    """
    Dependency para obtener usuario actual desde JWT
    """
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="No se pudo validar las credenciales",
        headers={"WWW-Authenticate": "Bearer"},
    )
    
    try:
        payload = jwt.decode(
            token, 
            settings.SECRET_KEY, 
            algorithms=[settings.ALGORITHM]
        )
        user_id: str = payload.get("sub")
        if user_id is None:
            raise credentials_exception
    except JWTError:
        raise credentials_exception
    
    user = user_service.get_user(db, user_id=int(user_id))
    if user is None:
        raise credentials_exception
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -> User:
    """
    Dependency para verificar que usuario est√© activo
    """
    if not current_user.is_active:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST, 
            detail="Usuario inactivo"
        )
    return current_user

async def get_current_active_superuser(
    current_user: User = Depends(get_current_user),
) -> User:
    """
    Dependency para verificar que usuario sea superusuario
    """
    if not current_user.is_superuser:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="Permisos insuficientes"
        )
    return current_user
```

#### 6. **Endpoints Refactorizados**

**api/v1/endpoints/users.py**:
```python
from typing import List
from fastapi import APIRouter, Depends, status
from sqlalchemy.orm import Session
from app.api import deps
from app.schemas.user import User as UserSchema, UserCreate, UserUpdate
from app.services.user_service import user_service
from app.models.user import User

router = APIRouter()

@router.get("/", response_model=List[UserSchema])
def list_users(
    db: Session = Depends(deps.get_db),
    skip: int = 0,
    limit: int = 100,
    current_user: User = Depends(deps.get_current_active_superuser)
):
    """
    Listar usuarios (solo superusuarios)
    """
    users = user_service.get_users(db, skip=skip, limit=limit)
    return users

@router.get("/me", response_model=UserSchema)
def read_user_me(
    current_user: User = Depends(deps.get_current_active_user),
):
    """
    Obtener usuario actual
    """
    return current_user

@router.get("/{user_id}", response_model=UserSchema)
def read_user(
    user_id: int,
    db: Session = Depends(deps.get_db),
    current_user: User = Depends(deps.get_current_active_user),
):
    """
    Obtener usuario espec√≠fico
    """
    return user_service.get_user(db, user_id=user_id)

@router.put("/{user_id}", response_model=UserSchema)
def update_user(
    user_id: int,
    user_in: UserUpdate,
    db: Session = Depends(deps.get_db),
    current_user: User = Depends(deps.get_current_active_superuser),
):
    """
    Actualizar usuario (solo superusuarios)
    """
    return user_service.update_user(db, user_id=user_id, user_in=user_in)
```

#### 7. **Router Principal Versionado**

**api/v1/router.py**:
```python
from fastapi import APIRouter
from app.api.v1.endpoints import auth, users, websocket

api_router = APIRouter()

# Incluir todos los routers de endpoints
api_router.include_router(
    auth.router, 
    prefix="/auth", 
    tags=["authentication"]
)
api_router.include_router(
    users.router, 
    prefix="/users", 
    tags=["users"]
)
api_router.include_router(
    websocket.router, 
    prefix="/ws", 
    tags=["websocket"]
)
```

**main.py actualizado**:
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api.v1.router import api_router

app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    description="API Full Stack Profesional con FastAPI y Next.js",
    openapi_url=f"/api/v1/openapi.json",
    docs_url="/api/docs",
    redoc_url="/api/redoc"
)

# CORS
origins = [
    "http://localhost:3000",
    "http://frontend:3000",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Incluir router principal
app.include_router(api_router, prefix="/api/v1")

@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "version": settings.VERSION,
        "environment": settings.ENVIRONMENT
    }
```

### üí° TIPS Y OBSERVACIONES DEL INSTRUCTOR

1. **Sobre Arquitectura en Capas**:
   - Cada capa tiene una responsabilidad √∫nica y clara
   - Facilita el testing al poder mockear cada capa independientemente
   - Permite cambiar implementaciones sin afectar otras capas

2. **Sobre el Patr√≥n Repository**:
   - Abstrae la l√≥gica de acceso a datos
   - Facilita el cambio de ORM o base de datos en el futuro
   - Permite reutilizar operaciones CRUD comunes

3. **Sobre la Capa de Servicios**:
   - Contiene toda la l√≥gica de negocio
   - Los endpoints solo orquestan llamadas a servicios
   - Facilita la reutilizaci√≥n de l√≥gica en diferentes endpoints

4. **Sobre Excepciones Personalizadas**:
   - Proporciona mensajes de error consistentes
   - Facilita el manejo centralizado de errores
   - Mejora la experiencia del cliente de la API

5. **Sobre Dependencias**:
   - FastAPI maneja autom√°ticamente la inyecci√≥n de dependencias
   - Permite composici√≥n de dependencias (una depende de otra)
   - Facilita el testing con dependencias mockeadas

### üé¨ CAP√çTULOS Y TIMESTAMPS ESTIMADOS

- **[00:00 - 02:00]** Introducci√≥n y problemas de la estructura anterior
- **[02:00 - 05:00]** Dise√±o de la nueva arquitectura en capas
- **[05:00 - 08:00]** Implementaci√≥n del patr√≥n Repository
- **[08:00 - 11:00]** Creaci√≥n de la capa de servicios
- **[11:00 - 14:00]** Refactorizaci√≥n de endpoints
- **[14:00 - 16:14]** Testing y conclusiones

### üîó CONEXI√ìN CON OTROS EPISODIOS

**Depende de**:
- Video 2: Estructura inicial del backend
- Video 3: Frontend configurado

**Prepara para**:
- Video 5: Creaci√≥n de modelos complejos con relaciones
- Videos futuros: Implementaci√≥n de caracter√≠sticas avanzadas

**Mejoras introducidas**:
- Arquitectura escalable y mantenible
- Separaci√≥n clara de responsabilidades
- C√≥digo m√°s testeable
- Base s√≥lida para crecer el proyecto

---

## üìπ VIDEO 5: FastAPI y NextJS - Creamos los modelos con sus relaciones | Curso App Full Stack #5

### üìä INFORMACI√ìN GENERAL
- **URL**: https://www.youtube.com/watch?v=z1Q8dcP5jWI
- **Duraci√≥n**: 22:06 minutos
- **Vistas**: 221 vistas
- **Publicado**: Hace 2 meses
- **Me gusta**: 15
- **Canal**: C√≥digo para Principiantes (3.78K suscriptores)
- **Hashtags**: #FastAPI #NextJS #PostgreSQL

### üìù DESCRIPCI√ìN
Episodio dedicado al modelado completo de la base de datos, implementando modelos SQLAlchemy con relaciones complejas entre entidades, aplicando las mejores pr√°cticas de dise√±o de bases de datos relacionales.

### üéØ OBJETIVOS DEL VIDEO
- Dise√±ar el esquema completo de la base de datos
- Crear modelos SQLAlchemy con relaciones
- Implementar diferentes tipos de relaciones (1:1, 1:N, N:M)
- Configurar cascadas y comportamientos de eliminaci√≥n
- Crear migraciones con Alembic
- Implementar esquemas Pydantic correspondientes

### üîë CONCEPTOS T√âCNICOS PRINCIPALES

#### 1. **Dise√±o del Esquema de Base de Datos**

**Entidades principales del sistema**:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    User      ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ id (PK)      ‚îÇ
‚îÇ username     ‚îÇ
‚îÇ email        ‚îÇ
‚îÇ password_hash‚îÇ
‚îÇ is_active    ‚îÇ
‚îÇ is_superuser ‚îÇ
‚îÇ created_at   ‚îÇ
‚îÇ updated_at   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ 1:N (un usuario, muchos proyectos)
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Project    ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ id (PK)      ‚îÇ
‚îÇ name         ‚îÇ
‚îÇ description  ‚îÇ
‚îÇ owner_id (FK)‚îÇ
‚îÇ is_active    ‚îÇ
‚îÇ created_at   ‚îÇ
‚îÇ updated_at   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ 1:N (un proyecto, muchas tareas)
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Task      ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ id (PK)      ‚îÇ
‚îÇ title        ‚îÇ
‚îÇ description  ‚îÇ
‚îÇ status       ‚îÇ
‚îÇ priority     ‚îÇ
‚îÇ project_id   ‚îÇ
‚îÇ assigned_to  ‚îÇ
‚îÇ created_at   ‚îÇ
‚îÇ updated_at   ‚îÇ
‚îÇ due_date     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ N:M (muchas tareas, muchos tags)
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   TaskTag    ‚îÇ       ‚îÇ     Tag      ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ task_id (FK) ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ id (PK)      ‚îÇ
‚îÇ tag_id (FK)  ‚îÇ       ‚îÇ name         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ color        ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 2. **Modelo Base con Timestamps**

**models/base.py**:
```python
from datetime import datetime
from sqlalchemy import Column, Integer, DateTime
from sqlalchemy.ext.declarative import declared_attr
from app.db.base import Base

class TimestampMixin:
    """
    Mixin para agregar timestamps autom√°ticos
    """
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(
        DateTime, 
        default=datetime.utcnow, 
        onupdate=datetime.utcnow, 
        nullable=False
    )

class BaseModel(Base, TimestampMixin):
    """
    Clase base para todos los modelos
    """
    __abstract__ = True
    
    id = Column(Integer, primary_key=True, index=True, autoincrement=True)
    
    @declared_attr
    def __tablename__(cls) -> str:
        """Generar nombre de tabla autom√°ticamente"""
        return cls.__name__.lower()
```

#### 3. **Modelo de Usuario**

**models/user.py**:
```python
from sqlalchemy import Boolean, Column, String
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class User(BaseModel):
    """
    Modelo de usuario del sistema
    """
    __tablename__ = "users"
    
    # Campos b√°sicos
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(255), unique=True, index=True, nullable=False)
    full_name = Column(String(100), nullable=True)
    hashed_password = Column(String(255), nullable=False)
    
    # Estados
    is_active = Column(Boolean, default=True)
    is_superuser = Column(Boolean, default=False)
    is_verified = Column(Boolean, default=False)
    
    # Relaciones
    projects = relationship(
        "Project", 
        back_populates="owner",
        cascade="all, delete-orphan",  # Eliminar proyectos si se elimina usuario
        lazy="dynamic"  # Carga bajo demanda
    )
    
    assigned_tasks = relationship(
        "Task",
        back_populates="assignee",
        foreign_keys="[Task.assigned_to_id]",
        lazy="dynamic"
    )
    
    def __repr__(self):
        return f"<User(id={self.id}, username='{self.username}', email='{self.email}')>"
```

**Esquema Pydantic correspondiente (schemas/user.py)**:
```python
from typing import Optional
from datetime import datetime
from pydantic import BaseModel, EmailStr, Field

class UserBase(BaseModel):
    """Schema base de usuario"""
    email: EmailStr
    username: str = Field(..., min_length=3, max_length=50)
    full_name: Optional[str] = Field(None, max_length=100)
    is_active: bool = True

class UserCreate(UserBase):
    """Schema para crear usuario"""
    password: str = Field(..., min_length=8, max_length=100)

class UserUpdate(BaseModel):
    """Schema para actualizar usuario"""
    email: Optional[EmailStr] = None
    username: Optional[str] = Field(None, min_length=3, max_length=50)
    full_name: Optional[str] = Field(None, max_length=100)
    password: Optional[str] = Field(None, min_length=8, max_length=100)
    is_active: Optional[bool] = None

class User(UserBase):
    """Schema de respuesta de usuario"""
    id: int
    is_superuser: bool
    is_verified: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True  # Antes orm_mode = True

class UserInDB(User):
    """Schema de usuario en DB (incluye hash)"""
    hashed_password: str
```

#### 4. **Modelo de Proyecto con Relaci√≥n 1:N**

**models/project.py**:
```python
from sqlalchemy import Boolean, Column, String, Text, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class Project(BaseModel):
    """
    Modelo de proyecto
    Relaci√≥n 1:N con User (un usuario, muchos proyectos)
    Relaci√≥n 1:N con Task (un proyecto, muchas tareas)
    """
    __tablename__ = "projects"
    
    # Campos b√°sicos
    name = Column(String(100), nullable=False, index=True)
    description = Column(Text, nullable=True)
    is_active = Column(Boolean, default=True)
    
    # Foreign Keys
    owner_id = Column(
        Integer, 
        ForeignKey("users.id", ondelete="CASCADE"),
        nullable=False,
        index=True
    )
    
    # Relaciones
    owner = relationship(
        "User", 
        back_populates="projects"
    )
    
    tasks = relationship(
        "Task",
        back_populates="project",
        cascade="all, delete-orphan",  # Eliminar tareas si se elimina proyecto
        lazy="dynamic"
    )
    
    def __repr__(self):
        return f"<Project(id={self.id}, name='{self.name}', owner_id={self.owner_id})>"
```

**Esquema Pydantic (schemas/project.py)**:
```python
from typing import Optional, List
from datetime import datetime
from pydantic import BaseModel, Field

class ProjectBase(BaseModel):
    """Schema base de proyecto"""
    name: str = Field(..., min_length=1, max_length=100)
    description: Optional[str] = None
    is_active: bool = True

class ProjectCreate(ProjectBase):
    """Schema para crear proyecto"""
    pass

class ProjectUpdate(BaseModel):
    """Schema para actualizar proyecto"""
    name: Optional[str] = Field(None, min_length=1, max_length=100)
    description: Optional[str] = None
    is_active: Optional[bool] = None

class Project(ProjectBase):
    """Schema de respuesta de proyecto"""
    id: int
    owner_id: int
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class ProjectWithOwner(Project):
    """Schema de proyecto con informaci√≥n del owner"""
    from app.schemas.user import User
    owner: User

class ProjectWithTasks(Project):
    """Schema de proyecto con tareas"""
    from app.schemas.task import Task
    tasks: List[Task] = []
```

#### 5. **Modelo de Tarea con Relaciones M√∫ltiples**

**models/task.py**:
```python
from sqlalchemy import (
    Column, String, Text, Integer, 
    ForeignKey, Enum, Date
)
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel

class TaskStatus(str, enum.Enum):
    """Estados posibles de una tarea"""
    TODO = "todo"
    IN_PROGRESS = "in_progress"
    IN_REVIEW = "in_review"
    DONE = "done"
    CANCELLED = "cancelled"

class TaskPriority(str, enum.Enum):
    """Prioridades de tarea"""
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    URGENT = "urgent"

class Task(BaseModel):
    """
    Modelo de tarea
    """
    __tablename__ = "tasks"
    
    # Campos b√°sicos
    title = Column(String(200), nullable=False, index=True)
    description = Column(Text, nullable=True)
    status = Column(
        Enum(TaskStatus), 
        default=TaskStatus.TODO, 
        nullable=False,
        index=True
    )
    priority = Column(
        Enum(TaskPriority), 
        default=TaskPriority.MEDIUM, 
        nullable=False
    )
    due_date = Column(Date, nullable=True)
    
    # Foreign Keys
    project_id = Column(
        Integer,
        ForeignKey("projects.id", ondelete="CASCADE"),
        nullable=False,
        index=True
    )
    
    assigned_to_id = Column(
        Integer,
        ForeignKey("users.id", ondelete="SET NULL"),
        nullable=True,
        index=True
    )
    
    # Relaciones
    project = relationship(
        "Project",
        back_populates="tasks"
    )
    
    assignee = relationship(
        "User",
        back_populates="assigned_tasks",
        foreign_keys=[assigned_to_id]
    )
    
    tags = relationship(
        "Tag",
        secondary="task_tags",  # Tabla intermedia para N:M
        back_populates="tasks",
        lazy="dynamic"
    )
    
    def __repr__(self):
        return f"<Task(id={self.id}, title='{self.title}', status='{self.status}')>"
```

**Esquema Pydantic (schemas/task.py)**:
```python
from typing import Optional, List
from datetime import datetime, date
from pydantic import BaseModel, Field
from app.models.task import TaskStatus, TaskPriority

class TaskBase(BaseModel):
    """Schema base de tarea"""
    title: str = Field(..., min_length=1, max_length=200)
    description: Optional[str] = None
    status: TaskStatus = TaskStatus.TODO
    priority: TaskPriority = TaskPriority.MEDIUM
    due_date: Optional[date] = None

class TaskCreate(TaskBase):
    """Schema para crear tarea"""
    project_id: int
    assigned_to_id: Optional[int] = None

class TaskUpdate(BaseModel):
    """Schema para actualizar tarea"""
    title: Optional[str] = Field(None, min_length=1, max_length=200)
    description: Optional[str] = None
    status: Optional[TaskStatus] = None
    priority: Optional[TaskPriority] = None
    due_date: Optional[date] = None
    assigned_to_id: Optional[int] = None

class Task(TaskBase):
    """Schema de respuesta de tarea"""
    id: int
    project_id: int
    assigned_to_id: Optional[int]
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class TaskWithRelations(Task):
    """Schema de tarea con relaciones"""
    from app.schemas.user import User
    from app.schemas.project import Project
    from app.schemas.tag import Tag
    
    project: Project
    assignee: Optional[User] = None
    tags: List[Tag] = []
```

#### 6. **Relaci√≥n N:M con Tags**

**models/tag.py**:
```python
from sqlalchemy import Column, String, Integer, ForeignKey, Table
from sqlalchemy.orm import relationship
from app.models.base import BaseModel, Base

# Tabla intermedia para relaci√≥n N:M entre Task y Tag
task_tags = Table(
    'task_tags',
    Base.metadata,
    Column('task_id', Integer, ForeignKey('tasks.id', ondelete="CASCADE"), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete="CASCADE"), primary_key=True)
)

class Tag(BaseModel):
    """
    Modelo de etiqueta/tag
    Relaci√≥n N:M con Task
    """
    __tablename__ = "tags"
    
    name = Column(String(50), unique=True, nullable=False, index=True)
    color = Column(String(7), default="#808080")  # Color hexadecimal
    
    # Relaci√≥n N:M con tasks
    tasks = relationship(
        "Task",
        secondary=task_tags,
        back_populates="tags",
        lazy="dynamic"
    )
    
    def __repr__(self):
        return f"<Tag(id={self.id}, name='{self.name}')>"
```

**Esquema Pydantic (schemas/tag.py)**:
```python
from typing import Optional
from datetime import datetime
from pydantic import BaseModel, Field

class TagBase(BaseModel):
    """Schema base de tag"""
    name: str = Field(..., min_length=1, max_length=50)
    color: str = Field(default="#808080", regex=r"^#[0-9A-Fa-f]{6}$")

class TagCreate(TagBase):
    """Schema para crear tag"""
    pass

class TagUpdate(BaseModel):
    """Schema para actualizar tag"""
    name: Optional[str] = Field(None, min_length=1, max_length=50)
    color: Optional[str] = Field(None, regex=r"^#[0-9A-Fa-f]{6}$")

class Tag(TagBase):
    """Schema de respuesta de tag"""
    id: int
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True
```

#### 7. **Configuraci√≥n de Migraciones con Alembic**

**Inicializar Alembic**:
```bash
# Inicializar Alembic
alembic init alembic

# Esto crea:
# - alembic/
# - alembic.ini
```

**Configurar alembic/env.py**:
```python
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context
from app.core.config import settings
from app.db.base import Base
# Importar todos los modelos para que Alembic los detecte
from app.models import user, project, task, tag

# Configuraci√≥n de Alembic
config = context.config

# Configurar URL de la base de datos
config.set_main_option("sqlalchemy.url", settings.DATABASE_URL)

# Interpretar config file para logging
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# Metadata para autogenerar migraciones
target_metadata = Base.metadata

def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode."""
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()

def run_migrations_online() -> None:
    """Run migrations in 'online' mode."""
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, 
            target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
```

**Comandos de Alembic**:
```bash
# Crear migraci√≥n autom√°tica
alembic revision --autogenerate -m "Create users, projects, tasks and tags tables"

# Aplicar migraciones
alembic upgrade head

# Ver historial de migraciones
alembic history

# Revertir √∫ltima migraci√≥n
alembic downgrade -1

# Ver SQL sin ejecutar
alembic upgrade head --sql

# Crear migraci√≥n vac√≠a
alembic revision -m "Add custom changes"
```

#### 8. **Ejemplo de Migraci√≥n Generada**

**alembic/versions/001_create_initial_tables.py**:
```python
"""Create users, projects, tasks and tags tables

Revision ID: 001
Revises: 
Create Date: 2024-01-XX
"""
from alembic import op
import sqlalchemy as sa

# revision identifiers
revision = '001'
down_revision = None
branch_labels = None
depends_on = None

def upgrade() -> None:
    # Crear tabla users
    op.create_table(
        'users',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('username', sa.String(length=50), nullable=False),
        sa.Column('email', sa.String(length=255), nullable=False),
        sa.Column('full_name', sa.String(length=100), nullable=True),
        sa.Column('hashed_password', sa.String(length=255), nullable=False),
        sa.Column('is_active', sa.Boolean(), nullable=True),
        sa.Column('is_superuser', sa.Boolean(), nullable=True),
        sa.Column('is_verified', sa.Boolean(), nullable=True),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_users_email'), 'users', ['email'], unique=True)
    op.create_index(op.f('ix_users_username'), 'users', ['username'], unique=True)
    op.create_index(op.f('ix_users_id'), 'users', ['id'], unique=False)
    
    # Crear tabla projects
    op.create_table(
        'projects',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('name', sa.String(length=100), nullable=False),
        sa.Column('description', sa.Text(), nullable=True),
        sa.Column('is_active', sa.Boolean(), nullable=True),
        sa.Column('owner_id', sa.Integer(), nullable=False),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_projects_id'), 'projects', ['id'], unique=False)
    op.create_index(op.f('ix_projects_name'), 'projects', ['name'], unique=False)
    op.create_index(op.f('ix_projects_owner_id'), 'projects', ['owner_id'], unique=False)
    
    # Crear tabla tags
    op.create_table(
        'tags',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('name', sa.String(length=50), nullable=False),
        sa.Column('color', sa.String(length=7), nullable=True),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.PrimaryKeyConstraint('id'),
        sa.UniqueConstraint('name')
    )
    op.create_index(op.f('ix_tags_id'), 'tags', ['id'], unique=False)
    op.create_index(op.f('ix_tags_name'), 'tags', ['name'], unique=True)
    
    # Crear tabla tasks
    op.create_table(
        'tasks',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('title', sa.String(length=200), nullable=False),
        sa.Column('description', sa.Text(), nullable=True),
        sa.Column('status', sa.Enum('TODO', 'IN_PROGRESS', 'IN_REVIEW', 'DONE', 'CANCELLED', name='taskstatus'), nullable=False),
        sa.Column('priority', sa.Enum('LOW', 'MEDIUM', 'HIGH', 'URGENT', name='taskpriority'), nullable=False),
        sa.Column('due_date', sa.Date(), nullable=True),
        sa.Column('project_id', sa.Integer(), nullable=False),
        sa.Column('assigned_to_id', sa.Integer(), nullable=True),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.ForeignKeyConstraint(['assigned_to_id'], ['users.id'], ondelete='SET NULL'),
        sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_tasks_id'), 'tasks', ['id'], unique=False)
    op.create_index(op.f('ix_tasks_title'), 'tasks', ['title'], unique=False)
    op.create_index(op.f('ix_tasks_status'), 'tasks', ['status'], unique=False)
    op.create_index(op.f('ix_tasks_project_id'), 'tasks', ['project_id'], unique=False)
    op.create_index(op.f('ix_tasks_assigned_to_id'), 'tasks', ['assigned_to_id'], unique=False)
    
    # Crear tabla intermedia task_tags
    op.create_table(
        'task_tags',
        sa.Column('task_id', sa.Integer(), nullable=False),
        sa.Column('tag_id', sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(['tag_id'], ['tags.id'], ondelete='CASCADE'),
        sa.ForeignKeyConstraint(['task_id'], ['tasks.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('task_id', 'tag_id')
    )

def downgrade() -> None:
    op.drop_table('task_tags')
    op.drop_index(op.f('ix_tasks_assigned_to_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_project_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_status'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_title'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_id'), table_name='tasks')
    op.drop_table('tasks')
    op.drop_index(op.f('ix_tags_name'), table_name='tags')
    op.drop_index(op.f('ix_tags_id'), table_name='tags')
    op.drop_table('tags')
    op.drop_index(op.f('ix_projects_owner_id'), table_name='projects')
    op.drop_index(op.f('ix_projects_name'), table_name='projects')
    op.drop_index(op.f('ix_projects_id'), table_name='projects')
    op.drop_table('projects')
    op.drop_index(op.f('ix_users_username'), table_name='users')
    op.drop_index(op.f('ix_users_id'), table_name='users')
    op.drop_index(op.f('ix_users_email'), table_name='users')
    op.drop_table('users')
```

### üí° TIPS Y OBSERVACIONES DEL INSTRUCTOR

1. **Sobre Relaciones SQLAlchemy**:
   - `back_populates` crea relaciones bidireccionales autom√°ticas
   - `cascade="all, delete-orphan"` elimina registros hu√©rfanos autom√°ticamente
   - `lazy="dynamic"` devuelve una query en lugar de cargar todos los datos
   - `ondelete="CASCADE"` o `"SET NULL"` define comportamiento a nivel de BD

2. **Sobre Foreign Keys**:
   - Siempre indexar foreign keys para mejor rendimiento
   - Definir expl√≠citamente el comportamiento `ondelete`
   - Usar nombres descriptivos para las columnas FK

3. **Sobre Enums**:
   - SQLAlchemy Enums proporcionan validaci√≥n a nivel de BD
   - Usar `str, enum.Enum` para compatibilidad con Pydantic
   - Los enums mejoran la integridad de datos

4. **Sobre Timestamps**:
   - Usar `default=datetime.utcnow` (sin par√©ntesis) para llamada lazy
   - `onupdate` actualiza autom√°ticamente el campo en cada UPDATE
   - Siempre trabajar con UTC en el backend

5. **Sobre Migraciones**:
   - Revisar siempre las migraciones autogeneradas antes de aplicarlas
   - Usar mensajes descriptivos para las migraciones
   - Mantener orden cronol√≥gico claro en las versiones
   - Probar migraciones en entorno de desarrollo primero

6. **Sobre Pydantic Schemas**:
   - Separar schemas de creaci√≥n, actualizaci√≥n y respuesta
   - Usar `Optional` para campos que pueden no estar presentes en updates
   - `from_attributes = True` permite crear schemas desde modelos ORM
   - Validaciones de Pydantic complementan las de SQLAlchemy

### üé¨ CAP√çTULOS Y TIMESTAMPS ESTIMADOS

- **[00:00 - 03:00]** Introducci√≥n y dise√±o del esquema
- **[03:00 - 07:00]** Modelo base y timestamps
- **[07:00 - 10:00]** Modelo de usuario y sus relaciones
- **[10:00 - 14:00]** Modelos de proyecto y tarea
- **[14:00 - 17:00]** Relaci√≥n N:M con tags
- **[17:00 - 20:00]** Configuraci√≥n de Alembic y migraciones
- **[20:00 - 22:06]** Pruebas y conclusiones

### üîó CONEXI√ìN CON OTROS EPISODIOS

**Depende de**:
- Video 2: Configuraci√≥n inicial de SQLAlchemy
- Video 4: Arquitectura en capas profesional

**Prepara para**:
- Implementaci√≥n de CRUD completo para todas las entidades
- Endpoints de API para cada modelo
- Implementaci√≥n de WebSockets con datos reales
- Autenticaci√≥n y autorizaci√≥n con roles

**Fundamentos establecidos**:
- Esquema completo de base de datos
- Relaciones entre entidades
- Sistema de migraciones
- Validaci√≥n de datos con Pydantic

---

## üìä RESUMEN GENERAL DE LA SERIE

### Duraci√≥n Total
- **Video 1**: 10:13 min
- **Video 2**: 43:31 min
- **Video 3**: 28:14 min
- **Video 4**: 16:14 min
- **Video 5**: 22:06 min
- **TOTAL**: ~2 horas (120 minutos)

### Progresi√≥n del Curso
1. **Episodio 1**: Visi√≥n general y arquitectura
2. **Episodio 2**: Backend inicial (el m√°s extenso)
3. **Episodio 3**: Frontend con Next.js
4. **Episodio 4**: Refactorizaci√≥n profesional
5. **Episodio 5**: Modelado de datos completo

### Stack Tecnol√≥gico Completo
- **Backend**: FastAPI + SQLAlchemy + Alembic + Pydantic
- **Frontend**: Next.js + TypeScript + TailwindCSS + shadcn/ui
- **Base de Datos**: PostgreSQL
- **Contenedorizaci√≥n**: Podman/Docker
- **Autenticaci√≥n**: JWT con cookies HttpOnly
- **Comunicaci√≥n en Tiempo Real**: WebSockets

### Conceptos Avanzados Cubiertos
‚úÖ Arquitectura en capas
‚úÖ Patr√≥n Repository
‚úÖ Inyecci√≥n de dependencias
‚úÖ Relaciones de base de datos (1:1, 1:N, N:M)
‚úÖ Migraciones de base de datos
‚úÖ Validaci√≥n con Pydantic
‚úÖ Contenedorizaci√≥n multi-servicio
‚úÖ Type safety end-to-end

---

*Fin del Documento 1*

## --------------------------------------------------

---

## DOCUMENTO 2: DOCUMENTACI√ìN T√âCNICA CONSOLIDADA
# DOCUMENTO 2: DOCUMENTACI√ìN T√âCNICA CONSOLIDADA
## Tutorial Completo: Aplicaci√≥n Full Stack con FastAPI y Next.js
### De la serie "C√≥digo para Principiantes"

---

## üìã TABLA DE CONTENIDOS

1. [Introducci√≥n al Proyecto Completo](#1-introducci√≥n-al-proyecto-completo)
2. [Arquitectura General de la Aplicaci√≥n](#2-arquitectura-general-de-la-aplicaci√≥n)
3. [Configuraci√≥n del Entorno](#3-configuraci√≥n-del-entorno)
4. [Estructura Profesional del Proyecto](#4-estructura-profesional-del-proyecto)
5. [Backend con FastAPI](#5-backend-con-fastapi)
6. [Frontend con Next.js](#6-frontend-con-nextjs)
7. [Modelos y Relaciones de Datos](#7-modelos-y-relaciones-de-datos)
8. [Implementaci√≥n de WebSockets](#8-implementaci√≥n-de-websockets)
9. [Autenticaci√≥n y Seguridad](#9-autenticaci√≥n-y-seguridad)
10. [Mejores Pr√°cticas Aplicadas](#10-mejores-pr√°cticas-aplicadas)
11. [Referencias Cruzadas entre Episodios](#11-referencias-cruzadas-entre-episodios)

---

## 1. INTRODUCCI√ìN AL PROYECTO COMPLETO

### 1.1 Visi√≥n General

Este proyecto es una aplicaci√≥n Full Stack profesional que combina las tecnolog√≠as m√°s modernas del desarrollo web:

- **Backend**: FastAPI (Python) - Framework as√≠ncrono de alto rendimiento
- **Frontend**: Next.js (React + TypeScript) - Framework con SSR y optimizaci√≥n autom√°tica
- **Base de Datos**: PostgreSQL - Sistema de gesti√≥n de bases de datos relacional robusto
- **Contenedorizaci√≥n**: Podman/Docker - Entornos consistentes y portables

**Caracter√≠sticas Principales**:
- ‚úÖ API RESTful completa con documentaci√≥n autom√°tica
- ‚úÖ Comunicaci√≥n en tiempo real con WebSockets
- ‚úÖ Autenticaci√≥n segura con JWT y cookies HttpOnly
- ‚úÖ Arquitectura escalable y profesional
- ‚úÖ Type safety end-to-end (Python type hints + TypeScript)
- ‚úÖ Sistema completo de gesti√≥n de proyectos y tareas

### 1.2 Objetivos del Tutorial

Al completar este tutorial, habr√°s construido:
- Una API REST completa con FastAPI
- Una aplicaci√≥n frontend moderna con Next.js
- Sistema de autenticaci√≥n robusto
- Base de datos relacional con modelos complejos
- Comunicaci√≥n en tiempo real con WebSockets
- Aplicaci√≥n completamente contenerizada

### 1.3 Requisitos Previos

**Conocimientos necesarios**:
- Python intermedio (3.11+)
- JavaScript/TypeScript b√°sico
- Conceptos de bases de datos relacionales
- Comandos b√°sicos de terminal
- Fundamentos de HTTP/REST APIs

**Software requerido**:
- Python 3.11 o superior
- Node.js 20 o superior
- PostgreSQL 15 o superior
- Docker/Podman
- Editor de c√≥digo (VS Code recomendado)

### 1.4 ¬øPor qu√© este Stack?

**FastAPI**:
- Rendimiento comparable a Node.js y Go
- Validaci√≥n autom√°tica de datos con Pydantic
- Documentaci√≥n interactiva autom√°tica (Swagger/Redoc)
- Soporte nativo para async/await
- Type hints para c√≥digo m√°s seguro

**Next.js**:
- Server-Side Rendering para mejor SEO
- Enrutamiento autom√°tico basado en archivos
- Optimizaci√≥n autom√°tica de im√°genes y c√≥digo
- Excelente experiencia de desarrollo
- Integraci√≥n perfecta con React

**PostgreSQL**:
- Base de datos relacional robusta y confiable
- Soporte completo para transacciones ACID
- Extensibilidad y rendimiento probado
- Amplia comunidad y documentaci√≥n

**Podman/Docker**:
- Entornos consistentes entre desarrollo y producci√≥n
- F√°cil escalabilidad horizontal
- Aislamiento de dependencias
- Simplifica despliegue

---

## 2. ARQUITECTURA GENERAL DE LA APLICACI√ìN

### 2.1 Diagrama de Arquitectura Completa

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CLIENTE (NAVEGADOR)                       ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ              NEXT.JS FRONTEND (Puerto 3000)                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ React Components                                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ TypeScript                                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ TailwindCSS + shadcn/ui                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Client API (axios)                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ WebSocket Client                                       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ HTTP/HTTPS
                            ‚îÇ WebSocket (ws/wss)
                            ‚îÇ JWT en Cookies
                            ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   FASTAPI BACKEND (Puerto 8000)                  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                    CAPA DE API (Routers)                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Endpoints REST (/api/v1/...)                            ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ WebSocket handlers (/ws)                                ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Validaci√≥n de entrada (Pydantic)                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Serializaci√≥n de respuestas                             ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                            ‚îÇ                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              CAPA DE SERVICIOS (Business Logic)           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ AuthService - L√≥gica de autenticaci√≥n                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ UserService - Gesti√≥n de usuarios                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ ProjectService - L√≥gica de proyectos                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ WebSocketService - Gesti√≥n de conexiones              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                            ‚îÇ                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ           CAPA DE REPOSITORIOS (Data Access)              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ CRUD gen√©rico (BaseRepository)                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ UserRepository                                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ ProjectRepository                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ TaskRepository                                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                            ‚îÇ                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                  CAPA DE MODELOS (ORM)                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ SQLAlchemy Models                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Definici√≥n de tablas y relaciones                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ User, Project, Task, Tag                              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ SQLAlchemy
                            ‚îÇ Alembic (migraciones)
                            ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  POSTGRESQL (Puerto 5432)                         ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚Ä¢ Base de datos relacional                                      ‚îÇ
‚îÇ  ‚Ä¢ Tablas: users, projects, tasks, tags, task_tags             ‚îÇ
‚îÇ  ‚Ä¢ √çndices, constraints, foreign keys                           ‚îÇ
‚îÇ  ‚Ä¢ Persistencia de datos                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CONTENEDORES (Docker/Podman)                   ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  [Frontend Container] ‚Üê‚Üí [Backend Container] ‚Üê‚Üí [DB Container]  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Network: fullstack_network                                      ‚îÇ
‚îÇ  Volumes: postgres_data                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.2 Flujo de Datos

#### Flujo de Autenticaci√≥n
```
1. Usuario ‚Üí Frontend: Ingresa credenciales
2. Frontend ‚Üí Backend: POST /api/v1/auth/login
3. Backend: Valida credenciales con UserService
4. Backend: Genera JWT con informaci√≥n del usuario
5. Backend ‚Üí Frontend: Set-Cookie con JWT (HttpOnly, Secure)
6. Frontend: Almacena estado de autenticaci√≥n
7. Para requests siguientes: Cookie enviada autom√°ticamente
```

#### Flujo de Operaci√≥n CRUD
```
1. Frontend: Usuario interact√∫a con UI
2. Frontend: Validaci√≥n local (Zod/react-hook-form)
3. Frontend ‚Üí Backend: HTTP request con JWT en cookie
4. Backend API Layer: Extrae y valida JWT
5. Backend API Layer: Valida datos de entrada (Pydantic)
6. Backend Service Layer: Ejecuta l√≥gica de negocio
7. Backend Repository Layer: Operaci√≥n en base de datos
8. PostgreSQL: Ejecuta query y retorna datos
9. Repository ‚Üí Service ‚Üí API: Propaga respuesta
10. Backend ‚Üí Frontend: Respuesta JSON serializada
11. Frontend: Actualiza UI y estado
```

#### Flujo de WebSocket
```
1. Frontend: Establece conexi√≥n WebSocket
2. Backend: Acepta conexi√≥n y valida autenticaci√≥n
3. Backend: Agrega cliente a ConnectionManager
4. Evento en el sistema: Cambio de estado
5. Backend: Broadcast mensaje a clientes conectados
6. Frontend: Recibe mensaje y actualiza UI en tiempo real
7. Al desconectar: Backend limpia recursos
```

### 2.3 Patrones de Arquitectura Aplicados

#### Clean Architecture (Arquitectura Limpia)
- **Capa Externa**: API endpoints y WebSocket handlers
- **Capa de Aplicaci√≥n**: Servicios con l√≥gica de negocio
- **Capa de Dominio**: Modelos y entidades
- **Capa de Infraestructura**: Repositorios y base de datos

#### Repository Pattern
- Abstracci√≥n del acceso a datos
- CRUD gen√©rico reutilizable
- Facilita testing con mocks
- Desacopla l√≥gica de negocio de persistencia

#### Service Layer Pattern
- Contiene l√≥gica de negocio
- Coordina entre repositorios
- Transacciones y validaciones complejas
- Reutilizaci√≥n de l√≥gica

#### Dependency Injection
- FastAPI gestiona dependencias autom√°ticamente
- Facilita testing y modularidad
- Permite composici√≥n de dependencias
- Mejora mantenibilidad del c√≥digo

---

## 3. CONFIGURACI√ìN DEL ENTORNO

### 3.1 Instalaci√≥n de Herramientas Base

#### Python 3.11+
```bash
# Verificar instalaci√≥n
python --version  # Debe ser 3.11 o superior

# Linux (Ubuntu/Debian)
sudo apt update
sudo apt install python3.11 python3.11-venv python3-pip

# macOS (con Homebrew)
brew install python@3.11

# Windows: Descargar desde python.org
```

#### Node.js 20+
```bash
# Verificar instalaci√≥n
node --version  # Debe ser 20 o superior

# Linux (usando nvm - recomendado)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# macOS (con Homebrew)
brew install node@20

# Windows: Descargar desde nodejs.org
```

#### PostgreSQL 15+
```bash
# Verificar instalaci√≥n
psql --version

# Linux (Ubuntu/Debian)
sudo apt install postgresql postgresql-contrib

# macOS (con Homebrew)
brew install postgresql@15

# Windows: Descargar desde postgresql.org

# Iniciar servicio
sudo systemctl start postgresql  # Linux
brew services start postgresql   # macOS
```

#### Docker/Podman
```bash
# Docker (Linux)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Podman (alternativa sin daemon)
# Linux (Ubuntu/Debian)
sudo apt install podman podman-compose

# macOS
brew install podman
```

### 3.2 Estructura de Directorios del Proyecto

```
fullstack-fastapi-nextjs/
‚îÇ
‚îú‚îÄ‚îÄ backend/                      # Aplicaci√≥n FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ router.py
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ endpoints/
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ projects.py
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ tasks.py
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ websocket.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ init_db.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tag.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tag.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ token.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_repo.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project_repo.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ task_repo.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ helpers.py
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conftest.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/
‚îÇ   ‚îú‚îÄ‚îÄ alembic/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ versions/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env.py
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îú‚îÄ‚îÄ .env.example
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ frontend/                     # Aplicaci√≥n Next.js
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (protected)/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ projects/
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/              # shadcn/ui components
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Navigation.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ forms/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LoginForm.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ RegisterForm.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ProjectForm.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TaskForm.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts           # Cliente API
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts          # L√≥gica de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts         # Utilidades
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useWebSocket.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useApi.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts           # Tipos TypeScript
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ globals.css
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ .env.local
‚îÇ   ‚îú‚îÄ‚îÄ .env.example
‚îÇ   ‚îú‚îÄ‚îÄ next.config.js
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.ts
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml            # Orquestaci√≥n de contenedores
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

### 3.3 Configuraci√≥n del Backend (FastAPI)

#### Crear entorno virtual y instalar dependencias
```bash
# Navegar al directorio backend
cd fullstack-fastapi-nextjs/backend

# Crear entorno virtual
python -m venv venv

# Activar entorno virtual
# Linux/macOS:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# Instalar dependencias
pip install -r requirements.txt
```

#### requirements.txt
```txt
# FastAPI y servidor ASGI
fastapi==0.109.0
uvicorn[standard]==0.27.0

# Base de datos y ORM
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
alembic==1.13.1

# Validaci√≥n y serializaci√≥n
pydantic==2.5.3
pydantic-settings==2.1.0
pydantic[email]==2.5.3

# Autenticaci√≥n y seguridad
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# CORS y middleware
python-dotenv==1.0.0

# WebSockets
websockets==12.0

# Testing
pytest==7.4.4
pytest-asyncio==0.23.3
httpx==0.26.0

# Utilidades
python-dateutil==2.8.2
```

#### Configuraci√≥n de variables de entorno (.env)
```env
# Application
APP_NAME="FastAPI Full Stack"
VERSION="1.0.0"
DEBUG=True
ENVIRONMENT="development"

# Database
DATABASE_URL=postgresql://fastapi_user:SecurePassword123!@localhost:5432/fullstack_db

# Security
SECRET_KEY=09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS
ALLOWED_ORIGINS=["http://localhost:3000","http://frontend:3000"]

# Server
HOST=0.0.0.0
PORT=8000
RELOAD=True
```

#### Generar SECRET_KEY seguro
```bash
# Python
python -c "import secrets; print(secrets.token_urlsafe(32))"

# OpenSSL
openssl rand -hex 32
```

#### Configurar PostgreSQL
```bash
# Conectar a PostgreSQL
sudo -u postgres psql

# Crear usuario y base de datos
CREATE USER fastapi_user WITH PASSWORD 'SecurePassword123!';
CREATE DATABASE fullstack_db OWNER fastapi_user;
GRANT ALL PRIVILEGES ON DATABASE fullstack_db TO fastapi_user;

# Salir
\q
```

### 3.4 Configuraci√≥n del Frontend (Next.js)

#### Crear proyecto e instalar dependencias
```bash
# Navegar al directorio del proyecto
cd fullstack-fastapi-nextjs

# Crear aplicaci√≥n Next.js
npx create-next-app@latest frontend --typescript --tailwind --app --src-dir

# Navegar a frontend
cd frontend

# Instalar dependencias adicionales
npm install axios react-hook-form zod @hookform/resolvers
npm install openapi-fetch openapi-typescript

# Instalar shadcn/ui
npx shadcn-ui@latest init

# Instalar componentes espec√≠ficos
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add card
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add form
npx shadcn-ui@latest add label
npx shadcn-ui@latest add select
npx shadcn-ui@latest add toast
```

#### Variables de entorno (.env.local)
```env
# API Backend
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws

# Application
NEXT_PUBLIC_APP_NAME="FastAPI Full Stack"
NEXT_PUBLIC_APP_VERSION="1.0.0"
```

### 3.5 Configuraci√≥n de Docker/Podman

#### docker-compose.yml completo
```yaml
version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: SecurePassword123!
      POSTGRES_DB: fullstack_db
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - fullstack_network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U fastapi_user -d fullstack_db"]
      interval: 10s
      timeout: 5s
      retries: 5

  # FastAPI Backend
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: fullstack_backend
    restart: unless-stopped
    env_file:
      - ./backend/.env
    environment:
      - DATABASE_URL=postgresql://fastapi_user:SecurePassword123!@postgres:5432/fullstack_db
    volumes:
      - ./backend/app:/app/app
      - ./backend/alembic:/app/alembic
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - fullstack_network
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # Next.js Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: http://backend:8000/api/v1
        NEXT_PUBLIC_WS_URL: ws://backend:8000/ws
    container_name: fullstack_frontend
    restart: unless-stopped
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
      - NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - /app/node_modules
      - /app/.next
    ports:
      - "3000:3000"
    depends_on:
      - backend
    networks:
      - fullstack_network

networks:
  fullstack_network:
    driver: bridge

volumes:
  postgres_data:
    driver: local
```

#### Comandos Docker/Podman esenciales
```bash
# Construir im√°genes
docker-compose build

# Levantar servicios
docker-compose up -d

# Ver logs
docker-compose logs -f
docker-compose logs -f backend
docker-compose logs -f frontend

# Detener servicios
docker-compose stop

# Detener y eliminar contenedores
docker-compose down

# Eliminar incluyendo vol√∫menes
docker-compose down -v

# Reconstruir sin cach√©
docker-compose build --no-cache

# Ejecutar comandos en contenedor
docker-compose exec backend bash
docker-compose exec backend alembic upgrade head

# Ver estado de contenedores
docker-compose ps

# Reiniciar servicio espec√≠fico
docker-compose restart backend
```

### 3.6 Verificaci√≥n de la Instalaci√≥n

#### Verificar Backend
```bash
# Activar entorno virtual
source backend/venv/bin/activate

# Ejecutar servidor
cd backend
uvicorn app.main:app --reload

# Verificar en navegador:
# http://localhost:8000/health
# http://localhost:8000/docs (Swagger UI)
# http://localhost:8000/redoc (ReDoc)
```

#### Verificar Frontend
```bash
# Ejecutar servidor de desarrollo
cd frontend
npm run dev

# Verificar en navegador:
# http://localhost:3000
```

#### Verificar PostgreSQL
```bash
# Conectar a la base de datos
psql -U fastapi_user -d fullstack_db -h localhost

# Verificar tablas (despu√©s de migraciones)
\dt

# Salir
\q
```

---

## 4. ESTRUCTURA PROFESIONAL DEL PROYECTO

### 4.1 Organizaci√≥n del Backend

#### Principios de Organizaci√≥n
1. **Separaci√≥n de Responsabilidades**: Cada m√≥dulo tiene una funci√≥n espec√≠fica
2. **Modularidad**: C√≥digo organizado en paquetes reutilizables
3. **Escalabilidad**: F√°cil agregar nuevas caracter√≠sticas
4. **Testabilidad**: Estructura facilita pruebas unitarias
5. **Mantenibilidad**: C√≥digo claro y bien documentado

#### Descripci√≥n de M√≥dulos

**`app/main.py`** - Punto de entrada
- Crea instancia de FastAPI
- Configura middleware (CORS, etc.)
- Incluye routers
- Define eventos de startup/shutdown
- Configura documentaci√≥n

**`app/core/`** - Configuraci√≥n central
- `config.py`: Settings con Pydantic
- `security.py`: JWT, hashing, autenticaci√≥n
- `exceptions.py`: Excepciones personalizadas

**`app/api/`** - Capa de presentaci√≥n
- `deps.py`: Dependencias compartidas
- `v1/router.py`: Router principal versionado
- `v1/endpoints/`: Endpoints espec√≠ficos

**`app/services/`** - L√≥gica de negocio
- Coordina operaciones complejas
- Valida reglas de negocio
- Orquesta entre repositorios
- Maneja transacciones

**`app/repositories/`** - Acceso a datos
- CRUD gen√©rico (base.py)
- Operaciones espec√≠ficas por entidad
- Abstrae SQLAlchemy
- Facilita testing con mocks

**`app/models/`** - Modelos ORM
- Definici√≥n de tablas con SQLAlchemy
- Relaciones entre entidades
- Constraints e √≠ndices

**`app/schemas/`** - Esquemas Pydantic
- Validaci√≥n de entrada/salida
- Serializaci√≥n autom√°tica
- Documentaci√≥n de API

**`app/db/`** - Configuraci√≥n de BD
- Conexi√≥n a PostgreSQL
- Session management
- Inicializaci√≥n de BD

### 4.2 Organizaci√≥n del Frontend

#### Principios de Organizaci√≥n
1. **Component-Based**: Todo es un componente reutilizable
2. **Type Safety**: TypeScript en todo el c√≥digo
3. **Separation of Concerns**: L√≥gica separada de presentaci√≥n
4. **Performance**: Server Components por defecto
5. **Accessibility**: Componentes accesibles (a11y)

#### Descripci√≥n de M√≥dulos

**`src/app/`** - Rutas de la aplicaci√≥n
- Next.js App Router
- Grupos de rutas: (auth), (protected)
- Layouts compartidos
- P√°ginas espec√≠ficas

**`src/components/`** - Componentes React
- `ui/`: Componentes de shadcn/ui
- `layout/`: Header, Footer, Sidebar
- `forms/`: Formularios espec√≠ficos

**`src/lib/`** - Librer√≠as y utilidades
- `api.ts`: Cliente HTTP (axios)
- `auth.ts`: L√≥gica de autenticaci√≥n
- `utils.ts`: Funciones auxiliares

**`src/hooks/`** - React Hooks personalizados
- `useAuth`: Gesti√≥n de autenticaci√≥n
- `useWebSocket`: Conexi√≥n WebSocket
- `useApi`: Llamadas a API

**`src/types/`** - Definiciones TypeScript
- Interfaces compartidas
- Tipos del API

### 4.3 Convenciones de Nomenclatura

#### Backend (Python)
```python
# Archivos y m√≥dulos: snake_case
user_service.py
auth_service.py

# Clases: PascalCase
class UserService:
class ProjectRepository:

# Funciones y variables: snake_case
def get_current_user():
user_id = 123

# Constantes: UPPER_SNAKE_CASE
SECRET_KEY = "..."
MAX_UPLOAD_SIZE = 10485760

# Modelos SQLAlchemy: PascalCase
class User(Base):
class Project(Base):

# Esquemas Pydantic: PascalCase
class UserCreate(BaseModel):
class UserResponse(BaseModel):
```

#### Frontend (TypeScript)
```typescript
// Archivos de componentes: PascalCase
UserProfile.tsx
LoginForm.tsx

// Archivos de utilidades: camelCase
api.ts
auth.ts

// Componentes: PascalCase
function UserProfile() {}
const LoginForm: React.FC = () => {}

// Funciones y variables: camelCase
const getUserData = () => {}
const userId = 123

// Constantes: UPPER_SNAKE_CASE
const API_URL = "..."
const MAX_RETRIES = 3

// Tipos e Interfaces: PascalCase
interface User {}
type ApiResponse<T> = {}

// Enums: PascalCase
enum TaskStatus {}
```

---

## 5. BACKEND CON FASTAPI

### 5.1 Aplicaci√≥n Principal (main.py)

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api.v1.router import api_router
from app.db.session import engine
from app.db.base import Base

# Crear instancia de FastAPI
app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    description="API Full Stack Profesional con FastAPI y Next.js",
    openapi_url=f"/api/v1/openapi.json",
    docs_url="/api/docs",
    redoc_url="/api/redoc",
    swagger_ui_parameters={"persistAuthorization": True}
)

# Configurar CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
    expose_headers=["*"]
)

# Incluir routers
app.include_router(api_router, prefix="/api/v1")

# Health check endpoint
@app.get("/health", tags=["health"])
async def health_check():
    """Endpoint de health check"""
    return {
        "status": "healthy",
        "version": settings.VERSION,
        "environment": settings.ENVIRONMENT
    }

# Eventos de ciclo de vida
@app.on_event("startup")
async def startup_event():
    """Ejecutar al iniciar la aplicaci√≥n"""
    print(f"üöÄ {settings.APP_NAME} v{settings.VERSION} iniciado")
    print(f"üìö Documentaci√≥n: http://{settings.HOST}:{settings.PORT}/api/docs")
    print(f"üîß Entorno: {settings.ENVIRONMENT}")

@app.on_event("shutdown")
async def shutdown_event():
    """Ejecutar al cerrar la aplicaci√≥n"""
    print("üëã Cerrando aplicaci√≥n...")
```

### 5.2 Configuraci√≥n (core/config.py)

```python
from typing import List
from pydantic_settings import BaseSettings, SettingsConfigDict
from pydantic import AnyHttpUrl, field_validator

class Settings(BaseSettings):
    """Configuraci√≥n de la aplicaci√≥n"""
    
    # Application
    APP_NAME: str
    VERSION: str = "1.0.0"
    DEBUG: bool = False
    ENVIRONMENT: str = "development"
    
    # Server
    HOST: str = "0.0.0.0"
    PORT: int = 8000
    RELOAD: bool = False
    
    # Database
    DATABASE_URL: str
    
    # Security
    SECRET_KEY: str
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # CORS
    ALLOWED_ORIGINS: List[AnyHttpUrl] = []
    
    @field_validator("ALLOWED_ORIGINS", mode="before")
    @classmethod
    def parse_origins(cls, v):
        if isinstance(v, str):
            return [i.strip() for i in v.split(",")]
        return v
    
    model_config = SettingsConfigDict(
        env_file=".env",
        case_sensitive=True,
        extra="ignore"
    )

# Instancia global de settings
settings = Settings()
```

### 5.3 Seguridad (core/security.py)

```python
from datetime import datetime, timedelta
from typing import Optional
from jose import jwt, JWTError
from passlib.context import CryptContext
from app.core.config import settings

# Configurar bcrypt para hashing de contrase√±as
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """Verificar contrase√±a con hash"""
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """Generar hash de contrase√±a"""
    return pwd_context.hash(password)

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -> str:
    """Crear JWT access token"""
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    
    to_encode.update({"exp": expire, "iat": datetime.utcnow()})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def create_refresh_token(data: dict) -> str:
    """Crear JWT refresh token"""
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)
    to_encode.update({"exp": expire, "iat": datetime.utcnow(), "type": "refresh"})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def decode_token(token: str) -> Optional[dict]:
    """Decodificar y validar JWT"""
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        return payload
    except JWTError:
        return None
```

### 5.4 Dependencias (api/deps.py)

```python
from typing import Generator, Optional
from fastapi import Depends, HTTPException, status, Cookie
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from app.core.config import settings
from app.core.security import decode_token
from app.db.session import SessionLocal
from app.models.user import User
from app.services.user_service import user_service

# OAuth2 scheme
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login", auto_error=False)

def get_db() -> Generator:
    """
    Dependency para obtener sesi√≥n de base de datos
    """
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

async def get_current_user(
    db: Session = Depends(get_db),
    token: Optional[str] = Depends(oauth2_scheme),
    access_token: Optional[str] = Cookie(None)
) -> User:
    """
    Dependency para obtener usuario actual desde JWT
    Prioriza cookie sobre header Authorization
    """
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="No se pudo validar las credenciales",
        headers={"WWW-Authenticate": "Bearer"},
    )
    
    # Priorizar token de cookie
    token_to_decode = access_token or token
    
    if not token_to_decode:
        raise credentials_exception
    
    payload = decode_token(token_to_decode)
    if payload is None:
        raise credentials_exception
    
    user_id: str = payload.get("sub")
    if user_id is None:
        raise credentials_exception
    
    user = user_service.get_user(db, user_id=int(user_id))
    if user is None:
        raise credentials_exception
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -> User:
    """
    Dependency para verificar que usuario est√© activo
    """
    if not current_user.is_active:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST, 
            detail="Usuario inactivo"
        )
    return current_user

async def get_current_active_superuser(
    current_user: User = Depends(get_current_user),
) -> User:
    """
    Dependency para verificar que usuario sea superusuario
    """
    if not current_user.is_superuser:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="Permisos insuficientes"
        )
    return current_user
```

### 5.5 Repositorio Base (repositories/base.py)

```python
from typing import TypeVar, Generic, Type, Optional, List, Any
from sqlalchemy.orm import Session
from sqlalchemy import select, update, delete
from app.db.base import Base

ModelType = TypeVar("ModelType", bound=Base)

class BaseRepository(Generic[ModelType]):
    """
    Repositorio base con operaciones CRUD gen√©ricas
    """
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -> Optional[ModelType]:
        """Obtener por ID"""
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(
        self, 
        db: Session, 
        *, 
        skip: int = 0, 
        limit: int = 100
    ) -> List[ModelType]:
        """Obtener m√∫ltiples registros"""
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def get_by_field(
        self,
        db: Session,
        *,
        field_name: str,
        value: Any
    ) -> Optional[ModelType]:
        """Obtener por campo espec√≠fico"""
        return db.query(self.model).filter(
            getattr(self.model, field_name) == value
        ).first()
    
    def create(self, db: Session, *, obj_in: dict) -> ModelType:
        """Crear nuevo registro"""
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(
        self, 
        db: Session, 
        *, 
        db_obj: ModelType, 
        obj_in: dict
    ) -> ModelType:
        """Actualizar registro existente"""
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -> Optional[ModelType]:
        """Eliminar registro"""
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
    
    def count(self, db: Session) -> int:
        """Contar registros"""
        return db.query(self.model).count()
```

### 5.6 Endpoints de Autenticaci√≥n (api/v1/endpoints/auth.py)

```python
from datetime import timedelta
from fastapi import APIRouter, Depends, HTTPException, status, Response
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session
from app.api import deps
from app.core.config import settings
from app.core.security import create_access_token, create_refresh_token
from app.schemas.user import UserCreate, User as UserSchema
from app.schemas.token import Token
from app.services.auth_service import auth_service

router = APIRouter()

@router.post("/register", response_model=UserSchema, status_code=status.HTTP_201_CREATED)
def register(
    *,
    db: Session = Depends(deps.get_db),
    user_in: UserCreate
):
    """
    Registrar nuevo usuario
    """
    user = auth_service.register_user(db, user_in=user_in)
    return user

@router.post("/login", response_model=Token)
def login(
    *,
    db: Session = Depends(deps.get_db),
    form_data: OAuth2PasswordRequestForm = Depends(),
    response: Response
):
    """
    Login de usuario con OAuth2 password flow
    """
    user = auth_service.authenticate(
        db, 
        email=form_data.username,  # OAuth2 usa "username"
        password=form_data.password
    )
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Email o contrase√±a incorrectos",
            headers={"WWW-Authenticate": "Bearer"},
        )
    
    # Crear tokens
    access_token = create_access_token(data={"sub": str(user.id)})
    refresh_token = create_refresh_token(data={"sub": str(user.id)})
    
    # Configurar cookies
    response.set_cookie(
        key="access_token",
        value=access_token,
        httponly=True,
        secure=not settings.DEBUG,  # HTTPS en producci√≥n
        samesite="strict",
        max_age=settings.ACCESS_TOKEN_EXPIRE_MINUTES * 60
    )
    
    response.set_cookie(
        key="refresh_token",
        value=refresh_token,
        httponly=True,
        secure=not settings.DEBUG,
        samesite="strict",
        max_age=settings.REFRESH_TOKEN_EXPIRE_DAYS * 24 * 60 * 60
    )
    
    return {
        "access_token": access_token,
        "refresh_token": refresh_token,
        "token_type": "bearer"
    }

@router.post("/logout")
def logout(response: Response):
    """
    Logout - eliminar cookies
    """
    response.delete_cookie(key="access_token")
    response.delete_cookie(key="refresh_token")
    return {"message": "Logout exitoso"}

@router.get("/me", response_model=UserSchema)
def read_users_me(
    current_user: User = Depends(deps.get_current_active_user),
):
    """
    Obtener usuario actual
    """
    return current_user
```

---

*(Contin√∫a en la siguiente parte debido al l√≠mite de caracteres...)*

---

## 6. FRONTEND CON NEXT.JS

### 6.1 Cliente API (lib/api.ts)

```typescript
import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';

// Configuraci√≥n base de axios
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1',
  timeout: 10000,
  withCredentials: true, // Enviar cookies autom√°ticamente
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para requests
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    // Logs en desarrollo
    if (process.env.NODE_ENV === 'development') {
      console.log(`üì° ${config.method?.toUpperCase()} ${config.url}`);
    }
    return config;
  },
  (error: AxiosError) => {
    return Promise.reject(error);
  }
);

// Interceptor para responses
apiClient.interceptors.response.use(
  (response) => {
    // Logs en desarrollo
    if (process.env.NODE_ENV === 'development') {
      console.log(`‚úÖ ${response.status} ${response.config.url}`);
    }
    return response;
  },
  async (error: AxiosError) => {
    const originalRequest = error.config;
    
    // Redirigir a login si 401
    if (error.response?.status === 401 && typeof window !== 'undefined') {
      window.location.href = '/login';
    }
    
    // Logs de error
    if (process.env.NODE_ENV === 'development') {
      console.error(`‚ùå ${error.response?.status} ${error.config?.url}`, error.response?.data);
    }
    
    return Promise.reject(error);
  }
);

// API functions
export const api = {
  // Auth
  auth: {
    login: async (email: string, password: string) => {
      const formData = new FormData();
      formData.append('username', email); // OAuth2 usa "username"
      formData.append('password', password);
      
      const response = await apiClient.post('/auth/login', formData, {
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
      });
      return response.data;
    },
    
    register: async (userData: any) => {
      const response = await apiClient.post('/auth/register', userData);
      return response.data;
    },
    
    logout: async () => {
      const response = await apiClient.post('/auth/logout');
      return response.data;
    },
    
    getCurrentUser: async () => {
      const response = await apiClient.get('/auth/me');
      return response.data;
    },
  },
  
  // Users
  users: {
    list: async (skip: number = 0, limit: number = 100) => {
      const response = await apiClient.get('/users/', { params: { skip, limit } });
      return response.data;
    },
    
    get: async (userId: number) => {
      const response = await apiClient.get(`/users/${userId}`);
      return response.data;
    },
    
    update: async (userId: number, userData: any) => {
      const response = await apiClient.put(`/users/${userId}`, userData);
      return response.data;
    },
  },
  
  // Projects
  projects: {
    list: async (skip: number = 0, limit: number = 100) => {
      const response = await apiClient.get('/projects/', { params: { skip, limit } });
      return response.data;
    },
    
    get: async (projectId: number) => {
      const response = await apiClient.get(`/projects/${projectId}`);
      return response.data;
    },
    
    create: async (projectData: any) => {
      const response = await apiClient.post('/projects/', projectData);
      return response.data;
    },
    
    update: async (projectId: number, projectData: any) => {
      const response = await apiClient.put(`/projects/${projectId}`, projectData);
      return response.data;
    },
    
    delete: async (projectId: number) => {
      const response = await apiClient.delete(`/projects/${projectId}`);
      return response.data;
    },
  },
  
  // Tasks
  tasks: {
    list: async (projectId?: number, skip: number = 0, limit: number = 100) => {
      const response = await apiClient.get('/tasks/', { 
        params: { project_id: projectId, skip, limit } 
      });
      return response.data;
    },
    
    get: async (taskId: number) => {
      const response = await apiClient.get(`/tasks/${taskId}`);
      return response.data;
    },
    
    create: async (taskData: any) => {
      const response = await apiClient.post('/tasks/', taskData);
      return response.data;
    },
    
    update: async (taskId: number, taskData: any) => {
      const response = await apiClient.put(`/tasks/${taskId}`, taskData);
      return response.data;
    },
    
    delete: async (taskId: number) => {
      const response = await apiClient.delete(`/tasks/${taskId}`);
      return response.data;
    },
  },
};

export default apiClient;
```

### 6.2 Hook de Autenticaci√≥n (hooks/useAuth.ts)

```typescript
import { useState, useEffect, useCallback } from 'react';
import { api } from '@/lib/api';

interface User {
  id: number;
  username: string;
  email: string;
  full_name: string | null;
  is_active: boolean;
  is_superuser: boolean;
}

interface AuthState {
  user: User | null;
  isLoading: boolean;
  isAuthenticated: boolean;
}

export function useAuth() {
  const [authState, setAuthState] = useState<AuthState>({
    user: null,
    isLoading: true,
    isAuthenticated: false,
  });

  // Cargar usuario actual al montar
  useEffect(() => {
    loadUser();
  }, []);

  const loadUser = async () => {
    try {
      const user = await api.auth.getCurrentUser();
      setAuthState({
        user,
        isLoading: false,
        isAuthenticated: true,
      });
    } catch (error) {
      setAuthState({
        user: null,
        isLoading: false,
        isAuthenticated: false,
      });
    }
  };

  const login = useCallback(async (email: string, password: string) => {
    try {
      await api.auth.login(email, password);
      await loadUser();
      return { success: true };
    } catch (error: any) {
      return {
        success: false,
        error: error.response?.data?.detail || 'Error al iniciar sesi√≥n',
      };
    }
  }, []);

  const register = useCallback(async (userData: any) => {
    try {
      await api.auth.register(userData);
      return { success: true };
    } catch (error: any) {
      return {
        success: false,
        error: error.response?.data?.detail || 'Error al registrarse',
      };
    }
  }, []);

  const logout = useCallback(async () => {
    try {
      await api.auth.logout();
      setAuthState({
        user: null,
        isLoading: false,
        isAuthenticated: false,
      });
      // Redirigir a login
      if (typeof window !== 'undefined') {
        window.location.href = '/login';
      }
    } catch (error) {
      console.error('Error al cerrar sesi√≥n:', error);
    }
  }, []);

  return {
    user: authState.user,
    isLoading: authState.isLoading,
    isAuthenticated: authState.isAuthenticated,
    login,
    register,
    logout,
    reload: loadUser,
  };
}
```

---

## 7. MODELOS Y RELACIONES DE DATOS

### 7.1 Diagrama Entidad-Relaci√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      ESQUEMA DE BASE DE DATOS                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      USER        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ id (PK)        ‚îÇ
‚îÇ ‚Ä¢ username (UQ)  ‚îÇ
‚îÇ ‚Ä¢ email (UQ)     ‚îÇ
‚îÇ ‚Ä¢ full_name      ‚îÇ
‚îÇ ‚Ä¢ hashed_password‚îÇ
‚îÇ ‚Ä¢ is_active      ‚îÇ
‚îÇ ‚Ä¢ is_superuser   ‚îÇ
‚îÇ ‚Ä¢ is_verified    ‚îÇ
‚îÇ ‚Ä¢ created_at     ‚îÇ
‚îÇ ‚Ä¢ updated_at     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ 1
        ‚îÇ owns
        ‚îÇ N
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     PROJECT      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ id (PK)        ‚îÇ
‚îÇ ‚Ä¢ name           ‚îÇ
‚îÇ ‚Ä¢ description    ‚îÇ
‚îÇ ‚Ä¢ is_active      ‚îÇ
‚îÇ ‚Ä¢ owner_id (FK)  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ created_at     ‚îÇ      ‚îÇ references
‚îÇ ‚Ä¢ updated_at     ‚îÇ      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
        ‚îÇ 1               ‚îÇ
        ‚îÇ contains        ‚îÇ
        ‚îÇ N               ‚îÇ
        ‚ñº                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ      TASK        ‚îÇ      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§      ‚îÇ
‚îÇ ‚Ä¢ id (PK)        ‚îÇ      ‚îÇ
‚îÇ ‚Ä¢ title          ‚îÇ      ‚îÇ
‚îÇ ‚Ä¢ description    ‚îÇ      ‚îÇ
‚îÇ ‚Ä¢ status         ‚îÇ      ‚îÇ
‚îÇ ‚Ä¢ priority       ‚îÇ      ‚îÇ
‚îÇ ‚Ä¢ due_date       ‚îÇ      ‚îÇ
‚îÇ ‚Ä¢ project_id (FK)‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ ‚Ä¢ assigned_to_id ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ created_at     ‚îÇ     ‚îÇ references USER
‚îÇ ‚Ä¢ updated_at     ‚îÇ     ‚îÇ (optional)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
        ‚îÇ N               ‚îÇ
        ‚îÇ tagged with     ‚îÇ
        ‚îÇ M               ‚ñº
        ‚ñº              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    (implicit)    ‚îÇ
‚îÇ    TASK_TAG      ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  (junction table)‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ task_id (FK,PK)‚îÇ
‚îÇ ‚Ä¢ tag_id (FK,PK) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ M
        ‚îÇ references
        ‚îÇ 1
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       TAG        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ id (PK)        ‚îÇ
‚îÇ ‚Ä¢ name (UQ)      ‚îÇ
‚îÇ ‚Ä¢ color          ‚îÇ
‚îÇ ‚Ä¢ created_at     ‚îÇ
‚îÇ ‚Ä¢ updated_at     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

LEYENDA:
PK  = Primary Key
FK  = Foreign Key
UQ  = Unique Constraint
1   = Relaci√≥n uno
N   = Relaci√≥n muchos
M   = Relaci√≥n muchos (en N:M)
```

### 7.2 Tipos de Relaciones Implementadas

#### Relaci√≥n 1:N (Uno a Muchos)
**User ‚Üí Projects**
- Un usuario puede tener m√∫ltiples proyectos
- Cada proyecto pertenece a un √∫nico usuario (owner)
- Cascade: Al eliminar usuario, se eliminan sus proyectos

**Project ‚Üí Tasks**
- Un proyecto contiene m√∫ltiples tareas
- Cada tarea pertenece a un √∫nico proyecto
- Cascade: Al eliminar proyecto, se eliminan sus tareas

#### Relaci√≥n N:1 (Muchos a Uno - Opcional)
**Task ‚Üí User (assigned_to)**
- Una tarea puede estar asignada a un usuario (o ninguno)
- Un usuario puede tener m√∫ltiples tareas asignadas
- ON DELETE SET NULL: Al eliminar usuario, las tareas quedan sin asignar

#### Relaci√≥n N:M (Muchos a Muchos)
**Task ‚Üî Tag**
- Una tarea puede tener m√∫ltiples tags
- Un tag puede estar en m√∫ltiples tareas
- Tabla intermedia: task_tags
- Cascade en ambas direcciones

### 7.3 C√≥digo de Modelos Completo

Ya documentado en la secci√≥n del DOCUMENTO 1 (Video 5).

---

## 8. IMPLEMENTACI√ìN DE WEBSOCKETS

### 8.1 Conceptos de WebSockets

**¬øQu√© son los WebSockets?**
- Protocolo de comunicaci√≥n bidireccional full-duplex
- Conexi√≥n persistente entre cliente y servidor
- Ideal para aplicaciones en tiempo real
- Baja latencia comparado con polling HTTP

**Casos de uso en este proyecto**:
- Notificaciones de cambios en proyectos/tareas
- Actualizaciones en tiempo real del dashboard
- Chat o mensajer√≠a entre usuarios
- Sincronizaci√≥n de estado entre clientes

### 8.2 Backend: WebSocket Manager

**services/websocket_service.py**:
```python
from typing import Set, Dict
from fastapi import WebSocket, WebSocketDisconnect
import json
from datetime import datetime

class ConnectionManager:
    """
    Gestor de conexiones WebSocket
    """
    def __init__(self):
        # Almacenar conexiones activas por user_id
        self.active_connections: Dict[int, Set[WebSocket]] = {}
    
    async def connect(self, websocket: WebSocket, user_id: int):
        """Conectar cliente WebSocket"""
        await websocket.accept()
        
        if user_id not in self.active_connections:
            self.active_connections[user_id] = set()
        
        self.active_connections[user_id].add(websocket)
        print(f"‚úÖ Usuario {user_id} conectado. Total conexiones: {self.get_connection_count()}")
    
    def disconnect(self, websocket: WebSocket, user_id: int):
        """Desconectar cliente WebSocket"""
        if user_id in self.active_connections:
            self.active_connections[user_id].discard(websocket)
            
            # Limpiar si no hay m√°s conexiones
            if not self.active_connections[user_id]:
                del self.active_connections[user_id]
        
        print(f"‚ùå Usuario {user_id} desconectado. Total conexiones: {self.get_connection_count()}")
    
    async def send_personal_message(self, message: dict, user_id: int):
        """Enviar mensaje a un usuario espec√≠fico"""
        if user_id in self.active_connections:
            message_json = json.dumps(message)
            for connection in list(self.active_connections[user_id]):
                try:
                    await connection.send_text(message_json)
                except Exception as e:
                    print(f"Error enviando mensaje a usuario {user_id}: {e}")
                    self.disconnect(connection, user_id)
    
    async def broadcast(self, message: dict, exclude_user: int = None):
        """
        Broadcast mensaje a todos los usuarios conectados
        Opcionalmente excluir un usuario espec√≠fico
        """
        message_json = json.dumps(message)
        
        for user_id, connections in list(self.active_connections.items()):
            if exclude_user and user_id == exclude_user:
                continue
            
            for connection in list(connections):
                try:
                    await connection.send_text(message_json)
                except Exception as e:
                    print(f"Error en broadcast a usuario {user_id}: {e}")
                    self.disconnect(connection, user_id)
    
    async def broadcast_to_project_members(self, message: dict, project_id: int, db):
        """
        Broadcast a usuarios de un proyecto espec√≠fico
        """
        # Aqu√≠ implementar√≠as l√≥gica para obtener miembros del proyecto
        # y enviar solo a ellos
        pass
    
    def get_connection_count(self) -> int:
        """Obtener n√∫mero total de conexiones"""
        return sum(len(connections) for connections in self.active_connections.values())
    
    def get_connected_users(self) -> list:
        """Obtener lista de user_ids conectados"""
        return list(self.active_connections.keys())

# Instancia global del manager
websocket_manager = ConnectionManager()
```

**Endpoint WebSocket (api/v1/endpoints/websocket.py)**:
```python
from fastapi import APIRouter, WebSocket, WebSocketDisconnect, Depends
from sqlalchemy.orm import Session
from app.api import deps
from app.services.websocket_service import websocket_manager
from app.core.security import decode_token
import json

router = APIRouter()

@router.websocket("/ws/{token}")
async def websocket_endpoint(
    websocket: WebSocket,
    token: str,
    db: Session = Depends(deps.get_db)
):
    """
    Endpoint WebSocket para comunicaci√≥n en tiempo real
    
    Cliente debe proveer token JWT en la URL
    """
    # Validar token
    payload = decode_token(token)
    if not payload:
        await websocket.close(code=1008)  # Policy violation
        return
    
    user_id = int(payload.get("sub"))
    
    # Conectar
    await websocket_manager.connect(websocket, user_id)
    
    try:
        # Enviar mensaje de bienvenida
        await websocket.send_json({
            "type": "connection",
            "message": "Conectado exitosamente",
            "user_id": user_id,
            "timestamp": datetime.utcnow().isoformat()
        })
        
        # Loop para recibir mensajes
        while True:
            # Recibir mensaje del cliente
            data = await websocket.receive_text()
            message_data = json.loads(data)
            
            # Procesar seg√∫n tipo de mensaje
            message_type = message_data.get("type")
            
            if message_type == "ping":
                # Responder pong
                await websocket.send_json({
                    "type": "pong",
                    "timestamp": datetime.utcnow().isoformat()
                })
            
            elif message_type == "broadcast":
                # Broadcast a todos
                await websocket_manager.broadcast({
                    "type": "message",
                    "user_id": user_id,
                    "content": message_data.get("content"),
                    "timestamp": datetime.utcnow().isoformat()
                })
            
            elif message_type == "notification":
                # Aqu√≠ se manejar√≠an notificaciones espec√≠ficas
                pass
    
    except WebSocketDisconnect:
        websocket_manager.disconnect(websocket, user_id)
    except Exception as e:
        print(f"Error en WebSocket para usuario {user_id}: {e}")
        websocket_manager.disconnect(websocket, user_id)
```

### 8.3 Frontend: Hook de WebSocket

**hooks/useWebSocket.ts**:
```typescript
import { useEffect, useRef, useState, useCallback } from 'react';

interface WebSocketMessage {
  type: string;
  [key: string]: any;
}

interface UseWebSocketOptions {
  onMessage?: (message: WebSocketMessage) => void;
  onOpen?: () => void;
  onClose?: () => void;
  onError?: (error: Event) => void;
  reconnectInterval?: number;
  maxReconnectAttempts?: number;
}

export function useWebSocket(token: string | null, options: UseWebSocketOptions = {}) {
  const {
    onMessage,
    onOpen,
    onClose,
    onError,
    reconnectInterval = 3000,
    maxReconnectAttempts = 5,
  } = options;

  const [isConnected, setIsConnected] = useState(false);
  const [reconnectCount, setReconnectCount] = useState(0);
  const ws = useRef<WebSocket | null>(null);
  const reconnectTimer = useRef<NodeJS.Timeout | null>(null);

  const connect = useCallback(() => {
    if (!token || ws.current?.readyState === WebSocket.OPEN) {
      return;
    }

    const wsUrl = `${process.env.NEXT_PUBLIC_WS_URL}/${token}`;
    console.log('üîå Conectando WebSocket...');
    
    ws.current = new WebSocket(wsUrl);

    ws.current.onopen = () => {
      console.log('‚úÖ WebSocket conectado');
      setIsConnected(true);
      setReconnectCount(0);
      onOpen?.();
    };

    ws.current.onmessage = (event) => {
      try {
        const message: WebSocketMessage = JSON.parse(event.data);
        console.log('üì® Mensaje recibido:', message);
        onMessage?.(message);
      } catch (error) {
        console.error('Error parseando mensaje:', error);
      }
    };

    ws.current.onclose = () => {
      console.log('üîå WebSocket desconectado');
      setIsConnected(false);
      onClose?.();

      // Intentar reconectar
      if (reconnectCount < maxReconnectAttempts) {
        reconnectTimer.current = setTimeout(() => {
          console.log(`üîÑ Intentando reconectar (${reconnectCount + 1}/${maxReconnectAttempts})...`);
          setReconnectCount(prev => prev + 1);
          connect();
        }, reconnectInterval);
      }
    };

    ws.current.onerror = (error) => {
      console.error('‚ùå Error en WebSocket:', error);
      onError?.(error);
    };
  }, [token, reconnectCount, onMessage, onOpen, onClose, onError, reconnectInterval, maxReconnectAttempts]);

  // Conectar al montar o cuando cambie el token
  useEffect(() => {
    connect();

    // Cleanup al desmontar
    return () => {
      if (reconnectTimer.current) {
        clearTimeout(reconnectTimer.current);
      }
      if (ws.current) {
        ws.current.close();
      }
    };
  }, [connect]);

  // Funci√≥n para enviar mensajes
  const sendMessage = useCallback((message: WebSocketMessage) => {
    if (ws.current?.readyState === WebSocket.OPEN) {
      ws.current.send(JSON.stringify(message));
      console.log('üì§ Mensaje enviado:', message);
    } else {
      console.warn('‚ö†Ô∏è WebSocket no est√° conectado');
    }
  }, []);

  // Funci√≥n para cerrar manualmente
  const disconnect = useCallback(() => {
    if (reconnectTimer.current) {
      clearTimeout(reconnectTimer.current);
    }
    ws.current?.close();
  }, []);

  // Heartbeat (ping/pong)
  useEffect(() => {
    if (!isConnected) return;

    const pingInterval = setInterval(() => {
      sendMessage({ type: 'ping' });
    }, 30000); // cada 30 segundos

    return () => clearInterval(pingInterval);
  }, [isConnected, sendMessage]);

  return {
    isConnected,
    sendMessage,
    disconnect,
    reconnect: connect,
  };
}
```

### 8.4 Uso en Componentes

**Ejemplo de uso en Dashboard**:
```typescript
'use client';

import { useAuth } from '@/hooks/useAuth';
import { useWebSocket } from '@/hooks/useWebSocket';
import { useEffect, useState } from 'react';
import { toast } from '@/components/ui/use-toast';

export default function Dashboard() {
  const { user } = useAuth();
  const [notifications, setNotifications] = useState<any[]>([]);
  
  // Obtener token (simplificado, en producci√≥n usar estado global)
  const [token, setToken] = useState<string | null>(null);
  
  useEffect(() => {
    // Aqu√≠ obtendr√≠as el token del estado de autenticaci√≥n
    // setToken(authToken);
  }, []);

  const { isConnected, sendMessage } = useWebSocket(token, {
    onMessage: (message) => {
      console.log('Mensaje recibido:', message);
      
      switch (message.type) {
        case 'notification':
          setNotifications(prev => [...prev, message]);
          toast({
            title: 'Nueva notificaci√≥n',
            description: message.content,
          });
          break;
        
        case 'task_updated':
          // Actualizar UI con nueva informaci√≥n de tarea
          break;
        
        case 'project_updated':
          // Actualizar UI con nueva informaci√≥n de proyecto
          break;
      }
    },
    
    onOpen: () => {
      console.log('WebSocket conectado');
      toast({
        title: 'Conectado',
        description: 'Actualizaciones en tiempo real activadas',
      });
    },
    
    onClose: () => {
      console.log('WebSocket desconectado');
    },
  });

  return (
    <div>
      <div className="flex items-center gap-2">
        <div className={`h-2 w-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-red-500'}`} />
        <span>{isConnected ? 'Conectado' : 'Desconectado'}</span>
      </div>
      
      {/* Rest of dashboard */}
    </div>
  );
}
```

---

## 9. AUTENTICACI√ìN Y SEGURIDAD

### 9.1 Flujo de Autenticaci√≥n Completo

```
1. REGISTRO
   Usuario ‚Üí Frontend: Completa formulario de registro
   Frontend: Valida datos localmente
   Frontend ‚Üí Backend: POST /api/v1/auth/register
   Backend: Valida datos con Pydantic
   Backend: Hash de contrase√±a con bcrypt
   Backend: Crea usuario en BD
   Backend ‚Üí Frontend: Usuario creado (sin login autom√°tico)
   Frontend: Redirige a p√°gina de login

2. LOGIN
   Usuario ‚Üí Frontend: Ingresa email y contrase√±a
   Frontend ‚Üí Backend: POST /api/v1/auth/login (OAuth2PasswordRequestForm)
   Backend: Busca usuario por email
   Backend: Verifica contrase√±a con bcrypt
   Backend: Genera JWT access token (30 min)
   Backend: Genera JWT refresh token (7 d√≠as)
   Backend: Set-Cookie con tokens (HttpOnly, Secure, SameSite=Strict)
   Backend ‚Üí Frontend: Tokens en cookies + respuesta JSON
   Frontend: Guarda estado de autenticaci√≥n
   Frontend: Redirige a dashboard

3. ACCESO A RECURSOS PROTEGIDOS
   Frontend ‚Üí Backend: GET /api/v1/users/me (cookie enviada autom√°ticamente)
   Backend: Extrae token de cookie
   Backend: Valida y decodifica JWT
   Backend: Obtiene user_id del payload
   Backend: Busca usuario en BD
   Backend: Verifica que usuario est√© activo
   Backend ‚Üí Frontend: Datos del usuario
   Frontend: Actualiza UI

4. REFRESH TOKEN (Renovaci√≥n)
   Frontend: Detecta que access token expir√≥
   Frontend ‚Üí Backend: POST /api/v1/auth/refresh (refresh token en cookie)
   Backend: Valida refresh token
   Backend: Genera nuevo access token
   Backend: Set-Cookie con nuevo access token
   Backend ‚Üí Frontend: Nuevo token
   Frontend: Reintenta request original

5. LOGOUT
   Usuario ‚Üí Frontend: Click en logout
   Frontend ‚Üí Backend: POST /api/v1/auth/logout
   Backend: Delete-Cookie (access_token y refresh_token)
   Backend ‚Üí Frontend: Confirmaci√≥n
   Frontend: Limpia estado de autenticaci√≥n
   Frontend: Redirige a login
```

### 9.2 Seguridad Implementada

#### Hashing de Contrase√±as
- **Algoritmo**: bcrypt
- **Rounds**: 12 (por defecto en passlib)
- **Salting**: Autom√°tico en bcrypt
- **Nunca** almacenar contrase√±as en texto plano

#### JSON Web Tokens (JWT)
- **Algoritmo**: HS256 (HMAC-SHA256)
- **Secret Key**: 256 bits generado aleatoriamente
- **Claims incluidos**:
  - `sub`: User ID
  - `iat`: Issued At (timestamp)
  - `exp`: Expiration (timestamp)
  - `type`: "access" o "refresh"

#### Cookies Seguras
- **HttpOnly**: true - No accesible desde JavaScript
- **Secure**: true en producci√≥n - Solo HTTPS
- **SameSite**: Strict - Previene CSRF
- **Max-Age**: Basado en tipo de token

#### CORS (Cross-Origin Resource Sharing)
- Origins permitidos configurados expl√≠citamente
- Credentials: true para permitir cookies
- Methods: Solo los necesarios
- Headers: Configurados apropiadamente

#### Validaci√≥n de Entrada
- **Backend**: Pydantic schemas con validaciones
- **Frontend**: Zod + react-hook-form
- Validaci√≥n de tipos, longitudes, formatos
- Sanitizaci√≥n de datos

#### SQL Injection Prevention
- SQLAlchemy ORM previene inyecci√≥n SQL
- Uso de par√°metros preparados
- Nunca concatenar strings en queries

### 9.3 Mejores Pr√°cticas de Seguridad

1. **Variables de Entorno**
   - Nunca commitear archivos `.env`
   - Usar secretos diferentes por entorno
   - Rotar secretos peri√≥dicamente

2. **HTTPS en Producci√≥n**
   - Forzar HTTPS
   - HSTS headers
   - Certificados SSL/TLS v√°lidos

3. **Rate Limiting**
   - Limitar intentos de login
   - Prevenir brute force attacks
   - Usar herramientas como slowapi

4. **Logging y Monitoreo**
   - Log de intentos de autenticaci√≥n
   - Alertas de actividad sospechosa
   - No logear informaci√≥n sensible

5. **Dependency Updates**
   - Mantener dependencias actualizadas
   - Escanear vulnerabilidades (Snyk, Dependabot)
   - Aplicar parches de seguridad

---

## 10. MEJORES PR√ÅCTICAS APLICADAS

### 10.1 Arquitectura y Dise√±o

‚úÖ **Clean Architecture**: Separaci√≥n clara en capas
‚úÖ **SOLID Principles**: C√≥digo mantenible y extensible
‚úÖ **DRY (Don't Repeat Yourself)**: Reutilizaci√≥n de c√≥digo
‚úÖ **Separation of Concerns**: Cada m√≥dulo una responsabilidad
‚úÖ **Dependency Injection**: C√≥digo desacoplado y testeable

### 10.2 Desarrollo

‚úÖ **Type Safety**: Python type hints + TypeScript
‚úÖ **Validaci√≥n de Datos**: Pydantic + Zod
‚úÖ **Error Handling**: Excepciones personalizadas y manejo centralizado
‚úÖ **Async/Await**: Operaciones as√≠ncronas para mejor rendimiento
‚úÖ **Code Style**: Black, isort, Prettier, ESLint

### 10.3 Base de Datos

‚úÖ **ORM**: SQLAlchemy para abstracci√≥n de BD
‚úÖ **Migraciones**: Alembic para control de versiones de esquema
‚úÖ **Relaciones**: Foreign keys, constraints, √≠ndices apropiados
‚úÖ **Transacciones**: Manejo adecuado de commits y rollbacks
‚úÖ **Connection Pooling**: Reutilizaci√≥n eficiente de conexiones

### 10.4 Seguridad

‚úÖ **Authentication**: JWT con cookies seguras
‚úÖ **Password Hashing**: bcrypt para contrase√±as
‚úÖ **CORS**: Configurado apropiadamente
‚úÖ **Input Validation**: Validaci√≥n exhaustiva de entrada
‚úÖ **SQL Injection Prevention**: ORM con par√°metros preparados

### 10.5 Testing

‚úÖ **Unit Tests**: Pruebas de componentes individuales
‚úÖ **Integration Tests**: Pruebas de flujos completos
‚úÖ **Mocking**: Mockear dependencias externas
‚úÖ **Coverage**: Medir cobertura de c√≥digo
‚úÖ **CI/CD**: Integraci√≥n continua con tests autom√°ticos

### 10.6 Documentaci√≥n

‚úÖ **API Documentation**: OpenAPI/Swagger autom√°tico
‚úÖ **Code Comments**: Comentarios donde sea necesario
‚úÖ **Type Hints**: Documentaci√≥n impl√≠cita con tipos
‚úÖ **README**: Instrucciones claras de instalaci√≥n y uso
‚úÖ **Architecture Docs**: Documentaci√≥n de dise√±o

### 10.7 DevOps

‚úÖ **Containerization**: Docker/Podman para portabilidad
‚úÖ **Environment Variables**: Configuraci√≥n externa
‚úÖ **Logging**: Logs estructurados y √∫tiles
‚úÖ **Health Checks**: Endpoints de monitoreo
‚úÖ **Graceful Shutdown**: Manejo apropiado de se√±ales

---

## 11. REFERENCIAS CRUZADAS ENTRE EPISODIOS

### Video 1 ‚Üí Videos posteriores
- **Arquitectura presentada** ‚Üí Implementada en Videos 2-5
- **Stack tecnol√≥gico** ‚Üí Configurado en Videos 2-3
- **Caracter√≠sticas clave** ‚Üí Desarrolladas progresivamente

### Video 2 ‚Üí Videos 3, 4, 5
- **Backend b√°sico** ‚Üí Consumido por Frontend (Video 3)
- **Estructura inicial** ‚Üí Refactorizada (Video 4)
- **SQLAlchemy setup** ‚Üí Modelos creados (Video 5)

### Video 3 ‚Üí Videos 4, 5
- **Frontend configurado** ‚Üí Integrado con Backend mejorado
- **Cliente API** ‚Üí Consume endpoints expandidos
- **Componentes UI** ‚Üí Utilizan datos de modelos

### Video 4 ‚Üí Video 5
- **Arquitectura en capas** ‚Üí Facilita implementaci√≥n de modelos
- **Repositorios** ‚Üí Extendidos para nuevas entidades
- **Servicios** ‚Üí Implementan l√≥gica de modelos complejos

### Video 5 ‚Üí Siguientes episodios
- **Modelos completos** ‚Üí Base para CRUD completo
- **Relaciones** ‚Üí Queries complejas y joins
- **Migraciones** ‚Üí Esquema versionado y actualizable

### Progresi√≥n Natural del Curso
```
1. Visi√≥n General (Video 1)
   ‚Üì
2. Backend B√°sico (Video 2)
   ‚Üì
3. Frontend B√°sico (Video 3)
   ‚Üì
4. Refactorizaci√≥n Profesional (Video 4)
   ‚Üì
5. Modelos y Relaciones Complejas (Video 5)
   ‚Üì
[Episodios Futuros]
   ‚Üì
6. CRUD Completo para todas las entidades
7. Implementaci√≥n completa de WebSockets
8. Sistema de autenticaci√≥n completo
9. Testing comprehensivo
10. Despliegue en producci√≥n
```

---

## üìö RECURSOS ADICIONALES

### Documentaci√≥n Oficial
- **FastAPI**: https://fastapi.tiangolo.com/
- **Next.js**: https://nextjs.org/docs
- **PostgreSQL**: https://www.postgresql.org/docs/
- **SQLAlchemy**: https://docs.sqlalchemy.org/
- **Pydantic**: https://docs.pydantic.dev/
- **Docker**: https://docs.docker.com/

### Herramientas
- **Swagger Editor**: https://editor.swagger.io/
- **Postman**: https://www.postman.com/
- **DBeaver**: https://dbeaver.io/ (cliente PostgreSQL)
- **VS Code Extensions**: 
  - Python
  - Pylance
  - ES7+ React/Redux/React-Native snippets
  - Tailwind CSS IntelliSense

### Comunidad
- **FastAPI Discord**: https://discord.gg/VQjSZaeJmf
- **Next.js Discord**: https://nextjs.org/discord
- **Stack Overflow**: Etiquetas #fastapi #nextjs

---

*Fin del Documento 2*

## --------------------------------------------------

---

## DOCUMENTO 3: RESUMEN ESTRUCTURADO POR EPISODIO
# DOCUMENTO 3: RESUMEN ESTRUCTURADO POR EPISODIO
## Serie: Aplicaci√≥n Full Stack con FastAPI y Next.js
### Canal: C√≥digo para Principiantes

---

## üìã √çNDICE DE EPISODIOS

1. [Episodio 1: Introducci√≥n al Proyecto Full Stack](#episodio-1-introducci√≥n-al-proyecto-full-stack)
2. [Episodio 2: Preparaci√≥n del Backend con FastAPI](#episodio-2-preparaci√≥n-del-backend-con-fastapi)
3. [Episodio 3: Configuraci√≥n del Frontend con Next.js](#episodio-3-configuraci√≥n-del-frontend-con-nextjs)
4. [Episodio 4: Reorganizaci√≥n Profesional del Backend](#episodio-4-reorganizaci√≥n-profesional-del-backend)
5. [Episodio 5: Creaci√≥n de Modelos y Relaciones](#episodio-5-creaci√≥n-de-modelos-y-relaciones)

---

## EPISODIO 1: Introducci√≥n al Proyecto Full Stack

### üìä Informaci√≥n del Video
- **T√≠tulo**: FastAPI y Next.js: Crea una App Full Stack Real (con WebSockets)
- **URL**: https://www.youtube.com/watch?v=5oNktUuWBMY
- **Duraci√≥n**: 10:13 minutos
- **Vistas**: 650
- **Publicado**: Hace 3 meses

### üìù Resumen Ejecutivo

Este episodio inaugural establece las bases del proyecto Full Stack, presentando la visi√≥n general de la aplicaci√≥n que se construir√° a lo largo de la serie. El instructor introduce el stack tecnol√≥gico completo (FastAPI, Next.js, PostgreSQL y Podman), explica la arquitectura del sistema y destaca las caracter√≠sticas principales que hacen de este un proyecto profesional y real, no solo un tutorial b√°sico.

El enfoque est√° en proporcionar un roadmap claro del curso, motivar a los estudiantes mostrando el alcance del proyecto final, y establecer expectativas sobre lo que aprender√°n: desde la configuraci√≥n b√°sica hasta la implementaci√≥n de caracter√≠sticas avanzadas como WebSockets y autenticaci√≥n segura con JWT.

### üéØ Objetivos del Episodio

**Objetivo Principal**: Presentar la visi√≥n completa del proyecto y el plan de la serie

**Objetivos Espec√≠ficos**:
1. ‚úÖ Introducir el stack tecnol√≥gico (FastAPI + Next.js + PostgreSQL + Podman)
2. ‚úÖ Explicar la arquitectura general de la aplicaci√≥n
3. ‚úÖ Destacar caracter√≠sticas clave: WebSockets y autenticaci√≥n segura
4. ‚úÖ Motivar el aprendizaje mostrando un proyecto real
5. ‚úÖ Establecer el roadmap de episodios futuros

### üîë Puntos Clave T√©cnicos

#### 1. Stack Tecnol√≥gico Presentado

**Backend: FastAPI**
- Framework Python moderno y de alto rendimiento
- Basado en est√°ndares: OpenAPI y JSON Schema
- Documentaci√≥n autom√°tica (Swagger UI)
- Validaci√≥n de datos con Pydantic
- Soporte nativo para async/await
- **Ventaja principal**: Desarrollo r√°pido con alta calidad de c√≥digo

**Frontend: Next.js**
- Framework React con Server-Side Rendering
- Enrutamiento autom√°tico basado en archivos
- Optimizaci√≥n de performance out-of-the-box
- Excelente experiencia de desarrollo
- **Ventaja principal**: SEO mejorado y carga inicial r√°pida

**Base de Datos: PostgreSQL**
- Sistema de gesti√≥n de BD relacional robusto
- ACID compliance para transacciones confiables
- Extensible y con gran ecosistema
- **Ventaja principal**: Confiabilidad en producci√≥n

**Contenedorizaci√≥n: Podman**
- Alternativa a Docker sin daemon root
- Mayor seguridad al no requerir privilegios de root
- Compatible con comandos de Docker
- **Ventaja principal**: Seguridad mejorada en desarrollo y producci√≥n

#### 2. Arquitectura del Sistema

**Modelo de Tres Capas**:
```
[Frontend - Next.js] ‚Üê HTTP/WebSocket ‚Üí [Backend - FastAPI] ‚Üê SQL ‚Üí [DB - PostgreSQL]
```

- **Capa de Presentaci√≥n**: Next.js maneja UI/UX
- **Capa de L√≥gica de Negocio**: FastAPI procesa requests y l√≥gica
- **Capa de Datos**: PostgreSQL persiste informaci√≥n

**Comunicaci√≥n**:
- REST API para operaciones CRUD
- WebSockets para actualizaciones en tiempo real
- JWT en cookies HttpOnly para autenticaci√≥n

#### 3. Caracter√≠sticas Destacadas

**WebSockets para Tiempo Real**:
- Comunicaci√≥n bidireccional y persistente
- Ideal para notificaciones instant√°neas
- Sincronizaci√≥n de datos entre clientes
- Baja latencia comparado con polling

**Autenticaci√≥n Segura**:
- JSON Web Tokens (JWT) para stateless auth
- Almacenamiento en cookies HttpOnly (no accesible desde JS)
- Secure flag para transmisi√≥n solo por HTTPS
- SameSite=Strict para prevenir CSRF

**Containerizaci√≥n Completa**:
- Desarrollo en contenedores = producci√≥n sin sorpresas
- Aislamiento de dependencias
- F√°cil escalabilidad horizontal
- Reproducibilidad del entorno

### üíº Tecnolog√≠as Utilizadas

| Categor√≠a | Tecnolog√≠a | Versi√≥n | Prop√≥sito |
|-----------|-----------|---------|-----------|
| Backend Framework | FastAPI | Latest | API REST as√≠ncrona |
| Frontend Framework | Next.js | 14+ | Aplicaci√≥n React con SSR |
| Base de Datos | PostgreSQL | 15+ | Persistencia relacional |
| Contenedores | Podman/Docker | Latest | Entorno consistente |
| Lenguaje Backend | Python | 3.11+ | L√≥gica del servidor |
| Lenguaje Frontend | TypeScript | 5+ | Type safety en cliente |
| ORM | SQLAlchemy | 2.0 | Interacci√≥n con BD |
| Validaci√≥n | Pydantic | 2.0+ | Schemas y validaci√≥n |

### ‚úÖ Resultados Alcanzados

Al finalizar este episodio, los estudiantes han logrado:

1. **Comprensi√≥n Clara del Proyecto**:
   - Entienden qu√© se va a construir
   - Conocen las tecnolog√≠as involucradas
   - Tienen expectativas realistas del alcance

2. **Motivaci√≥n Establecida**:
   - Ven el valor de un proyecto profesional
   - Comprenden las aplicaciones pr√°cticas
   - Est√°n preparados para el compromiso de la serie

3. **Contexto T√©cnico**:
   - Conocen las ventajas de cada tecnolog√≠a
   - Entienden por qu√© se eligi√≥ este stack
   - Ven c√≥mo las piezas encajan juntas

4. **Roadmap Mental**:
   - Saben qu√© esperar en pr√≥ximos episodios
   - Entienden la progresi√≥n del aprendizaje
   - Pueden planificar su tiempo de estudio

### üîó Conexi√≥n con Episodios Previos/Siguientes

**No hay episodios previos** - Este es el inicio de la serie

**Prepara para**:
- **Episodio 2**: Implementaci√≥n pr√°ctica del backend presentado aqu√≠
- **Episodio 3**: Configuraci√≥n del frontend para consumir el backend
- **Episodios 4-5**: Refinamiento y caracter√≠sticas avanzadas

**Conceptos que ser√°n expandidos**:
- WebSockets: Implementaci√≥n completa en episodios posteriores
- Autenticaci√≥n JWT: C√≥digo detallado en backend y frontend
- Arquitectura: Refactorizaci√≥n profesional en episodio 4
- Base de datos: Modelado completo en episodio 5

### üìå Notas Importantes

> **Para Principiantes**: Este episodio es principalmente conceptual. No te preocupes si no entiendes todos los t√©rminos t√©cnicos; se explicar√°n con c√≥digo en episodios posteriores.

> **Requisito Previo**: Conocimientos b√°sicos de Python y JavaScript son recomendados, pero no estrictamente necesarios.

> **Tiempo de Compromiso**: La serie completa requiere seguimiento constante y pr√°ctica. Reserva tiempo para codificar junto con los videos.

### üé¨ Estructura del Episodio

```
[00:00-02:00] ‚Üí Introducci√≥n y bienvenida
[02:00-04:00] ‚Üí Presentaci√≥n del stack tecnol√≥gico
[04:00-06:30] ‚Üí Arquitectura y dise√±o del sistema
[06:30-08:30] ‚Üí Caracter√≠sticas principales: WebSockets y auth
[08:30-10:13] ‚Üí Roadmap y conclusi√≥n
```

---

## EPISODIO 2: Preparaci√≥n del Backend con FastAPI

### üìä Informaci√≥n del Video
- **T√≠tulo**: FastAPI y Next.js: Preparamos el Backend | Curso App Full Stack #2
- **URL**: https://www.youtube.com/watch?v=fNgmKHZ1HJU
- **Duraci√≥n**: 43:31 minutos ‚≠ê (El m√°s largo de la serie)
- **Vistas**: 538
- **Publicado**: Hace 3 meses

### üìù Resumen Ejecutivo

Este episodio marca el inicio de la implementaci√≥n pr√°ctica, siendo el m√°s extenso y detallado de la serie. El instructor gu√≠a paso a paso la configuraci√≥n completa del backend con FastAPI, desde la instalaci√≥n de dependencias hasta la creaci√≥n de un contenedor Docker funcional. Se establece la estructura base del proyecto, se configura la conexi√≥n a PostgreSQL, se implementan endpoints de prueba y se introduce el concepto de documentaci√≥n autom√°tica con Swagger UI.

Es un episodio fundamental que sienta las bases t√©cnicas sobre las cuales se construir√° todo el backend. Se presta especial atenci√≥n a las mejores pr√°cticas desde el inicio, como el uso de variables de entorno, la organizaci√≥n modular del c√≥digo y la configuraci√≥n apropiada del servidor ASGI con Uvicorn.

### üéØ Objetivos del Episodio

**Objetivo Principal**: Configurar un backend FastAPI funcional y profesional desde cero

**Objetivos Espec√≠ficos**:
1. ‚úÖ Instalar Python 3.11+ y crear entorno virtual
2. ‚úÖ Instalar FastAPI, Uvicorn y todas las dependencias necesarias
3. ‚úÖ Crear la estructura inicial del proyecto backend
4. ‚úÖ Configurar PostgreSQL y establecer conexi√≥n con SQLAlchemy
5. ‚úÖ Implementar configuraci√≥n con variables de entorno
6. ‚úÖ Crear la aplicaci√≥n FastAPI con middleware CORS
7. ‚úÖ Implementar endpoints b√°sicos de prueba y health check
8. ‚úÖ Configurar Dockerfile y docker-compose para el backend
9. ‚úÖ Verificar funcionamiento con Swagger UI

### üîë Puntos Clave T√©cnicos

#### 1. Instalaci√≥n y Configuraci√≥n del Entorno

**Creaci√≥n de Entorno Virtual**:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```
- Aislamiento de dependencias del sistema
- Evita conflictos entre proyectos
- Facilita deployment reproducible

**Dependencias Principales Instaladas**:
- `fastapi`: Framework principal
- `uvicorn[standard]`: Servidor ASGI con extras
- `sqlalchemy`: ORM para PostgreSQL
- `psycopg2-binary`: Driver de PostgreSQL
- `alembic`: Migraciones de base de datos
- `pydantic-settings`: Configuraci√≥n con validaci√≥n
- `python-jose[cryptography]`: JWT
- `passlib[bcrypt]`: Hashing de contrase√±as
- `python-dotenv`: Manejo de .env files

#### 2. Estructura del Proyecto Backend

**Organizaci√≥n Inicial**:
```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py          # Marca como paquete Python
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Punto de entrada
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # Settings centralizados
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.py        # Endpoints iniciales
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.py      # JWT y hashing (futuro)
‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ database.py      # Conexi√≥n a BD
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ Dockerfile
```

**Razones de esta estructura**:
- Modularidad desde el inicio
- F√°cil de entender y navegar
- Escalable para crecer
- Sigue convenciones de Python

#### 3. Configuraci√≥n de PostgreSQL y SQLAlchemy

**Conexi√≥n a Base de Datos**:
```python
DATABASE_URL = "postgresql://usuario:contrase√±a@host:puerto/database"

engine = create_engine(
    DATABASE_URL,
    pool_pre_ping=True,    # Verifica conexiones antes de usar
    pool_size=10,          # M√°ximo 10 conexiones simult√°neas
    max_overflow=20        # Hasta 20 adicionales si necesario
)
```

**Session Management**:
```python
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()  # Siempre cerrar sesi√≥n
```

**Pool de Conexiones**:
- Reutiliza conexiones existentes
- Mejora performance significativamente
- Evita overhead de crear/cerrar conexiones

#### 4. Variables de Entorno y Configuraci√≥n

**Archivo .env**:
```env
APP_NAME="FastAPI Full Stack"
DEBUG=True
DATABASE_URL=postgresql://fastapi_user:password@localhost:5432/fullstack_db
SECRET_KEY=tu-clave-super-secreta
```

**Pydantic Settings**:
```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    APP_NAME: str
    DEBUG: bool = False
    DATABASE_URL: str
    SECRET_KEY: str
    
    class Config:
        env_file = ".env"
```

**Beneficios**:
- Separaci√≥n de configuraci√≥n del c√≥digo
- Diferentes configs por entorno (dev/prod)
- Validaci√≥n autom√°tica con Pydantic
- Type hints para mejor DX

#### 5. Aplicaci√≥n FastAPI Principal

**Creaci√≥n de la App**:
```python
app = FastAPI(
    title="FastAPI Full Stack",
    version="1.0.0",
    docs_url="/docs",      # Swagger UI
    redoc_url="/redoc"     # ReDoc
)
```

**CORS Configuration**:
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # Next.js
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```
- Permite requests desde Next.js
- `allow_credentials=True` para cookies
- Configuraci√≥n permisiva en desarrollo

**Health Check Endpoint**:
```python
@app.get("/health")
async def health_check():
    return {"status": "healthy", "version": "1.0.0"}
```
- √ötil para monitoring y load balancers
- Verifica que el servidor est√© respondiendo

#### 6. Contenedorizaci√≥n con Docker

**Dockerfile**:
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update && apt-get install -y \
    gcc postgresql-client

# Instalar dependencias Python
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copiar c√≥digo
COPY ./app ./app

EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
```

**docker-compose.yml (parcial)**:
```yaml
services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: fullstack_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    depends_on:
      - postgres
    volumes:
      - ./backend/app:/app/app  # Hot reload
```

**Ventajas de Containerizaci√≥n**:
- Entorno id√©ntico en todos los sistemas
- No contamina instalaci√≥n local
- F√°cil de compartir y replicar
- Preparado para producci√≥n

### üíº Tecnolog√≠as Utilizadas

| Componente | Tecnolog√≠a | Prop√≥sito Espec√≠fico |
|-----------|------------|---------------------|
| Framework | FastAPI 0.109+ | API REST as√≠ncrona |
| Servidor ASGI | Uvicorn | Servidor de alto rendimiento |
| ORM | SQLAlchemy 2.0 | Abstracci√≥n de base de datos |
| BD Driver | psycopg2 | Conexi√≥n a PostgreSQL |
| Migraciones | Alembic | Control de versiones de esquema |
| Validaci√≥n | Pydantic 2.5+ | Schemas y settings |
| Contenedores | Docker/Podman | Entorno reproducible |
| Variables Entorno | python-dotenv | Configuraci√≥n externa |

### ‚úÖ Resultados Alcanzados

Al finalizar este episodio, se tiene:

1. **Backend Funcional**:
   - Servidor FastAPI corriendo en puerto 8000
   - Documentaci√≥n autom√°tica accesible en /docs
   - Health check endpoint respondiendo

2. **Base de Datos Configurada**:
   - PostgreSQL ejecut√°ndose en contenedor
   - Conexi√≥n establecida con SQLAlchemy
   - Pool de conexiones configurado

3. **Estructura Profesional**:
   - C√≥digo organizado en m√≥dulos
   - Variables de entorno separadas
   - Configuraci√≥n centralizada con Pydantic

4. **Entorno Contenerizado**:
   - Docker Compose orquestando servicios
   - Vol√∫menes para persistencia de datos
   - Hot reload para desarrollo √°gil

5. **Middleware Configurado**:
   - CORS listo para Next.js
   - Preparado para agregar m√°s middleware

6. **Documentaci√≥n Viva**:
   - Swagger UI generado autom√°ticamente
   - Esquemas Pydantic documentando API
   - ReDoc como alternativa

### üîó Conexi√≥n con Episodios Previos/Siguientes

**Depende de**:
- **Episodio 1**: Arquitectura y tecnolog√≠as presentadas

**Prepara para**:
- **Episodio 3**: Frontend consumir√° esta API
- **Episodio 4**: Esta estructura ser√° refactorizada profesionalmente
- **Episodio 5**: Modelos SQLAlchemy se crear√°n aqu√≠

**Conceptos que se expandir√°n**:
- Endpoints b√°sicos ‚Üí CRUD completo
- Estructura simple ‚Üí Arquitectura en capas
- Sin autenticaci√≥n ‚Üí JWT completo
- Sin modelos ‚Üí Modelos complejos con relaciones

### üìå Notas Importantes

> **Comando Cr√≠tico**: Siempre activar el entorno virtual antes de trabajar con el proyecto.

> **Puerto 8000**: Aseg√∫rate de que este puerto est√© libre en tu sistema.

> **Variables de Entorno**: NUNCA commitear el archivo .env al repositorio. Usar .env.example como plantilla.

> **Hot Reload**: El flag `--reload` de Uvicorn reinicia autom√°ticamente al detectar cambios en el c√≥digo.

> **PostgreSQL**: Si usas PostgreSQL local en lugar de Docker, ajusta el host en DATABASE_URL a `localhost` en lugar de `postgres`.

### üé¨ Estructura del Episodio

```
[00:00-05:00] ‚Üí Introducci√≥n y repaso del ep. 1
[05:00-10:00] ‚Üí Instalaci√≥n de Python, venv y FastAPI
[10:00-18:00] ‚Üí Creaci√≥n de estructura del proyecto
[18:00-25:00] ‚Üí Configuraci√≥n de PostgreSQL y SQLAlchemy
[25:00-32:00] ‚Üí Implementaci√≥n de main.py y endpoints
[32:00-38:00] ‚Üí Dockerfile y docker-compose
[38:00-43:31] ‚Üí Testing, Swagger UI y conclusiones
```

### üí° Tips del Instructor

1. **Sobre Uvicorn**: El flag `--reload` es solo para desarrollo, nunca en producci√≥n
2. **Sobre Pool de Conexiones**: Ajustar `pool_size` seg√∫n carga esperada
3. **Sobre CORS**: En producci√≥n, especificar origins exactos, no usar "*"
4. **Sobre .env**: Generar SECRET_KEY con `openssl rand -hex 32`
5. **Sobre Docker**: Usar vol√∫menes nombrados para persistencia importante

---

## EPISODIO 3: Configuraci√≥n del Frontend con Next.js

### üìä Informaci√≥n del Video
- **T√≠tulo**: FastAPI y NextJS: Preparamos el contenedor del Frontend | Curso App Full Stack #3
- **URL**: https://www.youtube.com/watch?v=5zkla8UaiwI
- **Duraci√≥n**: 28:14 minutos
- **Vistas**: 258
- **Publicado**: Hace 3 meses

### üìù Resumen Ejecutivo

Este episodio se enfoca completamente en el frontend, configurando Next.js con todas las herramientas modernas necesarias para una aplicaci√≥n profesional. El instructor gu√≠a la creaci√≥n del proyecto Next.js con App Router, la configuraci√≥n de TypeScript para type safety, la integraci√≥n de TailwindCSS para estilos, y la instalaci√≥n de shadcn/ui para componentes reutilizables.

Se implementa un cliente API con axios configurado para comunicarse con el backend FastAPI, se estructuran los componentes de manera escalable, y se containeriza todo en Docker. El episodio termina con la aplicaci√≥n frontend conect√°ndose exitosamente al backend y lista para recibir caracter√≠sticas.

### üéØ Objetivos del Episodio

**Objetivo Principal**: Configurar un frontend Next.js moderno y profesional que se comunique con el backend FastAPI

**Objetivos Espec√≠ficos**:
1. ‚úÖ Crear proyecto Next.js con App Router y TypeScript
2. ‚úÖ Configurar TailwindCSS para estilos utility-first
3. ‚úÖ Instalar y configurar shadcn/ui para componentes
4. ‚úÖ Estructurar el proyecto con buenas pr√°cticas
5. ‚úÖ Implementar cliente API con axios
6. ‚úÖ Configurar variables de entorno para URLs
7. ‚úÖ Crear contenedor Docker para Next.js
8. ‚úÖ Integrar frontend y backend en docker-compose
9. ‚úÖ Verificar comunicaci√≥n frontend-backend

### üîë Puntos Clave T√©cnicos

#### 1. Creaci√≥n del Proyecto Next.js

**Comando de Inicializaci√≥n**:
```bash
npx create-next-app@latest frontend \
  --typescript \
  --tailwind \
  --app \
  --src-dir \
  --no-git
```

**Opciones Seleccionadas**:
- `--typescript`: Type safety con TypeScript
- `--tailwind`: TailwindCSS preconfigurado
- `--app`: App Router (nueva arquitectura de Next.js)
- `--src-dir`: C√≥digo en carpeta src/
- `--no-git`: No inicializar Git (ya est√° en ra√≠z del proyecto)

**Ventajas del App Router**:
- Server Components por defecto (mejor performance)
- Layouts anidados
- Loading y error states m√°s f√°ciles
- Streaming y Suspense integrados

#### 2. TypeScript Configuration

**tsconfig.json Configurado**:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "paths": {
      "@/*": ["./src/*"]  // Path aliases
    }
  }
}
```

**Beneficios de TypeScript**:
- Detecci√≥n de errores en tiempo de desarrollo
- IntelliSense mejorado en VSCode
- Refactoring m√°s seguro
- Documentaci√≥n impl√≠cita con tipos
- Prevenci√≥n de bugs comunes

#### 3. TailwindCSS y Estilos

**tailwind.config.ts**:
```typescript
import type { Config } from "tailwindcss"

const config: Config = {
  darkMode: ["class"],  // Dark mode con clase
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        border: "hsl(var(--border))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: { /* ... */ },
        secondary: { /* ... */ },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
    },
  },
}
```

**Ventajas de Tailwind**:
- Desarrollo r√°pido con utility classes
- No hay CSS no utilizado en producci√≥n (tree-shaking)
- Dise√±o consistente con sistema de dise√±o
- Responsive design sencillo
- Dark mode f√°cil de implementar

#### 4. Shadcn/UI Components

**Instalaci√≥n**:
```bash
npx shadcn-ui@latest init

# Instalar componentes espec√≠ficos
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add card
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add form
```

**Caracter√≠sticas de shadcn/ui**:
- Componentes copiados al proyecto (no npm package)
- Totalmente personalizables
- Accesibles (a11y) por defecto
- Basados en Radix UI
- Estilos con Tailwind

**Ejemplo de Uso**:
```typescript
import { Button } from "@/components/ui/button"
import { Card } from "@/components/ui/card"

export function MyComponent() {
  return (
    <Card>
      <Button variant="default">Click me</Button>
      <Button variant="outline">Outline</Button>
    </Card>
  )
}
```

#### 5. Estructura del Proyecto

**Organizaci√≥n de Carpetas**:
```
frontend/src/
‚îú‚îÄ‚îÄ app/                    # App Router
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx         # Root layout
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # Home page
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/            # Grupo de rutas auth
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îî‚îÄ‚îÄ (protected)/       # Rutas protegidas
‚îÇ       ‚îî‚îÄ‚îÄ dashboard/
‚îÇ           ‚îî‚îÄ‚îÄ page.tsx
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                # shadcn components
‚îÇ   ‚îú‚îÄ‚îÄ layout/            # Header, Footer, etc.
‚îÇ   ‚îî‚îÄ‚îÄ forms/             # Formularios
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api.ts            # Cliente API
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts           # L√≥gica auth
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts          # Utilidades
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îî‚îÄ‚îÄ useWebSocket.ts
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ api.ts            # Tipos TypeScript
‚îî‚îÄ‚îÄ styles/
    ‚îî‚îÄ‚îÄ globals.css       # Estilos globales
```

**Razones de esta Estructura**:
- **app/**: Rutas seg√∫n convenci√≥n de Next.js
- **components/**: Reutilizaci√≥n de componentes
- **lib/**: L√≥gica compartida y utilidades
- **hooks/**: Custom React hooks
- **types/**: Definiciones TypeScript centralizadas

#### 6. Cliente API con Axios

**lib/api.ts**:
```typescript
import axios, { AxiosInstance } from 'axios';

const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  timeout: 10000,
  withCredentials: true,  // Enviar cookies
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para manejar errores
apiClient.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export const api = {
  auth: {
    login: async (email: string, password: string) => {
      const formData = new FormData();
      formData.append('username', email);
      formData.append('password', password);
      return apiClient.post('/auth/login', formData);
    },
    // ...m√°s m√©todos
  },
  // ...m√°s endpoints
};
```

**Caracter√≠sticas del Cliente**:
- `withCredentials: true` para enviar/recibir cookies
- Interceptors para manejo global de errores
- Timeout configurado para prevenir requests colgados
- Redireccionamiento autom√°tico a login en 401

#### 7. Variables de Entorno

**.env.local**:
```env
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
```

**Uso en C√≥digo**:
```typescript
const apiUrl = process.env.NEXT_PUBLIC_API_URL;
```

**Nota Importante**: 
- Prefijo `NEXT_PUBLIC_` para variables accesibles en el cliente
- Sin prefijo solo est√°n disponibles en server-side code

#### 8. Containerizaci√≥n del Frontend

**Dockerfile (multi-stage)**:
```dockerfile
# Stage 1: Dependencies
FROM node:20-alpine AS deps
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci

# Stage 2: Builder
FROM node:20-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# Stage 3: Runner
FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV production
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
EXPOSE 3000
CMD ["node", "server.js"]
```

**next.config.js**:
```javascript
const nextConfig = {
  output: 'standalone',  // Para Docker
  images: {
    domains: ['localhost'],
  },
}
```

**docker-compose.yml Actualizado**:
```yaml
services:
  postgres:
    # ... (mismo que antes)
  
  backend:
    # ... (mismo que antes)
  
  frontend:
    build: ./frontend
    container_name: fullstack_frontend
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
    ports:
      - "3000:3000"
    depends_on:
      - backend
    volumes:
      - ./frontend/src:/app/src  # Hot reload
```

### üíº Tecnolog√≠as Utilizadas

| Componente | Tecnolog√≠a | Prop√≥sito |
|-----------|------------|-----------|
| Framework | Next.js 14 | Aplicaci√≥n React con SSR |
| Lenguaje | TypeScript 5 | Type safety |
| Estilos | TailwindCSS 3 | Utility-first CSS |
| Componentes UI | shadcn/ui | Componentes preconstruidos |
| HTTP Client | Axios | Requests a API |
| Validaci√≥n Forms | Zod + react-hook-form | Formularios robustos |
| Contenedores | Docker | Entorno consistente |

### ‚úÖ Resultados Alcanzados

Al finalizar este episodio:

1. **Frontend Funcional**:
   - Next.js corriendo en puerto 3000
   - App Router configurado
   - TypeScript funcionando

2. **Estilos Configurados**:
   - TailwindCSS listo para usar
   - Sistema de dise√±o con variables CSS
   - Dark mode preparado

3. **Componentes UI**:
   - shadcn/ui instalado
   - Botones, inputs, cards, etc. disponibles
   - Personalizables y accesibles

4. **Comunicaci√≥n con Backend**:
   - Cliente API configurado con axios
   - Variables de entorno para URLs
   - Interceptors para manejo de errores

5. **Estructura Escalable**:
   - Carpetas organizadas l√≥gicamente
   - Separaci√≥n de concerns
   - F√°cil de navegar y extender

6. **Containerizado**:
   - Dockerfile multi-stage optimizado
   - Integrado en docker-compose
   - Hot reload para desarrollo

### üîó Conexi√≥n con Episodios Previos/Siguientes

**Depende de**:
- **Episodio 1**: Arquitectura general
- **Episodio 2**: Backend FastAPI funcionando

**Prepara para**:
- **Episodio 4-5**: Frontend consumir√° nuevos endpoints
- **Episodios futuros**: Implementaci√≥n de features (auth, CRUD, WebSockets)

**Conceptos que se usar√°n**:
- Cliente API ‚Üí Consumir√° todos los endpoints del backend
- Estructura de componentes ‚Üí Se llenar√° con funcionalidad
- Hooks personalizados ‚Üí useAuth, useWebSocket, etc.

### üìå Notas Importantes

> **App Router vs Pages Router**: Este proyecto usa App Router (recomendado por Next.js). Es diferente a tutoriales antiguos.

> **Puerto 3000**: Aseg√∫rate de que est√© libre en tu sistema.

> **NEXT_PUBLIC_ Prefix**: Variables sin este prefijo no estar√°n disponibles en el cliente.

> **Hot Reload**: Los cambios en src/ se reflejan autom√°ticamente gracias al volumen de Docker.

> **Build Time**: El primer build puede tardar varios minutos mientras descarga dependencias.

### üé¨ Estructura del Episodio

```
[00:00-03:00] ‚Üí Introducci√≥n y repaso
[03:00-08:00] ‚Üí Crear proyecto Next.js y configuraci√≥n inicial
[08:00-12:00] ‚Üí Configurar TypeScript y TailwindCSS
[12:00-18:00] ‚Üí Instalar shadcn/ui y estructurar componentes
[18:00-22:00] ‚Üí Implementar cliente API
[22:00-26:00] ‚Üí Containerizaci√≥n con Docker
[26:00-28:14] ‚Üí Pruebas y conclusi√≥n
```

### üí° Tips del Instructor

1. **Sobre shadcn/ui**: Los componentes se copian al proyecto, as√≠ que puedes modificarlos libremente
2. **Sobre TypeScript**: Usar `interface` para objetos p√∫blicos, `type` para uniones y aliases
3. **Sobre Tailwind**: Usar el plugin de VSCode para autocompletado de clases
4. **Sobre API Client**: Centralizar todas las llamadas en lib/api.ts facilita mantenimiento
5. **Sobre Hot Reload**: Si no funciona, reiniciar el contenedor resuelve la mayor√≠a de problemas

---

## EPISODIO 4: Reorganizaci√≥n Profesional del Backend

### üìä Informaci√≥n del Video
- **T√≠tulo**: FastAPI y NextJS: Reorganizamos profesionalmente el Backend | Curso App Full Stack #4
- **URL**: https://www.youtube.com/watch?v=4c1Tw2rb5cE
- **Duraci√≥n**: 16:14 minutos
- **Vistas**: 142
- **Publicado**: Hace 2 meses

### üìù Resumen Ejecutivo

Este episodio es crucial para la evoluci√≥n del proyecto hacia c√≥digo de producci√≥n. El instructor refactoriza completamente el backend, transform√°ndolo de una estructura b√°sica a una arquitectura profesional en capas. Se implementan patrones de dise√±o fundamentales como Repository Pattern y Service Layer, se introducen excepciones personalizadas, y se establece un sistema robusto de inyecci√≥n de dependencias.

Aunque m√°s corto que episodios anteriores, este es denso en conceptos de arquitectura de software. El enfoque no est√° tanto en escribir mucho c√≥digo nuevo, sino en reorganizar el existente de manera que sea mantenible, testeable y escalable. Es un episodio que separa proyectos de tutorial de aplicaciones reales.

### üéØ Objetivos del Episodio

**Objetivo Principal**: Transformar el backend b√°sico en una arquitectura profesional y escalable

**Objetivos Espec√≠ficos**:
1. ‚úÖ Implementar arquitectura en capas (API ‚Üí Services ‚Üí Repositories ‚Üí Models)
2. ‚úÖ Crear patr√≥n Repository con CRUD gen√©rico
3. ‚úÖ Implementar Service Layer para l√≥gica de negocio
4. ‚úÖ Definir excepciones personalizadas
5. ‚úÖ Mejorar sistema de dependencias (deps.py)
6. ‚úÖ Versionar la API (prefijo /api/v1)
7. ‚úÖ Refactorizar endpoints para usar nueva arquitectura
8. ‚úÖ Preparar estructura para crecer sin fricci√≥n

### üîë Puntos Clave T√©cnicos

#### 1. Arquitectura en Capas Implementada

**Separaci√≥n de Responsabilidades**:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API LAYER (api/v1/endpoints/)        ‚îÇ
‚îÇ   ‚Ä¢ Recibe requests HTTP                ‚îÇ
‚îÇ   ‚Ä¢ Valida datos con Pydantic          ‚îÇ
‚îÇ   ‚Ä¢ Llama a servicios                   ‚îÇ
‚îÇ   ‚Ä¢ Serializa respuestas                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ Depends
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   SERVICE LAYER (services/)             ‚îÇ
‚îÇ   ‚Ä¢ L√≥gica de negocio                   ‚îÇ
‚îÇ   ‚Ä¢ Validaciones complejas              ‚îÇ
‚îÇ   ‚Ä¢ Orquesta repositorios               ‚îÇ
‚îÇ   ‚Ä¢ Maneja transacciones                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ Usa
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   REPOSITORY LAYER (repositories/)      ‚îÇ
‚îÇ   ‚Ä¢ Acceso a datos (CRUD)              ‚îÇ
‚îÇ   ‚Ä¢ Queries a base de datos            ‚îÇ
‚îÇ   ‚Ä¢ Abstrae SQLAlchemy                  ‚îÇ
‚îÇ   ‚Ä¢ Sin l√≥gica de negocio              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ Opera sobre
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MODEL LAYER (models/)                 ‚îÇ
‚îÇ   ‚Ä¢ Definici√≥n de tablas                ‚îÇ
‚îÇ   ‚Ä¢ Relaciones entre entidades          ‚îÇ
‚îÇ   ‚Ä¢ Constraints y validaciones BD       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Beneficios de esta Arquitectura**:
- Cada capa tiene responsabilidad √∫nica (SRP)
- Testing m√°s f√°cil (mockear cada capa)
- Cambios localizados (modificar una capa sin afectar otras)
- Reutilizaci√≥n de c√≥digo
- Escalabilidad vertical y horizontal

#### 2. Repository Pattern (Patr√≥n Repositorio)

**BaseRepository Gen√©rico**:
```python
from typing import TypeVar, Generic, Type, Optional, List
from sqlalchemy.orm import Session

ModelType = TypeVar("ModelType")

class BaseRepository(Generic[ModelType]):
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -> Optional[ModelType]:
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(self, db: Session, skip: int = 0, limit: int = 100) -> List[ModelType]:
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def create(self, db: Session, *, obj_in: dict) -> ModelType:
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(self, db: Session, *, db_obj: ModelType, obj_in: dict) -> ModelType:
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -> Optional[ModelType]:
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
```

**UserRepository Espec√≠fico**:
```python
from app.models.user import User

class UserRepository(BaseRepository[User]):
    def __init__(self):
        super().__init__(User)
    
    def get_by_email(self, db: Session, *, email: str) -> Optional[User]:
        return db.query(User).filter(User.email == email).first()
    
    def get_by_username(self, db: Session, *, username: str) -> Optional[User]:
        return db.query(User).filter(User.username == username).first()

user_repository = UserRepository()  # Instancia global
```

**Ventajas del Repository Pattern**:
- CRUD gen√©rico reutilizable
- F√°cil de mockear para testing
- Abstrae detalles de SQLAlchemy
- Queries espec√≠ficas en repositorios especializados
- Cambiar ORM afecta solo repositorios

#### 3. Service Layer (Capa de Servicios)

**UserService con L√≥gica de Negocio**:
```python
class UserService:
    def __init__(self):
        self.repo = user_repository
    
    def create_user(self, db: Session, user_in: UserCreate) -> User:
        # Validaci√≥n: email √∫nico
        if self.repo.get_by_email(db, email=user_in.email):
            raise UserAlreadyExistsException("Email ya registrado")
        
        # Validaci√≥n: username √∫nico
        if self.repo.get_by_username(db, username=user_in.username):
            raise UserAlreadyExistsException("Username ya existe")
        
        # Hash de contrase√±a
        hashed_password = get_password_hash(user_in.password)
        
        # Crear usuario
        user_data = user_in.dict(exclude={'password'})
        user_data['hashed_password'] = hashed_password
        
        return self.repo.create(db, obj_in=user_data)
    
    def authenticate(self, db: Session, *, email: str, password: str) -> Optional[User]:
        user = self.repo.get_by_email(db, email=email)
        if not user:
            return None
        if not verify_password(password, user.hashed_password):
            return None
        return user

user_service = UserService()  # Instancia global
```

**Responsabilidades del Service Layer**:
- Implementar reglas de negocio
- Coordinar m√∫ltiples repositorios
- Validaciones complejas
- Transformaci√≥n de datos
- Manejo de transacciones
- **No** acceder directamente a la BD

#### 4. Excepciones Personalizadas

**core/exceptions.py**:
```python
from fastapi import HTTPException, status

class BaseAPIException(HTTPException):
    def __init__(self, detail: str, status_code: int = 400):
        super().__init__(status_code=status_code, detail=detail)

class UserAlreadyExistsException(BaseAPIException):
    def __init__(self, detail: str = "El usuario ya existe"):
        super().__init__(detail, status_code=status.HTTP_409_CONFLICT)

class UserNotFoundException(BaseAPIException):
    def __init__(self, detail: str = "Usuario no encontrado"):
        super().__init__(detail, status_code=status.HTTP_404_NOT_FOUND)

class InvalidCredentialsException(BaseAPIException):
    def __init__(self, detail: str = "Credenciales inv√°lidas"):
        super().__init__(detail, status_code=status.HTTP_401_UNAUTHORIZED)
```

**Ventajas**:
- Errores consistentes en toda la API
- C√≥digos de estado HTTP apropiados
- Mensajes descriptivos
- F√°cil de extender

#### 5. Sistema de Dependencias Mejorado

**api/deps.py Refactorizado**:
```python
from fastapi import Depends, HTTPException, status, Cookie
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from app.db.session import SessionLocal
from app.models.user import User
from app.services.user_service import user_service
from app.core.security import decode_token

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login", auto_error=False)

def get_db() -> Generator:
    """Dependency de base de datos"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

async def get_current_user(
    db: Session = Depends(get_db),
    token: Optional[str] = Depends(oauth2_scheme),
    access_token: Optional[str] = Cookie(None)
) -> User:
    """Obtener usuario actual desde JWT"""
    # Priorizar cookie sobre header
    token_to_decode = access_token or token
    
    if not token_to_decode:
        raise HTTPException(status_code=401, detail="No autenticado")
    
    payload = decode_token(token_to_decode)
    if not payload:
        raise HTTPException(status_code=401, detail="Token inv√°lido")
    
    user_id = int(payload.get("sub"))
    user = user_service.get_user(db, user_id=user_id)
    
    if not user:
        raise HTTPException(status_code=401, detail="Usuario no encontrado")
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -> User:
    """Verificar usuario activo"""
    if not current_user.is_active:
        raise HTTPException(status_code=400, detail="Usuario inactivo")
    return current_user
```

**Composici√≥n de Dependencias**:
- `get_current_active_user` depende de `get_current_user`
- `get_current_user` depende de `get_db`
- FastAPI resuelve autom√°ticamente el √°rbol de dependencias

#### 6. Versionado de API

**Estructura Versionada**:
```
app/api/
‚îú‚îÄ‚îÄ deps.py
‚îî‚îÄ‚îÄ v1/
    ‚îú‚îÄ‚îÄ router.py          # Agrega todos los routers
    ‚îî‚îÄ‚îÄ endpoints/
        ‚îú‚îÄ‚îÄ auth.py        # POST /api/v1/auth/login
        ‚îú‚îÄ‚îÄ users.py       # GET /api/v1/users/
        ‚îú‚îÄ‚îÄ projects.py    # GET /api/v1/projects/
        ‚îî‚îÄ‚îÄ tasks.py       # GET /api/v1/tasks/
```

**Router Principal Versionado**:
```python
# app/api/v1/router.py
from fastapi import APIRouter
from app.api.v1.endpoints import auth, users, projects

api_router = APIRouter()

api_router.include_router(auth.router, prefix="/auth", tags=["authentication"])
api_router.include_router(users.router, prefix="/users", tags=["users"])
api_router.include_router(projects.router, prefix="/projects", tags=["projects"])
```

**En main.py**:
```python
app.include_router(api_router, prefix="/api/v1")
```

**Beneficios del Versionado**:
- Cambios breaking en v2 sin afectar v1
- Clientes pueden migrar gradualmente
- Deprecar versiones antiguas de forma controlada
- Profesionalismo y est√°ndares de API

#### 7. Endpoints Refactorizados

**Antes (Video 2)**:
```python
@app.post("/register")
def register(user_in: UserCreate, db: Session = Depends(get_db)):
    # Validaci√≥n inline
    if db.query(User).filter(User.email == user_in.email).first():
        raise HTTPException(400, "Email ya existe")
    # Hash inline
    hashed = pwd_context.hash(user_in.password)
    # Creaci√≥n inline
    user = User(**user_in.dict(), hashed_password=hashed)
    db.add(user)
    db.commit()
    return user
```

**Despu√©s (Video 4)**:
```python
@router.post("/register", response_model=UserResponse, status_code=201)
def register(
    user_in: UserCreate,
    db: Session = Depends(deps.get_db)
):
    """Registrar nuevo usuario"""
    return auth_service.register_user(db, user_in=user_in)
```

**Mejoras Evidentes**:
- Endpoint limpio y conciso
- Toda la l√≥gica en el servicio
- F√°cil de testear
- Exceptions manejadas centralmente
- Type hints y response_model

### üíº Tecnolog√≠as y Patrones Utilizados

| Patr√≥n/Concepto | Implementaci√≥n | Beneficio Principal |
|-----------------|----------------|---------------------|
| Repository Pattern | BaseRepository gen√©rico | Reutilizaci√≥n CRUD |
| Service Layer | UserService, AuthService | L√≥gica de negocio centralizada |
| Dependency Injection | FastAPI Depends | C√≥digo desacoplado |
| Exception Handling | Excepciones personalizadas | Errores consistentes |
| API Versioning | /api/v1/ prefix | Evoluci√≥n sin breaking changes |
| Generic Types | TypeVar en repositories | Type safety con flexibilidad |

### ‚úÖ Resultados Alcanzados

Al finalizar este episodio:

1. **Arquitectura Profesional**:
   - 4 capas bien definidas
   - Separaci√≥n clara de responsabilidades
   - C√≥digo mantenible y escalable

2. **Repository Pattern**:
   - CRUD gen√©rico funcionando
   - Repositorios espec√≠ficos por entidad
   - Abstracci√≥n completa de SQLAlchemy

3. **Service Layer**:
   - L√≥gica de negocio centralizada
   - Validaciones complejas
   - Servicios reutilizables

4. **Manejo de Errores**:
   - Excepciones personalizadas
   - C√≥digos HTTP apropiados
   - Mensajes de error consistentes

5. **API Versionada**:
   - Estructura para versiones futuras
   - Documentaci√≥n organizada por versi√≥n
   - Evoluci√≥n controlada

6. **Testing Facilitado**:
   - Cada capa puede testearse independientemente
   - Mocking sencillo con interfaces claras
   - Cobertura de c√≥digo m√°s f√°cil

### üîó Conexi√≥n con Episodios Previos/Siguientes

**Depende de**:
- **Episodio 2**: Estructura b√°sica que se refactoriza

**Mejora**:
- **Episodio 3**: Frontend ahora consume API m√°s robusta

**Prepara para**:
- **Episodio 5**: Modelos complejos usan repositorios y servicios
- **Episodios futuros**: CRUD completo con arquitectura s√≥lida

**Transformaci√≥n Clave**:
```
Episodio 2: main.py con todo inline
            ‚Üì Refactorizaci√≥n
Episodio 4: API ‚Üí Service ‚Üí Repository ‚Üí Model
```

### üìå Notas Importantes

> **Refactoring vs Rewriting**: Este episodio refactoriza, no reescribe. El comportamiento externo sigue igual.

> **Backward Compatibility**: Los endpoints mantienen sus URLs (solo agregan prefijo /api/v1/).

> **No Premature Optimization**: Esta arquitectura es necesaria ahora que el proyecto crece, no desde el inicio.

> **Testing**: Aunque no se muestra en este episodio, esta arquitectura facilita enormemente el testing.

> **Migraciones**: No es necesario correr migraciones ya que no cambiaron los modelos, solo la estructura del c√≥digo.

### üé¨ Estructura del Episodio

```
[00:00-02:00] ‚Üí Introducci√≥n y problemas de arquitectura actual
[02:00-05:00] ‚Üí Dise√±o de nueva arquitectura en capas
[05:00-08:00] ‚Üí Implementaci√≥n de Repository Pattern
[08:00-11:00] ‚Üí Creaci√≥n de Service Layer
[11:00-14:00] ‚Üí Refactorizaci√≥n de endpoints
[14:00-16:14] ‚Üí Testing y conclusi√≥n
```

### üí° Tips del Instructor

1. **Sobre Refactoring**: Hacer en pasos peque√±os, probando despu√©s de cada cambio
2. **Sobre Repositories**: Empezar con CRUD gen√©rico, agregar m√©todos espec√≠ficos seg√∫n necesidad
3. **Sobre Services**: Un servicio por entidad principal (UserService, ProjectService, etc.)
4. **Sobre Exceptions**: Crear solo las que realmente necesitas, no todas las posibles
5. **Sobre Testing**: Esta arquitectura permite testear l√≥gica de negocio sin levantar el servidor

---

## EPISODIO 5: Creaci√≥n de Modelos y Relaciones

### üìä Informaci√≥n del Video
- **T√≠tulo**: FastAPI y NextJS: Creamos los modelos con sus relaciones | Curso App Full Stack #5
- **URL**: https://www.youtube.com/watch?v=z1Q8dcP5jWI
- **Duraci√≥n**: 22:06 minutos
- **Vistas**: 221
- **Publicado**: Hace 2 meses

### üìù Resumen Ejecutivo

Este episodio se sumerge en el modelado completo de la base de datos, implementando un esquema relacional robusto con SQLAlchemy. El instructor dise√±a modelos complejos con diferentes tipos de relaciones (1:1, 1:N, N:M), configura cascadas y comportamientos de eliminaci√≥n apropiados, e implementa caracter√≠sticas avanzadas como timestamps autom√°ticos y enums para estados.

Se hace especial √©nfasis en las mejores pr√°cticas de dise√±o de bases de datos: normalizaci√≥n, indices, foreign keys con comportamiento expl√≠cito, y la separaci√≥n entre modelos ORM (SQLAlchemy) y esquemas de validaci√≥n (Pydantic). El episodio culmina con la configuraci√≥n completa de Alembic para migraciones y la aplicaci√≥n exitosa del esquema en PostgreSQL.

### üéØ Objetivos del Episodio

**Objetivo Principal**: Dise√±ar e implementar un esquema completo de base de datos con relaciones complejas

**Objetivos Espec√≠ficos**:
1. ‚úÖ Dise√±ar esquema ER (Entidad-Relaci√≥n) completo
2. ‚úÖ Crear modelo base con timestamps autom√°ticos
3. ‚úÖ Implementar modelo User completo
4. ‚úÖ Implementar modelo Project con relaci√≥n 1:N a User
5. ‚úÖ Implementar modelo Task con relaciones m√∫ltiples
6. ‚úÖ Implementar modelo Tag con relaci√≥n N:M a Task
7. ‚úÖ Configurar Alembic para migraciones
8. ‚úÖ Crear esquemas Pydantic correspondientes
9. ‚úÖ Aplicar migraciones en PostgreSQL

### üîë Puntos Clave T√©cnicos

#### 1. Dise√±o del Esquema de Base de Datos

**Entidades Principales**:
- **User**: Usuarios del sistema
- **Project**: Proyectos creados por usuarios
- **Task**: Tareas dentro de proyectos
- **Tag**: Etiquetas para categorizar tareas

**Relaciones Dise√±adas**:
```
User (1) ‚îÄ‚îÄ< Project (N)     [Un usuario tiene muchos proyectos]
Project (1) ‚îÄ‚îÄ< Task (N)     [Un proyecto tiene muchas tareas]
User (1) ‚îÄ‚îÄ< Task (N)        [Un usuario tiene tareas asignadas - opcional]
Task (N) ><‚îÄ‚îÄ Tag (M)        [Muchas tareas tienen muchos tags]
```

**Decisiones de Dise√±o**:
- User como "owner" de Projects (no puede ser nulo)
- Task asignada a User es opcional (puede ser NULL)
- Cascadas apropiadas para mantener integridad referencial
- Indices en foreign keys para performance

#### 2. Modelo Base con Timestamps

**models/base.py**:
```python
from datetime import datetime
from sqlalchemy import Column, Integer, DateTime
from sqlalchemy.ext.declarative import declared_attr
from app.db.base import Base

class TimestampMixin:
    """Mixin para timestamps autom√°ticos"""
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(
        DateTime, 
        default=datetime.utcnow, 
        onupdate=datetime.utcnow, 
        nullable=False
    )

class BaseModel(Base, TimestampMixin):
    """Clase base para todos los modelos"""
    __abstract__ = True
    
    id = Column(Integer, primary_key=True, index=True, autoincrement=True)
    
    @declared_attr
    def __tablename__(cls) -> str:
        return cls.__name__.lower()
```

**Beneficios del Modelo Base**:
- DRY: `id`, `created_at`, `updated_at` en todos los modelos autom√°ticamente
- `datetime.utcnow` sin `()` para lazy evaluation
- `onupdate` actualiza `updated_at` en cada UPDATE
- `__abstract__ = True` evita crear tabla para BaseModel
- `declared_attr` para generar `__tablename__` din√°micamente

#### 3. Modelo User Completo

**models/user.py**:
```python
from sqlalchemy import Boolean, Column, String
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class User(BaseModel):
    __tablename__ = "users"
    
    # Campos b√°sicos
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(255), unique=True, index=True, nullable=False)
    full_name = Column(String(100), nullable=True)
    hashed_password = Column(String(255), nullable=False)
    
    # Estados booleanos
    is_active = Column(Boolean, default=True)
    is_superuser = Column(Boolean, default=False)
    is_verified = Column(Boolean, default=False)
    
    # Relaciones
    projects = relationship(
        "Project", 
        back_populates="owner",
        cascade="all, delete-orphan",
        lazy="dynamic"
    )
    
    assigned_tasks = relationship(
        "Task",
        back_populates="assignee",
        foreign_keys="[Task.assigned_to_id]",
        lazy="dynamic"
    )
```

**Caracter√≠sticas Importantes**:
- `unique=True` en username y email
- `index=True` en campos de b√∫squeda frecuente
- `cascade="all, delete-orphan"` elimina proyectos si se elimina usuario
- `lazy="dynamic"` para cargar relaciones bajo demanda
- `foreign_keys` expl√≠cito cuando hay ambig√ºedad

**Esquema Pydantic Correspondiente**:
```python
from pydantic import BaseModel, EmailStr, Field

class UserBase(BaseModel):
    email: EmailStr
    username: str = Field(..., min_length=3, max_length=50)
    full_name: Optional[str] = None

class UserCreate(UserBase):
    password: str = Field(..., min_length=8)

class User(UserBase):
    id: int
    is_active: bool
    is_superuser: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True  # Antes orm_mode
```

#### 4. Relaci√≥n 1:N (Project pertenece a User)

**models/project.py**:
```python
from sqlalchemy import Boolean, Column, String, Text, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class Project(BaseModel):
    __tablename__ = "projects"
    
    name = Column(String(100), nullable=False, index=True)
    description = Column(Text, nullable=True)
    is_active = Column(Boolean, default=True)
    
    # Foreign Key a User
    owner_id = Column(
        Integer, 
        ForeignKey("users.id", ondelete="CASCADE"),
        nullable=False,
        index=True
    )
    
    # Relaciones
    owner = relationship("User", back_populates="projects")
    tasks = relationship(
        "Task",
        back_populates="project",
        cascade="all, delete-orphan",
        lazy="dynamic"
    )
```

**Aspectos Clave**:
- `ForeignKey("users.id", ondelete="CASCADE")`
  - Si se elimina el usuario, se eliminan sus proyectos
  - Integridad referencial a nivel de BD
- `nullable=False` en `owner_id`
  - Proyecto DEBE tener un owner
  - No puede existir proyecto hu√©rfano
- `index=True` en foreign keys
  - Acelera queries `WHERE owner_id = X`
  - Crucial para performance

#### 5. Modelo Task con Relaciones M√∫ltiples y Enums

**models/task.py**:
```python
from sqlalchemy import Column, String, Text, Integer, ForeignKey, Enum, Date
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel

class TaskStatus(str, enum.Enum):
    TODO = "todo"
    IN_PROGRESS = "in_progress"
    IN_REVIEW = "in_review"
    DONE = "done"
    CANCELLED = "cancelled"

class TaskPriority(str, enum.Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    URGENT = "urgent"

class Task(BaseModel):
    __tablename__ = "tasks"
    
    title = Column(String(200), nullable=False, index=True)
    description = Column(Text, nullable=True)
    status = Column(Enum(TaskStatus), default=TaskStatus.TODO, nullable=False, index=True)
    priority = Column(Enum(TaskPriority), default=TaskPriority.MEDIUM, nullable=False)
    due_date = Column(Date, nullable=True)
    
    # FK a Project (requerido)
    project_id = Column(
        Integer,
        ForeignKey("projects.id", ondelete="CASCADE"),
        nullable=False,
        index=True
    )
    
    # FK a User (opcional)
    assigned_to_id = Column(
        Integer,
        ForeignKey("users.id", ondelete="SET NULL"),
        nullable=True,
        index=True
    )
    
    # Relaciones
    project = relationship("Project", back_populates="tasks")
    assignee = relationship("User", back_populates="assigned_tasks", foreign_keys=[assigned_to_id])
    tags = relationship("Tag", secondary="task_tags", back_populates="tasks", lazy="dynamic")
```

**Caracter√≠sticas Avanzadas**:
- **Enums**: Valores restringidos a nivel de BD
  - `str, enum.Enum` para compatibilidad Pydantic
  - Previene datos inv√°lidos
  - Mejor que strings libres
- **ondelete Diferenciados**:
  - `CASCADE` para project: eliminar task si se elimina proyecto
  - `SET NULL` para assignee: dejar sin asignar si se elimina usuario
- **√çndice en status**: Queries frecuentes por estado
- **Relaci√≥n N:M** con tags via tabla intermedia

#### 6. Relaci√≥n N:M (Task ‚Üî Tag)

**models/tag.py**:
```python
from sqlalchemy import Column, String, Integer, ForeignKey, Table
from sqlalchemy.orm import relationship
from app.models.base import BaseModel, Base

# Tabla intermedia (association table)
task_tags = Table(
    'task_tags',
    Base.metadata,
    Column('task_id', Integer, ForeignKey('tasks.id', ondelete="CASCADE"), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete="CASCADE"), primary_key=True)
)

class Tag(BaseModel):
    __tablename__ = "tags"
    
    name = Column(String(50), unique=True, nullable=False, index=True)
    color = Column(String(7), default="#808080")  # Hex color
    
    # Relaci√≥n N:M
    tasks = relationship(
        "Task",
        secondary=task_tags,
        back_populates="tags",
        lazy="dynamic"
    )
```

**Relaci√≥n N:M Explicada**:
- **Tabla Intermedia**: `task_tags` sin modelo ORM
  - Solo une IDs de tasks y tags
  - Primary key compuesta (task_id, tag_id)
  - Cascadas en ambas direcciones
- **secondary**: SQLAlchemy maneja autom√°ticamente la tabla intermedia
- **Uso**:
  ```python
  task.tags.append(tag)  # Agregar tag a task
  task.tags.remove(tag)  # Quitar tag de task
  tags_of_task = task.tags.all()  # Obtener tags de task
  tasks_with_tag = tag.tasks.all()  # Obtener tasks con tag
  ```

#### 7. Migraciones con Alembic

**Configuraci√≥n de Alembic**:
```bash
# Inicializar Alembic
alembic init alembic
```

**alembic/env.py (configurado)**:
```python
from app.core.config import settings
from app.db.base import Base
# Importar TODOS los modelos para detecci√≥n autom√°tica
from app.models import user, project, task, tag

config.set_main_option("sqlalchemy.url", settings.DATABASE_URL)
target_metadata = Base.metadata

def run_migrations_online():
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )
    with connectable.connect() as connection:
        context.configure(connection=connection, target_metadata=target_metadata)
        with context.begin_transaction():
            context.run_migrations()
```

**Comandos de Alembic**:
```bash
# Crear migraci√≥n autom√°tica
alembic revision --autogenerate -m "Create all tables"

# Revisar migraci√≥n generada
# alembic/versions/001_create_all_tables.py

# Aplicar migraciones
alembic upgrade head

# Ver estado actual
alembic current

# Ver historial
alembic history

# Revertir √∫ltima migraci√≥n
alembic downgrade -1

# Revertir todo
alembic downgrade base
```

**Migraci√≥n Generada (simplificado)**:
```python
def upgrade():
    op.create_table(
        'users',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('username', sa.String(50), nullable=False),
        sa.Column('email', sa.String(255), nullable=False),
        # ... m√°s columnas
        sa.PrimaryKeyConstraint('id'),
        sa.UniqueConstraint('email'),
        sa.UniqueConstraint('username')
    )
    op.create_index('ix_users_email', 'users', ['email'])
    
    op.create_table(
        'projects',
        # ... definici√≥n
        sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ondelete='CASCADE')
    )
    
    # ... m√°s tablas

def downgrade():
    op.drop_table('task_tags')
    op.drop_table('tasks')
    op.drop_table('tags')
    op.drop_table('projects')
    op.drop_table('users')
```

### üíº Tecnolog√≠as y Conceptos Utilizados

| Concepto | Implementaci√≥n | Beneficio |
|----------|----------------|-----------|
| SQLAlchemy ORM | Modelos declarativos | Abstracci√≥n de SQL |
| Alembic | Sistema de migraciones | Versionado de esquema |
| Pydantic Schemas | Validaci√≥n de I/O | Type safety |
| Enums | TaskStatus, TaskPriority | Valores restringidos |
| Timestamps | created_at, updated_at | Auditor√≠a autom√°tica |
| Cascadas | ondelete behaviors | Integridad referencial |
| √çndices | index=True en campos clave | Performance de queries |
| Relaciones 1:N | User‚ÜíProjects, Project‚ÜíTasks | Modelado jer√°rquico |
| Relaciones N:M | Task‚ÜîTag | Clasificaci√≥n flexible |

### ‚úÖ Resultados Alcanzados

Al finalizar este episodio:

1. **Esquema de BD Completo**:
   - 4 tablas principales (users, projects, tasks, tags)
   - 1 tabla intermedia (task_tags)
   - Todas las relaciones configuradas

2. **Modelos SQLAlchemy**:
   - Modelo base reutilizable
   - Timestamps autom√°ticos
   - Relaciones bidireccionales
   - Cascadas y comportamientos configurados

3. **Esquemas Pydantic**:
   - Schemas de creaci√≥n (Create)
   - Schemas de actualizaci√≥n (Update)
   - Schemas de respuesta (Response)
   - Validaciones con Field()

4. **Sistema de Migraciones**:
   - Alembic configurado
   - Migraci√≥n inicial creada
   - Esquema aplicado en PostgreSQL

5. **Features Avanzadas**:
   - Enums para estados
   - Relaciones opcionales y requeridas
   - Tabla intermedia para N:M
   - √çndices para performance

6. **Integridad de Datos**:
   - Foreign keys con constraints
   - Unique constraints
   - NOT NULL donde corresponde
   - Cascadas para mantener consistencia

### üîó Conexi√≥n con Episodios Previos/Siguientes

**Depende de**:
- **Episodio 2**: Configuraci√≥n de SQLAlchemy
- **Episodio 4**: Repositorios preparados para estos modelos

**Utiliza**:
- **Arquitectura del Ep. 4**: Estos modelos usan los repositorios y servicios

**Prepara para**:
- **Episodios futuros**: CRUD completo con estos modelos
- **Endpoints**: API para proyectos, tareas y tags
- **Frontend**: UI para gestionar todas estas entidades

**Evoluci√≥n del Proyecto**:
```
Ep 2: Configuraci√≥n SQLAlchemy b√°sica
Ep 4: Arquitectura en capas
Ep 5: Modelos complejos + Migraciones
      ‚Üì
Pr√≥ximo: CRUD completo + WebSockets
```

### üìå Notas Importantes

> **Importar Modelos**: En `alembic/env.py`, importar TODOS los modelos para que Alembic los detecte en autogenerate.

> **Revisar Migraciones**: SIEMPRE revisar migraciones autogeneradas antes de aplicarlas. Alembic puede equivocarse.

> **Orden de Creaci√≥n**: Las migraciones crean tablas en orden correcto respetando foreign keys (primero users, luego projects, luego tasks).

> **Cascadas**: `ondelete="CASCADE"` vs `ondelete="SET NULL"` tienen implicaciones importantes. Elegir seg√∫n la sem√°ntica del negocio.

> **Enums**: SQLAlchemy crea un tipo ENUM en PostgreSQL. Cambiar enums requiere migraci√≥n cuidadosa.

> **lazy="dynamic"**: Retorna query en lugar de lista. √ötil para relaciones con muchos registros.

### üé¨ Estructura del Episodio

```
[00:00-03:00] ‚Üí Introducci√≥n y dise√±o del esquema ER
[03:00-07:00] ‚Üí Implementaci√≥n del modelo base y User
[07:00-10:00] ‚Üí Modelo Project con relaci√≥n 1:N
[10:00-14:00] ‚Üí Modelo Task con relaciones m√∫ltiples y enums
[14:00-17:00] ‚Üí Modelo Tag y relaci√≥n N:M
[17:00-20:00] ‚Üí Configuraci√≥n de Alembic y creaci√≥n de migraci√≥n
[20:00-22:06] ‚Üí Aplicar migraciones y verificaci√≥n en PostgreSQL
```

### üí° Tips del Instructor

1. **Sobre Dise√±o de Esquema**: Dibuja el diagrama ER antes de codificar. Ayuda a visualizar relaciones.

2. **Sobre Migraciones**: Usa mensajes descriptivos. Ser√°s t√∫ en el futuro quien los lea.

3. **Sobre Enums**: Define enums en el modelo SQLAlchemy. Pydantic los importa autom√°ticamente.

4. **Sobre Relaciones**: `back_populates` debe coincidir en ambos modelos o fallar√°.

5. **Sobre √çndices**: Indexar foreign keys es crucial. PostgreSQL no lo hace autom√°ticamente.

6. **Sobre Timestamps**: Siempre usar UTC (`datetime.utcnow`). Convertir a timezone local en el frontend.

7. **Sobre Cascadas**: Documentar decisiones de `ondelete` en comentarios. No siempre es obvio por qu√© se eligi√≥ CASCADE vs SET NULL.

---

## üìä RESUMEN COMPARATIVO DE LA SERIE

### Duraci√≥n y Popularidad

| Episodio | Duraci√≥n | Vistas | Me Gusta | Complejidad | Enfoque Principal |
|----------|----------|--------|----------|-------------|-------------------|
| 1 | 10:13 | 650 | 55 | ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ | Conceptual |
| 2 | 43:31 ‚≠ê | 538 | 33 | ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ | Implementaci√≥n Backend |
| 3 | 28:14 | 258 | 18 | ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ | Implementaci√≥n Frontend |
| 4 | 16:14 | 142 | 10 | ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ | Arquitectura Avanzada |
| 5 | 22:06 | 221 | 15 | ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ | Modelado de Datos |
| **Total** | **~2h** | **1,809** | **131** | - | - |

### Progresi√≥n del Conocimiento

```
Episodio 1: CONCEPTOS
‚Üì (comprensi√≥n general)

Episodio 2: BACKEND B√ÅSICO
‚Üì (implementaci√≥n inicial)

Episodio 3: FRONTEND B√ÅSICO
‚Üì (aplicaci√≥n funcionando end-to-end)

Episodio 4: REFACTORING PROFESIONAL
‚Üì (c√≥digo de calidad producci√≥n)

Episodio 5: DATOS COMPLEJOS
‚Üì (modelado avanzado)

[Episodios Futuros]: FEATURES COMPLETAS
```

### Stack Tecnol√≥gico Final

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           FULL STACK COMPLETO               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Frontend:                                   ‚îÇ
‚îÇ  ‚Ä¢ Next.js 14 (App Router)                 ‚îÇ
‚îÇ  ‚Ä¢ TypeScript 5                             ‚îÇ
‚îÇ  ‚Ä¢ TailwindCSS 3                            ‚îÇ
‚îÇ  ‚Ä¢ shadcn/ui                                ‚îÇ
‚îÇ  ‚Ä¢ axios                                    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ Backend:                                    ‚îÇ
‚îÇ  ‚Ä¢ FastAPI 0.109+                          ‚îÇ
‚îÇ  ‚Ä¢ Python 3.11+                             ‚îÇ
‚îÇ  ‚Ä¢ SQLAlchemy 2.0                           ‚îÇ
‚îÇ  ‚Ä¢ Alembic                                  ‚îÇ
‚îÇ  ‚Ä¢ Pydantic 2.5+                            ‚îÇ
‚îÇ  ‚Ä¢ JWT (python-jose)                        ‚îÇ
‚îÇ  ‚Ä¢ bcrypt (passlib)                         ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ Base de Datos:                              ‚îÇ
‚îÇ  ‚Ä¢ PostgreSQL 15                            ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ DevOps:                                     ‚îÇ
‚îÇ  ‚Ä¢ Docker/Podman                            ‚îÇ
‚îÇ  ‚Ä¢ docker-compose                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Conclusi√≥n de la Serie (hasta ahora)

Estos 5 episodios establecen una base s√≥lida y profesional para una aplicaci√≥n Full Stack moderna. La progresi√≥n es l√≥gica y bien estructurada:

1. **Visi√≥n** ‚Üí Sabes QU√â vas a construir
2. **Backend** ‚Üí Tienes un servidor funcionando
3. **Frontend** ‚Üí Tienes una UI que consume la API
4. **Arquitectura** ‚Üí C√≥digo profesional y escalable
5. **Datos** ‚Üí Modelo de datos robusto

Los pr√≥ximos episodios (anticipados) cubrir√≠an:
- CRUD completo para todas las entidades
- Autenticaci√≥n completa (JWT, cookies, refresh tokens)
- WebSockets implementados
- Testing comprehensivo
- Despliegue en producci√≥n

**Valor de la Serie**: Este no es un tutorial b√°sico. Es una gu√≠a completa para construir aplicaciones profesionales con stack moderno, siguiendo mejores pr√°cticas desde el inicio.

---

*Fin del Documento 3*

## --------------------------------------------------

---

## DOCUMENTO 4: GU√çA DE IMPLEMENTACI√ìN PR√ÅCTICA
# DOCUMENTO 4: GU√çA DE IMPLEMENTACI√ìN PR√ÅCTICA
## Aplicaci√≥n Full Stack con FastAPI y Next.js
### Gu√≠a Paso a Paso para Replicar el Proyecto

---

## üìã TABLA DE CONTENIDOS

1. [Requisitos Previos y Herramientas](#requisitos-previos-y-herramientas)
2. [Instalaci√≥n y Configuraci√≥n del Entorno](#instalaci√≥n-y-configuraci√≥n-del-entorno)
3. [Configuraci√≥n del Backend (FastAPI)](#configuraci√≥n-del-backend-fastapi)
4. [Configuraci√≥n del Frontend (Next.js)](#configuraci√≥n-del-frontend-nextjs)
5. [Configuraci√≥n de la Base de Datos](#configuraci√≥n-de-la-base-de-datos)
6. [Estructura Completa de Archivos](#estructura-completa-de-archivos)
7. [C√≥digo Completo por M√≥dulos](#c√≥digo-completo-por-m√≥dulos)
8. [Comandos de Terminal Necesarios](#comandos-de-terminal-necesarios)
9. [Checklist de Verificaci√≥n](#checklist-de-verificaci√≥n)
10. [Troubleshooting Com√∫n](#troubleshooting-com√∫n)

---

## 1. REQUISITOS PREVIOS Y HERRAMIENTAS

### üîß Software Necesario

#### Obligatorio

| Herramienta | Versi√≥n M√≠nima | Prop√≥sito | Descarga |
|-------------|---------------|-----------|----------|
| **Python** | 3.11+ | Backend con FastAPI | https://www.python.org/downloads/ |
| **Node.js** | 18+ LTS | Frontend con Next.js | https://nodejs.org/ |
| **Docker** | 20+ | Contenedorizaci√≥n | https://www.docker.com/ |
| **Git** | 2.30+ | Control de versiones | https://git-scm.com/ |

#### Alternativas a Docker

| Herramienta | Ventaja | Descarga |
|-------------|---------|----------|
| **Podman** | No requiere daemon root | https://podman.io/ |
| **PostgreSQL Local** | Sin contenedores | https://www.postgresql.org/download/ |

#### Editores de C√≥digo Recomendados

| Editor | Ventajas | Extensiones Recomendadas |
|--------|----------|--------------------------|
| **VSCode** | Ecosistema rico, gratis | Python, Pylance, ESLint, Prettier, Tailwind CSS IntelliSense |
| **PyCharm** | Excelente para Python | N/A (integrado) |
| **WebStorm** | Excelente para Next.js | N/A (integrado) |

### üìö Conocimientos Previos Recomendados

**Nivel M√≠nimo**: Intermedio

**Backend**:
- ‚úÖ Python b√°sico (funciones, clases, decoradores)
- ‚úÖ Conceptos de API REST (GET, POST, PUT, DELETE)
- ‚úÖ SQL b√°sico (SELECT, INSERT, UPDATE, DELETE)
- ‚≠ê Async/await en Python (deseable)
- ‚≠ê ORM (SQLAlchemy) (deseable)

**Frontend**:
- ‚úÖ JavaScript/TypeScript b√°sico
- ‚úÖ React fundamentals (components, hooks)
- ‚úÖ CSS b√°sico
- ‚≠ê Next.js App Router (deseable)
- ‚≠ê TailwindCSS (deseable)

**DevOps**:
- ‚úÖ Terminal/L√≠nea de comandos
- ‚úÖ Conceptos b√°sicos de Docker
- ‚≠ê docker-compose (deseable)

### üåê Recursos de Aprendizaje

Si necesitas repasar alg√∫n concepto:

- **Python Async**: https://docs.python.org/3/library/asyncio.html
- **FastAPI Tutorial**: https://fastapi.tiangolo.com/tutorial/
- **Next.js Learn**: https://nextjs.org/learn
- **SQLAlchemy Docs**: https://docs.sqlalchemy.org/
- **Docker Get Started**: https://docs.docker.com/get-started/

---

## 2. INSTALACI√ìN Y CONFIGURACI√ìN DEL ENTORNO

### üöÄ Paso 1: Verificar Instalaciones

Abre una terminal y verifica que todo est√© instalado:

```bash
# Verificar Python
python --version
# Debe mostrar: Python 3.11.x o superior

# Verificar pip
pip --version

# Verificar Node.js
node --version
# Debe mostrar: v18.x.x o superior

# Verificar npm
npm --version

# Verificar Docker
docker --version
docker-compose --version

# Verificar Git
git --version
```

**¬øAlgo falta?** Instala desde los links de la secci√≥n anterior.

### üöÄ Paso 2: Crear Estructura del Proyecto

```bash
# Crear directorio principal
mkdir fastapi-nextjs-fullstack
cd fastapi-nextjs-fullstack

# Inicializar repositorio Git
git init

# Crear .gitignore
touch .gitignore
```

**Contenido de `.gitignore`**:
```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
.env
*.db
*.log

# Node
node_modules/
.next/
out/
.env.local
.env.production.local
.turbo

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Database
*.sql
postgres_data/

# Docker
*.log
```

### üöÄ Paso 3: Crear Directorios del Proyecto

```bash
# Crear estructura base
mkdir -p backend/app/{api/v1/endpoints,core,db,models,repositories,schemas,services}
mkdir -p frontend/src/{app,components/ui,lib,hooks,types}
mkdir -p postgres_data

# √Årbol resultante:
# .
# ‚îú‚îÄ‚îÄ backend/
# ‚îÇ   ‚îî‚îÄ‚îÄ app/
# ‚îú‚îÄ‚îÄ frontend/
# ‚îÇ   ‚îî‚îÄ‚îÄ src/
# ‚îú‚îÄ‚îÄ postgres_data/
# ‚îî‚îÄ‚îÄ .gitignore
```

---

## 3. CONFIGURACI√ìN DEL BACKEND (FASTAPI)

### üì¶ Paso 1: Crear Entorno Virtual de Python

```bash
cd backend

# Crear entorno virtual
python -m venv venv

# Activar entorno virtual
# En Linux/Mac:
source venv/bin/activate
# En Windows:
venv\Scripts\activate

# Tu terminal ahora deber√≠a mostrar (venv) al inicio
```

**‚ö†Ô∏è IMPORTANTE**: Siempre activa el entorno virtual antes de trabajar con el backend.

### üì¶ Paso 2: Instalar Dependencias de Python

Crear `requirements.txt`:

```txt
# Framework
fastapi==0.109.0
uvicorn[standard]==0.27.0

# Base de datos
sqlalchemy==2.0.25
alembic==1.13.1
psycopg2-binary==2.9.9

# Validaci√≥n y configuraci√≥n
pydantic==2.5.3
pydantic-settings==2.1.0
python-dotenv==1.0.0

# Autenticaci√≥n
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# WebSockets
websockets==12.0

# CORS
python-cors==1.0.0

# Utilidades
python-dateutil==2.8.2
```

Instalar:

```bash
pip install -r requirements.txt

# Verificar instalaci√≥n
pip list
```

### üì¶ Paso 3: Configurar Variables de Entorno

Crear `backend/.env`:

```env
# Aplicaci√≥n
APP_NAME="FastAPI Full Stack Application"
DEBUG=True
VERSION="1.0.0"

# Base de datos
DATABASE_URL=postgresql://fastapi_user:SecurePassword123@localhost:5432/fullstack_db

# Seguridad
SECRET_KEY=your-super-secret-key-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS
ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# Servidor
HOST=0.0.0.0
PORT=8000
```

**üîê Generar SECRET_KEY Seguro**:
```bash
# Usar Python para generar clave aleatoria
python -c "import secrets; print(secrets.token_urlsafe(32))"

# O usar openssl
openssl rand -hex 32
```

### üì¶ Paso 4: Estructura de Archivos del Backend

Crear todos los archivos Python necesarios:

```bash
# Desde backend/

# Archivos de paquete (__init__.py)
touch app/__init__.py
touch app/api/__init__.py
touch app/api/v1/__init__.py
touch app/api/v1/endpoints/__init__.py
touch app/core/__init__.py
touch app/db/__init__.py
touch app/models/__init__.py
touch app/repositories/__init__.py
touch app/schemas/__init__.py
touch app/services/__init__.py

# Archivos principales
touch app/main.py
touch app/core/config.py
touch app/core/security.py
touch app/db/base.py
touch app/db/session.py
touch app/api/deps.py
touch app/api/v1/router.py

# Modelos
touch app/models/base.py
touch app/models/user.py
touch app/models/project.py
touch app/models/task.py
touch app/models/tag.py

# Schemas
touch app/schemas/user.py
touch app/schemas/project.py
touch app/schemas/task.py
touch app/schemas/tag.py
touch app/schemas/token.py

# Repositories
touch app/repositories/base.py
touch app/repositories/user.py
touch app/repositories/project.py

# Services
touch app/services/user_service.py
touch app/services/auth_service.py

# Endpoints
touch app/api/v1/endpoints/auth.py
touch app/api/v1/endpoints/users.py
touch app/api/v1/endpoints/health.py

# Dockerfile
touch Dockerfile
```

### üì¶ Paso 5: Configurar Alembic

```bash
# Desde backend/ con venv activado
alembic init alembic

# Esto crea:
# alembic/
# ‚îú‚îÄ‚îÄ env.py
# ‚îú‚îÄ‚îÄ script.py.mako
# ‚îî‚îÄ‚îÄ versions/
# alembic.ini
```

Modificar `alembic.ini`:

```ini
# L√≠nea ~40: Comentar sqlalchemy.url
# sqlalchemy.url = driver://user:pass@localhost/dbname

# La URL se obtendr√° din√°micamente de .env
```

---

## 4. CONFIGURACI√ìN DEL FRONTEND (NEXT.JS)

### üì¶ Paso 1: Crear Proyecto Next.js

```bash
# Desde la ra√≠z del proyecto
cd ..  # Salir de backend/

# Crear proyecto Next.js
npx create-next-app@latest frontend \
  --typescript \
  --tailwind \
  --app \
  --src-dir \
  --no-git \
  --import-alias "@/*"

# Opciones interactivas (si las pide):
# ‚úî Use ESLint? ‚Üí Yes
# ‚úî Use Turbopack? ‚Üí No
# ‚úî Customize default import alias? ‚Üí No
```

### üì¶ Paso 2: Instalar Dependencias Adicionales

```bash
cd frontend

# Cliente HTTP
npm install axios

# Validaci√≥n de formularios
npm install react-hook-form zod @hookform/resolvers

# shadcn/ui (componentes UI)
npx shadcn-ui@latest init

# Configuraci√≥n interactiva de shadcn:
# ‚úî Style ‚Üí Default
# ‚úî Base color ‚Üí Slate
# ‚úî CSS variables ‚Üí Yes

# Instalar componentes shadcn espec√≠ficos
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add card
npx shadcn-ui@latest add form
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add dropdown-menu
npx shadcn-ui@latest add toast
npx shadcn-ui@latest add select
npx shadcn-ui@latest add label
```

### üì¶ Paso 3: Configurar Variables de Entorno

Crear `frontend/.env.local`:

```env
# API Backend
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws

# Aplicaci√≥n
NEXT_PUBLIC_APP_NAME="Full Stack App"
```

**‚ö†Ô∏è Nota**: Prefijo `NEXT_PUBLIC_` es obligatorio para variables accesibles en el cliente.

### üì¶ Paso 4: Configurar Next.js

Modificar `frontend/next.config.js`:

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone',  // Para Docker
  images: {
    domains: ['localhost'],  // Permitir im√°genes de localhost
  },
  eslint: {
    ignoreDuringBuilds: false,
  },
  typescript: {
    ignoreBuildErrors: false,
  },
}

module.exports = nextConfig
```

### üì¶ Paso 5: Estructura de Archivos del Frontend

```bash
# Desde frontend/

# Crear estructura de carpetas adicionales
mkdir -p src/components/layout
mkdir -p src/components/forms
mkdir -p src/lib
mkdir -p src/hooks
mkdir -p src/types
mkdir -p src/app/(auth)/login
mkdir -p src/app/(auth)/register
mkdir -p src/app/(protected)/dashboard

# Crear archivos principales
touch src/lib/api.ts
touch src/lib/auth.ts
touch src/lib/utils.ts
touch src/hooks/useAuth.ts
touch src/types/api.ts
touch src/components/layout/Header.tsx
touch src/components/layout/Footer.tsx
```

---

## 5. CONFIGURACI√ìN DE LA BASE DE DATOS

### üêò Opci√≥n A: PostgreSQL con Docker (Recomendado)

Crear `docker-compose.yml` en la ra√≠z del proyecto:

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: SecurePassword123
      POSTGRES_DB: fullstack_db
    ports:
      - "5432:5432"
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U fastapi_user -d fullstack_db"]
      interval: 10s
      timeout: 5s
      retries: 5

  backend:
    build: ./backend
    container_name: fullstack_backend
    environment:
      DATABASE_URL: postgresql://fastapi_user:SecurePassword123@postgres:5432/fullstack_db
    env_file:
      - ./backend/.env
    ports:
      - "8000:8000"
    volumes:
      - ./backend/app:/app/app
    depends_on:
      postgres:
        condition: service_healthy
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  frontend:
    build: ./frontend
    container_name: fullstack_frontend
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8000/api/v1
    ports:
      - "3000:3000"
    volumes:
      - ./frontend/src:/app/src
    depends_on:
      - backend
    command: npm run dev

volumes:
  postgres_data:
```

**Iniciar servicios**:

```bash
# Desde la ra√≠z del proyecto
docker-compose up -d postgres

# Verificar que PostgreSQL est√© corriendo
docker-compose ps

# Ver logs
docker-compose logs -f postgres
```

### üêò Opci√≥n B: PostgreSQL Local (Sin Docker)

**Instalaci√≥n**:

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install postgresql postgresql-contrib

# macOS (con Homebrew)
brew install postgresql@15
brew services start postgresql@15

# Windows: Descargar desde postgresql.org
```

**Crear base de datos**:

```bash
# Conectarse a PostgreSQL
psql postgres

# Dentro de psql:
CREATE USER fastapi_user WITH PASSWORD 'SecurePassword123';
CREATE DATABASE fullstack_db OWNER fastapi_user;
GRANT ALL PRIVILEGES ON DATABASE fullstack_db TO fastapi_user;
\q
```

**Actualizar `backend/.env`**:
```env
DATABASE_URL=postgresql://fastapi_user:SecurePassword123@localhost:5432/fullstack_db
```

---

## 6. ESTRUCTURA COMPLETA DE ARCHIVOS

### üìÅ Vista Completa del Proyecto

```
fastapi-nextjs-fullstack/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ alembic/                    # Migraciones de BD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ versions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ env.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ script.py.mako
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # ‚≠ê Punto de entrada
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py             # ‚≠ê Dependencias
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ router.py       # ‚≠ê Router principal v1
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ endpoints/
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ auth.py     # Login, register
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ users.py    # CRUD usuarios
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ health.py   # Health check
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py           # ‚≠ê Configuraci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.py         # ‚≠ê JWT, hashing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py             # Base declarativa
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session.py          # ‚≠ê SessionLocal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py             # ‚≠ê BaseModel
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py             # ‚≠ê Modelo User
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project.py          # Modelo Project
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task.py             # Modelo Task
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tag.py              # Modelo Tag
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py             # ‚≠ê BaseRepository
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py             # UserRepository
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ project.py          # ProjectRepository
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py             # ‚≠ê UserCreate, UserResponse
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tag.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ token.py            # ‚≠ê Token schemas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ user_service.py     # ‚≠ê L√≥gica de negocio User
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ auth_service.py     # ‚≠ê L√≥gica de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ tests/                      # Tests (futuro)
‚îÇ   ‚îú‚îÄ‚îÄ .env                        # ‚ö†Ô∏è NO commitear
‚îÇ   ‚îú‚îÄ‚îÄ .env.example                # Template de .env
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt            # ‚≠ê Dependencias Python
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile                  # ‚≠ê Imagen Docker backend
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini                 # Config Alembic
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx          # ‚≠ê Root layout
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            # ‚≠ê Home page
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/             # Grupo de rutas
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (protected)/        # Rutas protegidas
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # ‚≠ê shadcn components
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ forms/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts              # ‚≠ê Cliente API axios
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts             # Helpers de auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts            # Utilidades
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts          # ‚≠ê Hook de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useWebSocket.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts              # ‚≠ê Tipos TypeScript
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ globals.css         # ‚≠ê Estilos globales
‚îÇ   ‚îú‚îÄ‚îÄ .env.local                  # ‚ö†Ô∏è NO commitear
‚îÇ   ‚îú‚îÄ‚îÄ .env.example
‚îÇ   ‚îú‚îÄ‚îÄ next.config.js              # ‚≠ê Config Next.js
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.ts          # ‚≠ê Config Tailwind
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json               # ‚≠ê Config TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ package.json                # ‚≠ê Dependencias Node
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile                  # ‚≠ê Imagen Docker frontend
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ postgres_data/                  # ‚ö†Ô∏è NO commitear (volumen Docker)
‚îú‚îÄ‚îÄ docker-compose.yml              # ‚≠ê Orquestaci√≥n de servicios
‚îú‚îÄ‚îÄ .gitignore                      # ‚≠ê Archivos ignorados por Git
‚îî‚îÄ‚îÄ README.md                       # ‚≠ê Documentaci√≥n principal
```

**Leyenda**:
- ‚≠ê Archivo cr√≠tico/principal
- ‚ö†Ô∏è No debe estar en Git
- üìÅ Carpeta

---

## 7. C√ìDIGO COMPLETO POR M√ìDULOS

### üêç BACKEND - C√≥digo Python

#### 7.1. Configuraci√≥n Principal

**`backend/app/core/config.py`**:
```python
from pydantic_settings import BaseSettings
from typing import List

class Settings(BaseSettings):
    # Aplicaci√≥n
    APP_NAME: str = "FastAPI Full Stack"
    DEBUG: bool = False
    VERSION: str = "1.0.0"
    
    # Base de datos
    DATABASE_URL: str
    
    # Seguridad
    SECRET_KEY: str
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # CORS
    ALLOWED_ORIGINS: List[str] = ["http://localhost:3000"]
    
    # Servidor
    HOST: str = "0.0.0.0"
    PORT: int = 8000
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

#### 7.2. Seguridad y Autenticaci√≥n

**`backend/app/core/security.py`**:
```python
from datetime import datetime, timedelta
from typing import Optional
from jose import JWTError, jwt
from passlib.context import CryptContext
from app.core.config import settings

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """Verificar contrase√±a"""
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """Hashear contrase√±a"""
    return pwd_context.hash(password)

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -> str:
    """Crear JWT access token"""
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(
            minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES
        )
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def decode_token(token: str) -> Optional[dict]:
    """Decodificar JWT token"""
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        return payload
    except JWTError:
        return None
```

#### 7.3. Base de Datos

**`backend/app/db/base.py`**:
```python
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()
```

**`backend/app/db/session.py`**:
```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

engine = create_engine(
    settings.DATABASE_URL,
    pool_pre_ping=True,
    pool_size=10,
    max_overflow=20
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def get_db():
    """Dependency para obtener sesi√≥n de BD"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

#### 7.4. Modelos SQLAlchemy

**`backend/app/models/base.py`**:
```python
from datetime import datetime
from sqlalchemy import Column, Integer, DateTime
from sqlalchemy.ext.declarative import declared_attr
from app.db.base import Base

class TimestampMixin:
    """Mixin para timestamps autom√°ticos"""
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(
        DateTime, 
        default=datetime.utcnow, 
        onupdate=datetime.utcnow, 
        nullable=False
    )

class BaseModel(Base, TimestampMixin):
    """Clase base para todos los modelos"""
    __abstract__ = True
    
    id = Column(Integer, primary_key=True, index=True, autoincrement=True)
    
    @declared_attr
    def __tablename__(cls) -> str:
        return cls.__name__.lower()
```

**`backend/app/models/user.py`**:
```python
from sqlalchemy import Boolean, Column, String
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class User(BaseModel):
    __tablename__ = "users"
    
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(255), unique=True, index=True, nullable=False)
    full_name = Column(String(100), nullable=True)
    hashed_password = Column(String(255), nullable=False)
    
    is_active = Column(Boolean, default=True)
    is_superuser = Column(Boolean, default=False)
    is_verified = Column(Boolean, default=False)
    
    # Relaciones
    projects = relationship(
        "Project", 
        back_populates="owner",
        cascade="all, delete-orphan",
        lazy="dynamic"
    )
    
    assigned_tasks = relationship(
        "Task",
        back_populates="assignee",
        foreign_keys="[Task.assigned_to_id]",
        lazy="dynamic"
    )
```

**`backend/app/models/project.py`**:
```python
from sqlalchemy import Boolean, Column, String, Text, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class Project(BaseModel):
    __tablename__ = "projects"
    
    name = Column(String(100), nullable=False, index=True)
    description = Column(Text, nullable=True)
    is_active = Column(Boolean, default=True)
    
    owner_id = Column(
        Integer, 
        ForeignKey("users.id", ondelete="CASCADE"),
        nullable=False,
        index=True
    )
    
    # Relaciones
    owner = relationship("User", back_populates="projects")
    tasks = relationship(
        "Task",
        back_populates="project",
        cascade="all, delete-orphan",
        lazy="dynamic"
    )
```

**`backend/app/models/task.py`**:
```python
from sqlalchemy import Column, String, Text, Integer, ForeignKey, Enum, Date
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel

class TaskStatus(str, enum.Enum):
    TODO = "todo"
    IN_PROGRESS = "in_progress"
    IN_REVIEW = "in_review"
    DONE = "done"
    CANCELLED = "cancelled"

class TaskPriority(str, enum.Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    URGENT = "urgent"

class Task(BaseModel):
    __tablename__ = "tasks"
    
    title = Column(String(200), nullable=False, index=True)
    description = Column(Text, nullable=True)
    status = Column(Enum(TaskStatus), default=TaskStatus.TODO, nullable=False, index=True)
    priority = Column(Enum(TaskPriority), default=TaskPriority.MEDIUM, nullable=False)
    due_date = Column(Date, nullable=True)
    
    project_id = Column(
        Integer,
        ForeignKey("projects.id", ondelete="CASCADE"),
        nullable=False,
        index=True
    )
    
    assigned_to_id = Column(
        Integer,
        ForeignKey("users.id", ondelete="SET NULL"),
        nullable=True,
        index=True
    )
    
    # Relaciones
    project = relationship("Project", back_populates="tasks")
    assignee = relationship("User", back_populates="assigned_tasks", foreign_keys=[assigned_to_id])
    tags = relationship("Tag", secondary="task_tags", back_populates="tasks", lazy="dynamic")
```

**`backend/app/models/tag.py`**:
```python
from sqlalchemy import Column, String, Integer, ForeignKey, Table
from sqlalchemy.orm import relationship
from app.models.base import BaseModel, Base

task_tags = Table(
    'task_tags',
    Base.metadata,
    Column('task_id', Integer, ForeignKey('tasks.id', ondelete="CASCADE"), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete="CASCADE"), primary_key=True)
)

class Tag(BaseModel):
    __tablename__ = "tags"
    
    name = Column(String(50), unique=True, nullable=False, index=True)
    color = Column(String(7), default="#808080")
    
    tasks = relationship(
        "Task",
        secondary=task_tags,
        back_populates="tags",
        lazy="dynamic"
    )
```

#### 7.5. Schemas Pydantic

**`backend/app/schemas/user.py`**:
```python
from pydantic import BaseModel, EmailStr, Field
from typing import Optional
from datetime import datetime

class UserBase(BaseModel):
    email: EmailStr
    username: str = Field(..., min_length=3, max_length=50)
    full_name: Optional[str] = None

class UserCreate(UserBase):
    password: str = Field(..., min_length=8)

class UserUpdate(BaseModel):
    email: Optional[EmailStr] = None
    full_name: Optional[str] = None
    password: Optional[str] = None

class UserResponse(UserBase):
    id: int
    is_active: bool
    is_superuser: bool
    is_verified: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class UserInDB(UserResponse):
    hashed_password: str
```

**`backend/app/schemas/token.py`**:
```python
from pydantic import BaseModel
from typing import Optional

class Token(BaseModel):
    access_token: str
    token_type: str = "bearer"

class TokenPayload(BaseModel):
    sub: Optional[int] = None
```

#### 7.6. Repositories

**`backend/app/repositories/base.py`**:
```python
from typing import TypeVar, Generic, Type, Optional, List
from sqlalchemy.orm import Session
from app.models.base import BaseModel

ModelType = TypeVar("ModelType", bound=BaseModel)

class BaseRepository(Generic[ModelType]):
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -> Optional[ModelType]:
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(
        self, db: Session, *, skip: int = 0, limit: int = 100
    ) -> List[ModelType]:
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def create(self, db: Session, *, obj_in: dict) -> ModelType:
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(
        self, db: Session, *, db_obj: ModelType, obj_in: dict
    ) -> ModelType:
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -> Optional[ModelType]:
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
```

**`backend/app/repositories/user.py`**:
```python
from typing import Optional
from sqlalchemy.orm import Session
from app.models.user import User
from app.repositories.base import BaseRepository

class UserRepository(BaseRepository[User]):
    def __init__(self):
        super().__init__(User)
    
    def get_by_email(self, db: Session, *, email: str) -> Optional[User]:
        return db.query(User).filter(User.email == email).first()
    
    def get_by_username(self, db: Session, *, username: str) -> Optional[User]:
        return db.query(User).filter(User.username == username).first()

user_repository = UserRepository()
```

#### 7.7. Services

**`backend/app/services/auth_service.py`**:
```python
from typing import Optional
from sqlalchemy.orm import Session
from fastapi import HTTPException, status
from app.schemas.user import UserCreate, UserResponse
from app.schemas.token import Token
from app.repositories.user import user_repository
from app.core.security import (
    verify_password,
    get_password_hash,
    create_access_token
)
from datetime import timedelta
from app.core.config import settings

class AuthService:
    def register_user(self, db: Session, user_in: UserCreate) -> UserResponse:
        """Registrar nuevo usuario"""
        # Verificar email √∫nico
        if user_repository.get_by_email(db, email=user_in.email):
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail="Email ya registrado"
            )
        
        # Verificar username √∫nico
        if user_repository.get_by_username(db, username=user_in.username):
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail="Username ya existe"
            )
        
        # Hash de contrase√±a
        hashed_password = get_password_hash(user_in.password)
        
        # Crear usuario
        user_data = user_in.dict(exclude={'password'})
        user_data['hashed_password'] = hashed_password
        
        user = user_repository.create(db, obj_in=user_data)
        return UserResponse.from_orm(user)
    
    def authenticate(
        self, db: Session, *, email: str, password: str
    ) -> Optional[Token]:
        """Autenticar usuario y retornar token"""
        user = user_repository.get_by_email(db, email=email)
        
        if not user:
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="Credenciales inv√°lidas"
            )
        
        if not verify_password(password, user.hashed_password):
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="Credenciales inv√°lidas"
            )
        
        if not user.is_active:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Usuario inactivo"
            )
        
        # Crear token
        access_token_expires = timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
        access_token = create_access_token(
            data={"sub": str(user.id)},
            expires_delta=access_token_expires
        )
        
        return Token(access_token=access_token, token_type="bearer")

auth_service = AuthService()
```

#### 7.8. Dependencias

**`backend/app/api/deps.py`**:
```python
from typing import Generator, Optional
from fastapi import Depends, HTTPException, status, Cookie
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.models.user import User
from app.repositories.user import user_repository
from app.core.security import decode_token

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login", auto_error=False)

async def get_current_user(
    db: Session = Depends(get_db),
    token: Optional[str] = Depends(oauth2_scheme),
    access_token: Optional[str] = Cookie(None)
) -> User:
    """Obtener usuario actual desde JWT"""
    # Priorizar cookie sobre header
    token_to_decode = access_token or token
    
    if not token_to_decode:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="No autenticado"
        )
    
    payload = decode_token(token_to_decode)
    if not payload:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Token inv√°lido"
        )
    
    user_id = int(payload.get("sub"))
    user = user_repository.get(db, id=user_id)
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Usuario no encontrado"
        )
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -> User:
    """Verificar usuario activo"""
    if not current_user.is_active:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Usuario inactivo"
        )
    return current_user
```

#### 7.9. Endpoints

**`backend/app/api/v1/endpoints/auth.py`**:
```python
from fastapi import APIRouter, Depends, status, Response
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session
from app.schemas.user import UserCreate, UserResponse
from app.schemas.token import Token
from app.services.auth_service import auth_service
from app.api.deps import get_db

router = APIRouter()

@router.post("/register", response_model=UserResponse, status_code=status.HTTP_201_CREATED)
def register(
    user_in: UserCreate,
    db: Session = Depends(get_db)
):
    """Registrar nuevo usuario"""
    return auth_service.register_user(db, user_in=user_in)

@router.post("/login", response_model=Token)
def login(
    response: Response,
    form_data: OAuth2PasswordRequestForm = Depends(),
    db: Session = Depends(get_db)
):
    """Login y obtener token"""
    token = auth_service.authenticate(
        db,
        email=form_data.username,  # OAuth2 usa 'username', nosotros lo tratamos como email
        password=form_data.password
    )
    
    # Establecer token en cookie HttpOnly
    response.set_cookie(
        key="access_token",
        value=token.access_token,
        httponly=True,
        secure=False,  # True en producci√≥n con HTTPS
        samesite="lax",
        max_age=1800  # 30 minutos
    )
    
    return token

@router.post("/logout")
def logout(response: Response):
    """Logout (eliminar cookie)"""
    response.delete_cookie(key="access_token")
    return {"message": "Logout exitoso"}
```

**`backend/app/api/v1/endpoints/users.py`**:
```python
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.schemas.user import UserResponse
from app.api.deps import get_db, get_current_active_user
from app.models.user import User

router = APIRouter()

@router.get("/me", response_model=UserResponse)
def get_current_user_info(
    current_user: User = Depends(get_current_active_user)
):
    """Obtener informaci√≥n del usuario actual"""
    return current_user
```

**`backend/app/api/v1/endpoints/health.py`**:
```python
from fastapi import APIRouter
from app.core.config import settings

router = APIRouter()

@router.get("/health")
def health_check():
    """Health check endpoint"""
    return {
        "status": "healthy",
        "app_name": settings.APP_NAME,
        "version": settings.VERSION
    }
```

#### 7.10. Router y Main

**`backend/app/api/v1/router.py`**:
```python
from fastapi import APIRouter
from app.api.v1.endpoints import auth, users, health

api_router = APIRouter()

api_router.include_router(health.router, tags=["health"])
api_router.include_router(auth.router, prefix="/auth", tags=["authentication"])
api_router.include_router(users.router, prefix="/users", tags=["users"])
```

**`backend/app/main.py`**:
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api.v1.router import api_router

app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    docs_url="/docs",
    redoc_url="/redoc"
)

# CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Incluir router versionado
app.include_router(api_router, prefix="/api/v1")

@app.get("/")
def root():
    return {
        "message": "FastAPI Full Stack API",
        "docs": "/docs",
        "version": settings.VERSION
    }
```

#### 7.11. Docker

**`backend/Dockerfile`**:
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Copiar requirements e instalar
COPY requirements.txt .
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# Copiar c√≥digo
COPY ./app ./app
COPY alembic.ini .
COPY ./alembic ./alembic

EXPOSE 8000

# Comando por defecto (puede sobrescribirse en docker-compose)
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 7.12. Alembic

**`alembic/env.py`** (modificado):
```python
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context

# Importar settings y Base
from app.core.config import settings
from app.db.base import Base

# Importar TODOS los modelos
from app.models import user, project, task, tag

# Configurar URL de BD
config = context.config
config.set_main_option("sqlalchemy.url", settings.DATABASE_URL)

if config.config_file_name is not None:
    fileConfig(config.config_file_name)

target_metadata = Base.metadata

def run_migrations_offline():
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()

def run_migrations_online():
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
```

### ‚öõÔ∏è FRONTEND - C√≥digo TypeScript/React

#### 7.13. Cliente API

**`frontend/src/lib/api.ts`**:
```typescript
import axios, { AxiosInstance, AxiosError } from 'axios';

const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  timeout: 10000,
  withCredentials: true,  // Importante para cookies
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para manejo de errores
apiClient.interceptors.response.use(
  response => response,
  (error: AxiosError) => {
    if (error.response?.status === 401) {
      // Redirigir a login
      if (typeof window !== 'undefined') {
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);

// API Methods
export const api = {
  auth: {
    register: async (data: { email: string; username: string; password: string }) => {
      return apiClient.post('/auth/register', data);
    },
    login: async (email: string, password: string) => {
      const formData = new FormData();
      formData.append('username', email);  // OAuth2 expects 'username'
      formData.append('password', password);
      return apiClient.post('/auth/login', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
    },
    logout: async () => {
      return apiClient.post('/auth/logout');
    },
    getCurrentUser: async () => {
      return apiClient.get('/users/me');
    },
  },
  // Agregar m√°s endpoints seg√∫n necesidad
};

export default apiClient;
```

#### 7.14. Tipos TypeScript

**`frontend/src/types/api.ts`**:
```typescript
export interface User {
  id: number;
  email: string;
  username: string;
  full_name?: string;
  is_active: boolean;
  is_superuser: boolean;
  is_verified: boolean;
  created_at: string;
  updated_at: string;
}

export interface LoginCredentials {
  email: string;
  password: string;
}

export interface RegisterData {
  email: string;
  username: string;
  password: string;
  full_name?: string;
}

export interface Token {
  access_token: string;
  token_type: string;
}
```

#### 7.15. Hook de Autenticaci√≥n

**`frontend/src/hooks/useAuth.ts`**:
```typescript
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { api } from '@/lib/api';
import { User, LoginCredentials, RegisterData } from '@/types/api';

export function useAuth() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    checkAuth();
  }, []);

  const checkAuth = async () => {
    try {
      const response = await api.auth.getCurrentUser();
      setUser(response.data);
    } catch (error) {
      setUser(null);
    } finally {
      setLoading(false);
    }
  };

  const login = async (credentials: LoginCredentials) => {
    try {
      await api.auth.login(credentials.email, credentials.password);
      await checkAuth();
      router.push('/dashboard');
    } catch (error) {
      throw error;
    }
  };

  const register = async (data: RegisterData) => {
    try {
      await api.auth.register(data);
      // Auto-login despu√©s de registro
      await login({ email: data.email, password: data.password });
    } catch (error) {
      throw error;
    }
  };

  const logout = async () => {
    try {
      await api.auth.logout();
      setUser(null);
      router.push('/login');
    } catch (error) {
      console.error('Logout error:', error);
    }
  };

  return {
    user,
    loading,
    login,
    register,
    logout,
    checkAuth,
  };
}
```

#### 7.16. Layouts

**`frontend/src/app/layout.tsx`**:
```typescript
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Full Stack App',
  description: 'FastAPI + Next.js Full Stack Application',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="es">
      <body className={inter.className}>
        {children}
      </body>
    </html>
  )
}
```

#### 7.17. P√°gina de Login

**`frontend/src/app/(auth)/login/page.tsx`**:
```typescript
'use client';

import { useState } from 'react';
import { useAuth } from '@/hooks/useAuth';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';

export default function LoginPage() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const { login } = useAuth();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    
    try {
      await login({ email, password });
    } catch (err: any) {
      setError(err.response?.data?.detail || 'Error al iniciar sesi√≥n');
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center">
      <Card className="w-full max-w-md">
        <CardHeader>
          <CardTitle>Iniciar Sesi√≥n</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleSubmit} className="space-y-4">
            {error && (
              <div className="bg-red-50 text-red-600 p-3 rounded-md text-sm">
                {error}
              </div>
            )}
            
            <div>
              <Input
                type="email"
                placeholder="Email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
              />
            </div>
            
            <div>
              <Input
                type="password"
                placeholder="Contrase√±a"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
              />
            </div>
            
            <Button type="submit" className="w-full">
              Iniciar Sesi√≥n
            </Button>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}
```

#### 7.18. Frontend Dockerfile

**`frontend/Dockerfile`**:
```dockerfile
FROM node:20-alpine AS deps
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci

FROM node:20-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV production
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

---

## 8. COMANDOS DE TERMINAL NECESARIOS

### üîß Comandos de Configuraci√≥n Inicial

```bash
# 1. Clonar o crear proyecto
git init fastapi-nextjs-fullstack
cd fastapi-nextjs-fullstack

# 2. Backend: Crear entorno virtual
cd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# 3. Backend: Instalar dependencias
pip install -r requirements.txt

# 4. Backend: Configurar Alembic
alembic init alembic

# 5. Frontend: Crear proyecto Next.js
cd ..
npx create-next-app@latest frontend --typescript --tailwind --app --src-dir

# 6. Frontend: Instalar dependencias adicionales
cd frontend
npm install axios react-hook-form zod @hookform/resolvers
npx shadcn-ui@latest init
npx shadcn-ui@latest add button input card form dialog
```

### üêò Comandos de Base de Datos

```bash
# Con Docker
docker-compose up -d postgres
docker-compose logs -f postgres

# Conectarse a PostgreSQL en Docker
docker exec -it fullstack_postgres psql -U fastapi_user -d fullstack_db

# Sin Docker (local)
psql postgres
CREATE USER fastapi_user WITH PASSWORD 'SecurePassword123';
CREATE DATABASE fullstack_db OWNER fastapi_user;
\q

# Verificar conexi√≥n
psql -U fastapi_user -d fullstack_db -h localhost

# Dentro de psql:
\dt          # Listar tablas
\d users     # Describir tabla users
\q           # Salir
```

### üîÑ Comandos de Migraciones (Alembic)

```bash
# Desde backend/ con venv activado

# Crear migraci√≥n autom√°tica
alembic revision --autogenerate -m "Mensaje descriptivo"

# Ejemplos:
alembic revision --autogenerate -m "Create initial tables"
alembic revision --autogenerate -m "Add is_verified to users"

# Aplicar migraciones
alembic upgrade head

# Ver estado actual
alembic current

# Ver historial
alembic history

# Revertir √∫ltima migraci√≥n
alembic downgrade -1

# Revertir a revisi√≥n espec√≠fica
alembic downgrade <revision_id>

# Revertir todo
alembic downgrade base
```

### üöÄ Comandos para Iniciar Servicios

#### Opci√≥n A: Con Docker Compose (Recomendado)

```bash
# Desde la ra√≠z del proyecto

# Iniciar todos los servicios
docker-compose up

# Iniciar en segundo plano
docker-compose up -d

# Ver logs
docker-compose logs -f

# Ver logs de un servicio espec√≠fico
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f postgres

# Detener servicios
docker-compose down

# Detener y eliminar vol√∫menes (‚ö†Ô∏è ELIMINA DATOS)
docker-compose down -v

# Reconstruir im√°genes
docker-compose build

# Reconstruir e iniciar
docker-compose up --build
```

#### Opci√≥n B: Sin Docker (Local)

**Terminal 1 - Backend**:
```bash
cd backend
source venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# El backend estar√° en: http://localhost:8000
# Docs en: http://localhost:8000/docs
```

**Terminal 2 - Frontend**:
```bash
cd frontend
npm run dev

# El frontend estar√° en: http://localhost:3000
```

**Terminal 3 - PostgreSQL** (si no est√° como servicio):
```bash
# macOS con Homebrew
brew services start postgresql@15

# Linux (Debian/Ubuntu)
sudo service postgresql start
```

### üß™ Comandos de Testing y Desarrollo

```bash
# Backend: Formatear c√≥digo con Black
cd backend
pip install black
black app/

# Backend: Linting con flake8
pip install flake8
flake8 app/

# Backend: Type checking con mypy
pip install mypy
mypy app/

# Frontend: Linting
cd frontend
npm run lint

# Frontend: Formatear con Prettier
npm run format  # (si est√° configurado)

# Frontend: Build de producci√≥n
npm run build

# Frontend: Iniciar build de producci√≥n
npm start
```

### üìä Comandos de Docker √ötiles

```bash
# Ver contenedores corriendo
docker ps

# Ver todos los contenedores
docker ps -a

# Ver logs de contenedor
docker logs fullstack_backend
docker logs -f fullstack_backend  # Seguir logs

# Entrar a contenedor
docker exec -it fullstack_backend /bin/bash
docker exec -it fullstack_postgres /bin/bash

# Ver im√°genes
docker images

# Eliminar contenedor
docker rm fullstack_backend

# Eliminar imagen
docker rmi <image_id>

# Limpiar recursos no utilizados
docker system prune

# Ver uso de espacio
docker system df

# Reiniciar contenedor
docker restart fullstack_backend
```

### üîç Comandos de Debugging

```bash
# Backend: Verificar configuraci√≥n
cd backend
source venv/bin/activate
python -c "from app.core.config import settings; print(settings.DATABASE_URL)"

# Backend: Probar conexi√≥n a BD
python -c "from app.db.session import engine; engine.connect(); print('‚úì Conexi√≥n exitosa')"

# Backend: Shell interactivo
python
>>> from app.db.session import SessionLocal
>>> from app.models.user import User
>>> db = SessionLocal()
>>> users = db.query(User).all()
>>> print(users)

# PostgreSQL: Verificar datos
docker exec -it fullstack_postgres psql -U fastapi_user -d fullstack_db -c "SELECT * FROM users;"

# Frontend: Verificar variables de entorno
cd frontend
npm run build
# Las variables NEXT_PUBLIC_* se mostrar√°n si hay errores
```

---

## 9. CHECKLIST DE VERIFICACI√ìN

### ‚úÖ Fase 1: Instalaci√≥n de Herramientas

- [ ] Python 3.11+ instalado (`python --version`)
- [ ] pip actualizado (`pip install --upgrade pip`)
- [ ] Node.js 18+ instalado (`node --version`)
- [ ] npm actualizado (`npm install -g npm@latest`)
- [ ] Docker instalado y corriendo (`docker --version`, `docker ps`)
- [ ] docker-compose instalado (`docker-compose --version`)
- [ ] Git instalado (`git --version`)
- [ ] Editor de c√≥digo configurado (VSCode con extensiones recomendadas)

### ‚úÖ Fase 2: Configuraci√≥n del Proyecto

- [ ] Repositorio Git inicializado
- [ ] `.gitignore` creado con contenido apropiado
- [ ] Estructura de carpetas creada (`backend/`, `frontend/`)
- [ ] `backend/.env` configurado con variables correctas
- [ ] `frontend/.env.local` configurado
- [ ] `docker-compose.yml` creado en ra√≠z

### ‚úÖ Fase 3: Backend (FastAPI)

- [ ] Entorno virtual creado y activado
- [ ] Dependencias instaladas (`pip list` muestra paquetes)
- [ ] `requirements.txt` creado con todas las dependencias
- [ ] Estructura de carpetas backend creada correctamente
- [ ] Archivos `__init__.py` en todos los paquetes
- [ ] `app/main.py` implementado
- [ ] `app/core/config.py` con Settings configurado
- [ ] `app/core/security.py` con funciones JWT
- [ ] `app/db/session.py` con engine y SessionLocal
- [ ] Modelos SQLAlchemy creados (`user.py`, `project.py`, etc.)
- [ ] Schemas Pydantic creados
- [ ] Repositorios implementados (BaseRepository, UserRepository)
- [ ] Servicios implementados (AuthService, UserService)
- [ ] Endpoints creados (`auth.py`, `users.py`, `health.py`)
- [ ] Router v1 configurado
- [ ] CORS middleware configurado
- [ ] Alembic inicializado
- [ ] `alembic/env.py` modificado correctamente
- [ ] Dockerfile backend creado

### ‚úÖ Fase 4: Base de Datos

- [ ] PostgreSQL corriendo (Docker o local)
- [ ] Base de datos `fullstack_db` creada
- [ ] Usuario `fastapi_user` creado con permisos
- [ ] Conexi√≥n desde backend exitosa
- [ ] Primera migraci√≥n creada (`alembic revision --autogenerate`)
- [ ] Migraciones aplicadas (`alembic upgrade head`)
- [ ] Tablas creadas en PostgreSQL (verificar con `\dt` en psql)
- [ ] Relaciones entre tablas correctas

### ‚úÖ Fase 5: Frontend (Next.js)

- [ ] Proyecto Next.js creado
- [ ] TypeScript configurado
- [ ] TailwindCSS funcionando
- [ ] shadcn/ui inicializado
- [ ] Componentes UI instalados (button, input, card, etc.)
- [ ] `src/lib/api.ts` implementado
- [ ] `src/types/api.ts` con interfaces TypeScript
- [ ] `src/hooks/useAuth.ts` implementado
- [ ] Layout principal creado
- [ ] P√°gina de login implementada
- [ ] P√°gina de registro implementada (opcional)
- [ ] `next.config.js` configurado
- [ ] Dockerfile frontend creado

### ‚úÖ Fase 6: Integraci√≥n

- [ ] `docker-compose.yml` completo con los 3 servicios
- [ ] Backend responde en `http://localhost:8000`
- [ ] Frontend responde en `http://localhost:3000`
- [ ] Swagger UI accesible en `http://localhost:8000/docs`
- [ ] Frontend puede hacer requests al backend
- [ ] CORS configurado correctamente
- [ ] Cookies funcionando entre frontend y backend

### ‚úÖ Fase 7: Funcionalidad

- [ ] Endpoint `/api/v1/health` responde correctamente
- [ ] Registro de usuario funciona (`POST /api/v1/auth/register`)
- [ ] Login funciona (`POST /api/v1/auth/login`)
- [ ] Token JWT se crea y almacena en cookie
- [ ] Endpoint protegido `/api/v1/users/me` requiere autenticaci√≥n
- [ ] Usuario autenticado puede acceder a `/api/v1/users/me`
- [ ] Logout funciona y elimina cookie
- [ ] Frontend muestra errores apropiadamente
- [ ] Redirecci√≥n a login cuando no autenticado

### ‚úÖ Fase 8: Pruebas Manuales

- [ ] Crear usuario desde Swagger UI
- [ ] Login con usuario creado
- [ ] Verificar token en cookie (DevTools ‚Üí Application ‚Üí Cookies)
- [ ] Acceder a endpoint protegido con token
- [ ] Logout y verificar que cookie se elimina
- [ ] Repetir proceso desde frontend
- [ ] Verificar datos en PostgreSQL

### ‚úÖ Fase 9: Optimizaci√≥n y Limpieza

- [ ] Eliminar c√≥digo de prueba/debug
- [ ] Revisar que no hay credenciales en c√≥digo
- [ ] `.env` y `.env.local` en `.gitignore`
- [ ] Documentaci√≥n actualizada (`README.md`)
- [ ] Comentarios en c√≥digo complejo
- [ ] Variables de entorno documentadas en `.env.example`

### ‚úÖ Fase 10: Preparaci√≥n para Producci√≥n

- [ ] `DEBUG=False` en producci√≥n
- [ ] `SECRET_KEY` fuerte y √∫nico
- [ ] CORS restringido a dominios espec√≠ficos
- [ ] HTTPS habilitado (para cookies `Secure`)
- [ ] Database backup configurado
- [ ] Logs configurados apropiadamente
- [ ] Health checks configurados
- [ ] Rate limiting considerado
- [ ] Monitoring y alertas (opcional)

---

## 10. TROUBLESHOOTING COM√öN

### üêõ Problemas de Backend

#### Problema 1: "ModuleNotFoundError: No module named 'app'"

**Causa**: Python no encuentra el paquete `app`.

**Soluci√≥n**:
```bash
# Asegurarse de estar en backend/
cd backend

# Verificar que exista app/__init__.py
ls app/__init__.py

# Ejecutar desde backend/ (no desde app/)
uvicorn app.main:app --reload
```

#### Problema 2: "sqlalchemy.exc.OperationalError: could not connect to server"

**Causa**: PostgreSQL no est√° corriendo o credenciales incorrectas.

**Soluciones**:
```bash
# Verificar que PostgreSQL est√© corriendo
docker ps | grep postgres

# Si no est√° corriendo:
docker-compose up -d postgres

# Verificar logs:
docker-compose logs postgres

# Verificar variables de entorno:
cat backend/.env

# Probar conexi√≥n manual:
psql -U fastapi_user -d fullstack_db -h localhost
```

#### Problema 3: "alembic.util.exc.CommandError: Target database is not up to date"

**Causa**: Migraciones no aplicadas.

**Soluci√≥n**:
```bash
cd backend
source venv/bin/activate
alembic upgrade head
```

#### Problema 4: "fastapi.exceptions.ValidationError" en endpoints

**Causa**: Schema Pydantic no coincide con datos enviados.

**Soluci√≥n**:
- Verificar el schema en la documentaci√≥n Swagger (`/docs`)
- Asegurarse de enviar todos los campos requeridos
- Revisar tipos de datos (string vs int, etc.)

#### Problema 5: "CORS policy: No 'Access-Control-Allow-Origin'"

**Causa**: CORS no configurado correctamente.

**Soluci√≥n**:
```python
# En app/main.py, verificar:
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # ‚Üê Verificar URL
    allow_credentials=True,                    # ‚Üê Debe ser True para cookies
    allow_methods=["*"],
    allow_headers=["*"],
)
```

#### Problema 6: "401 Unauthorized" en endpoints protegidos

**Causa**: Token no enviado o inv√°lido.

**Soluci√≥n**:
```bash
# Verificar que cookie se cre√≥ en login
# DevTools ‚Üí Network ‚Üí Request a /api/v1/auth/login ‚Üí Response Headers
# Debe tener: Set-Cookie: access_token=...

# Verificar que cookie se env√≠a en requests subsecuentes
# DevTools ‚Üí Network ‚Üí Request a /api/v1/users/me ‚Üí Request Headers
# Debe tener: Cookie: access_token=...

# Si no aparece, verificar withCredentials en axios:
# src/lib/api.ts debe tener:
# withCredentials: true
```

### üêõ Problemas de Frontend

#### Problema 7: "Error: Invalid hook call"

**Causa**: Hook usado fuera de componente o versi√≥n React incompatible.

**Soluci√≥n**:
- Asegurarse de que hooks est√°n dentro de componentes funcionales
- Agregar `'use client'` al inicio del archivo si usa hooks

```typescript
'use client';  // ‚Üê Agregar esto

import { useState } from 'react';
```

#### Problema 8: "Module not found: Can't resolve '@/components/ui/button'"

**Causa**: shadcn/ui no instalado o path alias mal configurado.

**Soluci√≥n**:
```bash
# Instalar componente:
npx shadcn-ui@latest add button

# Verificar tsconfig.json tenga:
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

#### Problema 9: "Hydration failed" en Next.js

**Causa**: HTML del servidor no coincide con el cliente.

**Soluci√≥n**:
- No usar `localStorage` o `window` directamente en render
- Usar `useEffect` para c√≥digo que solo debe correr en cliente:

```typescript
useEffect(() => {
  // C√≥digo que usa window o localStorage
}, []);
```

#### Problema 10: "TypeError: Cannot read property 'map' of undefined"

**Causa**: Intentar mapear un array que a√∫n no se carg√≥.

**Soluci√≥n**:
```typescript
// Agregar verificaci√≥n:
{data && data.map(item => (
  <div key={item.id}>{item.name}</div>
))}

// O usar optional chaining:
{data?.map(item => (
  <div key={item.id}>{item.name}</div>
))}
```

### üêõ Problemas de Docker

#### Problema 11: "ERROR: Couldn't connect to Docker daemon"

**Causa**: Docker no est√° corriendo.

**Soluci√≥n**:
```bash
# Windows/Mac: Iniciar Docker Desktop

# Linux: Iniciar servicio Docker
sudo systemctl start docker

# Verificar:
docker ps
```

#### Problema 12: "Port 5432 is already allocated"

**Causa**: PostgreSQL local usando el puerto.

**Soluci√≥n**:
```bash
# Opci√≥n 1: Detener PostgreSQL local
sudo service postgresql stop  # Linux
brew services stop postgresql  # Mac

# Opci√≥n 2: Cambiar puerto en docker-compose.yml
services:
  postgres:
    ports:
      - "5433:5432"  # ‚Üê Puerto externo diferente

# Actualizar DATABASE_URL en .env:
DATABASE_URL=postgresql://...@localhost:5433/fullstack_db
```

#### Problema 13: "Cannot start service: driver failed"

**Causa**: Contenedor anterior no eliminado o volumen corrupto.

**Soluci√≥n**:
```bash
# Detener y eliminar todo:
docker-compose down -v

# Eliminar contenedores manualmente:
docker rm -f fullstack_backend fullstack_frontend fullstack_postgres

# Eliminar vol√∫menes:
docker volume rm $(docker volume ls -q)

# Reiniciar:
docker-compose up --build
```

### üêõ Problemas de Autenticaci√≥n

#### Problema 14: "Cookie no se guarda en el navegador"

**Causa**: `SameSite` o `Secure` mal configurados.

**Soluci√≥n**:
```python
# En app/api/v1/endpoints/auth.py:
response.set_cookie(
    key="access_token",
    value=token.access_token,
    httponly=True,
    secure=False,      # ‚Üê False en desarrollo (localhost), True en producci√≥n con HTTPS
    samesite="lax",    # ‚Üê "lax" o "none" (no "strict" para requests cross-origin)
    max_age=1800
)
```

#### Problema 15: "Token expired"

**Causa**: Token JWT expir√≥.

**Soluci√≥n**:
```python
# Aumentar tiempo de expiraci√≥n en .env:
ACCESS_TOKEN_EXPIRE_MINUTES=60  # 1 hora

# Implementar refresh tokens (avanzado)
```

### üêõ Problemas de Migraci√≥n

#### Problema 16: "Target database is not up to date"

**Causa**: Modelo cambi√≥ pero no se cre√≥ migraci√≥n.

**Soluci√≥n**:
```bash
alembic revision --autogenerate -m "Describe cambios"
alembic upgrade head
```

#### Problema 17: "Can't locate revision identified by 'xxxxx'"

**Causa**: Migraci√≥n faltante o corrupta.

**Soluci√≥n**:
```bash
# Ver historial:
alembic history

# Si falta migraci√≥n, recrear desde scratch:
alembic downgrade base
rm alembic/versions/*.py
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

### üêõ Problemas de Performance

#### Problema 18: "Backend responde muy lento"

**Causas y Soluciones**:

1. **Sin √≠ndices en BD**:
```python
# Agregar index=True en modelos:
email = Column(String, unique=True, index=True)
```

2. **N+1 queries**:
```python
# Usar eager loading:
from sqlalchemy.orm import joinedload

users = db.query(User).options(joinedload(User.projects)).all()
```

3. **Pool de conexiones peque√±o**:
```python
# En app/db/session.py:
engine = create_engine(
    settings.DATABASE_URL,
    pool_size=20,      # ‚Üê Aumentar
    max_overflow=40    # ‚Üê Aumentar
)
```

---

## üìö RECURSOS ADICIONALES

### Documentaci√≥n Oficial

- **FastAPI**: https://fastapi.tiangolo.com/
- **Next.js**: https://nextjs.org/docs
- **SQLAlchemy**: https://docs.sqlalchemy.org/
- **Pydantic**: https://docs.pydantic.dev/
- **TailwindCSS**: https://tailwindcss.com/docs
- **shadcn/ui**: https://ui.shadcn.com/

### Comunidad y Soporte

- **FastAPI Discord**: https://discord.gg/fastapi
- **Next.js Discord**: https://nextjs.org/discord
- **Stack Overflow**: Etiquetar preguntas con `fastapi`, `next.js`, `sqlalchemy`

### Tutoriales y Cursos

- **FastAPI Official Tutorial**: https://fastapi.tiangolo.com/tutorial/
- **Next.js Learn**: https://nextjs.org/learn
- **Full Stack FastAPI PostgreSQL**: https://github.com/tiangolo/full-stack-fastapi-postgresql

### Herramientas √ötiles

- **Postman**: Probar APIs - https://www.postman.com/
- **pgAdmin**: GUI para PostgreSQL - https://www.pgadmin.org/
- **DB Browser for SQLite**: Para desarrollo r√°pido - https://sqlitebrowser.org/

---

## üéâ CONCLUSI√ìN

¬°Felicidades! Si completaste todos los pasos, ahora tienes:

‚úÖ Un backend FastAPI profesional con:
- Arquitectura en capas escalable
- Autenticaci√≥n JWT segura
- Migraciones de base de datos
- Documentaci√≥n autom√°tica

‚úÖ Un frontend Next.js moderno con:
- TypeScript para type safety
- TailwindCSS para estilos
- Componentes UI reutilizables
- Hooks personalizados

‚úÖ Una aplicaci√≥n Full Stack completa con:
- Comunicaci√≥n segura backend-frontend
- Autenticaci√≥n con cookies HttpOnly
- Base de datos relacional robusta
- Todo containerizado con Docker

### üöÄ Pr√≥ximos Pasos Recomendados

1. **Implementar CRUD Completo**: Para proyectos, tareas y tags
2. **Agregar WebSockets**: Para notificaciones en tiempo real
3. **Testing**: Unitarios y de integraci√≥n
4. **CI/CD**: GitHub Actions o GitLab CI
5. **Deploy**: En AWS, Google Cloud, Heroku, Railway, etc.
6. **Monitoring**: Sentry, Prometheus, Grafana
7. **Features Avanzadas**: B√∫squeda, filtros, paginaci√≥n, carga de archivos

**¬°El proyecto est√° listo para crecer!** üåü

---

*Fin del Documento 4*

---