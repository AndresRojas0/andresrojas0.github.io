<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="AAI|IAA Arise with AI|IA para aprender">
    <meta name="description" content="This AAI|IAA page shares the experience of a AI user.">
    <meta name="robots" content="index, follow" />
    <title>Iniciación - Pensando y prototipando una aplicación a partir de una planilla de trabajo</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
</head>
<body>
  <header>
    <h1>AAI | IAA</h1>
    <nav>
        <a href="/">Inicio</a>
        <a href="/pages/about">Acerca</a>
        <a href="/pages/contact">Contacto</a>
    </nav>
</header>

  <main>
    
<div class="article-with-sidebar">
  
  
  
  <div id="toc-bar" class="invisible">
    <span class="label">Iniciación - Pensando y prototipando una aplicación a partir de una planilla de trabajo</span>
    <button type="button" class="toc-trigger">
      ☰
    </button>
  </div>

  
  <button id="toc-solo-trigger" type="button" class="toc-trigger">
    <span class="label">Índice</span>
    <span>→</span>
  </button>

  
  <dialog id="toc-popup">
    <div class="header">
      <div class="label">Iniciación - Pensando y prototipando una aplicación a partir de una planilla de trabajo</div>
      <button id="toc-popup-close" type="button">
        ✕
      </button>
    </div>
    <div id="toc-popup-content">
      
    </div>
  </dialog>

  
  
  <aside id="toc-wrapper">
    <h2>Índice</h2>
    <nav>
      
    </nav>
  </aside>

  
  
  <article>
    
      <img src="/images/blog-post.svg" alt="Iniciación - Pensando y prototipando una aplicación a partir de una planilla de trabajo">
    

    <h1>Iniciación - Pensando y prototipando una aplicación a partir de una planilla de trabajo</h1>
    
    
      <time class="post-date" datetime="Sat Jul 19 2025 20:43:00 GMT-0300 (hora estándar de Argentina)">Sat Jul 19 2025 20:43:00 GMT-0300 (hora estándar de Argentina)</time>
    

    <p><strong>Autor:</strong> Andrés Rojas</p>
<p><strong>Fecha:</strong> 19 de julio de 2025</p>
<h2>Introducción</h2>
<p>Con el surgimiento del <strong>modelo extenso de lenguaje</strong> o LLM (<em>Large Language Model</em>) en 2018, definido formalmente como un modelo de lenguaje de aprendizaje profundo que consta de una red neuronal* con muchos parámetros (normalmente miles de millones o más) entrenados en grandes cantidades de texto sin etiquetar mediante aprendizaje autosupervisado o aprendizaje semisupervisado, entendiéndose esta definición como un tipo de <strong>inteligencia artificial</strong> (IA) entrenado con grandes cantidades de datos para entender y generar lenguaje humano de manera natural, se marca un hito en la historia y el inicio de un exponencial crecimiento, masividad y versatilidad de aplicaciones con IA generativa capaces de realizar tareas como escribir texto en lenguaje humano, traducir texto, responder preguntas, mantener diálogos, resumir, analizar y además escribir instrucciones y código en lenguajes de programación.
<br></p>
<p><em>(*) El concepto de red neuronal surge en 1943 al desarrollarse el primer modelo matemático de una neurona, posteriormente aparecen los conceptos de perceptrón, perceptrón multicapa, red neuronal prealimentada, red neuronal convolucional (Neocognitron), esta última mejorada en 1998 (backpropagation algorithm) y con posterior refinamiento e implementación en unidades de procesamiento gráfico en 2012.</em></p>
<h2>Parte I</h2>
<h3>Usando IA para proponer mejoras</h3>
<p>Pensemos el siguiente <a href="##" title="⚠ El escenario planteado está basado en una actividad laboral real. Los nombres de los campos han sido modificados deliberadamente. ⚠">escenario</a>*: como empleado en una pyme tengo la tarea de recorrer un área y realizar una serie de verificaciones puntuales, para ello dispongo de una planilla de cálculo (en documento excel) que debo completar con mi trabajo diario, estructurado en un encabezado con filas y debajo un cuerpo con columnas, todas con sus campos claramente identificados:</p>
<p><em>(*)⚠ El escenario planteado está basado en una actividad laboral real. Los nombres de los campos han sido modificados deliberadamente. ⚠</em></p>
<h3>Estructura de la planilla de trabajo</h3>
<h3>Filas</h3>
<ul>
<li>Tipo de planilla:</li>
<li>Fecha:</li>
<li>Nombre empleado:</li>
<li>Lugar de trabajo:</li>
<li>Totales:</li>
</ul>
<h3>Columnas</h3>
<ul>
<li>Grupo</li>
<li>Operador</li>
<li>Código</li>
<li>Máquina</li>
<li>Hora</li>
<li>Estado</li>
<li>Cantidad/Cantidades</li>
<li>Sector</li>
<li>Observaciones</li>
</ul>
<p>El campo Tipo de Planilla se completa con un nombre fijo &quot;Planilla de Trabajo Diario&quot;. Fecha, Nombre de empleado y Lugar de Trabajo son campos triviales. Totales es el resultado de sumar los registros desde columna Cantidades. En la columna Grupo se coloca un código alfanumérico. En columna Operador, el nombre del operador. En Máquina el número identificador de máquina. En Hora la hora exacta de verificación. En Estado un estado en minutos y segundos, positivo o negativo o cero. En Cantidad un número entero mayor o igual a cero. En Sector una ubicación en palabras. Observaciones opcionalmente se completa con un breve texto de observaciones realizadas.</p>
<p>Al finalizar la jornada, <u>cada planilla completada es enviada por correo electrónico</u> a un encargado o superior, para ser descargadas una por una en una computadora y luego revisadas, nuevamente una por una...</p>
<p>¿Cómo podríamos proponer una mejora a este procedimiento? Podemos acercarnos a una solución creando una aplicación web que nos permita registrar o cargar las planillas de trabajo diario y procesarlas convenientemente.</p>
<h2>Parte II</h2>
<h3>Obteniendo una estructura de datos</h3>
<blockquote>
<p>«Can you create a general data structure from this excel?»</p>
</blockquote>
<p>Procedemos con un primer &quot;prompt&quot; (comando o instrucción) como el anterior, agregando el documento excel, todo dentro de una nueva conversación con herramienta conversacional IA (ChatGPT, Claude, Gemini, o la de preferencia) usando el navegador de una computadora o aplicación de teléfono móvil. La IA analiza el documento, genera los scripts para poder &quot;leerlo&quot; y responde con un primer resultado.</p>
<h3>Estructura general de datos</h3>
<p>Una <strong>estructura de datos</strong> es según la enciclopedia una forma particular de organizar información para que pueda ser utilizada de manera eficiente. Más precisamente, una estructura de datos es una <u>colección de valores, las relaciones entre ellos y las funciones y operaciones que se pueden aplicar a los datos</u>, es decir, es una estructura algebraica de datos.
En este caso la denominamos <em>general</em> pues partimos de una representación de una planilla de cálculo en general hacia una estructura de datos más específica.</p>
<p>Continuando con el desarrollo, la IA tiene problemas al intentar analizar la planilla de cálculo...</p>
<blockquote>
<p>«I'll analyze the Excel file to understand its structure and create a general data structure representation for you.»</p>
</blockquote>
<pre><code>javascript

// Read and analyze the Excel file
import * as XLSX from 'xlsx';

const response = await window.fs.readFile('PLANILLA.xlsx');
const workbook = XLSX.read(response, {
    cellStyles: true,
    cellFormulas: true,
    cellDates: true,
    cellNF: true,
    sheetStubs: true
});

// Explore workbook structure
console.log(&quot;Workbook metadata:&quot;);
console.log(workbook.Workbook);

console.log(&quot;\nSheet names:&quot;);
console.log(workbook.SheetNames);

// Analyze each sheet
workbook.SheetNames.forEach((sheetName, index) =&gt; {
    console.log(`\n=== Sheet ${index + 1}: ${sheetName} ===`);
    const worksheet = workbook.Sheets[sheetName];
    
    // Get sheet metadata (properties starting with '!')
    const metadata = {};
    Object.keys(worksheet).forEach(key =&gt; {
        if (key.startsWith('!')) {
            metadata[key] = worksheet[key];
        }
    });
    console.log(&quot;Sheet metadata:&quot;, metadata);
    
    // Convert to JSON to see structure
    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null });
    console.log(`Dimensions: ${jsonData.length} rows`);
    
    if (jsonData.length &gt; 0) {
        console.log(&quot;First few rows:&quot;);
        jsonData.slice(0, Math.min(10, jsonData.length)).forEach((row, i) =&gt; {
            console.log(`Row ${i}:`, row);
        });
    }
});
</code></pre>
<p>Mensajes de error mediante, la siguiente respuesta fue:</p>
<blockquote>
<p>«I've created a general data structure template for inspection checklists based on the filename you provided. The structure covers the typical components found in daily work forms:»</p>
<ul>
<li>Document metadata and identification</li>
<li>General information about the inspection (date, inspector, location)</li>
<li>Subject details (what's being inspected)</li>
<li>Inspection items with status tracking</li>
<li>Summary and assessment results</li>
<li>Required actions and follow-up</li>
<li>Signatures for validation</li>
</ul>
</blockquote>
<blockquote>
<p>«This structure is flexible and can accommodate various types of inspections (safety, health, quality, compliance, etc.). The data types and validation rules ensure consistency and proper integration with other systems.»</p>
</blockquote>
<pre><code>javascript

{
  // Document metadata
  inspectionForm: {
    documentInfo: {
      title: &quot;Planilla de Trabajo&quot;,
      date: &quot;2025-07-10&quot;,
      version: &quot;string&quot;,
      formId: &quot;string&quot;
    },
    
    // General information section
    generalInfo: {
      inspectionId: &quot;string&quot;,
      inspectionDate: &quot;date&quot;,
      inspector: {
        name: &quot;string&quot;,
        id: &quot;string&quot;,
        certification: &quot;string&quot;
      },
      location: {
        address: &quot;string&quot;,
        coordinates: &quot;object&quot;,
        zone: &quot;string&quot;
      },
      inspectionType: &quot;string&quot;, // routine, complaint-based, follow-up, etc.
      weather: &quot;string&quot;
    },
    
    // Subject being inspected
    inspectedEntity: {
      name: &quot;string&quot;,
      type: &quot;string&quot;, // business, facility, equipment, etc.
      license: &quot;string&quot;,
      contact: {
        person: &quot;string&quot;,
        phone: &quot;string&quot;,
        email: &quot;string&quot;
      }
    },
    
    // Inspection items/checklist
    inspectionItems: [
      {
        category: &quot;string&quot;,
        itemId: &quot;string&quot;,
        description: &quot;string&quot;,
        requirement: &quot;string&quot;,
        status: &quot;string&quot;, // compliant, non-compliant, not-applicable, pending
        observations: &quot;string&quot;,
        photos: [&quot;string&quot;], // photo references
        correctionRequired: &quot;boolean&quot;,
        deadline: &quot;date&quot;
      }
    ],
    
    // Overall assessment
    summary: {
      totalItems: &quot;number&quot;,
      compliantItems: &quot;number&quot;,
      nonCompliantItems: &quot;number&quot;,
      overallStatus: &quot;string&quot;,
      riskLevel: &quot;string&quot;, // low, medium, high
      followUpRequired: &quot;boolean&quot;,
      followUpDate: &quot;date&quot;
    },
    
    // Actions and recommendations
    actions: [
      {
        type: &quot;string&quot;, // correction, warning, fine, closure
        description: &quot;string&quot;,
        deadline: &quot;date&quot;,
        responsible: &quot;string&quot;,
        status: &quot;string&quot;
      }
    ],
    
    // Signatures and approvals
    signatures: {
      inspector: {
        name: &quot;string&quot;,
        signature: &quot;string&quot;,
        date: &quot;date&quot;
      },
      inspected: {
        name: &quot;string&quot;,
        position: &quot;string&quot;,
        signature: &quot;string&quot;,
        date: &quot;date&quot;
      }
    }
  }
}
</code></pre>
<p>Esta estructura de datos puede ser útil pero resulta «genérica» para el caso. Se le vuelve a escribir, indicando cuáles son los campos de la planilla excel de trabajo:</p>
<blockquote>
<p>«Good job. In every DAILY WORK FORM we have:
Title: DAILY WORK FORM.
Employee name.
Date of the day.
Place of work (city or address).
And we have a list of service checks, each entry containing the following fields:
Group number.
Operator name.
Service code.
Machine number.
Exact hour of control.
Status.
Quantities.
Address of sector.
Observations (if necessary).»</p>
</blockquote>
<p>Su respuesta certera:</p>
<blockquote>
<p>«Perfect! Let me update the data structure to reflect the specific requirements for your DAILY WORK FORM for what appears to be a work inspection system.»</p>
</blockquote>
<pre><code>javascript

{
  dailyWorkForm: {
    // Form header information
    formHeader: {
      title: &quot;DAILY WORK FORM&quot;,
      employeeName: &quot;string&quot;,
      date: &quot;YYYY-MM-DD&quot;, // Date of the day
      placeOfWork: &quot;string&quot; // City or address
    },
    
    // List of inspections
    serviceChecks: [
      {
        groupNumber: &quot;string&quot;, // Group identifier
        operatorName: &quot;string&quot;,
        serviceCode: &quot;string&quot;, // Service identifier
        machineNumber: &quot;string&quot;, // Macine number
        exactHourOfControl: &quot;HH:MM:SS&quot;, // Time format
        status: {
          minutes: &quot;number&quot;, // Positive for late, negative for early
          status: &quot;string&quot; // &quot;on-time&quot;, &quot;ahead&quot;, &quot;late&quot;
        },
        quantities: &quot;number&quot;,
        addressOfSector: &quot;string&quot;,
        observations: &quot;string&quot; // Optional field
      }
    ]
  }
}
</code></pre>
<p>Además de obtener como resultado la estructura de datos de la planilla de cálculo y mostrar un ejemplo con datos (ficticios), se puede pedir ampliar la respuesta con las especificaciones de qué datos maneja cada campo, validación de datos de cada campo y restricciones, lógicas o reglas de negocio, y una estructura adicional de estadísticas diarias basadas en la planilla original.</p>
<p>Con esto, estamos listos para avanzar al siguiente paso.</p>
<h2>Parte III</h2>
<h3>Creando una aplicación web</h3>
<p>Buscando alguna herramienta de IA que genera <u>componentes de interfaz de usuario</u> a partir de descripciones en lenguaje natural, se inicia un nuevo hilo de conversación pero esta vez con <strong>Vercel V0</strong>. Sin vueltas, se le pide que a partir de la <u>estructura de datos</u> creada anteriormente cree una aplicación web <em>mobile first</em> para registrar trabajo diario:</p>
<blockquote>
<p>Hey there. Can you make a web mobile first for register my daily work? The data structure I use is shown below.</p>
</blockquote>
<p>Inmediatamente inserto la estructura de datos creada anteriormente:</p>
<pre><code>{
  dailyWorkForm: {
    // Form header information
    formHeader: {
      title: &quot;DAILY WORK FORM&quot;,
      employeeName: &quot;string&quot;,
      date: &quot;YYYY-MM-DD&quot;, // Date of the day
      placeOfWork: &quot;string&quot; // City or address
    },
    
    // List of inspections
    serviceChecks: [
      {
        groupNumber: &quot;string&quot;, // Group identifier
        operatorName: &quot;string&quot;,
        serviceCode: &quot;string&quot;, // Service identifier
        machineNumber: &quot;string&quot;, // Machine number
        exactHourOfControl: &quot;HH:MM:SS&quot;, // Time format
        status: {
          minutes: &quot;number&quot;, // Positive for late, negative for early
          status: &quot;string&quot; // &quot;on-time&quot;, &quot;ahead&quot;, &quot;late&quot;
        },
        quantities: &quot;number&quot;,
        addressOfSector: &quot;string&quot;,
        observations: &quot;string&quot; // Optional field
      }
    ]
  }
}
</code></pre>
<p>Y algunas condiciones:</p>
<blockquote>
<p>Status criteria: negative = late (yellow color), positive = early (from 2 onwards, red color), 0 = on-time (between 0 and 1min 59sec, green color).
Add a checkbox of non-compliance in the Observations attribute, and call it &quot;Infracción&quot;. If the service has non-compliance, turn all the Service Check into red background. Under Service Inspections, add a counter for services checks recorded with non-compliance.</p>
</blockquote>
<p>Viendo los resultados positivos, se le pide que permita cargar o subir directamente la planilla de cálculo excel y autocomplete los campos uno por uno, con persistencia de datos y base de datos mediante:</p>
<blockquote>
<p>Please, add a function to upload an .xlsx document with the spreadsheet fields: Nombre, Día, Lugar, Sentido, Grupo, Operador, Código, Máquina, Hora, Status, Cantidades, Sector, Observación. Nombre, Día, Lugar, Sentido, are rows in the xlsx document. Grupo, Operador, Código, Máquina, Hora, Status, Cantidades, Sector, Observación, are columns in the xlsx document. Please accept lowercase and uppercase field names indistinctly (field matching case-insensitive).
Fill automatically all the daily form in their respective attributes: Name, Date, Place of Work; and for every Service Inspection: Group Number, Service Code, Operator Name, Machine Number, Time, Status, Quantities, Address of Sector, Observations.</p>
</blockquote>
<blockquote>
<p>Status Variance attribute has the format mm:ss. If the xlsx document uploaded has Status field in +mm, -mm, +mm:ss, -mm:ss, (+mm:ss), (-mm:ss), extract the exact values to fill the Status Variance.
Examples: (+02:30) → 2 minutes 30 seconds early, (-01:45) → 1 minute 45 seconds late, +3:30  → 3 minutes 30 seconds early, -2:00 → 2 minutes 00 seconds late.</p>
</blockquote>
<blockquote>
<p>Add a calendar to visualize saved forms in every day.
In Recent Inspections Forms add a Delete functionality for a selectd form.
In Recent Inspections Forms, in View Details, add Observations attribute, if it empty show &quot;None&quot;.
If the xlsx document uploaded have Observación field with a word &quot;INFRACCIÓN&quot; or &quot;Infracción&quot; or &quot;infracción&quot;, check the non-compliance box in their respective services.</p>
</blockquote>
<p>Se puede agregar algunas estadísticas en un panel de control o <em>dashboard</em>:</p>
<blockquote>
<p>In Dashboard, in overview show me the top 10 of most used lineOrRouteNumber, and the top 20 of most used addressOfStop, in the current month.</p>
</blockquote>
<p>Esta conversación se puede extender tanto como uno quiera y crea necesario, corrigiendo errores de interpretación, aprendiendo a escribir de forma objetiva para reducir errores, proponiendo e intercambiando ideas... Con algunas instrucciones como las vistas, <em>prompts</em> claros y concisos se logran resultados sorprendentes. No hay límites para poner creatividad con estas herramientas.</p>

  </article>
</div>

  </main>
  <hr class="fleuron" />

<footer>
    <p>Arise with IA | IA para Aprender &copy; 2025</p>
</footer>


  
  
  <script>
  (function() {
    'use strict';
    
    // ============================================
    // 1. Scroll Header Shrink Effect (OPTIMIZADO)
    // ============================================
    const header = document.querySelector('header');
    let ticking = false;
    
    window.addEventListener('scroll', function() {
      if (!ticking) {
        window.requestAnimationFrame(function() {
          header.classList.toggle('shrink', window.scrollY > 50);
          ticking = false;
        });
        ticking = true;
      }
    });
    
    // ============================================
    // 2. Format Dates in Spanish
    // ============================================
    function formatDates() {
      const timeElements = document.querySelectorAll('time.post-date');
      const meses = [
        'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
        'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
      ];
      
      timeElements.forEach(function(timeEl) {
        const dateStr = timeEl.textContent.trim();
        const date = new Date(dateStr);
        
        if (!isNaN(date.getTime())) {
          const day = date.getDate();
          const month = meses[date.getMonth()];
          const year = date.getFullYear();
          
          timeEl.textContent = day + ' de ' + month + ' de ' + year;
          timeEl.setAttribute('datetime', dateStr);
        }
      });
    }
    
    // ============================================
    // 3. Table of Contents (TOC) - OPTIMIZADO
    // ============================================
    function initTableOfContents() {
      // Buscar artículo
      const article = document.querySelector('article');
      if (!article) return;
      
      // Buscar encabezados (h2, h3, h4)
      const headings = article.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) {
        // Ocultar elementos del TOC si no hay encabezados
        const tocElements = document.querySelectorAll('#toc-bar, #toc-solo-trigger, #toc-wrapper');
        tocElements.forEach(el => el && (el.style.display = 'none'));
        return;
      }
      
      // Generar HTML del índice
      let html = '<ul>';
      headings.forEach(function(heading, index) {
        // Generar ID si no existe
        if (!heading.id) {
          const text = heading.textContent.trim();
          const slug = text
            .toLowerCase()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .replace(/[^a-z0-9\s]+/g, '')
            .replace(/\s+/g, '-')
            .replace(/^-+|-+$/g, '');
          heading.id = slug || 'seccion-' + (index + 1);
        }
        
        // Indentación según nivel
        const level = parseInt(heading.tagName[1]);
        const style = level === 3 ? ' style="padding-left: 1.5em"' : 
                     level === 4 ? ' style="padding-left: 3em"' : '';
        
        html += '<li' + style + '><a href="#' + heading.id + '">' + 
                heading.textContent.trim() + '</a></li>';
      });
      html += '</ul>';
      
      // Insertar en popup (mobile)
      const popupContent = document.getElementById('toc-popup-content');
      if (popupContent) popupContent.innerHTML = html;
      
      // Insertar en sidebar (desktop)
      const tocWrapper = document.getElementById('toc-wrapper');
      if (tocWrapper) {
        let nav = tocWrapper.querySelector('nav');
        if (!nav) {
          nav = document.createElement('nav');
          tocWrapper.appendChild(nav);
        }
        nav.innerHTML = html;
      }
      
      // Configurar popup modal
      const popup = document.getElementById('toc-popup');
      const triggers = document.querySelectorAll('.toc-trigger');
      const btnClose = document.getElementById('toc-popup-close');
      
      if (popup && triggers.length > 0) {
        // Función para cerrar popup con animación
        function closePopup() {
          popup.setAttribute('closing', '');
          popup.addEventListener('animationend', function handleAnimationEnd() {
            popup.removeAttribute('closing');
            popup.close();
            document.documentElement.classList.remove('overflow-hidden');
            document.body.classList.remove('overflow-hidden');
            popup.removeEventListener('animationend', handleAnimationEnd);
          });
        }
        
        // Abrir popup (OPTIMIZADO)
        triggers.forEach(function(trigger) {
          trigger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            document.documentElement.classList.add('overflow-hidden');
            document.body.classList.add('overflow-hidden');
            popup.showModal();
          });
        });
        
        // Cerrar popup (FIX)
        if (btnClose) {
          btnClose.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            closePopup();
          });
        }
        
        // Click en backdrop (SIMPLIFICADO)
        popup.addEventListener('click', function(e) {
          if (e.target === popup) {
            closePopup();
          }
        });
        
        // ESC key
        popup.addEventListener('cancel', function(e) {
          e.preventDefault();
          closePopup();
        });
        
        // Manejar resize (cerrar popup en desktop)
        window.addEventListener('resize', function() {
          if (window.innerWidth >= 1200 && popup.open) {
            popup.close();
            document.documentElement.classList.remove('overflow-hidden');
            document.body.classList.remove('overflow-hidden');
          }
        });
      }
      
      // Botón flotante con IntersectionObserver
      const tocBar = document.getElementById('toc-bar');
      const soloTrigger = document.getElementById('toc-solo-trigger');
      
      if (tocBar && soloTrigger) {
        const observer = new IntersectionObserver(
          function(entries) {
            entries.forEach(function(entry) {
              tocBar.classList.toggle('invisible', entry.isIntersecting);
            });
          },
          { rootMargin: '-48px 0px 0px 0px' }
        );
        observer.observe(soloTrigger);
      }
      
      // Smooth scroll y scroll spy
      const tocLinks = document.querySelectorAll('#toc-popup-content a, #toc-wrapper a');
      const linkMap = new Map();
      
      // Crear mapa de IDs a enlaces
      tocLinks.forEach(function(link) {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          const id = href.substring(1);
          if (!linkMap.has(id)) {
            linkMap.set(id, []);
          }
          linkMap.get(id).push(link);
          
          // Smooth scroll
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById(id);
            if (target) {
              const offset = 100;
              const targetPosition = target.getBoundingClientRect().top + 
                                   window.pageYOffset - offset;
              window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
              });
              history.pushState(null, null, '#' + id);
              if (popup && popup.open) {
                closePopup();
              }
            }
          });
        }
      });
      
      // Scroll spy con IntersectionObserver
      const scrollObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            
            // Remover clase active de todos
            tocLinks.forEach(function(link) {
              link.classList.remove('active');
            });
            
            // Agregar clase active a los enlaces correspondientes
            const activeLinks = linkMap.get(id);
            if (activeLinks) {
              activeLinks.forEach(function(link) {
                link.classList.add('active');
              });
            }
          }
        });
      }, {
        rootMargin: '-100px 0px -66%',
        threshold: 0
      });
      
      // Observar todos los encabezados
      headings.forEach(function(heading) {
        if (heading.id) {
          scrollObserver.observe(heading);
        }
      });
    }
    
    // ============================================
    // Inicialización
    // ============================================
    function init() {
      formatDates();
      initTableOfContents();
    }
    
    // Ejecutar cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
  })();
  </script>

</body>
</html>
