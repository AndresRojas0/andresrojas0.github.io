<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="AAI|IAA Arise with AI|IA para aprender">
    <meta name="description" content="This AAI|IAA page shares the experience of a AI user.">
    <meta name="robots" content="index, follow" />
    <title>Desarrollo: Aplicación de E-commerce, Enfoque Estructurado con IA y el Protocolo RICECO</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
</head>
<body>
  <header>
    <h1>AAI | IAA</h1>
    <nav>
        <a href="/">Inicio</a>
        <a href="/pages/about">Acerca</a>
        <a href="/pages/contact">Contacto</a>
    </nav>
</header>

  <main>
    
<div class="article-with-sidebar">
  
  
  
  <div id="toc-bar" class="invisible">
    <span class="label">Desarrollo: Aplicación de E-commerce, Enfoque Estructurado con IA y el Protocolo RICECO</span>
    <button type="button" class="toc-trigger">
      ☰
    </button>
  </div>

  
  <button id="toc-solo-trigger" type="button" class="toc-trigger">
    <span class="label">Índice</span>
    <span>→</span>
  </button>

  
  <dialog id="toc-popup">
    <div class="header">
      <div class="label">Desarrollo: Aplicación de E-commerce, Enfoque Estructurado con IA y el Protocolo RICECO</div>
      <button id="toc-popup-close" type="button">
        ✕
      </button>
    </div>
    <div id="toc-popup-content">
      
    </div>
  </dialog>

  
  
  <aside id="toc-wrapper">
    <h2>Índice</h2>
    <nav>
      
    </nav>
  </aside>

  
  
  <article>
    
      <img src="/images/13237881_5186432.svg" alt="Desarrollo: Aplicación de E-commerce, Enfoque Estructurado con IA y el Protocolo RICECO">
    

    <h1>Desarrollo: Aplicación de E-commerce, Enfoque Estructurado con IA y el Protocolo RICECO</h1>
    
    
      <time class="post-date" datetime="Fri Nov 28 2025 20:00:00 GMT-0300 (hora estándar de Argentina)">Fri Nov 28 2025 20:00:00 GMT-0300 (hora estándar de Argentina)</time>
    

    <p><strong>Autor:</strong> Andres Rojas</p>
<p><strong>Fecha:</strong> 28 de noviembre de 2025</p>
<h2>Introducción</h2>
<p>El desarrollo de aplicaciones web robustas y escalables requiere un enfoque metódico que abarque desde la conceptualización inicial hasta la implementación técnica y las futuras iteraciones. Este artículo detalla el proceso de desarrollo para una aplicación de comercio electrónico con un diseño <em>mobile-first</em>, diseñada para gestionar un catálogo de productos jerárquico y facilitar las operaciones de clientes, vendedores y administradores. Se pone un énfasis particular en cómo la colaboración con una inteligencia artificial, guiada por un protocolo de comunicación estructurado como RICECO, puede optimizar y clarificar el ciclo de vida del desarrollo de software.</p>
<p>El objetivo es presentar una guía que no solo documente la arquitectura y las tecnologías de un proyecto específico, sino que también sirva como un modelo para la colaboración efectiva entre desarrolladores humanos y sistemas de IA en tareas de desarrollo complejas.</p>
<h2>1. Conceptualización del Proyecto</h2>
<p>La base de cualquier aplicación exitosa es una comprensión clara de sus objetivos de negocio y los roles de los usuarios que interactuarán con ella. Este proyecto se centra en una plataforma de e-commerce con tres roles de usuario distintos, cada uno con responsabilidades y permisos específicos.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Rol de Usuario</th>
<th style="text-align:left">Responsabilidades Principales</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>Cliente</strong></td>
<td style="text-align:left">Navegar por el catálogo de productos, filtrar, seleccionar artículos, gestionar un carrito de compras y enviar órdenes de compra.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Vendedor</strong></td>
<td style="text-align:left">Recibir y registrar las órdenes de compra de los clientes, y generar las notas de entrega correspondientes para el despacho de productos.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Administrador</strong></td>
<td style="text-align:left">Gestionar de forma integral todas las entidades de datos del sistema, incluyendo productos, categorías, proveedores y usuarios, con plenos poderes de creación, lectura, actualización y eliminación (CRUD).</td>
</tr>
</tbody>
</table>
<p>El propósito fundamental de la aplicación es digitalizar y optimizar el flujo de pedidos, desde la selección del producto por parte del cliente hasta la gestión logística por parte del vendedor, todo bajo la supervisión y gestión de datos del administrador.</p>
<h2>2. Modelo Conceptual y Estructura de Datos</h2>
<p>Para soportar las funcionalidades descritas, se define un modelo de datos relacional que organiza la información de manera lógica y eficiente. El siguiente diagrama de Entidad-Relación (ER) ilustra las principales entidades del sistema y cómo se conectan entre sí.</p>
<p><img src="https://private-us-east-1.manuscdn.com/sessionFile/C9wrFT7NmfOuRXYQbfT3aH/sandbox/7QJ5dvsABLHeZ6dsAvKbsz-images_1768827975866_na1fn_L2hvbWUvdWJ1bnR1L2RpYWdyYW1hX2VudGlkYWRlcw.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly9wcml2YXRlLXVzLWVhc3QtMS5tYW51c2Nkbi5jb20vc2Vzc2lvbkZpbGUvQzl3ckZUN05tZk91UlhZUWJmVDNhSC9zYW5kYm94LzdRSjVkdnNBQkxIZVo2ZHNBdktic3otaW1hZ2VzXzE3Njg4Mjc5NzU4NjZfbmExZm5fTDJodmJXVXZkV0oxYm5SMUwyUnBZV2R5WVcxaFgyVnVkR2xrWVdSbGN3LnBuZyIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTc5ODc2MTYwMH19fV19&amp;Key-Pair-Id=K2HSFNDJXOU9YS&amp;Signature=RKZ41vpRKT09Mr6tq8qWJQ-wk1vtbuZqj54Sle56RlRoz9l9y7zMOSGDiFMgM~VK~Ovd8Y-A9ONZrkhtHsxBY1Vk~Q0bAp~S4ZoZr-mRLHpV4eHlhzRF2Ao1t125y7kH6cQMxwsgNHQNKEc9jCR-e4D~YfBANEjzskobp7sX4QKD8~ALfiebHxE2uxnLEDoXqugse60z~84Z1~gcnSm5zFZbVZIzZKErGSFBB6GzyaJB1MJad8mAJXPuxZKJNY88P6NBLQBqSKg7JdlN3Cgokrhd3TJAEYUJjZieAu9ME5TT6TOp-rp8-jz9vM4pPNDxr3oxRRapAGZYag7zGgo-4g__" alt="Diagrama de Entidades y Relaciones"></p>
<p>El núcleo del modelo de datos es la estructura jerárquica del catálogo de productos, que sigue una organización de cuatro niveles para permitir una clasificación granular y flexible de los artículos:</p>
<p><strong>Colección → Categoría → Subcolección → Subcategoría → Producto</strong></p>
<p>Esta estructura permite a los clientes navegar de lo general a lo específico, mejorando la experiencia de usuario y la capacidad de descubrimiento de productos. A continuación, se presenta una tabla que resume las entidades clave.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Entidad</th>
<th style="text-align:left">Propósito en el Sistema</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>COLLECTION</code></td>
<td style="text-align:left">Agrupa categorías relacionadas (ej. &quot;Ropa de Verano&quot;).</td>
</tr>
<tr>
<td style="text-align:left"><code>CATEGORY</code></td>
<td style="text-align:left">Clasificación principal de productos (ej. &quot;Camisetas&quot;).</td>
</tr>
<tr>
<td style="text-align:left"><code>SUBCOLLECTION</code></td>
<td style="text-align:left">Agrupación intermedia dentro de una categoría (ej. &quot;Camisetas de Algodón&quot;).</td>
</tr>
<tr>
<td style="text-align:left"><code>SUBCATEGORY</code></td>
<td style="text-align:left">Clasificación más específica (ej. &quot;Manga Corta&quot;).</td>
</tr>
<tr>
<td style="text-align:left"><code>PRODUCT</code></td>
<td style="text-align:left">El artículo individual disponible para la venta.</td>
</tr>
<tr>
<td style="text-align:left"><code>SUPPLIER</code></td>
<td style="text-align:left">El proveedor que suministra uno o más productos.</td>
</tr>
<tr>
<td style="text-align:left"><code>CUSTOMER</code></td>
<td style="text-align:left">El cliente que realiza las órdenes de compra.</td>
</tr>
<tr>
<td style="text-align:left"><code>PURCHASE_ORDER</code></td>
<td style="text-align:left">La orden de compra generada por un cliente.</td>
</tr>
<tr>
<td style="text-align:left"><code>DELIVERY_NOTE</code></td>
<td style="text-align:left">La nota de entrega generada por un vendedor para despachar productos.</td>
</tr>
<tr>
<td style="text-align:left"><code>MISSING_ITEM</code></td>
<td style="text-align:left">Registro de los productos de una orden que no se incluyeron en la entrega.</td>
</tr>
</tbody>
</table>
<p>Para ilustrar la estructura de datos a nivel de objeto, el siguiente ejemplo muestra una representación en formato JSON de una entidad <code>PRODUCT</code>.</p>
<pre><code class="language-json">{
  &quot;id&quot;: 101,
  &quot;slug&quot;: &quot;samsung-galaxy-s24&quot;,
  &quot;supplier_id&quot;: 25,
  &quot;article&quot;: &quot;SG-S24&quot;,
  &quot;code&quot;: &quot;789123456&quot;,
  &quot;name&quot;: &quot;Samsung Galaxy S24&quot;,
  &quot;description&quot;: &quot;El último smartphone de Samsung con IA integrada.&quot;,
  &quot;price&quot;: 1299.99,
  &quot;subcategory_slug&quot;: &quot;smartphones-android&quot;,
  &quot;image_id&quot;: 450
}
</code></pre>
<h2>3. Historias de Usuario y Casos de Uso</h2>
<p>Las <strong>historias de usuario</strong> son una herramienta fundamental en el desarrollo ágil para capturar los requisitos desde la perspectiva del usuario final. Definen quién es el usuario, qué necesita hacer y por qué. A partir de estas historias, se derivan los <strong>casos de uso</strong>, que describen en detalle la interacción paso a paso entre el usuario y el sistema para lograr un objetivo específico.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Rol</th>
<th style="text-align:left">Historia de Usuario Clave</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>Cliente</strong></td>
<td style="text-align:left">Como cliente, quiero poder filtrar productos por categoría para encontrar rápidamente lo que busco.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Vendedor</strong></td>
<td style="text-align:left">Como vendedor, quiero que el sistema me muestre los artículos faltantes al crear una nota de entrega para gestionar el inventario.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Administrador</strong></td>
<td style="text-align:left">Como administrador, quiero poder cargar productos masivamente desde un archivo XLSX para agilizar la gestión del catálogo.</td>
</tr>
</tbody>
</table>
<p>Estos relatos se traducen en flujos de trabajo concretos. Por ejemplo, el caso de uso &quot;Realizar un Pedido&quot; implica que el cliente navegue, seleccione productos, los añada a un carrito y finalmente confirme la orden, lo que desencadena una notificación al vendedor. Este proceso define una secuencia clara de interacciones que deben ser implementadas en la interfaz de usuario y la lógica de negocio.</p>
<h2>4. El Proceso de Desarrollo Asistido por IA</h2>
<p>La colaboración con sistemas de inteligencia artificial puede acelerar significativamente el desarrollo, pero requiere una comunicación precisa. El protocolo <strong>RICECO</strong> es un marco estructurado para formular instrucciones a una IA, asegurando que los resultados sean predecibles, completos y alineados con los requisitos del proyecto.</p>
<h3>El Protocolo RICECO</h3>
<p>RICECO es un acrónimo que desglosa una solicitud en seis componentes clave:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Componente</th>
<th style="text-align:left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>R</strong>ole (Rol)</td>
<td style="text-align:left">Define la personalidad o el perfil profesional que la IA debe adoptar (ej. &quot;Actúa como un desarrollador backend senior&quot;).</td>
</tr>
<tr>
<td style="text-align:left"><strong>I</strong>nstruction (Instrucción)</td>
<td style="text-align:left">La tarea específica y directa que debe realizarse (ej. &quot;Desarrolla una aplicación web para gestionar entidades con operaciones CRUD&quot;).</td>
</tr>
<tr>
<td style="text-align:left"><strong>C</strong>ontext (Contexto)</td>
<td style="text-align:left">Proporciona el trasfondo, el propósito y la información necesaria para entender la tarea en profundidad.</td>
</tr>
<tr>
<td style="text-align:left"><strong>E</strong>xamples (Ejemplos)</td>
<td style="text-align:left">Ilustraciones concretas que guían a la IA sobre el resultado esperado (ej. flujos de trabajo de ejemplo).</td>
</tr>
<tr>
<td style="text-align:left"><strong>C</strong>onstraints (Restricciones)</td>
<td style="text-align:left">Limitaciones técnicas, de estilo o de otro tipo que deben respetarse (ej. &quot;Usa el ORM Drizzle y sigue la estructura de Next-Faster&quot;).</td>
</tr>
<tr>
<td style="text-align:left"><strong>O</strong>utput Format (Formato de Salida)</td>
<td style="text-align:left">Define la estructura que debe tener la respuesta de la IA (ej. &quot;Proporciona un plan de desarrollo seguido de una solicitud de confirmación&quot;).</td>
</tr>
</tbody>
</table>
<p>Al utilizar este protocolo, el desarrollador puede guiar a la IA para generar artefactos de alta calidad, como planes de desarrollo, esquemas de base de datos, componentes de código y documentación. La IA, actuando como un par programador, puede proponer soluciones, identificar dependencias y escribir código boilerplate, liberando al desarrollador para que se concentre en la lógica de negocio más compleja y la arquitectura general.</p>
<h3>Protocolo ejemplo</h3>
<blockquote>
<p><strong>Role:</strong>
Act as a senior backend developer writing React frontend code. You operate with precision, propose a detailed development plan before implementing changes, and always request explicit confirmation before proceeding with implementation.</p>
</blockquote>
<blockquote>
<p><strong>Instruction:</strong>
Develop a mobile-first web application to manage the following entities with full CRUD operations (Create, Read, Update, Delete):
PRODUCT, CATEGORY, SUBCATEGORY, COLLECTION, SUBCOLLECTION, IMAGE, SUPPLIER, CUSTOMER, PURCHASE_ORDER, DELIVERY_NOTE.</p>
</blockquote>
<blockquote>
<p><strong>Context:</strong>
<u>Background:</u> This is an e-commerce application with three primary user roles:
CUSTOMER: Can browse products, filter by categories and subcategories, select products, add them to cart, modify cart contents, and submit the cart as a PURCHASE_ORDER to a SALESPERSON.
SALESPERSON: Receives PURCHASE_ORDERs from customers, records them in the system, and creates DELIVERY_NOTEs for fulfillment.
ADMIN: Has full access to all entities with complete CRUD capabilities.
<u>Purpose:</u> Enable customers to place purchase orders, allow salespersons to process orders and generate delivery notes, and provide administrators with comprehensive data management tools.
<u>Tone:</u> Professional and business-oriented.</p>
</blockquote>
<blockquote>
<p><strong>Constraints:</strong>
<u>Technical Stack:</u>
Use Drizzle ORM schema following the hierarchical e-commerce product catalog structure from Next-Faster https://github.com/ethanniser/NextFaster.
The product organization follows a 4-level deep categorization: Collection → Category → Subcollection → Subcategory → Product.
<u>Entity Definitions:</u>
COLLECTION:
id (primary key),
name,
slug.
CATEGORY:
slug (primary key),
name,
collection_id (foreign key → COLLECTION),
image.
SUBCOLLECTION:
id (primary key),
name,
category_slug (foreign key → CATEGORY).
SUBCATEGORY:
slug (primary key),
name,
subcollection_id (foreign key → SUBCOLLECTION),
image.
PRODUCT:
id (primary key),
slug,
supplier_id (foreign key → SUPPLIER),
article (optional),
code (optional),
name,
description,
price,
subcategory_slug (foreign key → SUBCATEGORY),
image_id (foreign key → IMAGE).
IMAGE:
id (primary key),
title,
url.
SUPPLIER:
id (primary key),
name,
contact.
CUSTOMER:
id (primary key),
name,
address,
phone,
taxpayer_id.
PURCHASE_ORDER:
id (primary key),
customer_id (foreign key → CUSTOMER),
product_id (foreign key → PRODUCT),
quantity.
DELIVERY_NOTE:
(Structure to be defined based on business requirements).
<u>Admin-Specific Requirements:</u>
XLSX File Upload The ADMIN interface must support uploading .xlsx files with the following fields (in Spanish):
Proveedor (supplier code),
Artículo (article code, optional),
Código (code number, optional),
Descripción (description),
Categoría (zero, one, or many category &quot;tags&quot;, optional),
Imagen (Image URL, optional).
CRUD Operations Full Create, Read, Update, and Delete capabilities for all entities listed above.
<u>Salesperson-Specific Requirements:</u>
MISSING_ITEM List Generation For every DELIVERY_NOTE created, the system must automatically generate a MISSING_ITEM list for the SALESPERSON, showing which products from the PURCHASE_ORDER are not included in the delivery.</p>
</blockquote>
<blockquote>
<p><strong>Examples:</strong>
<u>Example 1: Customer Workflow.</u>
Customer browses products filtered by &quot;Electronics&quot; → &quot;Smartphones&quot; → &quot;Android&quot;.
Customer adds 2 units of &quot;Samsung Galaxy S24&quot; to cart.
Customer reviews cart and submits it as a PURCHASE_ORDER.
SALESPERSON receives the order notification .
<u>Example 2: Admin Product Upload.</u>
ADMIN uploads an .xlsx file with columns: Proveedor, Artículo, Código, Descripción, Categoría, Imagen.
System parses the file and creates/updates PRODUCT records.
System links products to appropriate SUPPLIER, CATEGORY, SUBCATEGORY, and IMAGE entities.
<u>Example 3: Delivery Note Creation.</u>
SALESPERSON creates a DELIVERY_NOTE for PURCHASE_ORDER #123.
PURCHASE_ORDER contains: Product A (qty: 5), Product B (qty: 3), Product C (qty: 2).
DELIVERY_NOTE includes: Product A (qty: 5), Product B (qty: 1).
System generates MISSING_ITEM list: Product B (missing: 2), Product C (missing: 2).</p>
</blockquote>
<blockquote>
<p><strong>Output Format:</strong>
For each implementation request, provide:
Development Plan: A structured breakdown of the implementation steps, including:
Database schema changes (if any),
Backend API endpoints required,
Frontend components to be created/modified,
State management approach,
Estimated complexity and dependencies.
Confirmation Request: Explicitly ask for approval before proceeding with code implementation.
Implementation: Upon confirmation, deliver:
Clean, well-commented code,
Component structure following React best practices,
Mobile-first responsive design,
Error handling and validation,
Type safety (TypeScript if applicable).
Testing Considerations: Brief notes on what should be tested.</p>
</blockquote>
<h2>5. Arquitectura y Tecnologías</h2>
<p>La selección de la pila tecnológica es una decisión crítica que impacta la escalabilidad, el mantenimiento y la experiencia del desarrollador. Para este proyecto, se ha optado por un conjunto de tecnologías modernas y eficientes:</p>
<ul>
<li><strong>Frontend:</strong> <strong>React</strong> con <strong>TypeScript</strong> para construir una interfaz de usuario interactiva, segura en tipos y mantenible. El diseño se aborda con un enfoque <em>mobile-first</em> para garantizar una experiencia óptima en dispositivos móviles.</li>
<li><strong>ORM:</strong> <strong>Drizzle ORM</strong>, un mapeador relacional de objetos para TypeScript que ofrece un rendimiento excelente y una sintaxis cercana a SQL, facilitando la interacción con la base de datos de una manera segura y eficiente.</li>
<li><strong>Base de Datos:</strong> Aunque no se especifica un motor concreto, Drizzle es compatible con bases de datos relacionales populares como <strong>PostgreSQL</strong> o <strong>MySQL</strong>, que son opciones robustas y probadas para aplicaciones de e-commerce.</li>
</ul>
<p>Esta arquitectura promueve una separación clara de responsabilidades entre el frontend y el backend, permitiendo un desarrollo y despliegue independientes.</p>
<h2>6. Iteraciones Futuras y Mejoras</h2>
<p>Un proyecto de software nunca está completamente &quot;terminado&quot;. Siempre hay oportunidades para mejorar y añadir nuevas funcionalidades. Algunas posibles iteraciones para esta aplicación incluyen:</p>
<ul>
<li><strong>Sistema de Autenticación de Usuarios:</strong> Implementar un sistema de inicio de sesión para que los clientes puedan ver su historial de pedidos y guardar su información.</li>
<li><strong>Pasarelas de Pago:</strong> Integrar servicios de pago como Stripe o PayPal para permitir transacciones en línea directas.</li>
<li><strong>Módulo de Inventario:</strong> Desarrollar un sistema de gestión de stock que se actualice automáticamente con cada compra y entrega.</li>
<li><strong>Notificaciones en Tiempo Real:</strong> Implementar notificaciones push o por correo electrónico para clientes y vendedores sobre el estado de los pedidos.</li>
<li><strong>Análisis y Reportes:</strong> Crear un panel de control para que los administradores y vendedores puedan visualizar métricas de ventas, productos más populares y otros KPIs.</li>
</ul>
<h2>Conclusión</h2>
<p>El desarrollo de esta aplicación de e-commerce demuestra cómo un enfoque estructurado, que combina principios sólidos de ingeniería de software con la colaboración de una inteligencia artificial, puede llevar a resultados exitosos. El uso del protocolo RICECO para guiar a la IA, junto con un modelo de datos bien definido y una pila tecnológica moderna, establece una base sólida para construir una aplicación funcional, escalable y fácil de mantener. Las futuras iteraciones permitirán enriquecer la plataforma, añadiendo valor tanto para los usuarios como para el negocio.</p>
<hr>
<h3>Referencias</h3>
<ul>
<li>[1] Next-Faster by Ethan Niser. <em>GitHub</em>. <a href="https://github.com/ethanniser/NextFaster">https://github.com/ethanniser/NextFaster</a></li>
<li>[2] The Easiest Prompt Formula to 10x Your Results. <a href="https://www.youtube.com/watch?v=X7YjqKk-7Y0">https://www.youtube.com/watch?v=X7YjqKk-7Y0</a></li>
</ul>

  </article>
</div>

  </main>
  <hr class="fleuron" />

<footer>
    <p>Arise with IA | IA para Aprender &copy; 2025</p>
</footer>


  
  
  <script>
  (function() {
    'use strict';
    
    // ============================================
    // 1. Scroll Header Shrink Effect (OPTIMIZADO)
    // ============================================
    const header = document.querySelector('header');
    let ticking = false;
    
    window.addEventListener('scroll', function() {
      if (!ticking) {
        window.requestAnimationFrame(function() {
          header.classList.toggle('shrink', window.scrollY > 50);
          ticking = false;
        });
        ticking = true;
      }
    });
    
    // ============================================
    // 2. Format Dates in Spanish
    // ============================================
    function formatDates() {
      const timeElements = document.querySelectorAll('time.post-date');
      const meses = [
        'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
        'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
      ];
      
      timeElements.forEach(function(timeEl) {
        const dateStr = timeEl.textContent.trim();
        const date = new Date(dateStr);
        
        if (!isNaN(date.getTime())) {
          const day = date.getDate();
          const month = meses[date.getMonth()];
          const year = date.getFullYear();
          
          timeEl.textContent = day + ' de ' + month + ' de ' + year;
          timeEl.setAttribute('datetime', dateStr);
        }
      });
    }
    
    // ============================================
    // 3. Table of Contents (TOC) - OPTIMIZADO
    // ============================================
    function initTableOfContents() {
      // Buscar artículo
      const article = document.querySelector('article');
      if (!article) return;
      
      // Buscar encabezados (h2, h3, h4)
      const headings = article.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) {
        // Ocultar elementos del TOC si no hay encabezados
        const tocElements = document.querySelectorAll('#toc-bar, #toc-solo-trigger, #toc-wrapper');
        tocElements.forEach(el => el && (el.style.display = 'none'));
        return;
      }
      
      // Generar HTML del índice
      let html = '<ul>';
      headings.forEach(function(heading, index) {
        // Generar ID si no existe
        if (!heading.id) {
          const text = heading.textContent.trim();
          const slug = text
            .toLowerCase()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .replace(/[^a-z0-9\s]+/g, '')
            .replace(/\s+/g, '-')
            .replace(/^-+|-+$/g, '');
          heading.id = slug || 'seccion-' + (index + 1);
        }
        
        // Indentación según nivel
        const level = parseInt(heading.tagName[1]);
        const style = level === 3 ? ' style="padding-left: 1.5em"' : 
                     level === 4 ? ' style="padding-left: 3em"' : '';
        
        html += '<li' + style + '><a href="#' + heading.id + '">' + 
                heading.textContent.trim() + '</a></li>';
      });
      html += '</ul>';
      
      // Insertar en popup (mobile)
      const popupContent = document.getElementById('toc-popup-content');
      if (popupContent) popupContent.innerHTML = html;
      
      // Insertar en sidebar (desktop)
      const tocWrapper = document.getElementById('toc-wrapper');
      if (tocWrapper) {
        let nav = tocWrapper.querySelector('nav');
        if (!nav) {
          nav = document.createElement('nav');
          tocWrapper.appendChild(nav);
        }
        nav.innerHTML = html;
      }
      
      // Configurar popup modal
      const popup = document.getElementById('toc-popup');
      const triggers = document.querySelectorAll('.toc-trigger');
      const btnClose = document.getElementById('toc-popup-close');
      
      if (popup && triggers.length > 0) {
        // Función para cerrar popup con animación
        function closePopup() {
          popup.setAttribute('closing', '');
          popup.addEventListener('animationend', function handleAnimationEnd() {
            popup.removeAttribute('closing');
            popup.close();
            document.documentElement.classList.remove('overflow-hidden');
            document.body.classList.remove('overflow-hidden');
            popup.removeEventListener('animationend', handleAnimationEnd);
          });
        }
        
        // Abrir popup (OPTIMIZADO)
        triggers.forEach(function(trigger) {
          trigger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            document.documentElement.classList.add('overflow-hidden');
            document.body.classList.add('overflow-hidden');
            popup.showModal();
          });
        });
        
        // Cerrar popup (FIX)
        if (btnClose) {
          btnClose.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            closePopup();
          });
        }
        
        // Click en backdrop (SIMPLIFICADO)
        popup.addEventListener('click', function(e) {
          if (e.target === popup) {
            closePopup();
          }
        });
        
        // ESC key
        popup.addEventListener('cancel', function(e) {
          e.preventDefault();
          closePopup();
        });
        
        // Manejar resize (cerrar popup en desktop)
        window.addEventListener('resize', function() {
          if (window.innerWidth >= 1200 && popup.open) {
            popup.close();
            document.documentElement.classList.remove('overflow-hidden');
            document.body.classList.remove('overflow-hidden');
          }
        });
      }
      
      // Botón flotante con IntersectionObserver
      const tocBar = document.getElementById('toc-bar');
      const soloTrigger = document.getElementById('toc-solo-trigger');
      
      if (tocBar && soloTrigger) {
        const observer = new IntersectionObserver(
          function(entries) {
            entries.forEach(function(entry) {
              tocBar.classList.toggle('invisible', entry.isIntersecting);
            });
          },
          { rootMargin: '-48px 0px 0px 0px' }
        );
        observer.observe(soloTrigger);
      }
      
      // Smooth scroll y scroll spy
      const tocLinks = document.querySelectorAll('#toc-popup-content a, #toc-wrapper a');
      const linkMap = new Map();
      
      // Crear mapa de IDs a enlaces
      tocLinks.forEach(function(link) {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          const id = href.substring(1);
          if (!linkMap.has(id)) {
            linkMap.set(id, []);
          }
          linkMap.get(id).push(link);
          
          // Smooth scroll
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById(id);
            if (target) {
              const offset = 100;
              const targetPosition = target.getBoundingClientRect().top + 
                                   window.pageYOffset - offset;
              window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
              });
              history.pushState(null, null, '#' + id);
              if (popup && popup.open) {
                closePopup();
              }
            }
          });
        }
      });
      
      // Scroll spy con IntersectionObserver
      const scrollObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            
            // Remover clase active de todos
            tocLinks.forEach(function(link) {
              link.classList.remove('active');
            });
            
            // Agregar clase active a los enlaces correspondientes
            const activeLinks = linkMap.get(id);
            if (activeLinks) {
              activeLinks.forEach(function(link) {
                link.classList.add('active');
              });
            }
          }
        });
      }, {
        rootMargin: '-100px 0px -66%',
        threshold: 0
      });
      
      // Observar todos los encabezados
      headings.forEach(function(heading) {
        if (heading.id) {
          scrollObserver.observe(heading);
        }
      });
    }
    
    // ============================================
    // Inicialización
    // ============================================
    function init() {
      formatDates();
      initTableOfContents();
    }
    
    // Ejecutar cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
  })();
  </script>

</body>
</html>
