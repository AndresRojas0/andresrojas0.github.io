<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="AAI|IAA Arise with AI|IA para aprender">
    <meta name="description" content="This AAI|IAA page shares the experience of a AI user.">
    <meta name="robots" content="index, follow" />
    <title>Desarrollo: AplicaciÃ³n profesional de soporte tÃ©cnico. Un resumen con IA.</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
</head>
<body>
  <header>
    <h1>AAI | IAA</h1>
    <nav>
        <a href="/">Inicio</a>
        <a href="/pages/about">Acerca</a>
        <a href="/pages/contact">Contacto</a>
    </nav>
</header>

  <main>
    
<div class="article-with-sidebar">
  
  
  
  <div id="toc-bar" class="invisible">
    <span class="label">Desarrollo: AplicaciÃ³n profesional de soporte tÃ©cnico. Un resumen con IA.</span>
    <button type="button" class="toc-trigger">
      â˜°
    </button>
  </div>

  
  <button id="toc-solo-trigger" type="button" class="toc-trigger">
    <span class="label">Ãndice</span>
    <span>â†’</span>
  </button>

  
  <dialog id="toc-popup">
    <div class="header">
      <div class="label">Desarrollo: AplicaciÃ³n profesional de soporte tÃ©cnico. Un resumen con IA.</div>
      <button id="toc-popup-close" type="button">
        âœ•
      </button>
    </div>
    <div id="toc-popup-content">
      
    </div>
  </dialog>

  
  
  <aside id="toc-wrapper">
    <h2>Ãndice</h2>
    <nav>
      
    </nav>
  </aside>

  
  
  <article>
    
      <img src="/images/vignette-cegid-xrp-mod.svg" alt="Desarrollo: AplicaciÃ³n profesional de soporte tÃ©cnico. Un resumen con IA.">
    

    <h1>Desarrollo: AplicaciÃ³n profesional de soporte tÃ©cnico. Un resumen con IA.</h1>
    
    
      <time class="post-date" datetime="Sun Dec 14 2025 20:00:00 GMT-0300 (hora estÃ¡ndar de Argentina)">Sun Dec 14 2025 20:00:00 GMT-0300 (hora estÃ¡ndar de Argentina)</time>
    

    <p><strong>Autor:</strong> Marcelo Robin (contenido original en video), IA (en la generaciÃ³n de texto)</p>
<hr>
<h2>DOCUMENTO 1: ANÃLISIS EXHAUSTIVO POR VIDEO</h2>
<h1>DOCUMENTO 1: ANÃLISIS EXHAUSTIVO POR VIDEO</h1>
<h2>Serie FastAPI y Next.js - Crea una App Full Stack Real</h2>
<h3>Canal: CÃ³digo para Principiantes</h3>
<hr>
<h2>ğŸ“¹ VIDEO 1: FastAPI y Next.js - Crea una App Full Stack Real (con WebSockets)</h2>
<h3>ğŸ“Š INFORMACIÃ“N GENERAL</h3>
<ul>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=5oNktUuWBMY</li>
<li><strong>DuraciÃ³n</strong>: 10:13 minutos</li>
<li><strong>Vistas</strong>: 650 vistas</li>
<li><strong>Publicado</strong>: Hace 3 meses</li>
<li><strong>Me gusta</strong>: 55</li>
<li><strong>Canal</strong>: CÃ³digo para Principiantes (3.78K suscriptores)</li>
<li><strong>Hashtags</strong>: #FastAPI #NextJS #PostgreSQL</li>
</ul>
<h3>ğŸ“ DESCRIPCIÃ“N</h3>
<p>Aprende paso a paso cÃ³mo crear una App Full Stack Real con FastAPI, Next.js y PostgreSQL, totalmente en contenedores de Podman, usando WebSockets para comunicaciÃ³n en tiempo real y cookies seguras con tokens para autenticaciÃ³n.</p>
<h3>ğŸ¯ OBJETIVOS DEL VIDEO</h3>
<p>Este primer episodio presenta:</p>
<ul>
<li>VisiÃ³n general del proyecto Full Stack completo</li>
<li>IntroducciÃ³n a las tecnologÃ­as principales (FastAPI, Next.js, PostgreSQL)</li>
<li>Arquitectura del sistema con contenedorizaciÃ³n</li>
<li>Planteamiento de caracterÃ­sticas clave: WebSockets y autenticaciÃ³n segura</li>
</ul>
<h3>ğŸ”‘ CONCEPTOS TÃ‰CNICOS PRINCIPALES</h3>
<h4>1. <strong>Stack TecnolÃ³gico</strong></h4>
<ul>
<li><strong>Backend</strong>: FastAPI (Framework Python asÃ­ncrono de alto rendimiento)</li>
<li><strong>Frontend</strong>: Next.js (Framework React con SSR/SSG)</li>
<li><strong>Base de Datos</strong>: PostgreSQL (Sistema de gestiÃ³n de base de datos relacional)</li>
<li><strong>ContenedorizaciÃ³n</strong>: Podman (Alternativa a Docker sin daemon root)</li>
</ul>
<h4>2. <strong>CaracterÃ­sticas Clave del Proyecto</strong></h4>
<ul>
<li><strong>WebSockets</strong>: ComunicaciÃ³n bidireccional en tiempo real</li>
<li><strong>AutenticaciÃ³n Segura</strong>: Tokens JWT almacenados en cookies HttpOnly</li>
<li><strong>Arquitectura de Contenedores</strong>: AplicaciÃ³n completamente contenerizada</li>
<li><strong>Desarrollo Full Stack</strong>: IntegraciÃ³n completa frontend-backend</li>
</ul>
<h4>3. <strong>Arquitectura del Sistema</strong></h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSockets/HTTP     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js       â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚    FastAPI       â”‚
â”‚   Frontend      â”‚     JWT en Cookies      â”‚    Backend       â”‚
â”‚  (Contenedor 1) â”‚                         â”‚  (Contenedor 2)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â†•
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   PostgreSQL     â”‚
                                            â”‚   Base de Datos  â”‚
                                            â”‚  (Contenedor 3)  â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3>ğŸ’¡ TIPS Y OBSERVACIONES DEL INSTRUCTOR</h3>
<ul>
<li>Este es un proyecto real de producciÃ³n, no un tutorial bÃ¡sico</li>
<li>Se seguirÃ¡n las mejores prÃ¡cticas profesionales</li>
<li>El uso de Podman en lugar de Docker ofrece ventajas en seguridad</li>
<li>La serie completa construirÃ¡ una aplicaciÃ³n funcional paso a paso</li>
</ul>
<h3>ğŸ¬ CAPÃTULOS Y TIMESTAMPS</h3>
<p><em>(Nota: Los timestamps especÃ­ficos no estaban disponibles en los metadatos extraÃ­dos)</em></p>
<p>Contenido estimado:</p>
<ul>
<li>[00:00 - 02:00] IntroducciÃ³n al proyecto Full Stack</li>
<li>[02:00 - 04:00] PresentaciÃ³n del stack tecnolÃ³gico</li>
<li>[04:00 - 06:30] Arquitectura y diseÃ±o del sistema</li>
<li>[06:30 - 08:30] CaracterÃ­sticas principales: WebSockets y autenticaciÃ³n</li>
<li>[08:30 - 10:13] Roadmap de la serie y prÃ³ximos episodios</li>
</ul>
<h3>ğŸ”— CONEXIÃ“N CON SIGUIENTES EPISODIOS</h3>
<p>Este video establece las bases para:</p>
<ul>
<li><strong>Video 2</strong>: ImplementaciÃ³n y configuraciÃ³n del Backend con FastAPI</li>
<li><strong>Video 3</strong>: ConfiguraciÃ³n del Frontend con Next.js</li>
<li><strong>Videos posteriores</strong>: Refinamiento y caracterÃ­sticas avanzadas</li>
</ul>
<hr>
<h2>ğŸ“¹ VIDEO 2: FastAPI y Next.js - Preparamos el Backend | Curso App Full Stack #2</h2>
<h3>ğŸ“Š INFORMACIÃ“N GENERAL</h3>
<ul>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=fNgmKHZ1HJU</li>
<li><strong>DuraciÃ³n</strong>: 43:31 minutos â­ (El episodio mÃ¡s largo de la serie)</li>
<li><strong>Vistas</strong>: 538 vistas</li>
<li><strong>Publicado</strong>: Hace 3 meses</li>
<li><strong>Me gusta</strong>: 33</li>
<li><strong>Canal</strong>: CÃ³digo para Principiantes (3.78K suscriptores)</li>
<li><strong>Hashtags</strong>: #FastAPI #NextJS #PostgreSQL</li>
</ul>
<h3>ğŸ“ DESCRIPCIÃ“N</h3>
<p>ContinuaciÃ³n del curso Full Stack donde se prepara y configura exhaustivamente el backend con FastAPI, estableciendo la base para la API REST y comunicaciÃ³n en tiempo real.</p>
<h3>ğŸ¯ OBJETIVOS DEL VIDEO</h3>
<ul>
<li>Configurar el entorno de desarrollo del Backend</li>
<li>Instalar y configurar FastAPI con todas sus dependencias</li>
<li>Establecer la estructura inicial del proyecto</li>
<li>Configurar la conexiÃ³n a PostgreSQL</li>
<li>Implementar endpoints bÃ¡sicos de prueba</li>
<li>Preparar el contenedor Docker/Podman para el backend</li>
</ul>
<h3>ğŸ”‘ CONCEPTOS TÃ‰CNICOS PRINCIPALES</h3>
<h4>1. <strong>InstalaciÃ³n y ConfiguraciÃ³n de FastAPI</strong></h4>
<p><strong>Dependencias Principales</strong>:</p>
<pre><code class="language-bash"># InstalaciÃ³n de FastAPI y servidor ASGI
pip install fastapi uvicorn[standard]

# AutenticaciÃ³n y seguridad
pip install python-jose[cryptography] passlib[bcrypt]

# ValidaciÃ³n de datos
pip install pydantic pydantic[email]

# Base de datos
pip install sqlalchemy psycopg2-binary alembic

# Utilidades
pip install python-multipart
</code></pre>
<p><strong>CaracterÃ­sticas de FastAPI exploradas</strong>:</p>
<ul>
<li><strong>Servidor ASGI (Uvicorn)</strong>: Servidor asÃ­ncrono de alto rendimiento</li>
<li><strong>ValidaciÃ³n automÃ¡tica</strong>: Uso de Pydantic para validaciÃ³n de tipos</li>
<li><strong>DocumentaciÃ³n automÃ¡tica</strong>: Swagger UI y Redoc generados automÃ¡ticamente</li>
<li><strong>Type hints</strong>: Aprovechamiento del tipado estÃ¡tico de Python</li>
</ul>
<h4>2. <strong>Estructura Inicial del Proyecto Backend</strong></h4>
<pre><code>backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # Punto de entrada de la aplicaciÃ³n
â”‚   â”œâ”€â”€ config.py            # ConfiguraciÃ³n y variables de entorno
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ routes.py        # DefiniciÃ³n de rutas/endpoints
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ security.py      # JWT, hashing, autenticaciÃ³n
â”‚   â”‚   â””â”€â”€ config.py        # Settings centralizados
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ database.py      # ConexiÃ³n a PostgreSQL
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ __init__.py      # Modelos SQLAlchemy (prÃ³ximo video)
â”‚   â””â”€â”€ schemas/
â”‚       â””â”€â”€ __init__.py      # Esquemas Pydantic (prÃ³ximo video)
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â””â”€â”€ .env
</code></pre>
<h4>3. <strong>ConfiguraciÃ³n de la Base de Datos PostgreSQL</strong></h4>
<p><strong>Archivo <code>database.py</code></strong>:</p>
<pre><code class="language-python">from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

# URL de conexiÃ³n a PostgreSQL
DATABASE_URL = &quot;postgresql://user:password@postgres:5432/dbname&quot;

# Crear engine con pool de conexiones
engine = create_engine(
    DATABASE_URL,
    pool_pre_ping=True,  # Verificar conexiones
    pool_size=10,        # NÃºmero de conexiones
    max_overflow=20      # Conexiones adicionales mÃ¡ximas
)

# Configurar sesiÃ³n
SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=engine
)

# Base para modelos declarativos
Base = declarative_base()

# Dependency para obtener sesiÃ³n de BD
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
</code></pre>
<h4>4. <strong>ConfiguraciÃ³n de Variables de Entorno</strong></h4>
<p><strong>Archivo <code>.env</code></strong>:</p>
<pre><code class="language-env"># Database
DATABASE_URL=postgresql://fastapi_user:securepassword@postgres:5432/fullstack_db

# Security
SECRET_KEY=your-super-secret-key-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Application
APP_NAME=FastAPI Full Stack
DEBUG=True
VERSION=1.0.0
</code></pre>
<p><strong>Archivo <code>config.py</code> con Pydantic</strong>:</p>
<pre><code class="language-python">from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # Database
    DATABASE_URL: str
    
    # Security
    SECRET_KEY: str
    ALGORITHM: str = &quot;HS256&quot;
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # Application
    APP_NAME: str = &quot;FastAPI Full Stack&quot;
    DEBUG: bool = False
    VERSION: str = &quot;1.0.0&quot;
    
    class Config:
        env_file = &quot;.env&quot;
        case_sensitive = True

settings = Settings()
</code></pre>
<h4>5. <strong>AplicaciÃ³n Principal FastAPI</strong></h4>
<p><strong>Archivo <code>main.py</code></strong>:</p>
<pre><code class="language-python">from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api import routes

# Crear instancia de FastAPI
app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    description=&quot;API Full Stack con FastAPI y Next.js&quot;,
    docs_url=&quot;/docs&quot;,
    redoc_url=&quot;/redoc&quot;
)

# Configurar CORS para Next.js
origins = [
    &quot;http://localhost:3000&quot;,  # Next.js dev
    &quot;http://frontend:3000&quot;,   # Next.js container
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=[&quot;*&quot;],
    allow_headers=[&quot;*&quot;],
)

# Incluir routers
app.include_router(routes.router, prefix=&quot;/api/v1&quot;)

# Endpoint de health check
@app.get(&quot;/health&quot;)
async def health_check():
    return {
        &quot;status&quot;: &quot;healthy&quot;,
        &quot;version&quot;: settings.VERSION
    }

# Evento de inicio
@app.on_event(&quot;startup&quot;)
async def startup_event():
    print(f&quot;ğŸš€ {settings.APP_NAME} iniciado&quot;)
    print(f&quot;ğŸ“š DocumentaciÃ³n en: http://localhost:8000/docs&quot;)

# Evento de cierre
@app.on_event(&quot;shutdown&quot;)
async def shutdown_event():
    print(&quot;ğŸ‘‹ Cerrando aplicaciÃ³n&quot;)
</code></pre>
<h4>6. <strong>ContainerizaciÃ³n del Backend</strong></h4>
<p><strong>Dockerfile para FastAPI</strong>:</p>
<pre><code class="language-dockerfile"># Imagen base con Python
FROM python:3.11-slim

# Directorio de trabajo
WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update &amp;&amp; apt-get install -y \
    gcc \
    postgresql-client \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# Copiar requirements
COPY requirements.txt .

# Instalar dependencias Python
RUN pip install --no-cache-dir -r requirements.txt

# Copiar cÃ³digo de la aplicaciÃ³n
COPY ./app ./app

# Exponer puerto
EXPOSE 8000

# Comando para ejecutar
CMD [&quot;uvicorn&quot;, &quot;app.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;, &quot;--reload&quot;]
</code></pre>
<p><strong>docker-compose.yml parcial</strong>:</p>
<pre><code class="language-yaml">version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: securepassword
      POSTGRES_DB: fullstack_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - &quot;5432:5432&quot;
    networks:
      - fullstack_network

  backend:
    build: ./backend
    container_name: fullstack_backend
    env_file:
      - ./backend/.env
    volumes:
      - ./backend/app:/app/app
    ports:
      - &quot;8000:8000&quot;
    depends_on:
      - postgres
    networks:
      - fullstack_network

networks:
  fullstack_network:
    driver: bridge

volumes:
  postgres_data:
</code></pre>
<h4>7. <strong>Comandos y Configuraciones Importantes</strong></h4>
<p><strong>Comandos de desarrollo</strong>:</p>
<pre><code class="language-bash"># Levantar contenedores con Podman
podman-compose up -d

# Ver logs del backend
podman logs -f fullstack_backend

# Ejecutar migraciones (cuando se configuren)
podman exec fullstack_backend alembic upgrade head

# Acceder al contenedor
podman exec -it fullstack_backend bash

# Detener contenedores
podman-compose down

# Reconstruir imÃ¡genes
podman-compose build --no-cache
</code></pre>
<p><strong>Ejecutar FastAPI localmente (sin contenedores)</strong>:</p>
<pre><code class="language-bash"># Modo desarrollo con recarga automÃ¡tica
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Modo producciÃ³n con mÃºltiples workers
uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
</code></pre>
<h3>ğŸ’¡ TIPS Y OBSERVACIONES DEL INSTRUCTOR</h3>
<ol>
<li>
<p><strong>Sobre la estructura del proyecto</strong>:</p>
<ul>
<li>Empezar con una estructura simple y escalarla segÃºn necesidad</li>
<li>Separar claramente las responsabilidades (API, lÃ³gica de negocio, datos)</li>
<li>Mantener la configuraciÃ³n centralizada</li>
</ul>
</li>
<li>
<p><strong>Sobre PostgreSQL</strong>:</p>
<ul>
<li>Usar pool de conexiones para mejor rendimiento</li>
<li>Configurar <code>pool_pre_ping=True</code> para reconexiones automÃ¡ticas</li>
<li>Siempre cerrar sesiones de base de datos con <code>try/finally</code></li>
</ul>
</li>
<li>
<p><strong>Sobre FastAPI</strong>:</p>
<ul>
<li>La documentaciÃ³n automÃ¡tica (Swagger UI) es invaluable para desarrollo</li>
<li>Aprovechar la inyecciÃ³n de dependencias para cÃ³digo limpio</li>
<li>Usar <code>async</code>/<code>await</code> para operaciones I/O bound</li>
</ul>
</li>
<li>
<p><strong>Sobre contenedores</strong>:</p>
<ul>
<li>Usar volÃºmenes para persistencia de datos</li>
<li>Configurar networks para comunicaciÃ³n entre contenedores</li>
<li>Separar configuraciones de desarrollo y producciÃ³n</li>
</ul>
</li>
<li>
<p><strong>Sobre seguridad</strong>:</p>
<ul>
<li>NUNCA commitear archivos <code>.env</code> al repositorio</li>
<li>Usar <code>SECRET_KEY</code> fuertes generadas aleatoriamente</li>
<li>Configurar CORS apropiadamente segÃºn el entorno</li>
</ul>
</li>
</ol>
<h3>ğŸ¬ CAPÃTULOS Y TIMESTAMPS ESTIMADOS</h3>
<ul>
<li><strong>[00:00 - 05:00]</strong> IntroducciÃ³n y repaso del episodio anterior</li>
<li><strong>[05:00 - 10:00]</strong> InstalaciÃ³n de FastAPI y dependencias</li>
<li><strong>[10:00 - 18:00]</strong> ConfiguraciÃ³n de la estructura del proyecto</li>
<li><strong>[18:00 - 25:00]</strong> ConfiguraciÃ³n de PostgreSQL y SQLAlchemy</li>
<li><strong>[25:00 - 32:00]</strong> CreaciÃ³n del archivo main.py y endpoints bÃ¡sicos</li>
<li><strong>[32:00 - 38:00]</strong> ConfiguraciÃ³n del Dockerfile y docker-compose</li>
<li><strong>[38:00 - 43:31]</strong> Pruebas, verificaciÃ³n y conclusiones</li>
</ul>
<h3>ğŸ”— CONEXIÃ“N CON OTROS EPISODIOS</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li>Video 1: VisiÃ³n general y arquitectura del proyecto</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li>Video 3: ConfiguraciÃ³n del Frontend con Next.js</li>
<li>Video 4: ReorganizaciÃ³n profesional del Backend</li>
<li>Video 5: CreaciÃ³n de modelos y relaciones de base de datos</li>
</ul>
<hr>
<h2>ğŸ“¹ VIDEO 3: FastAPI y NextJS - Preparamos el contenedor del Frontend | Curso App Full Stack #3</h2>
<h3>ğŸ“Š INFORMACIÃ“N GENERAL</h3>
<ul>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=5zkla8UaiwI</li>
<li><strong>DuraciÃ³n</strong>: 28:14 minutos</li>
<li><strong>Vistas</strong>: 258 vistas</li>
<li><strong>Publicado</strong>: Hace 3 meses</li>
<li><strong>Me gusta</strong>: 18</li>
<li><strong>Canal</strong>: CÃ³digo para Principiantes (3.78K suscriptores)</li>
<li><strong>Hashtags</strong>: #FastAPI #NextJS #PostgreSQL</li>
</ul>
<h3>ğŸ“ DESCRIPCIÃ“N</h3>
<p>Episodio dedicado a la configuraciÃ³n completa del contenedor del Frontend con Next.js, estableciendo la base para la interfaz de usuario y la comunicaciÃ³n con el backend FastAPI.</p>
<h3>ğŸ¯ OBJETIVOS DEL VIDEO</h3>
<ul>
<li>Instalar y configurar Next.js</li>
<li>Configurar TypeScript para el proyecto</li>
<li>Establecer la estructura del proyecto Frontend</li>
<li>Configurar TailwindCSS para estilos</li>
<li>Implementar componentes UI con shadcn/ui</li>
<li>Crear el contenedor Docker/Podman para Next.js</li>
<li>Configurar la comunicaciÃ³n con el backend</li>
</ul>
<h3>ğŸ”‘ CONCEPTOS TÃ‰CNICOS PRINCIPALES</h3>
<h4>1. <strong>InstalaciÃ³n y ConfiguraciÃ³n de Next.js</strong></h4>
<p><strong>Crear proyecto Next.js</strong>:</p>
<pre><code class="language-bash"># Crear nuevo proyecto con App Router
npx create-next-app@latest frontend --typescript --tailwind --app

# Opciones seleccionadas:
# âœ“ Would you like to use TypeScript? Yes
# âœ“ Would you like to use ESLint? Yes
# âœ“ Would you like to use Tailwind CSS? Yes
# âœ“ Would you like to use `src/` directory? Yes
# âœ“ Would you like to use App Router? Yes
# âœ“ Would you like to customize the default import alias? No
</code></pre>
<p><strong>Dependencias adicionales</strong>:</p>
<pre><code class="language-bash">cd frontend

# Cliente HTTP para consumir API
npm install axios

# Manejo de formularios
npm install react-hook-form zod @hookform/resolvers

# Cliente OpenAPI tipado
npm install openapi-fetch openapi-typescript

# Shadcn UI components
npx shadcn-ui@latest init
</code></pre>
<h4>2. <strong>Estructura del Proyecto Frontend</strong></h4>
<pre><code>frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ layout.tsx        # Layout principal
â”‚   â”‚   â”œâ”€â”€ page.tsx          # PÃ¡gina home
â”‚   â”‚   â”œâ”€â”€ (auth)/           # Grupo de rutas autenticaciÃ³n
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ (protected)/      # Grupo de rutas protegidas
â”‚   â”‚       â””â”€â”€ dashboard/
â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/               # Componentes shadcn
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ forms/
â”‚   â”‚       â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚       â””â”€â”€ RegisterForm.tsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api.ts           # Cliente API
â”‚   â”‚   â”œâ”€â”€ auth.ts          # LÃ³gica de autenticaciÃ³n
â”‚   â”‚   â””â”€â”€ utils.ts         # Utilidades
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ useWebSocket.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ api.ts           # Tipos TypeScript
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ globals.css
â”œâ”€â”€ public/
â”‚   â””â”€â”€ assets/
â”œâ”€â”€ .env.local
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ Dockerfile
</code></pre>
<h4>3. <strong>ConfiguraciÃ³n de TypeScript</strong></h4>
<p><strong>tsconfig.json</strong>:</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;ES2020&quot;,
    &quot;lib&quot;: [&quot;dom&quot;, &quot;dom.iterable&quot;, &quot;esnext&quot;],
    &quot;allowJs&quot;: true,
    &quot;skipLibCheck&quot;: true,
    &quot;strict&quot;: true,
    &quot;forceConsistentCasingInFileNames&quot;: true,
    &quot;noEmit&quot;: true,
    &quot;esModuleInterop&quot;: true,
    &quot;module&quot;: &quot;esnext&quot;,
    &quot;moduleResolution&quot;: &quot;bundler&quot;,
    &quot;resolveJsonModule&quot;: true,
    &quot;isolatedModules&quot;: true,
    &quot;jsx&quot;: &quot;preserve&quot;,
    &quot;incremental&quot;: true,
    &quot;plugins&quot;: [
      {
        &quot;name&quot;: &quot;next&quot;
      }
    ],
    &quot;paths&quot;: {
      &quot;@/*&quot;: [&quot;./src/*&quot;]
    }
  },
  &quot;include&quot;: [&quot;next-env.d.ts&quot;, &quot;**/*.ts&quot;, &quot;**/*.tsx&quot;, &quot;.next/types/**/*.ts&quot;],
  &quot;exclude&quot;: [&quot;node_modules&quot;]
}
</code></pre>
<h4>4. <strong>ConfiguraciÃ³n de TailwindCSS</strong></h4>
<p><strong>tailwind.config.ts</strong>:</p>
<pre><code class="language-typescript">import type { Config } from &quot;tailwindcss&quot;

const config: Config = {
  darkMode: [&quot;class&quot;],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    container: {
      center: true,
      padding: &quot;2rem&quot;,
      screens: {
        &quot;2xl&quot;: &quot;1400px&quot;,
      },
    },
    extend: {
      colors: {
        border: &quot;hsl(var(--border))&quot;,
        input: &quot;hsl(var(--input))&quot;,
        ring: &quot;hsl(var(--ring))&quot;,
        background: &quot;hsl(var(--background))&quot;,
        foreground: &quot;hsl(var(--foreground))&quot;,
        primary: {
          DEFAULT: &quot;hsl(var(--primary))&quot;,
          foreground: &quot;hsl(var(--primary-foreground))&quot;,
        },
        secondary: {
          DEFAULT: &quot;hsl(var(--secondary))&quot;,
          foreground: &quot;hsl(var(--secondary-foreground))&quot;,
        },
        destructive: {
          DEFAULT: &quot;hsl(var(--destructive))&quot;,
          foreground: &quot;hsl(var(--destructive-foreground))&quot;,
        },
        muted: {
          DEFAULT: &quot;hsl(var(--muted))&quot;,
          foreground: &quot;hsl(var(--muted-foreground))&quot;,
        },
        accent: {
          DEFAULT: &quot;hsl(var(--accent))&quot;,
          foreground: &quot;hsl(var(--accent-foreground))&quot;,
        },
      },
      borderRadius: {
        lg: &quot;var(--radius)&quot;,
        md: &quot;calc(var(--radius) - 2px)&quot;,
        sm: &quot;calc(var(--radius) - 4px)&quot;,
      },
    },
  },
  plugins: [require(&quot;tailwindcss-animate&quot;)],
}
export default config
</code></pre>
<h4>5. <strong>Cliente API para comunicaciÃ³n con Backend</strong></h4>
<p><strong>lib/api.ts</strong>:</p>
<pre><code class="language-typescript">import axios, { AxiosInstance, AxiosError } from 'axios';

// ConfiguraciÃ³n base de axios
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1',
  timeout: 10000,
  withCredentials: true, // Para enviar cookies
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para requests
apiClient.interceptors.request.use(
  (config) =&gt; {
    // Agregar token si existe
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) =&gt; {
    return Promise.reject(error);
  }
);

// Interceptor para responses
apiClient.interceptors.response.use(
  (response) =&gt; response,
  async (error: AxiosError) =&gt; {
    if (error.response?.status === 401) {
      // Redirigir a login si no autorizado
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

// Funciones de API
export const api = {
  // Auth
  login: async (username: string, password: string) =&gt; {
    const response = await apiClient.post('/auth/login', { username, password });
    return response.data;
  },
  
  register: async (userData: any) =&gt; {
    const response = await apiClient.post('/auth/register', userData);
    return response.data;
  },
  
  logout: async () =&gt; {
    const response = await apiClient.post('/auth/logout');
    return response.data;
  },
  
  // User
  getCurrentUser: async () =&gt; {
    const response = await apiClient.get('/users/me');
    return response.data;
  },
};

export default apiClient;
</code></pre>
<p><strong>Variables de entorno (.env.local)</strong>:</p>
<pre><code class="language-env">NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
</code></pre>
<h4>6. <strong>Layout Principal de la AplicaciÃ³n</strong></h4>
<p><strong>app/layout.tsx</strong>:</p>
<pre><code class="language-typescript">import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'FastAPI + Next.js Full Stack',
  description: 'AplicaciÃ³n Full Stack con FastAPI y Next.js',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    &lt;html lang=&quot;es&quot;&gt;
      &lt;body className={inter.className}&gt;
        &lt;div className=&quot;min-h-screen bg-background&quot;&gt;
          {children}
        &lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<h4>7. <strong>ContainerizaciÃ³n del Frontend</strong></h4>
<p><strong>Dockerfile para Next.js</strong>:</p>
<pre><code class="language-dockerfile"># Stage 1: Dependencies
FROM node:20-alpine AS deps
WORKDIR /app

# Copiar package files
COPY package.json package-lock.json* ./
RUN npm ci

# Stage 2: Builder
FROM node:20-alpine AS builder
WORKDIR /app

# Copiar dependencias
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Variables de entorno para build
ENV NEXT_TELEMETRY_DISABLED 1
ARG NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL

# Build de la aplicaciÃ³n
RUN npm run build

# Stage 3: Runner
FROM node:20-alpine AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

# Crear usuario no-root
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# Copiar archivos necesarios
COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME &quot;0.0.0.0&quot;

CMD [&quot;node&quot;, &quot;server.js&quot;]
</code></pre>
<p><strong>next.config.js</strong>:</p>
<pre><code class="language-javascript">/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone', // Para Docker
  images: {
    domains: ['localhost'],
  },
  async rewrites() {
    return [
      {
        source: '/api/:path*',
        destination: `${process.env.NEXT_PUBLIC_API_URL}/:path*`,
      },
    ];
  },
}

module.exports = nextConfig
</code></pre>
<p><strong>docker-compose.yml actualizado</strong>:</p>
<pre><code class="language-yaml">version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: securepassword
      POSTGRES_DB: fullstack_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - &quot;5432:5432&quot;
    networks:
      - fullstack_network

  backend:
    build: ./backend
    container_name: fullstack_backend
    env_file:
      - ./backend/.env
    volumes:
      - ./backend/app:/app/app
    ports:
      - &quot;8000:8000&quot;
    depends_on:
      - postgres
    networks:
      - fullstack_network

  frontend:
    build: 
      context: ./frontend
      args:
        NEXT_PUBLIC_API_URL: http://backend:8000/api/v1
    container_name: fullstack_frontend
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
      - NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
    ports:
      - &quot;3000:3000&quot;
    depends_on:
      - backend
    networks:
      - fullstack_network
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public

networks:
  fullstack_network:
    driver: bridge

volumes:
  postgres_data:
</code></pre>
<h4>8. <strong>Comandos Importantes para el Frontend</strong></h4>
<p><strong>Desarrollo local</strong>:</p>
<pre><code class="language-bash"># Instalar dependencias
npm install

# Modo desarrollo
npm run dev

# Build de producciÃ³n
npm run build

# Ejecutar build
npm start

# Linter
npm run lint
</code></pre>
<p><strong>Con contenedores</strong>:</p>
<pre><code class="language-bash"># Build del contenedor frontend
podman build -t fullstack-frontend ./frontend

# Ejecutar solo frontend
podman run -p 3000:3000 fullstack-frontend

# Levantar stack completo
podman-compose up -d

# Ver logs del frontend
podman logs -f fullstack_frontend
</code></pre>
<h3>ğŸ’¡ TIPS Y OBSERVACIONES DEL INSTRUCTOR</h3>
<ol>
<li>
<p><strong>Sobre Next.js</strong>:</p>
<ul>
<li>App Router es la nueva forma recomendada (vs Pages Router)</li>
<li>Server Components mejoran el rendimiento inicial</li>
<li>Usar Server Actions para formularios simples</li>
</ul>
</li>
<li>
<p><strong>Sobre TypeScript</strong>:</p>
<ul>
<li>Aprovechar el tipado fuerte para prevenir errores</li>
<li>Generar tipos automÃ¡ticamente desde OpenAPI del backend</li>
<li>Usar interfaces para estructuras de datos complejas</li>
</ul>
</li>
<li>
<p><strong>Sobre Tailwind y shadcn/ui</strong>:</p>
<ul>
<li>shadcn/ui provee componentes reutilizables y personalizables</li>
<li>Mantener consistencia en el diseÃ±o usando variables CSS</li>
<li>Aprovechar las utilidades de Tailwind para desarrollo rÃ¡pido</li>
</ul>
</li>
<li>
<p><strong>Sobre la comunicaciÃ³n Frontend-Backend</strong>:</p>
<ul>
<li>Usar <code>withCredentials: true</code> para cookies HttpOnly</li>
<li>Configurar CORS apropiadamente en ambos lados</li>
<li>Manejar errores de red con interceptors de axios</li>
</ul>
</li>
<li>
<p><strong>Sobre contenedores</strong>:</p>
<ul>
<li>Multi-stage builds reducen el tamaÃ±o de la imagen final</li>
<li>Usar <code>standalone</code> output para optimizar el contenedor</li>
<li>Separar variables de entorno para build y runtime</li>
</ul>
</li>
</ol>
<h3>ğŸ¬ CAPÃTULOS Y TIMESTAMPS ESTIMADOS</h3>
<ul>
<li><strong>[00:00 - 03:00]</strong> IntroducciÃ³n y repaso</li>
<li><strong>[03:00 - 08:00]</strong> InstalaciÃ³n de Next.js y configuraciÃ³n inicial</li>
<li><strong>[08:00 - 12:00]</strong> ConfiguraciÃ³n de TypeScript y TailwindCSS</li>
<li><strong>[12:00 - 18:00]</strong> Estructura del proyecto y componentes bÃ¡sicos</li>
<li><strong>[18:00 - 22:00]</strong> Cliente API y comunicaciÃ³n con backend</li>
<li><strong>[22:00 - 26:00]</strong> ContainerizaciÃ³n con Docker/Podman</li>
<li><strong>[26:00 - 28:14]</strong> Pruebas y conclusiones</li>
</ul>
<h3>ğŸ”— CONEXIÃ“N CON OTROS EPISODIOS</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li>Video 1: Arquitectura general</li>
<li>Video 2: Backend configurado y funcionando</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li>Video 4: Refinamiento del Backend</li>
<li>Videos futuros: ImplementaciÃ³n de caracterÃ­sticas (autenticaciÃ³n, WebSockets)</li>
</ul>
<hr>
<h2>ğŸ“¹ VIDEO 4: FastAPI y NextJS - Reorganizamos profesionalmente el Backend | Curso App Full Stack #4</h2>
<h3>ğŸ“Š INFORMACIÃ“N GENERAL</h3>
<ul>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=4c1Tw2rb5cE</li>
<li><strong>DuraciÃ³n</strong>: 16:14 minutos</li>
<li><strong>Vistas</strong>: 142 vistas</li>
<li><strong>Publicado</strong>: Hace 2 meses</li>
<li><strong>Me gusta</strong>: 10</li>
<li><strong>Canal</strong>: CÃ³digo para Principiantes (3.78K suscriptores)</li>
<li><strong>Hashtags</strong>: #FastAPI #NextJS #PostgreSQL</li>
</ul>
<h3>ğŸ“ DESCRIPCIÃ“N</h3>
<p>Episodio enfocado en la refactorizaciÃ³n profesional del backend, aplicando mejores prÃ¡cticas de arquitectura y organizaciÃ³n del cÃ³digo para lograr un proyecto escalable y mantenible.</p>
<h3>ğŸ¯ OBJETIVOS DEL VIDEO</h3>
<ul>
<li>Refactorizar la estructura del proyecto backend</li>
<li>Implementar arquitectura en capas</li>
<li>Separar responsabilidades (routers, services, repositories)</li>
<li>Aplicar patrones de diseÃ±o profesionales</li>
<li>Mejorar la inyecciÃ³n de dependencias</li>
<li>Preparar el cÃ³digo para escalabilidad</li>
</ul>
<h3>ğŸ”‘ CONCEPTOS TÃ‰CNICOS PRINCIPALES</h3>
<h4>1. <strong>Arquitectura en Capas Profesional</strong></h4>
<p>La nueva estructura implementa una arquitectura limpia con separaciÃ³n clara de responsabilidades:</p>
<pre><code>backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                  # CAPA DE PRESENTACIÃ“N
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ deps.py          # Dependencias compartidas
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ router.py    # Router principal v1
â”‚   â”‚       â””â”€â”€ endpoints/
â”‚   â”‚           â”œâ”€â”€ __init__.py
â”‚   â”‚           â”œâ”€â”€ auth.py
â”‚   â”‚           â”œâ”€â”€ users.py
â”‚   â”‚           â””â”€â”€ websocket.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                 # CONFIGURACIÃ“N CENTRAL
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py        # Settings con Pydantic
â”‚   â”‚   â”œâ”€â”€ security.py      # JWT, hashing, tokens
â”‚   â”‚   â””â”€â”€ exceptions.py    # Excepciones personalizadas
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                   # CAPA DE PERSISTENCIA
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py          # Base class imports
â”‚   â”‚   â”œâ”€â”€ session.py       # Session management
â”‚   â”‚   â””â”€â”€ init_db.py       # DB initialization
â”‚   â”‚
â”‚   â”œâ”€â”€ models/               # MODELOS ORM (SQLAlchemy)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â””â”€â”€ task.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/              # ESQUEMAS PYDANTIC
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â”œâ”€â”€ task.py
â”‚   â”‚   â””â”€â”€ token.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/             # CAPA DE LÃ“GICA DE NEGOCIO
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â”œâ”€â”€ user_service.py
â”‚   â”‚   â””â”€â”€ websocket_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/         # CAPA DE ACCESO A DATOS
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py          # CRUD genÃ©rico
â”‚   â”‚   â”œâ”€â”€ user_repo.py
â”‚   â”‚   â””â”€â”€ project_repo.py
â”‚   â”‚
â”‚   â””â”€â”€ utils/                # UTILIDADES
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ helpers.py
â”‚
â”œâ”€â”€ tests/                    # TESTS
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ repositories/
â”‚
â”œâ”€â”€ alembic/                  # MIGRACIONES
â”‚   â”œâ”€â”€ versions/
â”‚   â””â”€â”€ env.py
â”‚
â”œâ”€â”€ .env
â”œâ”€â”€ .env.example
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ alembic.ini
â””â”€â”€ Dockerfile
</code></pre>
<h4>2. <strong>PatrÃ³n Repository para Acceso a Datos</strong></h4>
<p><strong>repositories/base.py</strong> - Repositorio genÃ©rico con operaciones CRUD:</p>
<pre><code class="language-python">from typing import TypeVar, Generic, Type, Optional, List
from sqlalchemy.orm import Session
from sqlalchemy import select
from app.db.base import Base

ModelType = TypeVar(&quot;ModelType&quot;, bound=Base)

class BaseRepository(Generic[ModelType]):
    &quot;&quot;&quot;
    Repositorio base con operaciones CRUD genÃ©ricas
    &quot;&quot;&quot;
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -&gt; Optional[ModelType]:
        &quot;&quot;&quot;Obtener por ID&quot;&quot;&quot;
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(
        self, 
        db: Session, 
        *, 
        skip: int = 0, 
        limit: int = 100
    ) -&gt; List[ModelType]:
        &quot;&quot;&quot;Obtener mÃºltiples registros&quot;&quot;&quot;
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def create(self, db: Session, *, obj_in: dict) -&gt; ModelType:
        &quot;&quot;&quot;Crear nuevo registro&quot;&quot;&quot;
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(
        self, 
        db: Session, 
        *, 
        db_obj: ModelType, 
        obj_in: dict
    ) -&gt; ModelType:
        &quot;&quot;&quot;Actualizar registro existente&quot;&quot;&quot;
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -&gt; Optional[ModelType]:
        &quot;&quot;&quot;Eliminar registro&quot;&quot;&quot;
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
</code></pre>
<p><strong>repositories/user_repo.py</strong> - Repositorio especÃ­fico de usuarios:</p>
<pre><code class="language-python">from typing import Optional
from sqlalchemy.orm import Session
from app.models.user import User
from app.repositories.base import BaseRepository

class UserRepository(BaseRepository[User]):
    &quot;&quot;&quot;
    Repositorio para operaciones de usuarios
    &quot;&quot;&quot;
    def __init__(self):
        super().__init__(User)
    
    def get_by_email(self, db: Session, *, email: str) -&gt; Optional[User]:
        &quot;&quot;&quot;Obtener usuario por email&quot;&quot;&quot;
        return db.query(User).filter(User.email == email).first()
    
    def get_by_username(self, db: Session, *, username: str) -&gt; Optional[User]:
        &quot;&quot;&quot;Obtener usuario por username&quot;&quot;&quot;
        return db.query(User).filter(User.username == username).first()
    
    def is_active(self, user: User) -&gt; bool:
        &quot;&quot;&quot;Verificar si usuario estÃ¡ activo&quot;&quot;&quot;
        return user.is_active
    
    def is_superuser(self, user: User) -&gt; bool:
        &quot;&quot;&quot;Verificar si usuario es superusuario&quot;&quot;&quot;
        return user.is_superuser

# Instancia global del repositorio
user_repository = UserRepository()
</code></pre>
<h4>3. <strong>Capa de Servicios (LÃ³gica de Negocio)</strong></h4>
<p><strong>services/user_service.py</strong>:</p>
<pre><code class="language-python">from typing import Optional, List
from sqlalchemy.orm import Session
from app.repositories.user_repo import user_repository
from app.schemas.user import UserCreate, UserUpdate
from app.models.user import User
from app.core.security import get_password_hash, verify_password
from app.core.exceptions import UserAlreadyExistsException, UserNotFoundException

class UserService:
    &quot;&quot;&quot;
    Servicio con lÃ³gica de negocio de usuarios
    &quot;&quot;&quot;
    
    def __init__(self):
        self.repo = user_repository
    
    def create_user(self, db: Session, user_in: UserCreate) -&gt; User:
        &quot;&quot;&quot;
        Crear nuevo usuario con validaciones de negocio
        &quot;&quot;&quot;
        # Validar que no exista el email
        existing_user = self.repo.get_by_email(db, email=user_in.email)
        if existing_user:
            raise UserAlreadyExistsException(&quot;Email ya registrado&quot;)
        
        # Validar que no exista el username
        existing_username = self.repo.get_by_username(db, username=user_in.username)
        if existing_username:
            raise UserAlreadyExistsException(&quot;Username ya existe&quot;)
        
        # Hash de la contraseÃ±a
        hashed_password = get_password_hash(user_in.password)
        
        # Crear usuario
        user_data = user_in.dict(exclude={'password'})
        user_data['hashed_password'] = hashed_password
        
        return self.repo.create(db, obj_in=user_data)
    
    def authenticate(
        self, 
        db: Session, 
        *, 
        email: str, 
        password: str
    ) -&gt; Optional[User]:
        &quot;&quot;&quot;
        Autenticar usuario
        &quot;&quot;&quot;
        user = self.repo.get_by_email(db, email=email)
        if not user:
            return None
        if not verify_password(password, user.hashed_password):
            return None
        if not self.repo.is_active(user):
            return None
        return user
    
    def get_user(self, db: Session, user_id: int) -&gt; User:
        &quot;&quot;&quot;
        Obtener usuario por ID
        &quot;&quot;&quot;
        user = self.repo.get(db, id=user_id)
        if not user:
            raise UserNotFoundException(f&quot;Usuario {user_id} no encontrado&quot;)
        return user
    
    def get_users(
        self, 
        db: Session, 
        *, 
        skip: int = 0, 
        limit: int = 100
    ) -&gt; List[User]:
        &quot;&quot;&quot;
        Obtener lista de usuarios
        &quot;&quot;&quot;
        return self.repo.get_multi(db, skip=skip, limit=limit)
    
    def update_user(
        self, 
        db: Session, 
        *, 
        user_id: int, 
        user_in: UserUpdate
    ) -&gt; User:
        &quot;&quot;&quot;
        Actualizar usuario
        &quot;&quot;&quot;
        user = self.get_user(db, user_id)
        update_data = user_in.dict(exclude_unset=True)
        
        if 'password' in update_data:
            update_data['hashed_password'] = get_password_hash(update_data['password'])
            del update_data['password']
        
        return self.repo.update(db, db_obj=user, obj_in=update_data)

# Instancia global del servicio
user_service = UserService()
</code></pre>
<h4>4. <strong>Excepciones Personalizadas</strong></h4>
<p><strong>core/exceptions.py</strong>:</p>
<pre><code class="language-python">from fastapi import HTTPException, status

class BaseAPIException(HTTPException):
    &quot;&quot;&quot;ExcepciÃ³n base para la API&quot;&quot;&quot;
    def __init__(self, detail: str, status_code: int = status.HTTP_400_BAD_REQUEST):
        super().__init__(status_code=status_code, detail=detail)

class UserAlreadyExistsException(BaseAPIException):
    &quot;&quot;&quot;Usuario ya existe&quot;&quot;&quot;
    def __init__(self, detail: str = &quot;El usuario ya existe&quot;):
        super().__init__(detail=detail, status_code=status.HTTP_409_CONFLICT)

class UserNotFoundException(BaseAPIException):
    &quot;&quot;&quot;Usuario no encontrado&quot;&quot;&quot;
    def __init__(self, detail: str = &quot;Usuario no encontrado&quot;):
        super().__init__(detail=detail, status_code=status.HTTP_404_NOT_FOUND)

class InvalidCredentialsException(BaseAPIException):
    &quot;&quot;&quot;Credenciales invÃ¡lidas&quot;&quot;&quot;
    def __init__(self, detail: str = &quot;Credenciales invÃ¡lidas&quot;):
        super().__init__(detail=detail, status_code=status.HTTP_401_UNAUTHORIZED)

class InsufficientPermissionsException(BaseAPIException):
    &quot;&quot;&quot;Permisos insuficientes&quot;&quot;&quot;
    def __init__(self, detail: str = &quot;Permisos insuficientes&quot;):
        super().__init__(detail=detail, status_code=status.HTTP_403_FORBIDDEN)
</code></pre>
<h4>5. <strong>Dependencias Compartidas</strong></h4>
<p><strong>api/deps.py</strong>:</p>
<pre><code class="language-python">from typing import Generator, Optional
from fastapi import Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from jose import jwt, JWTError
from sqlalchemy.orm import Session
from app.core.config import settings
from app.db.session import SessionLocal
from app.models.user import User
from app.services.user_service import user_service

# OAuth2 scheme
oauth2_scheme = OAuth2PasswordBearer(tokenUrl=&quot;/api/v1/auth/login&quot;)

def get_db() -&gt; Generator:
    &quot;&quot;&quot;
    Dependency para obtener sesiÃ³n de base de datos
    &quot;&quot;&quot;
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

async def get_current_user(
    db: Session = Depends(get_db),
    token: str = Depends(oauth2_scheme)
) -&gt; User:
    &quot;&quot;&quot;
    Dependency para obtener usuario actual desde JWT
    &quot;&quot;&quot;
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail=&quot;No se pudo validar las credenciales&quot;,
        headers={&quot;WWW-Authenticate&quot;: &quot;Bearer&quot;},
    )
    
    try:
        payload = jwt.decode(
            token, 
            settings.SECRET_KEY, 
            algorithms=[settings.ALGORITHM]
        )
        user_id: str = payload.get(&quot;sub&quot;)
        if user_id is None:
            raise credentials_exception
    except JWTError:
        raise credentials_exception
    
    user = user_service.get_user(db, user_id=int(user_id))
    if user is None:
        raise credentials_exception
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -&gt; User:
    &quot;&quot;&quot;
    Dependency para verificar que usuario estÃ© activo
    &quot;&quot;&quot;
    if not current_user.is_active:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST, 
            detail=&quot;Usuario inactivo&quot;
        )
    return current_user

async def get_current_active_superuser(
    current_user: User = Depends(get_current_user),
) -&gt; User:
    &quot;&quot;&quot;
    Dependency para verificar que usuario sea superusuario
    &quot;&quot;&quot;
    if not current_user.is_superuser:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail=&quot;Permisos insuficientes&quot;
        )
    return current_user
</code></pre>
<h4>6. <strong>Endpoints Refactorizados</strong></h4>
<p><strong>api/v1/endpoints/users.py</strong>:</p>
<pre><code class="language-python">from typing import List
from fastapi import APIRouter, Depends, status
from sqlalchemy.orm import Session
from app.api import deps
from app.schemas.user import User as UserSchema, UserCreate, UserUpdate
from app.services.user_service import user_service
from app.models.user import User

router = APIRouter()

@router.get(&quot;/&quot;, response_model=List[UserSchema])
def list_users(
    db: Session = Depends(deps.get_db),
    skip: int = 0,
    limit: int = 100,
    current_user: User = Depends(deps.get_current_active_superuser)
):
    &quot;&quot;&quot;
    Listar usuarios (solo superusuarios)
    &quot;&quot;&quot;
    users = user_service.get_users(db, skip=skip, limit=limit)
    return users

@router.get(&quot;/me&quot;, response_model=UserSchema)
def read_user_me(
    current_user: User = Depends(deps.get_current_active_user),
):
    &quot;&quot;&quot;
    Obtener usuario actual
    &quot;&quot;&quot;
    return current_user

@router.get(&quot;/{user_id}&quot;, response_model=UserSchema)
def read_user(
    user_id: int,
    db: Session = Depends(deps.get_db),
    current_user: User = Depends(deps.get_current_active_user),
):
    &quot;&quot;&quot;
    Obtener usuario especÃ­fico
    &quot;&quot;&quot;
    return user_service.get_user(db, user_id=user_id)

@router.put(&quot;/{user_id}&quot;, response_model=UserSchema)
def update_user(
    user_id: int,
    user_in: UserUpdate,
    db: Session = Depends(deps.get_db),
    current_user: User = Depends(deps.get_current_active_superuser),
):
    &quot;&quot;&quot;
    Actualizar usuario (solo superusuarios)
    &quot;&quot;&quot;
    return user_service.update_user(db, user_id=user_id, user_in=user_in)
</code></pre>
<h4>7. <strong>Router Principal Versionado</strong></h4>
<p><strong>api/v1/router.py</strong>:</p>
<pre><code class="language-python">from fastapi import APIRouter
from app.api.v1.endpoints import auth, users, websocket

api_router = APIRouter()

# Incluir todos los routers de endpoints
api_router.include_router(
    auth.router, 
    prefix=&quot;/auth&quot;, 
    tags=[&quot;authentication&quot;]
)
api_router.include_router(
    users.router, 
    prefix=&quot;/users&quot;, 
    tags=[&quot;users&quot;]
)
api_router.include_router(
    websocket.router, 
    prefix=&quot;/ws&quot;, 
    tags=[&quot;websocket&quot;]
)
</code></pre>
<p><strong>main.py actualizado</strong>:</p>
<pre><code class="language-python">from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api.v1.router import api_router

app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    description=&quot;API Full Stack Profesional con FastAPI y Next.js&quot;,
    openapi_url=f&quot;/api/v1/openapi.json&quot;,
    docs_url=&quot;/api/docs&quot;,
    redoc_url=&quot;/api/redoc&quot;
)

# CORS
origins = [
    &quot;http://localhost:3000&quot;,
    &quot;http://frontend:3000&quot;,
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=[&quot;*&quot;],
    allow_headers=[&quot;*&quot;],
)

# Incluir router principal
app.include_router(api_router, prefix=&quot;/api/v1&quot;)

@app.get(&quot;/health&quot;)
async def health_check():
    return {
        &quot;status&quot;: &quot;healthy&quot;,
        &quot;version&quot;: settings.VERSION,
        &quot;environment&quot;: settings.ENVIRONMENT
    }
</code></pre>
<h3>ğŸ’¡ TIPS Y OBSERVACIONES DEL INSTRUCTOR</h3>
<ol>
<li>
<p><strong>Sobre Arquitectura en Capas</strong>:</p>
<ul>
<li>Cada capa tiene una responsabilidad Ãºnica y clara</li>
<li>Facilita el testing al poder mockear cada capa independientemente</li>
<li>Permite cambiar implementaciones sin afectar otras capas</li>
</ul>
</li>
<li>
<p><strong>Sobre el PatrÃ³n Repository</strong>:</p>
<ul>
<li>Abstrae la lÃ³gica de acceso a datos</li>
<li>Facilita el cambio de ORM o base de datos en el futuro</li>
<li>Permite reutilizar operaciones CRUD comunes</li>
</ul>
</li>
<li>
<p><strong>Sobre la Capa de Servicios</strong>:</p>
<ul>
<li>Contiene toda la lÃ³gica de negocio</li>
<li>Los endpoints solo orquestan llamadas a servicios</li>
<li>Facilita la reutilizaciÃ³n de lÃ³gica en diferentes endpoints</li>
</ul>
</li>
<li>
<p><strong>Sobre Excepciones Personalizadas</strong>:</p>
<ul>
<li>Proporciona mensajes de error consistentes</li>
<li>Facilita el manejo centralizado de errores</li>
<li>Mejora la experiencia del cliente de la API</li>
</ul>
</li>
<li>
<p><strong>Sobre Dependencias</strong>:</p>
<ul>
<li>FastAPI maneja automÃ¡ticamente la inyecciÃ³n de dependencias</li>
<li>Permite composiciÃ³n de dependencias (una depende de otra)</li>
<li>Facilita el testing con dependencias mockeadas</li>
</ul>
</li>
</ol>
<h3>ğŸ¬ CAPÃTULOS Y TIMESTAMPS ESTIMADOS</h3>
<ul>
<li><strong>[00:00 - 02:00]</strong> IntroducciÃ³n y problemas de la estructura anterior</li>
<li><strong>[02:00 - 05:00]</strong> DiseÃ±o de la nueva arquitectura en capas</li>
<li><strong>[05:00 - 08:00]</strong> ImplementaciÃ³n del patrÃ³n Repository</li>
<li><strong>[08:00 - 11:00]</strong> CreaciÃ³n de la capa de servicios</li>
<li><strong>[11:00 - 14:00]</strong> RefactorizaciÃ³n de endpoints</li>
<li><strong>[14:00 - 16:14]</strong> Testing y conclusiones</li>
</ul>
<h3>ğŸ”— CONEXIÃ“N CON OTROS EPISODIOS</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li>Video 2: Estructura inicial del backend</li>
<li>Video 3: Frontend configurado</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li>Video 5: CreaciÃ³n de modelos complejos con relaciones</li>
<li>Videos futuros: ImplementaciÃ³n de caracterÃ­sticas avanzadas</li>
</ul>
<p><strong>Mejoras introducidas</strong>:</p>
<ul>
<li>Arquitectura escalable y mantenible</li>
<li>SeparaciÃ³n clara de responsabilidades</li>
<li>CÃ³digo mÃ¡s testeable</li>
<li>Base sÃ³lida para crecer el proyecto</li>
</ul>
<hr>
<h2>ğŸ“¹ VIDEO 5: FastAPI y NextJS - Creamos los modelos con sus relaciones | Curso App Full Stack #5</h2>
<h3>ğŸ“Š INFORMACIÃ“N GENERAL</h3>
<ul>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=z1Q8dcP5jWI</li>
<li><strong>DuraciÃ³n</strong>: 22:06 minutos</li>
<li><strong>Vistas</strong>: 221 vistas</li>
<li><strong>Publicado</strong>: Hace 2 meses</li>
<li><strong>Me gusta</strong>: 15</li>
<li><strong>Canal</strong>: CÃ³digo para Principiantes (3.78K suscriptores)</li>
<li><strong>Hashtags</strong>: #FastAPI #NextJS #PostgreSQL</li>
</ul>
<h3>ğŸ“ DESCRIPCIÃ“N</h3>
<p>Episodio dedicado al modelado completo de la base de datos, implementando modelos SQLAlchemy con relaciones complejas entre entidades, aplicando las mejores prÃ¡cticas de diseÃ±o de bases de datos relacionales.</p>
<h3>ğŸ¯ OBJETIVOS DEL VIDEO</h3>
<ul>
<li>DiseÃ±ar el esquema completo de la base de datos</li>
<li>Crear modelos SQLAlchemy con relaciones</li>
<li>Implementar diferentes tipos de relaciones (1:1, 1:N, N:M)</li>
<li>Configurar cascadas y comportamientos de eliminaciÃ³n</li>
<li>Crear migraciones con Alembic</li>
<li>Implementar esquemas Pydantic correspondientes</li>
</ul>
<h3>ğŸ”‘ CONCEPTOS TÃ‰CNICOS PRINCIPALES</h3>
<h4>1. <strong>DiseÃ±o del Esquema de Base de Datos</strong></h4>
<p><strong>Entidades principales del sistema</strong>:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚
â”‚ username     â”‚
â”‚ email        â”‚
â”‚ password_hashâ”‚
â”‚ is_active    â”‚
â”‚ is_superuser â”‚
â”‚ created_at   â”‚
â”‚ updated_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N (un usuario, muchos proyectos)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Project    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚
â”‚ name         â”‚
â”‚ description  â”‚
â”‚ owner_id (FK)â”‚
â”‚ is_active    â”‚
â”‚ created_at   â”‚
â”‚ updated_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N (un proyecto, muchas tareas)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Task      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚
â”‚ title        â”‚
â”‚ description  â”‚
â”‚ status       â”‚
â”‚ priority     â”‚
â”‚ project_id   â”‚
â”‚ assigned_to  â”‚
â”‚ created_at   â”‚
â”‚ updated_at   â”‚
â”‚ due_date     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ N:M (muchas tareas, muchos tags)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TaskTag    â”‚       â”‚     Tag      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ task_id (FK) â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚
â”‚ tag_id (FK)  â”‚       â”‚ name         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ color        â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4>2. <strong>Modelo Base con Timestamps</strong></h4>
<p><strong>models/base.py</strong>:</p>
<pre><code class="language-python">from datetime import datetime
from sqlalchemy import Column, Integer, DateTime
from sqlalchemy.ext.declarative import declared_attr
from app.db.base import Base

class TimestampMixin:
    &quot;&quot;&quot;
    Mixin para agregar timestamps automÃ¡ticos
    &quot;&quot;&quot;
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(
        DateTime, 
        default=datetime.utcnow, 
        onupdate=datetime.utcnow, 
        nullable=False
    )

class BaseModel(Base, TimestampMixin):
    &quot;&quot;&quot;
    Clase base para todos los modelos
    &quot;&quot;&quot;
    __abstract__ = True
    
    id = Column(Integer, primary_key=True, index=True, autoincrement=True)
    
    @declared_attr
    def __tablename__(cls) -&gt; str:
        &quot;&quot;&quot;Generar nombre de tabla automÃ¡ticamente&quot;&quot;&quot;
        return cls.__name__.lower()
</code></pre>
<h4>3. <strong>Modelo de Usuario</strong></h4>
<p><strong>models/user.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import Boolean, Column, String
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class User(BaseModel):
    &quot;&quot;&quot;
    Modelo de usuario del sistema
    &quot;&quot;&quot;
    __tablename__ = &quot;users&quot;
    
    # Campos bÃ¡sicos
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(255), unique=True, index=True, nullable=False)
    full_name = Column(String(100), nullable=True)
    hashed_password = Column(String(255), nullable=False)
    
    # Estados
    is_active = Column(Boolean, default=True)
    is_superuser = Column(Boolean, default=False)
    is_verified = Column(Boolean, default=False)
    
    # Relaciones
    projects = relationship(
        &quot;Project&quot;, 
        back_populates=&quot;owner&quot;,
        cascade=&quot;all, delete-orphan&quot;,  # Eliminar proyectos si se elimina usuario
        lazy=&quot;dynamic&quot;  # Carga bajo demanda
    )
    
    assigned_tasks = relationship(
        &quot;Task&quot;,
        back_populates=&quot;assignee&quot;,
        foreign_keys=&quot;[Task.assigned_to_id]&quot;,
        lazy=&quot;dynamic&quot;
    )
    
    def __repr__(self):
        return f&quot;&lt;User(id={self.id}, username='{self.username}', email='{self.email}')&gt;&quot;
</code></pre>
<p><strong>Esquema Pydantic correspondiente (schemas/user.py)</strong>:</p>
<pre><code class="language-python">from typing import Optional
from datetime import datetime
from pydantic import BaseModel, EmailStr, Field

class UserBase(BaseModel):
    &quot;&quot;&quot;Schema base de usuario&quot;&quot;&quot;
    email: EmailStr
    username: str = Field(..., min_length=3, max_length=50)
    full_name: Optional[str] = Field(None, max_length=100)
    is_active: bool = True

class UserCreate(UserBase):
    &quot;&quot;&quot;Schema para crear usuario&quot;&quot;&quot;
    password: str = Field(..., min_length=8, max_length=100)

class UserUpdate(BaseModel):
    &quot;&quot;&quot;Schema para actualizar usuario&quot;&quot;&quot;
    email: Optional[EmailStr] = None
    username: Optional[str] = Field(None, min_length=3, max_length=50)
    full_name: Optional[str] = Field(None, max_length=100)
    password: Optional[str] = Field(None, min_length=8, max_length=100)
    is_active: Optional[bool] = None

class User(UserBase):
    &quot;&quot;&quot;Schema de respuesta de usuario&quot;&quot;&quot;
    id: int
    is_superuser: bool
    is_verified: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True  # Antes orm_mode = True

class UserInDB(User):
    &quot;&quot;&quot;Schema de usuario en DB (incluye hash)&quot;&quot;&quot;
    hashed_password: str
</code></pre>
<h4>4. <strong>Modelo de Proyecto con RelaciÃ³n 1:N</strong></h4>
<p><strong>models/project.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import Boolean, Column, String, Text, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class Project(BaseModel):
    &quot;&quot;&quot;
    Modelo de proyecto
    RelaciÃ³n 1:N con User (un usuario, muchos proyectos)
    RelaciÃ³n 1:N con Task (un proyecto, muchas tareas)
    &quot;&quot;&quot;
    __tablename__ = &quot;projects&quot;
    
    # Campos bÃ¡sicos
    name = Column(String(100), nullable=False, index=True)
    description = Column(Text, nullable=True)
    is_active = Column(Boolean, default=True)
    
    # Foreign Keys
    owner_id = Column(
        Integer, 
        ForeignKey(&quot;users.id&quot;, ondelete=&quot;CASCADE&quot;),
        nullable=False,
        index=True
    )
    
    # Relaciones
    owner = relationship(
        &quot;User&quot;, 
        back_populates=&quot;projects&quot;
    )
    
    tasks = relationship(
        &quot;Task&quot;,
        back_populates=&quot;project&quot;,
        cascade=&quot;all, delete-orphan&quot;,  # Eliminar tareas si se elimina proyecto
        lazy=&quot;dynamic&quot;
    )
    
    def __repr__(self):
        return f&quot;&lt;Project(id={self.id}, name='{self.name}', owner_id={self.owner_id})&gt;&quot;
</code></pre>
<p><strong>Esquema Pydantic (schemas/project.py)</strong>:</p>
<pre><code class="language-python">from typing import Optional, List
from datetime import datetime
from pydantic import BaseModel, Field

class ProjectBase(BaseModel):
    &quot;&quot;&quot;Schema base de proyecto&quot;&quot;&quot;
    name: str = Field(..., min_length=1, max_length=100)
    description: Optional[str] = None
    is_active: bool = True

class ProjectCreate(ProjectBase):
    &quot;&quot;&quot;Schema para crear proyecto&quot;&quot;&quot;
    pass

class ProjectUpdate(BaseModel):
    &quot;&quot;&quot;Schema para actualizar proyecto&quot;&quot;&quot;
    name: Optional[str] = Field(None, min_length=1, max_length=100)
    description: Optional[str] = None
    is_active: Optional[bool] = None

class Project(ProjectBase):
    &quot;&quot;&quot;Schema de respuesta de proyecto&quot;&quot;&quot;
    id: int
    owner_id: int
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class ProjectWithOwner(Project):
    &quot;&quot;&quot;Schema de proyecto con informaciÃ³n del owner&quot;&quot;&quot;
    from app.schemas.user import User
    owner: User

class ProjectWithTasks(Project):
    &quot;&quot;&quot;Schema de proyecto con tareas&quot;&quot;&quot;
    from app.schemas.task import Task
    tasks: List[Task] = []
</code></pre>
<h4>5. <strong>Modelo de Tarea con Relaciones MÃºltiples</strong></h4>
<p><strong>models/task.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import (
    Column, String, Text, Integer, 
    ForeignKey, Enum, Date
)
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel

class TaskStatus(str, enum.Enum):
    &quot;&quot;&quot;Estados posibles de una tarea&quot;&quot;&quot;
    TODO = &quot;todo&quot;
    IN_PROGRESS = &quot;in_progress&quot;
    IN_REVIEW = &quot;in_review&quot;
    DONE = &quot;done&quot;
    CANCELLED = &quot;cancelled&quot;

class TaskPriority(str, enum.Enum):
    &quot;&quot;&quot;Prioridades de tarea&quot;&quot;&quot;
    LOW = &quot;low&quot;
    MEDIUM = &quot;medium&quot;
    HIGH = &quot;high&quot;
    URGENT = &quot;urgent&quot;

class Task(BaseModel):
    &quot;&quot;&quot;
    Modelo de tarea
    &quot;&quot;&quot;
    __tablename__ = &quot;tasks&quot;
    
    # Campos bÃ¡sicos
    title = Column(String(200), nullable=False, index=True)
    description = Column(Text, nullable=True)
    status = Column(
        Enum(TaskStatus), 
        default=TaskStatus.TODO, 
        nullable=False,
        index=True
    )
    priority = Column(
        Enum(TaskPriority), 
        default=TaskPriority.MEDIUM, 
        nullable=False
    )
    due_date = Column(Date, nullable=True)
    
    # Foreign Keys
    project_id = Column(
        Integer,
        ForeignKey(&quot;projects.id&quot;, ondelete=&quot;CASCADE&quot;),
        nullable=False,
        index=True
    )
    
    assigned_to_id = Column(
        Integer,
        ForeignKey(&quot;users.id&quot;, ondelete=&quot;SET NULL&quot;),
        nullable=True,
        index=True
    )
    
    # Relaciones
    project = relationship(
        &quot;Project&quot;,
        back_populates=&quot;tasks&quot;
    )
    
    assignee = relationship(
        &quot;User&quot;,
        back_populates=&quot;assigned_tasks&quot;,
        foreign_keys=[assigned_to_id]
    )
    
    tags = relationship(
        &quot;Tag&quot;,
        secondary=&quot;task_tags&quot;,  # Tabla intermedia para N:M
        back_populates=&quot;tasks&quot;,
        lazy=&quot;dynamic&quot;
    )
    
    def __repr__(self):
        return f&quot;&lt;Task(id={self.id}, title='{self.title}', status='{self.status}')&gt;&quot;
</code></pre>
<p><strong>Esquema Pydantic (schemas/task.py)</strong>:</p>
<pre><code class="language-python">from typing import Optional, List
from datetime import datetime, date
from pydantic import BaseModel, Field
from app.models.task import TaskStatus, TaskPriority

class TaskBase(BaseModel):
    &quot;&quot;&quot;Schema base de tarea&quot;&quot;&quot;
    title: str = Field(..., min_length=1, max_length=200)
    description: Optional[str] = None
    status: TaskStatus = TaskStatus.TODO
    priority: TaskPriority = TaskPriority.MEDIUM
    due_date: Optional[date] = None

class TaskCreate(TaskBase):
    &quot;&quot;&quot;Schema para crear tarea&quot;&quot;&quot;
    project_id: int
    assigned_to_id: Optional[int] = None

class TaskUpdate(BaseModel):
    &quot;&quot;&quot;Schema para actualizar tarea&quot;&quot;&quot;
    title: Optional[str] = Field(None, min_length=1, max_length=200)
    description: Optional[str] = None
    status: Optional[TaskStatus] = None
    priority: Optional[TaskPriority] = None
    due_date: Optional[date] = None
    assigned_to_id: Optional[int] = None

class Task(TaskBase):
    &quot;&quot;&quot;Schema de respuesta de tarea&quot;&quot;&quot;
    id: int
    project_id: int
    assigned_to_id: Optional[int]
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class TaskWithRelations(Task):
    &quot;&quot;&quot;Schema de tarea con relaciones&quot;&quot;&quot;
    from app.schemas.user import User
    from app.schemas.project import Project
    from app.schemas.tag import Tag
    
    project: Project
    assignee: Optional[User] = None
    tags: List[Tag] = []
</code></pre>
<h4>6. <strong>RelaciÃ³n N:M con Tags</strong></h4>
<p><strong>models/tag.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import Column, String, Integer, ForeignKey, Table
from sqlalchemy.orm import relationship
from app.models.base import BaseModel, Base

# Tabla intermedia para relaciÃ³n N:M entre Task y Tag
task_tags = Table(
    'task_tags',
    Base.metadata,
    Column('task_id', Integer, ForeignKey('tasks.id', ondelete=&quot;CASCADE&quot;), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete=&quot;CASCADE&quot;), primary_key=True)
)

class Tag(BaseModel):
    &quot;&quot;&quot;
    Modelo de etiqueta/tag
    RelaciÃ³n N:M con Task
    &quot;&quot;&quot;
    __tablename__ = &quot;tags&quot;
    
    name = Column(String(50), unique=True, nullable=False, index=True)
    color = Column(String(7), default=&quot;#808080&quot;)  # Color hexadecimal
    
    # RelaciÃ³n N:M con tasks
    tasks = relationship(
        &quot;Task&quot;,
        secondary=task_tags,
        back_populates=&quot;tags&quot;,
        lazy=&quot;dynamic&quot;
    )
    
    def __repr__(self):
        return f&quot;&lt;Tag(id={self.id}, name='{self.name}')&gt;&quot;
</code></pre>
<p><strong>Esquema Pydantic (schemas/tag.py)</strong>:</p>
<pre><code class="language-python">from typing import Optional
from datetime import datetime
from pydantic import BaseModel, Field

class TagBase(BaseModel):
    &quot;&quot;&quot;Schema base de tag&quot;&quot;&quot;
    name: str = Field(..., min_length=1, max_length=50)
    color: str = Field(default=&quot;#808080&quot;, regex=r&quot;^#[0-9A-Fa-f]{6}$&quot;)

class TagCreate(TagBase):
    &quot;&quot;&quot;Schema para crear tag&quot;&quot;&quot;
    pass

class TagUpdate(BaseModel):
    &quot;&quot;&quot;Schema para actualizar tag&quot;&quot;&quot;
    name: Optional[str] = Field(None, min_length=1, max_length=50)
    color: Optional[str] = Field(None, regex=r&quot;^#[0-9A-Fa-f]{6}$&quot;)

class Tag(TagBase):
    &quot;&quot;&quot;Schema de respuesta de tag&quot;&quot;&quot;
    id: int
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True
</code></pre>
<h4>7. <strong>ConfiguraciÃ³n de Migraciones con Alembic</strong></h4>
<p><strong>Inicializar Alembic</strong>:</p>
<pre><code class="language-bash"># Inicializar Alembic
alembic init alembic

# Esto crea:
# - alembic/
# - alembic.ini
</code></pre>
<p><strong>Configurar alembic/env.py</strong>:</p>
<pre><code class="language-python">from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context
from app.core.config import settings
from app.db.base import Base
# Importar todos los modelos para que Alembic los detecte
from app.models import user, project, task, tag

# ConfiguraciÃ³n de Alembic
config = context.config

# Configurar URL de la base de datos
config.set_main_option(&quot;sqlalchemy.url&quot;, settings.DATABASE_URL)

# Interpretar config file para logging
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# Metadata para autogenerar migraciones
target_metadata = Base.metadata

def run_migrations_offline() -&gt; None:
    &quot;&quot;&quot;Run migrations in 'offline' mode.&quot;&quot;&quot;
    url = config.get_main_option(&quot;sqlalchemy.url&quot;)
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={&quot;paramstyle&quot;: &quot;named&quot;},
    )

    with context.begin_transaction():
        context.run_migrations()

def run_migrations_online() -&gt; None:
    &quot;&quot;&quot;Run migrations in 'online' mode.&quot;&quot;&quot;
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix=&quot;sqlalchemy.&quot;,
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, 
            target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
</code></pre>
<p><strong>Comandos de Alembic</strong>:</p>
<pre><code class="language-bash"># Crear migraciÃ³n automÃ¡tica
alembic revision --autogenerate -m &quot;Create users, projects, tasks and tags tables&quot;

# Aplicar migraciones
alembic upgrade head

# Ver historial de migraciones
alembic history

# Revertir Ãºltima migraciÃ³n
alembic downgrade -1

# Ver SQL sin ejecutar
alembic upgrade head --sql

# Crear migraciÃ³n vacÃ­a
alembic revision -m &quot;Add custom changes&quot;
</code></pre>
<h4>8. <strong>Ejemplo de MigraciÃ³n Generada</strong></h4>
<p><strong>alembic/versions/001_create_initial_tables.py</strong>:</p>
<pre><code class="language-python">&quot;&quot;&quot;Create users, projects, tasks and tags tables

Revision ID: 001
Revises: 
Create Date: 2024-01-XX
&quot;&quot;&quot;
from alembic import op
import sqlalchemy as sa

# revision identifiers
revision = '001'
down_revision = None
branch_labels = None
depends_on = None

def upgrade() -&gt; None:
    # Crear tabla users
    op.create_table(
        'users',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('username', sa.String(length=50), nullable=False),
        sa.Column('email', sa.String(length=255), nullable=False),
        sa.Column('full_name', sa.String(length=100), nullable=True),
        sa.Column('hashed_password', sa.String(length=255), nullable=False),
        sa.Column('is_active', sa.Boolean(), nullable=True),
        sa.Column('is_superuser', sa.Boolean(), nullable=True),
        sa.Column('is_verified', sa.Boolean(), nullable=True),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_users_email'), 'users', ['email'], unique=True)
    op.create_index(op.f('ix_users_username'), 'users', ['username'], unique=True)
    op.create_index(op.f('ix_users_id'), 'users', ['id'], unique=False)
    
    # Crear tabla projects
    op.create_table(
        'projects',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('name', sa.String(length=100), nullable=False),
        sa.Column('description', sa.Text(), nullable=True),
        sa.Column('is_active', sa.Boolean(), nullable=True),
        sa.Column('owner_id', sa.Integer(), nullable=False),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_projects_id'), 'projects', ['id'], unique=False)
    op.create_index(op.f('ix_projects_name'), 'projects', ['name'], unique=False)
    op.create_index(op.f('ix_projects_owner_id'), 'projects', ['owner_id'], unique=False)
    
    # Crear tabla tags
    op.create_table(
        'tags',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('name', sa.String(length=50), nullable=False),
        sa.Column('color', sa.String(length=7), nullable=True),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.PrimaryKeyConstraint('id'),
        sa.UniqueConstraint('name')
    )
    op.create_index(op.f('ix_tags_id'), 'tags', ['id'], unique=False)
    op.create_index(op.f('ix_tags_name'), 'tags', ['name'], unique=True)
    
    # Crear tabla tasks
    op.create_table(
        'tasks',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('title', sa.String(length=200), nullable=False),
        sa.Column('description', sa.Text(), nullable=True),
        sa.Column('status', sa.Enum('TODO', 'IN_PROGRESS', 'IN_REVIEW', 'DONE', 'CANCELLED', name='taskstatus'), nullable=False),
        sa.Column('priority', sa.Enum('LOW', 'MEDIUM', 'HIGH', 'URGENT', name='taskpriority'), nullable=False),
        sa.Column('due_date', sa.Date(), nullable=True),
        sa.Column('project_id', sa.Integer(), nullable=False),
        sa.Column('assigned_to_id', sa.Integer(), nullable=True),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.Column('updated_at', sa.DateTime(), nullable=False),
        sa.ForeignKeyConstraint(['assigned_to_id'], ['users.id'], ondelete='SET NULL'),
        sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_tasks_id'), 'tasks', ['id'], unique=False)
    op.create_index(op.f('ix_tasks_title'), 'tasks', ['title'], unique=False)
    op.create_index(op.f('ix_tasks_status'), 'tasks', ['status'], unique=False)
    op.create_index(op.f('ix_tasks_project_id'), 'tasks', ['project_id'], unique=False)
    op.create_index(op.f('ix_tasks_assigned_to_id'), 'tasks', ['assigned_to_id'], unique=False)
    
    # Crear tabla intermedia task_tags
    op.create_table(
        'task_tags',
        sa.Column('task_id', sa.Integer(), nullable=False),
        sa.Column('tag_id', sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(['tag_id'], ['tags.id'], ondelete='CASCADE'),
        sa.ForeignKeyConstraint(['task_id'], ['tasks.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('task_id', 'tag_id')
    )

def downgrade() -&gt; None:
    op.drop_table('task_tags')
    op.drop_index(op.f('ix_tasks_assigned_to_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_project_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_status'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_title'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_id'), table_name='tasks')
    op.drop_table('tasks')
    op.drop_index(op.f('ix_tags_name'), table_name='tags')
    op.drop_index(op.f('ix_tags_id'), table_name='tags')
    op.drop_table('tags')
    op.drop_index(op.f('ix_projects_owner_id'), table_name='projects')
    op.drop_index(op.f('ix_projects_name'), table_name='projects')
    op.drop_index(op.f('ix_projects_id'), table_name='projects')
    op.drop_table('projects')
    op.drop_index(op.f('ix_users_username'), table_name='users')
    op.drop_index(op.f('ix_users_id'), table_name='users')
    op.drop_index(op.f('ix_users_email'), table_name='users')
    op.drop_table('users')
</code></pre>
<h3>ğŸ’¡ TIPS Y OBSERVACIONES DEL INSTRUCTOR</h3>
<ol>
<li>
<p><strong>Sobre Relaciones SQLAlchemy</strong>:</p>
<ul>
<li><code>back_populates</code> crea relaciones bidireccionales automÃ¡ticas</li>
<li><code>cascade=&quot;all, delete-orphan&quot;</code> elimina registros huÃ©rfanos automÃ¡ticamente</li>
<li><code>lazy=&quot;dynamic&quot;</code> devuelve una query en lugar de cargar todos los datos</li>
<li><code>ondelete=&quot;CASCADE&quot;</code> o <code>&quot;SET NULL&quot;</code> define comportamiento a nivel de BD</li>
</ul>
</li>
<li>
<p><strong>Sobre Foreign Keys</strong>:</p>
<ul>
<li>Siempre indexar foreign keys para mejor rendimiento</li>
<li>Definir explÃ­citamente el comportamiento <code>ondelete</code></li>
<li>Usar nombres descriptivos para las columnas FK</li>
</ul>
</li>
<li>
<p><strong>Sobre Enums</strong>:</p>
<ul>
<li>SQLAlchemy Enums proporcionan validaciÃ³n a nivel de BD</li>
<li>Usar <code>str, enum.Enum</code> para compatibilidad con Pydantic</li>
<li>Los enums mejoran la integridad de datos</li>
</ul>
</li>
<li>
<p><strong>Sobre Timestamps</strong>:</p>
<ul>
<li>Usar <code>default=datetime.utcnow</code> (sin parÃ©ntesis) para llamada lazy</li>
<li><code>onupdate</code> actualiza automÃ¡ticamente el campo en cada UPDATE</li>
<li>Siempre trabajar con UTC en el backend</li>
</ul>
</li>
<li>
<p><strong>Sobre Migraciones</strong>:</p>
<ul>
<li>Revisar siempre las migraciones autogeneradas antes de aplicarlas</li>
<li>Usar mensajes descriptivos para las migraciones</li>
<li>Mantener orden cronolÃ³gico claro en las versiones</li>
<li>Probar migraciones en entorno de desarrollo primero</li>
</ul>
</li>
<li>
<p><strong>Sobre Pydantic Schemas</strong>:</p>
<ul>
<li>Separar schemas de creaciÃ³n, actualizaciÃ³n y respuesta</li>
<li>Usar <code>Optional</code> para campos que pueden no estar presentes en updates</li>
<li><code>from_attributes = True</code> permite crear schemas desde modelos ORM</li>
<li>Validaciones de Pydantic complementan las de SQLAlchemy</li>
</ul>
</li>
</ol>
<h3>ğŸ¬ CAPÃTULOS Y TIMESTAMPS ESTIMADOS</h3>
<ul>
<li><strong>[00:00 - 03:00]</strong> IntroducciÃ³n y diseÃ±o del esquema</li>
<li><strong>[03:00 - 07:00]</strong> Modelo base y timestamps</li>
<li><strong>[07:00 - 10:00]</strong> Modelo de usuario y sus relaciones</li>
<li><strong>[10:00 - 14:00]</strong> Modelos de proyecto y tarea</li>
<li><strong>[14:00 - 17:00]</strong> RelaciÃ³n N:M con tags</li>
<li><strong>[17:00 - 20:00]</strong> ConfiguraciÃ³n de Alembic y migraciones</li>
<li><strong>[20:00 - 22:06]</strong> Pruebas y conclusiones</li>
</ul>
<h3>ğŸ”— CONEXIÃ“N CON OTROS EPISODIOS</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li>Video 2: ConfiguraciÃ³n inicial de SQLAlchemy</li>
<li>Video 4: Arquitectura en capas profesional</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li>ImplementaciÃ³n de CRUD completo para todas las entidades</li>
<li>Endpoints de API para cada modelo</li>
<li>ImplementaciÃ³n de WebSockets con datos reales</li>
<li>AutenticaciÃ³n y autorizaciÃ³n con roles</li>
</ul>
<p><strong>Fundamentos establecidos</strong>:</p>
<ul>
<li>Esquema completo de base de datos</li>
<li>Relaciones entre entidades</li>
<li>Sistema de migraciones</li>
<li>ValidaciÃ³n de datos con Pydantic</li>
</ul>
<hr>
<h2>ğŸ“Š RESUMEN GENERAL DE LA SERIE</h2>
<h3>DuraciÃ³n Total</h3>
<ul>
<li><strong>Video 1</strong>: 10:13 min</li>
<li><strong>Video 2</strong>: 43:31 min</li>
<li><strong>Video 3</strong>: 28:14 min</li>
<li><strong>Video 4</strong>: 16:14 min</li>
<li><strong>Video 5</strong>: 22:06 min</li>
<li><strong>TOTAL</strong>: ~2 horas (120 minutos)</li>
</ul>
<h3>ProgresiÃ³n del Curso</h3>
<ol>
<li><strong>Episodio 1</strong>: VisiÃ³n general y arquitectura</li>
<li><strong>Episodio 2</strong>: Backend inicial (el mÃ¡s extenso)</li>
<li><strong>Episodio 3</strong>: Frontend con Next.js</li>
<li><strong>Episodio 4</strong>: RefactorizaciÃ³n profesional</li>
<li><strong>Episodio 5</strong>: Modelado de datos completo</li>
</ol>
<h3>Stack TecnolÃ³gico Completo</h3>
<ul>
<li><strong>Backend</strong>: FastAPI + SQLAlchemy + Alembic + Pydantic</li>
<li><strong>Frontend</strong>: Next.js + TypeScript + TailwindCSS + shadcn/ui</li>
<li><strong>Base de Datos</strong>: PostgreSQL</li>
<li><strong>ContenedorizaciÃ³n</strong>: Podman/Docker</li>
<li><strong>AutenticaciÃ³n</strong>: JWT con cookies HttpOnly</li>
<li><strong>ComunicaciÃ³n en Tiempo Real</strong>: WebSockets</li>
</ul>
<h3>Conceptos Avanzados Cubiertos</h3>
<p>âœ… Arquitectura en capas
âœ… PatrÃ³n Repository
âœ… InyecciÃ³n de dependencias
âœ… Relaciones de base de datos (1:1, 1:N, N:M)
âœ… Migraciones de base de datos
âœ… ValidaciÃ³n con Pydantic
âœ… ContenedorizaciÃ³n multi-servicio
âœ… Type safety end-to-end</p>
<hr>
<p><em>Fin del Documento 1</em></p>
<h2>--------------------------------------------------</h2>
<hr>
<h2>DOCUMENTO 2: DOCUMENTACIÃ“N TÃ‰CNICA CONSOLIDADA</h2>
<h1>DOCUMENTO 2: DOCUMENTACIÃ“N TÃ‰CNICA CONSOLIDADA</h1>
<h2>Tutorial Completo: AplicaciÃ³n Full Stack con FastAPI y Next.js</h2>
<h3>De la serie &quot;CÃ³digo para Principiantes&quot;</h3>
<hr>
<h2>ğŸ“‹ TABLA DE CONTENIDOS</h2>
<ol>
<li><a href="#1-introducci%C3%B3n-al-proyecto-completo">IntroducciÃ³n al Proyecto Completo</a></li>
<li><a href="#2-arquitectura-general-de-la-aplicaci%C3%B3n">Arquitectura General de la AplicaciÃ³n</a></li>
<li><a href="#3-configuraci%C3%B3n-del-entorno">ConfiguraciÃ³n del Entorno</a></li>
<li><a href="#4-estructura-profesional-del-proyecto">Estructura Profesional del Proyecto</a></li>
<li><a href="#5-backend-con-fastapi">Backend con FastAPI</a></li>
<li><a href="#6-frontend-con-nextjs">Frontend con Next.js</a></li>
<li><a href="#7-modelos-y-relaciones-de-datos">Modelos y Relaciones de Datos</a></li>
<li><a href="#8-implementaci%C3%B3n-de-websockets">ImplementaciÃ³n de WebSockets</a></li>
<li><a href="#9-autenticaci%C3%B3n-y-seguridad">AutenticaciÃ³n y Seguridad</a></li>
<li><a href="#10-mejores-pr%C3%A1cticas-aplicadas">Mejores PrÃ¡cticas Aplicadas</a></li>
<li><a href="#11-referencias-cruzadas-entre-episodios">Referencias Cruzadas entre Episodios</a></li>
</ol>
<hr>
<h2>1. INTRODUCCIÃ“N AL PROYECTO COMPLETO</h2>
<h3>1.1 VisiÃ³n General</h3>
<p>Este proyecto es una aplicaciÃ³n Full Stack profesional que combina las tecnologÃ­as mÃ¡s modernas del desarrollo web:</p>
<ul>
<li><strong>Backend</strong>: FastAPI (Python) - Framework asÃ­ncrono de alto rendimiento</li>
<li><strong>Frontend</strong>: Next.js (React + TypeScript) - Framework con SSR y optimizaciÃ³n automÃ¡tica</li>
<li><strong>Base de Datos</strong>: PostgreSQL - Sistema de gestiÃ³n de bases de datos relacional robusto</li>
<li><strong>ContenedorizaciÃ³n</strong>: Podman/Docker - Entornos consistentes y portables</li>
</ul>
<p><strong>CaracterÃ­sticas Principales</strong>:</p>
<ul>
<li>âœ… API RESTful completa con documentaciÃ³n automÃ¡tica</li>
<li>âœ… ComunicaciÃ³n en tiempo real con WebSockets</li>
<li>âœ… AutenticaciÃ³n segura con JWT y cookies HttpOnly</li>
<li>âœ… Arquitectura escalable y profesional</li>
<li>âœ… Type safety end-to-end (Python type hints + TypeScript)</li>
<li>âœ… Sistema completo de gestiÃ³n de proyectos y tareas</li>
</ul>
<h3>1.2 Objetivos del Tutorial</h3>
<p>Al completar este tutorial, habrÃ¡s construido:</p>
<ul>
<li>Una API REST completa con FastAPI</li>
<li>Una aplicaciÃ³n frontend moderna con Next.js</li>
<li>Sistema de autenticaciÃ³n robusto</li>
<li>Base de datos relacional con modelos complejos</li>
<li>ComunicaciÃ³n en tiempo real con WebSockets</li>
<li>AplicaciÃ³n completamente contenerizada</li>
</ul>
<h3>1.3 Requisitos Previos</h3>
<p><strong>Conocimientos necesarios</strong>:</p>
<ul>
<li>Python intermedio (3.11+)</li>
<li>JavaScript/TypeScript bÃ¡sico</li>
<li>Conceptos de bases de datos relacionales</li>
<li>Comandos bÃ¡sicos de terminal</li>
<li>Fundamentos de HTTP/REST APIs</li>
</ul>
<p><strong>Software requerido</strong>:</p>
<ul>
<li>Python 3.11 o superior</li>
<li>Node.js 20 o superior</li>
<li>PostgreSQL 15 o superior</li>
<li>Docker/Podman</li>
<li>Editor de cÃ³digo (VS Code recomendado)</li>
</ul>
<h3>1.4 Â¿Por quÃ© este Stack?</h3>
<p><strong>FastAPI</strong>:</p>
<ul>
<li>Rendimiento comparable a Node.js y Go</li>
<li>ValidaciÃ³n automÃ¡tica de datos con Pydantic</li>
<li>DocumentaciÃ³n interactiva automÃ¡tica (Swagger/Redoc)</li>
<li>Soporte nativo para async/await</li>
<li>Type hints para cÃ³digo mÃ¡s seguro</li>
</ul>
<p><strong>Next.js</strong>:</p>
<ul>
<li>Server-Side Rendering para mejor SEO</li>
<li>Enrutamiento automÃ¡tico basado en archivos</li>
<li>OptimizaciÃ³n automÃ¡tica de imÃ¡genes y cÃ³digo</li>
<li>Excelente experiencia de desarrollo</li>
<li>IntegraciÃ³n perfecta con React</li>
</ul>
<p><strong>PostgreSQL</strong>:</p>
<ul>
<li>Base de datos relacional robusta y confiable</li>
<li>Soporte completo para transacciones ACID</li>
<li>Extensibilidad y rendimiento probado</li>
<li>Amplia comunidad y documentaciÃ³n</li>
</ul>
<p><strong>Podman/Docker</strong>:</p>
<ul>
<li>Entornos consistentes entre desarrollo y producciÃ³n</li>
<li>FÃ¡cil escalabilidad horizontal</li>
<li>Aislamiento de dependencias</li>
<li>Simplifica despliegue</li>
</ul>
<hr>
<h2>2. ARQUITECTURA GENERAL DE LA APLICACIÃ“N</h2>
<h3>2.1 Diagrama de Arquitectura Completa</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENTE (NAVEGADOR)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              NEXT.JS FRONTEND (Puerto 3000)                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â€¢ React Components                                       â”‚ â”‚
â”‚  â”‚  â€¢ TypeScript                                             â”‚ â”‚
â”‚  â”‚  â€¢ TailwindCSS + shadcn/ui                               â”‚ â”‚
â”‚  â”‚  â€¢ Client API (axios)                                     â”‚ â”‚
â”‚  â”‚  â€¢ WebSocket Client                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP/HTTPS
                            â”‚ WebSocket (ws/wss)
                            â”‚ JWT en Cookies
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FASTAPI BACKEND (Puerto 8000)                  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    CAPA DE API (Routers)                    â”‚â”‚
â”‚  â”‚  â€¢ Endpoints REST (/api/v1/...)                            â”‚â”‚
â”‚  â”‚  â€¢ WebSocket handlers (/ws)                                â”‚â”‚
â”‚  â”‚  â€¢ ValidaciÃ³n de entrada (Pydantic)                        â”‚â”‚
â”‚  â”‚  â€¢ SerializaciÃ³n de respuestas                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                            â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              CAPA DE SERVICIOS (Business Logic)           â”‚  â”‚
â”‚  â”‚  â€¢ AuthService - LÃ³gica de autenticaciÃ³n                 â”‚  â”‚
â”‚  â”‚  â€¢ UserService - GestiÃ³n de usuarios                     â”‚  â”‚
â”‚  â”‚  â€¢ ProjectService - LÃ³gica de proyectos                  â”‚  â”‚
â”‚  â”‚  â€¢ WebSocketService - GestiÃ³n de conexiones              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           CAPA DE REPOSITORIOS (Data Access)              â”‚  â”‚
â”‚  â”‚  â€¢ CRUD genÃ©rico (BaseRepository)                        â”‚  â”‚
â”‚  â”‚  â€¢ UserRepository                                         â”‚  â”‚
â”‚  â”‚  â€¢ ProjectRepository                                      â”‚  â”‚
â”‚  â”‚  â€¢ TaskRepository                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  CAPA DE MODELOS (ORM)                    â”‚  â”‚
â”‚  â”‚  â€¢ SQLAlchemy Models                                      â”‚  â”‚
â”‚  â”‚  â€¢ DefiniciÃ³n de tablas y relaciones                     â”‚  â”‚
â”‚  â”‚  â€¢ User, Project, Task, Tag                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ SQLAlchemy
                            â”‚ Alembic (migraciones)
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  POSTGRESQL (Puerto 5432)                         â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Base de datos relacional                                      â”‚
â”‚  â€¢ Tablas: users, projects, tasks, tags, task_tags             â”‚
â”‚  â€¢ Ãndices, constraints, foreign keys                           â”‚
â”‚  â€¢ Persistencia de datos                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTENEDORES (Docker/Podman)                   â”‚
â”‚                                                                  â”‚
â”‚  [Frontend Container] â†â†’ [Backend Container] â†â†’ [DB Container]  â”‚
â”‚                                                                  â”‚
â”‚  Network: fullstack_network                                      â”‚
â”‚  Volumes: postgres_data                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3>2.2 Flujo de Datos</h3>
<h4>Flujo de AutenticaciÃ³n</h4>
<pre><code>1. Usuario â†’ Frontend: Ingresa credenciales
2. Frontend â†’ Backend: POST /api/v1/auth/login
3. Backend: Valida credenciales con UserService
4. Backend: Genera JWT con informaciÃ³n del usuario
5. Backend â†’ Frontend: Set-Cookie con JWT (HttpOnly, Secure)
6. Frontend: Almacena estado de autenticaciÃ³n
7. Para requests siguientes: Cookie enviada automÃ¡ticamente
</code></pre>
<h4>Flujo de OperaciÃ³n CRUD</h4>
<pre><code>1. Frontend: Usuario interactÃºa con UI
2. Frontend: ValidaciÃ³n local (Zod/react-hook-form)
3. Frontend â†’ Backend: HTTP request con JWT en cookie
4. Backend API Layer: Extrae y valida JWT
5. Backend API Layer: Valida datos de entrada (Pydantic)
6. Backend Service Layer: Ejecuta lÃ³gica de negocio
7. Backend Repository Layer: OperaciÃ³n en base de datos
8. PostgreSQL: Ejecuta query y retorna datos
9. Repository â†’ Service â†’ API: Propaga respuesta
10. Backend â†’ Frontend: Respuesta JSON serializada
11. Frontend: Actualiza UI y estado
</code></pre>
<h4>Flujo de WebSocket</h4>
<pre><code>1. Frontend: Establece conexiÃ³n WebSocket
2. Backend: Acepta conexiÃ³n y valida autenticaciÃ³n
3. Backend: Agrega cliente a ConnectionManager
4. Evento en el sistema: Cambio de estado
5. Backend: Broadcast mensaje a clientes conectados
6. Frontend: Recibe mensaje y actualiza UI en tiempo real
7. Al desconectar: Backend limpia recursos
</code></pre>
<h3>2.3 Patrones de Arquitectura Aplicados</h3>
<h4>Clean Architecture (Arquitectura Limpia)</h4>
<ul>
<li><strong>Capa Externa</strong>: API endpoints y WebSocket handlers</li>
<li><strong>Capa de AplicaciÃ³n</strong>: Servicios con lÃ³gica de negocio</li>
<li><strong>Capa de Dominio</strong>: Modelos y entidades</li>
<li><strong>Capa de Infraestructura</strong>: Repositorios y base de datos</li>
</ul>
<h4>Repository Pattern</h4>
<ul>
<li>AbstracciÃ³n del acceso a datos</li>
<li>CRUD genÃ©rico reutilizable</li>
<li>Facilita testing con mocks</li>
<li>Desacopla lÃ³gica de negocio de persistencia</li>
</ul>
<h4>Service Layer Pattern</h4>
<ul>
<li>Contiene lÃ³gica de negocio</li>
<li>Coordina entre repositorios</li>
<li>Transacciones y validaciones complejas</li>
<li>ReutilizaciÃ³n de lÃ³gica</li>
</ul>
<h4>Dependency Injection</h4>
<ul>
<li>FastAPI gestiona dependencias automÃ¡ticamente</li>
<li>Facilita testing y modularidad</li>
<li>Permite composiciÃ³n de dependencias</li>
<li>Mejora mantenibilidad del cÃ³digo</li>
</ul>
<hr>
<h2>3. CONFIGURACIÃ“N DEL ENTORNO</h2>
<h3>3.1 InstalaciÃ³n de Herramientas Base</h3>
<h4>Python 3.11+</h4>
<pre><code class="language-bash"># Verificar instalaciÃ³n
python --version  # Debe ser 3.11 o superior

# Linux (Ubuntu/Debian)
sudo apt update
sudo apt install python3.11 python3.11-venv python3-pip

# macOS (con Homebrew)
brew install python@3.11

# Windows: Descargar desde python.org
</code></pre>
<h4>Node.js 20+</h4>
<pre><code class="language-bash"># Verificar instalaciÃ³n
node --version  # Debe ser 20 o superior

# Linux (usando nvm - recomendado)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# macOS (con Homebrew)
brew install node@20

# Windows: Descargar desde nodejs.org
</code></pre>
<h4>PostgreSQL 15+</h4>
<pre><code class="language-bash"># Verificar instalaciÃ³n
psql --version

# Linux (Ubuntu/Debian)
sudo apt install postgresql postgresql-contrib

# macOS (con Homebrew)
brew install postgresql@15

# Windows: Descargar desde postgresql.org

# Iniciar servicio
sudo systemctl start postgresql  # Linux
brew services start postgresql   # macOS
</code></pre>
<h4>Docker/Podman</h4>
<pre><code class="language-bash"># Docker (Linux)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Docker Compose
sudo curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Podman (alternativa sin daemon)
# Linux (Ubuntu/Debian)
sudo apt install podman podman-compose

# macOS
brew install podman
</code></pre>
<h3>3.2 Estructura de Directorios del Proyecto</h3>
<pre><code>fullstack-fastapi-nextjs/
â”‚
â”œâ”€â”€ backend/                      # AplicaciÃ³n FastAPI
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ router.py
â”‚   â”‚   â”‚       â””â”€â”€ endpoints/
â”‚   â”‚   â”‚           â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚           â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚           â”œâ”€â”€ users.py
â”‚   â”‚   â”‚           â”œâ”€â”€ projects.py
â”‚   â”‚   â”‚           â”œâ”€â”€ tasks.py
â”‚   â”‚   â”‚           â””â”€â”€ websocket.py
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â”‚   â””â”€â”€ exceptions.py
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â”‚   â””â”€â”€ init_db.py
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â”‚   â”œâ”€â”€ task.py
â”‚   â”‚   â”‚   â””â”€â”€ tag.py
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â”‚   â”œâ”€â”€ task.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tag.py
â”‚   â”‚   â”‚   â””â”€â”€ token.py
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project_service.py
â”‚   â”‚   â”‚   â””â”€â”€ websocket_service.py
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repo.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project_repo.py
â”‚   â”‚   â”‚   â””â”€â”€ task_repo.py
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ helpers.py
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ conftest.py
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”œâ”€â”€ alembic/
â”‚   â”‚   â”œâ”€â”€ versions/
â”‚   â”‚   â””â”€â”€ env.py
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ alembic.ini
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ frontend/                     # AplicaciÃ³n Next.js
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ (protected)/
â”‚   â”‚   â”‚       â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ projects/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚       â””â”€â”€ tasks/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/              # shadcn/ui components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Navigation.tsx
â”‚   â”‚   â”‚   â””â”€â”€ forms/
â”‚   â”‚   â”‚       â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ ProjectForm.tsx
â”‚   â”‚   â”‚       â””â”€â”€ TaskForm.tsx
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts           # Cliente API
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts          # LÃ³gica de autenticaciÃ³n
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts         # Utilidades
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚   â”‚   â”‚   â””â”€â”€ useApi.ts
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ api.ts           # Tipos TypeScript
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ assets/
â”‚   â”œâ”€â”€ .env.local
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ next.config.js
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ docker-compose.yml            # OrquestaciÃ³n de contenedores
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
</code></pre>
<h3>3.3 ConfiguraciÃ³n del Backend (FastAPI)</h3>
<h4>Crear entorno virtual y instalar dependencias</h4>
<pre><code class="language-bash"># Navegar al directorio backend
cd fullstack-fastapi-nextjs/backend

# Crear entorno virtual
python -m venv venv

# Activar entorno virtual
# Linux/macOS:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# Instalar dependencias
pip install -r requirements.txt
</code></pre>
<h4>requirements.txt</h4>
<pre><code class="language-txt"># FastAPI y servidor ASGI
fastapi==0.109.0
uvicorn[standard]==0.27.0

# Base de datos y ORM
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
alembic==1.13.1

# ValidaciÃ³n y serializaciÃ³n
pydantic==2.5.3
pydantic-settings==2.1.0
pydantic[email]==2.5.3

# AutenticaciÃ³n y seguridad
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# CORS y middleware
python-dotenv==1.0.0

# WebSockets
websockets==12.0

# Testing
pytest==7.4.4
pytest-asyncio==0.23.3
httpx==0.26.0

# Utilidades
python-dateutil==2.8.2
</code></pre>
<h4>ConfiguraciÃ³n de variables de entorno (.env)</h4>
<pre><code class="language-env"># Application
APP_NAME=&quot;FastAPI Full Stack&quot;
VERSION=&quot;1.0.0&quot;
DEBUG=True
ENVIRONMENT=&quot;development&quot;

# Database
DATABASE_URL=postgresql://fastapi_user:SecurePassword123!@localhost:5432/fullstack_db

# Security
SECRET_KEY=09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS
ALLOWED_ORIGINS=[&quot;http://localhost:3000&quot;,&quot;http://frontend:3000&quot;]

# Server
HOST=0.0.0.0
PORT=8000
RELOAD=True
</code></pre>
<h4>Generar SECRET_KEY seguro</h4>
<pre><code class="language-bash"># Python
python -c &quot;import secrets; print(secrets.token_urlsafe(32))&quot;

# OpenSSL
openssl rand -hex 32
</code></pre>
<h4>Configurar PostgreSQL</h4>
<pre><code class="language-bash"># Conectar a PostgreSQL
sudo -u postgres psql

# Crear usuario y base de datos
CREATE USER fastapi_user WITH PASSWORD 'SecurePassword123!';
CREATE DATABASE fullstack_db OWNER fastapi_user;
GRANT ALL PRIVILEGES ON DATABASE fullstack_db TO fastapi_user;

# Salir
\q
</code></pre>
<h3>3.4 ConfiguraciÃ³n del Frontend (Next.js)</h3>
<h4>Crear proyecto e instalar dependencias</h4>
<pre><code class="language-bash"># Navegar al directorio del proyecto
cd fullstack-fastapi-nextjs

# Crear aplicaciÃ³n Next.js
npx create-next-app@latest frontend --typescript --tailwind --app --src-dir

# Navegar a frontend
cd frontend

# Instalar dependencias adicionales
npm install axios react-hook-form zod @hookform/resolvers
npm install openapi-fetch openapi-typescript

# Instalar shadcn/ui
npx shadcn-ui@latest init

# Instalar componentes especÃ­ficos
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add card
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add form
npx shadcn-ui@latest add label
npx shadcn-ui@latest add select
npx shadcn-ui@latest add toast
</code></pre>
<h4>Variables de entorno (.env.local)</h4>
<pre><code class="language-env"># API Backend
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws

# Application
NEXT_PUBLIC_APP_NAME=&quot;FastAPI Full Stack&quot;
NEXT_PUBLIC_APP_VERSION=&quot;1.0.0&quot;
</code></pre>
<h3>3.5 ConfiguraciÃ³n de Docker/Podman</h3>
<h4>docker-compose.yml completo</h4>
<pre><code class="language-yaml">version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: SecurePassword123!
      POSTGRES_DB: fullstack_db
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - &quot;5432:5432&quot;
    networks:
      - fullstack_network
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U fastapi_user -d fullstack_db&quot;]
      interval: 10s
      timeout: 5s
      retries: 5

  # FastAPI Backend
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: fullstack_backend
    restart: unless-stopped
    env_file:
      - ./backend/.env
    environment:
      - DATABASE_URL=postgresql://fastapi_user:SecurePassword123!@postgres:5432/fullstack_db
    volumes:
      - ./backend/app:/app/app
      - ./backend/alembic:/app/alembic
    ports:
      - &quot;8000:8000&quot;
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - fullstack_network
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # Next.js Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: http://backend:8000/api/v1
        NEXT_PUBLIC_WS_URL: ws://backend:8000/ws
    container_name: fullstack_frontend
    restart: unless-stopped
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
      - NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - /app/node_modules
      - /app/.next
    ports:
      - &quot;3000:3000&quot;
    depends_on:
      - backend
    networks:
      - fullstack_network

networks:
  fullstack_network:
    driver: bridge

volumes:
  postgres_data:
    driver: local
</code></pre>
<h4>Comandos Docker/Podman esenciales</h4>
<pre><code class="language-bash"># Construir imÃ¡genes
docker-compose build

# Levantar servicios
docker-compose up -d

# Ver logs
docker-compose logs -f
docker-compose logs -f backend
docker-compose logs -f frontend

# Detener servicios
docker-compose stop

# Detener y eliminar contenedores
docker-compose down

# Eliminar incluyendo volÃºmenes
docker-compose down -v

# Reconstruir sin cachÃ©
docker-compose build --no-cache

# Ejecutar comandos en contenedor
docker-compose exec backend bash
docker-compose exec backend alembic upgrade head

# Ver estado de contenedores
docker-compose ps

# Reiniciar servicio especÃ­fico
docker-compose restart backend
</code></pre>
<h3>3.6 VerificaciÃ³n de la InstalaciÃ³n</h3>
<h4>Verificar Backend</h4>
<pre><code class="language-bash"># Activar entorno virtual
source backend/venv/bin/activate

# Ejecutar servidor
cd backend
uvicorn app.main:app --reload

# Verificar en navegador:
# http://localhost:8000/health
# http://localhost:8000/docs (Swagger UI)
# http://localhost:8000/redoc (ReDoc)
</code></pre>
<h4>Verificar Frontend</h4>
<pre><code class="language-bash"># Ejecutar servidor de desarrollo
cd frontend
npm run dev

# Verificar en navegador:
# http://localhost:3000
</code></pre>
<h4>Verificar PostgreSQL</h4>
<pre><code class="language-bash"># Conectar a la base de datos
psql -U fastapi_user -d fullstack_db -h localhost

# Verificar tablas (despuÃ©s de migraciones)
\dt

# Salir
\q
</code></pre>
<hr>
<h2>4. ESTRUCTURA PROFESIONAL DEL PROYECTO</h2>
<h3>4.1 OrganizaciÃ³n del Backend</h3>
<h4>Principios de OrganizaciÃ³n</h4>
<ol>
<li><strong>SeparaciÃ³n de Responsabilidades</strong>: Cada mÃ³dulo tiene una funciÃ³n especÃ­fica</li>
<li><strong>Modularidad</strong>: CÃ³digo organizado en paquetes reutilizables</li>
<li><strong>Escalabilidad</strong>: FÃ¡cil agregar nuevas caracterÃ­sticas</li>
<li><strong>Testabilidad</strong>: Estructura facilita pruebas unitarias</li>
<li><strong>Mantenibilidad</strong>: CÃ³digo claro y bien documentado</li>
</ol>
<h4>DescripciÃ³n de MÃ³dulos</h4>
<p><strong><code>app/main.py</code></strong> - Punto de entrada</p>
<ul>
<li>Crea instancia de FastAPI</li>
<li>Configura middleware (CORS, etc.)</li>
<li>Incluye routers</li>
<li>Define eventos de startup/shutdown</li>
<li>Configura documentaciÃ³n</li>
</ul>
<p><strong><code>app/core/</code></strong> - ConfiguraciÃ³n central</p>
<ul>
<li><code>config.py</code>: Settings con Pydantic</li>
<li><code>security.py</code>: JWT, hashing, autenticaciÃ³n</li>
<li><code>exceptions.py</code>: Excepciones personalizadas</li>
</ul>
<p><strong><code>app/api/</code></strong> - Capa de presentaciÃ³n</p>
<ul>
<li><code>deps.py</code>: Dependencias compartidas</li>
<li><code>v1/router.py</code>: Router principal versionado</li>
<li><code>v1/endpoints/</code>: Endpoints especÃ­ficos</li>
</ul>
<p><strong><code>app/services/</code></strong> - LÃ³gica de negocio</p>
<ul>
<li>Coordina operaciones complejas</li>
<li>Valida reglas de negocio</li>
<li>Orquesta entre repositorios</li>
<li>Maneja transacciones</li>
</ul>
<p><strong><code>app/repositories/</code></strong> - Acceso a datos</p>
<ul>
<li>CRUD genÃ©rico (base.py)</li>
<li>Operaciones especÃ­ficas por entidad</li>
<li>Abstrae SQLAlchemy</li>
<li>Facilita testing con mocks</li>
</ul>
<p><strong><code>app/models/</code></strong> - Modelos ORM</p>
<ul>
<li>DefiniciÃ³n de tablas con SQLAlchemy</li>
<li>Relaciones entre entidades</li>
<li>Constraints e Ã­ndices</li>
</ul>
<p><strong><code>app/schemas/</code></strong> - Esquemas Pydantic</p>
<ul>
<li>ValidaciÃ³n de entrada/salida</li>
<li>SerializaciÃ³n automÃ¡tica</li>
<li>DocumentaciÃ³n de API</li>
</ul>
<p><strong><code>app/db/</code></strong> - ConfiguraciÃ³n de BD</p>
<ul>
<li>ConexiÃ³n a PostgreSQL</li>
<li>Session management</li>
<li>InicializaciÃ³n de BD</li>
</ul>
<h3>4.2 OrganizaciÃ³n del Frontend</h3>
<h4>Principios de OrganizaciÃ³n</h4>
<ol>
<li><strong>Component-Based</strong>: Todo es un componente reutilizable</li>
<li><strong>Type Safety</strong>: TypeScript en todo el cÃ³digo</li>
<li><strong>Separation of Concerns</strong>: LÃ³gica separada de presentaciÃ³n</li>
<li><strong>Performance</strong>: Server Components por defecto</li>
<li><strong>Accessibility</strong>: Componentes accesibles (a11y)</li>
</ol>
<h4>DescripciÃ³n de MÃ³dulos</h4>
<p><strong><code>src/app/</code></strong> - Rutas de la aplicaciÃ³n</p>
<ul>
<li>Next.js App Router</li>
<li>Grupos de rutas: (auth), (protected)</li>
<li>Layouts compartidos</li>
<li>PÃ¡ginas especÃ­ficas</li>
</ul>
<p><strong><code>src/components/</code></strong> - Componentes React</p>
<ul>
<li><code>ui/</code>: Componentes de shadcn/ui</li>
<li><code>layout/</code>: Header, Footer, Sidebar</li>
<li><code>forms/</code>: Formularios especÃ­ficos</li>
</ul>
<p><strong><code>src/lib/</code></strong> - LibrerÃ­as y utilidades</p>
<ul>
<li><code>api.ts</code>: Cliente HTTP (axios)</li>
<li><code>auth.ts</code>: LÃ³gica de autenticaciÃ³n</li>
<li><code>utils.ts</code>: Funciones auxiliares</li>
</ul>
<p><strong><code>src/hooks/</code></strong> - React Hooks personalizados</p>
<ul>
<li><code>useAuth</code>: GestiÃ³n de autenticaciÃ³n</li>
<li><code>useWebSocket</code>: ConexiÃ³n WebSocket</li>
<li><code>useApi</code>: Llamadas a API</li>
</ul>
<p><strong><code>src/types/</code></strong> - Definiciones TypeScript</p>
<ul>
<li>Interfaces compartidas</li>
<li>Tipos del API</li>
</ul>
<h3>4.3 Convenciones de Nomenclatura</h3>
<h4>Backend (Python)</h4>
<pre><code class="language-python"># Archivos y mÃ³dulos: snake_case
user_service.py
auth_service.py

# Clases: PascalCase
class UserService:
class ProjectRepository:

# Funciones y variables: snake_case
def get_current_user():
user_id = 123

# Constantes: UPPER_SNAKE_CASE
SECRET_KEY = &quot;...&quot;
MAX_UPLOAD_SIZE = 10485760

# Modelos SQLAlchemy: PascalCase
class User(Base):
class Project(Base):

# Esquemas Pydantic: PascalCase
class UserCreate(BaseModel):
class UserResponse(BaseModel):
</code></pre>
<h4>Frontend (TypeScript)</h4>
<pre><code class="language-typescript">// Archivos de componentes: PascalCase
UserProfile.tsx
LoginForm.tsx

// Archivos de utilidades: camelCase
api.ts
auth.ts

// Componentes: PascalCase
function UserProfile() {}
const LoginForm: React.FC = () =&gt; {}

// Funciones y variables: camelCase
const getUserData = () =&gt; {}
const userId = 123

// Constantes: UPPER_SNAKE_CASE
const API_URL = &quot;...&quot;
const MAX_RETRIES = 3

// Tipos e Interfaces: PascalCase
interface User {}
type ApiResponse&lt;T&gt; = {}

// Enums: PascalCase
enum TaskStatus {}
</code></pre>
<hr>
<h2>5. BACKEND CON FASTAPI</h2>
<h3>5.1 AplicaciÃ³n Principal (main.py)</h3>
<pre><code class="language-python">from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api.v1.router import api_router
from app.db.session import engine
from app.db.base import Base

# Crear instancia de FastAPI
app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    description=&quot;API Full Stack Profesional con FastAPI y Next.js&quot;,
    openapi_url=f&quot;/api/v1/openapi.json&quot;,
    docs_url=&quot;/api/docs&quot;,
    redoc_url=&quot;/api/redoc&quot;,
    swagger_ui_parameters={&quot;persistAuthorization&quot;: True}
)

# Configurar CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=[&quot;*&quot;],
    allow_headers=[&quot;*&quot;],
    expose_headers=[&quot;*&quot;]
)

# Incluir routers
app.include_router(api_router, prefix=&quot;/api/v1&quot;)

# Health check endpoint
@app.get(&quot;/health&quot;, tags=[&quot;health&quot;])
async def health_check():
    &quot;&quot;&quot;Endpoint de health check&quot;&quot;&quot;
    return {
        &quot;status&quot;: &quot;healthy&quot;,
        &quot;version&quot;: settings.VERSION,
        &quot;environment&quot;: settings.ENVIRONMENT
    }

# Eventos de ciclo de vida
@app.on_event(&quot;startup&quot;)
async def startup_event():
    &quot;&quot;&quot;Ejecutar al iniciar la aplicaciÃ³n&quot;&quot;&quot;
    print(f&quot;ğŸš€ {settings.APP_NAME} v{settings.VERSION} iniciado&quot;)
    print(f&quot;ğŸ“š DocumentaciÃ³n: http://{settings.HOST}:{settings.PORT}/api/docs&quot;)
    print(f&quot;ğŸ”§ Entorno: {settings.ENVIRONMENT}&quot;)

@app.on_event(&quot;shutdown&quot;)
async def shutdown_event():
    &quot;&quot;&quot;Ejecutar al cerrar la aplicaciÃ³n&quot;&quot;&quot;
    print(&quot;ğŸ‘‹ Cerrando aplicaciÃ³n...&quot;)
</code></pre>
<h3>5.2 ConfiguraciÃ³n (core/config.py)</h3>
<pre><code class="language-python">from typing import List
from pydantic_settings import BaseSettings, SettingsConfigDict
from pydantic import AnyHttpUrl, field_validator

class Settings(BaseSettings):
    &quot;&quot;&quot;ConfiguraciÃ³n de la aplicaciÃ³n&quot;&quot;&quot;
    
    # Application
    APP_NAME: str
    VERSION: str = &quot;1.0.0&quot;
    DEBUG: bool = False
    ENVIRONMENT: str = &quot;development&quot;
    
    # Server
    HOST: str = &quot;0.0.0.0&quot;
    PORT: int = 8000
    RELOAD: bool = False
    
    # Database
    DATABASE_URL: str
    
    # Security
    SECRET_KEY: str
    ALGORITHM: str = &quot;HS256&quot;
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # CORS
    ALLOWED_ORIGINS: List[AnyHttpUrl] = []
    
    @field_validator(&quot;ALLOWED_ORIGINS&quot;, mode=&quot;before&quot;)
    @classmethod
    def parse_origins(cls, v):
        if isinstance(v, str):
            return [i.strip() for i in v.split(&quot;,&quot;)]
        return v
    
    model_config = SettingsConfigDict(
        env_file=&quot;.env&quot;,
        case_sensitive=True,
        extra=&quot;ignore&quot;
    )

# Instancia global de settings
settings = Settings()
</code></pre>
<h3>5.3 Seguridad (core/security.py)</h3>
<pre><code class="language-python">from datetime import datetime, timedelta
from typing import Optional
from jose import jwt, JWTError
from passlib.context import CryptContext
from app.core.config import settings

# Configurar bcrypt para hashing de contraseÃ±as
pwd_context = CryptContext(schemes=[&quot;bcrypt&quot;], deprecated=&quot;auto&quot;)

def verify_password(plain_password: str, hashed_password: str) -&gt; bool:
    &quot;&quot;&quot;Verificar contraseÃ±a con hash&quot;&quot;&quot;
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -&gt; str:
    &quot;&quot;&quot;Generar hash de contraseÃ±a&quot;&quot;&quot;
    return pwd_context.hash(password)

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -&gt; str:
    &quot;&quot;&quot;Crear JWT access token&quot;&quot;&quot;
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    
    to_encode.update({&quot;exp&quot;: expire, &quot;iat&quot;: datetime.utcnow()})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def create_refresh_token(data: dict) -&gt; str:
    &quot;&quot;&quot;Crear JWT refresh token&quot;&quot;&quot;
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)
    to_encode.update({&quot;exp&quot;: expire, &quot;iat&quot;: datetime.utcnow(), &quot;type&quot;: &quot;refresh&quot;})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def decode_token(token: str) -&gt; Optional[dict]:
    &quot;&quot;&quot;Decodificar y validar JWT&quot;&quot;&quot;
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        return payload
    except JWTError:
        return None
</code></pre>
<h3>5.4 Dependencias (api/deps.py)</h3>
<pre><code class="language-python">from typing import Generator, Optional
from fastapi import Depends, HTTPException, status, Cookie
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from app.core.config import settings
from app.core.security import decode_token
from app.db.session import SessionLocal
from app.models.user import User
from app.services.user_service import user_service

# OAuth2 scheme
oauth2_scheme = OAuth2PasswordBearer(tokenUrl=&quot;/api/v1/auth/login&quot;, auto_error=False)

def get_db() -&gt; Generator:
    &quot;&quot;&quot;
    Dependency para obtener sesiÃ³n de base de datos
    &quot;&quot;&quot;
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

async def get_current_user(
    db: Session = Depends(get_db),
    token: Optional[str] = Depends(oauth2_scheme),
    access_token: Optional[str] = Cookie(None)
) -&gt; User:
    &quot;&quot;&quot;
    Dependency para obtener usuario actual desde JWT
    Prioriza cookie sobre header Authorization
    &quot;&quot;&quot;
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail=&quot;No se pudo validar las credenciales&quot;,
        headers={&quot;WWW-Authenticate&quot;: &quot;Bearer&quot;},
    )
    
    # Priorizar token de cookie
    token_to_decode = access_token or token
    
    if not token_to_decode:
        raise credentials_exception
    
    payload = decode_token(token_to_decode)
    if payload is None:
        raise credentials_exception
    
    user_id: str = payload.get(&quot;sub&quot;)
    if user_id is None:
        raise credentials_exception
    
    user = user_service.get_user(db, user_id=int(user_id))
    if user is None:
        raise credentials_exception
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -&gt; User:
    &quot;&quot;&quot;
    Dependency para verificar que usuario estÃ© activo
    &quot;&quot;&quot;
    if not current_user.is_active:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST, 
            detail=&quot;Usuario inactivo&quot;
        )
    return current_user

async def get_current_active_superuser(
    current_user: User = Depends(get_current_user),
) -&gt; User:
    &quot;&quot;&quot;
    Dependency para verificar que usuario sea superusuario
    &quot;&quot;&quot;
    if not current_user.is_superuser:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail=&quot;Permisos insuficientes&quot;
        )
    return current_user
</code></pre>
<h3>5.5 Repositorio Base (repositories/base.py)</h3>
<pre><code class="language-python">from typing import TypeVar, Generic, Type, Optional, List, Any
from sqlalchemy.orm import Session
from sqlalchemy import select, update, delete
from app.db.base import Base

ModelType = TypeVar(&quot;ModelType&quot;, bound=Base)

class BaseRepository(Generic[ModelType]):
    &quot;&quot;&quot;
    Repositorio base con operaciones CRUD genÃ©ricas
    &quot;&quot;&quot;
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -&gt; Optional[ModelType]:
        &quot;&quot;&quot;Obtener por ID&quot;&quot;&quot;
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(
        self, 
        db: Session, 
        *, 
        skip: int = 0, 
        limit: int = 100
    ) -&gt; List[ModelType]:
        &quot;&quot;&quot;Obtener mÃºltiples registros&quot;&quot;&quot;
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def get_by_field(
        self,
        db: Session,
        *,
        field_name: str,
        value: Any
    ) -&gt; Optional[ModelType]:
        &quot;&quot;&quot;Obtener por campo especÃ­fico&quot;&quot;&quot;
        return db.query(self.model).filter(
            getattr(self.model, field_name) == value
        ).first()
    
    def create(self, db: Session, *, obj_in: dict) -&gt; ModelType:
        &quot;&quot;&quot;Crear nuevo registro&quot;&quot;&quot;
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(
        self, 
        db: Session, 
        *, 
        db_obj: ModelType, 
        obj_in: dict
    ) -&gt; ModelType:
        &quot;&quot;&quot;Actualizar registro existente&quot;&quot;&quot;
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -&gt; Optional[ModelType]:
        &quot;&quot;&quot;Eliminar registro&quot;&quot;&quot;
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
    
    def count(self, db: Session) -&gt; int:
        &quot;&quot;&quot;Contar registros&quot;&quot;&quot;
        return db.query(self.model).count()
</code></pre>
<h3>5.6 Endpoints de AutenticaciÃ³n (api/v1/endpoints/auth.py)</h3>
<pre><code class="language-python">from datetime import timedelta
from fastapi import APIRouter, Depends, HTTPException, status, Response
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session
from app.api import deps
from app.core.config import settings
from app.core.security import create_access_token, create_refresh_token
from app.schemas.user import UserCreate, User as UserSchema
from app.schemas.token import Token
from app.services.auth_service import auth_service

router = APIRouter()

@router.post(&quot;/register&quot;, response_model=UserSchema, status_code=status.HTTP_201_CREATED)
def register(
    *,
    db: Session = Depends(deps.get_db),
    user_in: UserCreate
):
    &quot;&quot;&quot;
    Registrar nuevo usuario
    &quot;&quot;&quot;
    user = auth_service.register_user(db, user_in=user_in)
    return user

@router.post(&quot;/login&quot;, response_model=Token)
def login(
    *,
    db: Session = Depends(deps.get_db),
    form_data: OAuth2PasswordRequestForm = Depends(),
    response: Response
):
    &quot;&quot;&quot;
    Login de usuario con OAuth2 password flow
    &quot;&quot;&quot;
    user = auth_service.authenticate(
        db, 
        email=form_data.username,  # OAuth2 usa &quot;username&quot;
        password=form_data.password
    )
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=&quot;Email o contraseÃ±a incorrectos&quot;,
            headers={&quot;WWW-Authenticate&quot;: &quot;Bearer&quot;},
        )
    
    # Crear tokens
    access_token = create_access_token(data={&quot;sub&quot;: str(user.id)})
    refresh_token = create_refresh_token(data={&quot;sub&quot;: str(user.id)})
    
    # Configurar cookies
    response.set_cookie(
        key=&quot;access_token&quot;,
        value=access_token,
        httponly=True,
        secure=not settings.DEBUG,  # HTTPS en producciÃ³n
        samesite=&quot;strict&quot;,
        max_age=settings.ACCESS_TOKEN_EXPIRE_MINUTES * 60
    )
    
    response.set_cookie(
        key=&quot;refresh_token&quot;,
        value=refresh_token,
        httponly=True,
        secure=not settings.DEBUG,
        samesite=&quot;strict&quot;,
        max_age=settings.REFRESH_TOKEN_EXPIRE_DAYS * 24 * 60 * 60
    )
    
    return {
        &quot;access_token&quot;: access_token,
        &quot;refresh_token&quot;: refresh_token,
        &quot;token_type&quot;: &quot;bearer&quot;
    }

@router.post(&quot;/logout&quot;)
def logout(response: Response):
    &quot;&quot;&quot;
    Logout - eliminar cookies
    &quot;&quot;&quot;
    response.delete_cookie(key=&quot;access_token&quot;)
    response.delete_cookie(key=&quot;refresh_token&quot;)
    return {&quot;message&quot;: &quot;Logout exitoso&quot;}

@router.get(&quot;/me&quot;, response_model=UserSchema)
def read_users_me(
    current_user: User = Depends(deps.get_current_active_user),
):
    &quot;&quot;&quot;
    Obtener usuario actual
    &quot;&quot;&quot;
    return current_user
</code></pre>
<hr>
<p><em>(ContinÃºa en la siguiente parte debido al lÃ­mite de caracteres...)</em></p>
<hr>
<h2>6. FRONTEND CON NEXT.JS</h2>
<h3>6.1 Cliente API (lib/api.ts)</h3>
<pre><code class="language-typescript">import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';

// ConfiguraciÃ³n base de axios
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1',
  timeout: 10000,
  withCredentials: true, // Enviar cookies automÃ¡ticamente
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para requests
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) =&gt; {
    // Logs en desarrollo
    if (process.env.NODE_ENV === 'development') {
      console.log(`ğŸ“¡ ${config.method?.toUpperCase()} ${config.url}`);
    }
    return config;
  },
  (error: AxiosError) =&gt; {
    return Promise.reject(error);
  }
);

// Interceptor para responses
apiClient.interceptors.response.use(
  (response) =&gt; {
    // Logs en desarrollo
    if (process.env.NODE_ENV === 'development') {
      console.log(`âœ… ${response.status} ${response.config.url}`);
    }
    return response;
  },
  async (error: AxiosError) =&gt; {
    const originalRequest = error.config;
    
    // Redirigir a login si 401
    if (error.response?.status === 401 &amp;&amp; typeof window !== 'undefined') {
      window.location.href = '/login';
    }
    
    // Logs de error
    if (process.env.NODE_ENV === 'development') {
      console.error(`âŒ ${error.response?.status} ${error.config?.url}`, error.response?.data);
    }
    
    return Promise.reject(error);
  }
);

// API functions
export const api = {
  // Auth
  auth: {
    login: async (email: string, password: string) =&gt; {
      const formData = new FormData();
      formData.append('username', email); // OAuth2 usa &quot;username&quot;
      formData.append('password', password);
      
      const response = await apiClient.post('/auth/login', formData, {
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
      });
      return response.data;
    },
    
    register: async (userData: any) =&gt; {
      const response = await apiClient.post('/auth/register', userData);
      return response.data;
    },
    
    logout: async () =&gt; {
      const response = await apiClient.post('/auth/logout');
      return response.data;
    },
    
    getCurrentUser: async () =&gt; {
      const response = await apiClient.get('/auth/me');
      return response.data;
    },
  },
  
  // Users
  users: {
    list: async (skip: number = 0, limit: number = 100) =&gt; {
      const response = await apiClient.get('/users/', { params: { skip, limit } });
      return response.data;
    },
    
    get: async (userId: number) =&gt; {
      const response = await apiClient.get(`/users/${userId}`);
      return response.data;
    },
    
    update: async (userId: number, userData: any) =&gt; {
      const response = await apiClient.put(`/users/${userId}`, userData);
      return response.data;
    },
  },
  
  // Projects
  projects: {
    list: async (skip: number = 0, limit: number = 100) =&gt; {
      const response = await apiClient.get('/projects/', { params: { skip, limit } });
      return response.data;
    },
    
    get: async (projectId: number) =&gt; {
      const response = await apiClient.get(`/projects/${projectId}`);
      return response.data;
    },
    
    create: async (projectData: any) =&gt; {
      const response = await apiClient.post('/projects/', projectData);
      return response.data;
    },
    
    update: async (projectId: number, projectData: any) =&gt; {
      const response = await apiClient.put(`/projects/${projectId}`, projectData);
      return response.data;
    },
    
    delete: async (projectId: number) =&gt; {
      const response = await apiClient.delete(`/projects/${projectId}`);
      return response.data;
    },
  },
  
  // Tasks
  tasks: {
    list: async (projectId?: number, skip: number = 0, limit: number = 100) =&gt; {
      const response = await apiClient.get('/tasks/', { 
        params: { project_id: projectId, skip, limit } 
      });
      return response.data;
    },
    
    get: async (taskId: number) =&gt; {
      const response = await apiClient.get(`/tasks/${taskId}`);
      return response.data;
    },
    
    create: async (taskData: any) =&gt; {
      const response = await apiClient.post('/tasks/', taskData);
      return response.data;
    },
    
    update: async (taskId: number, taskData: any) =&gt; {
      const response = await apiClient.put(`/tasks/${taskId}`, taskData);
      return response.data;
    },
    
    delete: async (taskId: number) =&gt; {
      const response = await apiClient.delete(`/tasks/${taskId}`);
      return response.data;
    },
  },
};

export default apiClient;
</code></pre>
<h3>6.2 Hook de AutenticaciÃ³n (hooks/useAuth.ts)</h3>
<pre><code class="language-typescript">import { useState, useEffect, useCallback } from 'react';
import { api } from '@/lib/api';

interface User {
  id: number;
  username: string;
  email: string;
  full_name: string | null;
  is_active: boolean;
  is_superuser: boolean;
}

interface AuthState {
  user: User | null;
  isLoading: boolean;
  isAuthenticated: boolean;
}

export function useAuth() {
  const [authState, setAuthState] = useState&lt;AuthState&gt;({
    user: null,
    isLoading: true,
    isAuthenticated: false,
  });

  // Cargar usuario actual al montar
  useEffect(() =&gt; {
    loadUser();
  }, []);

  const loadUser = async () =&gt; {
    try {
      const user = await api.auth.getCurrentUser();
      setAuthState({
        user,
        isLoading: false,
        isAuthenticated: true,
      });
    } catch (error) {
      setAuthState({
        user: null,
        isLoading: false,
        isAuthenticated: false,
      });
    }
  };

  const login = useCallback(async (email: string, password: string) =&gt; {
    try {
      await api.auth.login(email, password);
      await loadUser();
      return { success: true };
    } catch (error: any) {
      return {
        success: false,
        error: error.response?.data?.detail || 'Error al iniciar sesiÃ³n',
      };
    }
  }, []);

  const register = useCallback(async (userData: any) =&gt; {
    try {
      await api.auth.register(userData);
      return { success: true };
    } catch (error: any) {
      return {
        success: false,
        error: error.response?.data?.detail || 'Error al registrarse',
      };
    }
  }, []);

  const logout = useCallback(async () =&gt; {
    try {
      await api.auth.logout();
      setAuthState({
        user: null,
        isLoading: false,
        isAuthenticated: false,
      });
      // Redirigir a login
      if (typeof window !== 'undefined') {
        window.location.href = '/login';
      }
    } catch (error) {
      console.error('Error al cerrar sesiÃ³n:', error);
    }
  }, []);

  return {
    user: authState.user,
    isLoading: authState.isLoading,
    isAuthenticated: authState.isAuthenticated,
    login,
    register,
    logout,
    reload: loadUser,
  };
}
</code></pre>
<hr>
<h2>7. MODELOS Y RELACIONES DE DATOS</h2>
<h3>7.1 Diagrama Entidad-RelaciÃ³n</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ESQUEMA DE BASE DE DATOS                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      USER        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)        â”‚
â”‚ â€¢ username (UQ)  â”‚
â”‚ â€¢ email (UQ)     â”‚
â”‚ â€¢ full_name      â”‚
â”‚ â€¢ hashed_passwordâ”‚
â”‚ â€¢ is_active      â”‚
â”‚ â€¢ is_superuser   â”‚
â”‚ â€¢ is_verified    â”‚
â”‚ â€¢ created_at     â”‚
â”‚ â€¢ updated_at     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ 1
        â”‚ owns
        â”‚ N
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PROJECT      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)        â”‚
â”‚ â€¢ name           â”‚
â”‚ â€¢ description    â”‚
â”‚ â€¢ is_active      â”‚
â”‚ â€¢ owner_id (FK)  â”‚â—„â”€â”€â”€â”€â”€â”
â”‚ â€¢ created_at     â”‚      â”‚ references
â”‚ â€¢ updated_at     â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
        â”‚ 1               â”‚
        â”‚ contains        â”‚
        â”‚ N               â”‚
        â–¼                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚      TASK        â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚ â€¢ id (PK)        â”‚      â”‚
â”‚ â€¢ title          â”‚      â”‚
â”‚ â€¢ description    â”‚      â”‚
â”‚ â€¢ status         â”‚      â”‚
â”‚ â€¢ priority       â”‚      â”‚
â”‚ â€¢ due_date       â”‚      â”‚
â”‚ â€¢ project_id (FK)â”‚â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ assigned_to_id â”‚â”€â”€â”€â”€â”€â”
â”‚ â€¢ created_at     â”‚     â”‚ references USER
â”‚ â€¢ updated_at     â”‚     â”‚ (optional)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
        â”‚ N               â”‚
        â”‚ tagged with     â”‚
        â”‚ M               â–¼
        â–¼              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    (implicit)    â”‚
â”‚    TASK_TAG      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (junction table)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ task_id (FK,PK)â”‚
â”‚ â€¢ tag_id (FK,PK) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ M
        â”‚ references
        â”‚ 1
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       TAG        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)        â”‚
â”‚ â€¢ name (UQ)      â”‚
â”‚ â€¢ color          â”‚
â”‚ â€¢ created_at     â”‚
â”‚ â€¢ updated_at     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LEYENDA:
PK  = Primary Key
FK  = Foreign Key
UQ  = Unique Constraint
1   = RelaciÃ³n uno
N   = RelaciÃ³n muchos
M   = RelaciÃ³n muchos (en N:M)
</code></pre>
<h3>7.2 Tipos de Relaciones Implementadas</h3>
<h4>RelaciÃ³n 1:N (Uno a Muchos)</h4>
<p><strong>User â†’ Projects</strong></p>
<ul>
<li>Un usuario puede tener mÃºltiples proyectos</li>
<li>Cada proyecto pertenece a un Ãºnico usuario (owner)</li>
<li>Cascade: Al eliminar usuario, se eliminan sus proyectos</li>
</ul>
<p><strong>Project â†’ Tasks</strong></p>
<ul>
<li>Un proyecto contiene mÃºltiples tareas</li>
<li>Cada tarea pertenece a un Ãºnico proyecto</li>
<li>Cascade: Al eliminar proyecto, se eliminan sus tareas</li>
</ul>
<h4>RelaciÃ³n N:1 (Muchos a Uno - Opcional)</h4>
<p><strong>Task â†’ User (assigned_to)</strong></p>
<ul>
<li>Una tarea puede estar asignada a un usuario (o ninguno)</li>
<li>Un usuario puede tener mÃºltiples tareas asignadas</li>
<li>ON DELETE SET NULL: Al eliminar usuario, las tareas quedan sin asignar</li>
</ul>
<h4>RelaciÃ³n N:M (Muchos a Muchos)</h4>
<p><strong>Task â†” Tag</strong></p>
<ul>
<li>Una tarea puede tener mÃºltiples tags</li>
<li>Un tag puede estar en mÃºltiples tareas</li>
<li>Tabla intermedia: task_tags</li>
<li>Cascade en ambas direcciones</li>
</ul>
<h3>7.3 CÃ³digo de Modelos Completo</h3>
<p>Ya documentado en la secciÃ³n del DOCUMENTO 1 (Video 5).</p>
<hr>
<h2>8. IMPLEMENTACIÃ“N DE WEBSOCKETS</h2>
<h3>8.1 Conceptos de WebSockets</h3>
<p><strong>Â¿QuÃ© son los WebSockets?</strong></p>
<ul>
<li>Protocolo de comunicaciÃ³n bidireccional full-duplex</li>
<li>ConexiÃ³n persistente entre cliente y servidor</li>
<li>Ideal para aplicaciones en tiempo real</li>
<li>Baja latencia comparado con polling HTTP</li>
</ul>
<p><strong>Casos de uso en este proyecto</strong>:</p>
<ul>
<li>Notificaciones de cambios en proyectos/tareas</li>
<li>Actualizaciones en tiempo real del dashboard</li>
<li>Chat o mensajerÃ­a entre usuarios</li>
<li>SincronizaciÃ³n de estado entre clientes</li>
</ul>
<h3>8.2 Backend: WebSocket Manager</h3>
<p><strong>services/websocket_service.py</strong>:</p>
<pre><code class="language-python">from typing import Set, Dict
from fastapi import WebSocket, WebSocketDisconnect
import json
from datetime import datetime

class ConnectionManager:
    &quot;&quot;&quot;
    Gestor de conexiones WebSocket
    &quot;&quot;&quot;
    def __init__(self):
        # Almacenar conexiones activas por user_id
        self.active_connections: Dict[int, Set[WebSocket]] = {}
    
    async def connect(self, websocket: WebSocket, user_id: int):
        &quot;&quot;&quot;Conectar cliente WebSocket&quot;&quot;&quot;
        await websocket.accept()
        
        if user_id not in self.active_connections:
            self.active_connections[user_id] = set()
        
        self.active_connections[user_id].add(websocket)
        print(f&quot;âœ… Usuario {user_id} conectado. Total conexiones: {self.get_connection_count()}&quot;)
    
    def disconnect(self, websocket: WebSocket, user_id: int):
        &quot;&quot;&quot;Desconectar cliente WebSocket&quot;&quot;&quot;
        if user_id in self.active_connections:
            self.active_connections[user_id].discard(websocket)
            
            # Limpiar si no hay mÃ¡s conexiones
            if not self.active_connections[user_id]:
                del self.active_connections[user_id]
        
        print(f&quot;âŒ Usuario {user_id} desconectado. Total conexiones: {self.get_connection_count()}&quot;)
    
    async def send_personal_message(self, message: dict, user_id: int):
        &quot;&quot;&quot;Enviar mensaje a un usuario especÃ­fico&quot;&quot;&quot;
        if user_id in self.active_connections:
            message_json = json.dumps(message)
            for connection in list(self.active_connections[user_id]):
                try:
                    await connection.send_text(message_json)
                except Exception as e:
                    print(f&quot;Error enviando mensaje a usuario {user_id}: {e}&quot;)
                    self.disconnect(connection, user_id)
    
    async def broadcast(self, message: dict, exclude_user: int = None):
        &quot;&quot;&quot;
        Broadcast mensaje a todos los usuarios conectados
        Opcionalmente excluir un usuario especÃ­fico
        &quot;&quot;&quot;
        message_json = json.dumps(message)
        
        for user_id, connections in list(self.active_connections.items()):
            if exclude_user and user_id == exclude_user:
                continue
            
            for connection in list(connections):
                try:
                    await connection.send_text(message_json)
                except Exception as e:
                    print(f&quot;Error en broadcast a usuario {user_id}: {e}&quot;)
                    self.disconnect(connection, user_id)
    
    async def broadcast_to_project_members(self, message: dict, project_id: int, db):
        &quot;&quot;&quot;
        Broadcast a usuarios de un proyecto especÃ­fico
        &quot;&quot;&quot;
        # AquÃ­ implementarÃ­as lÃ³gica para obtener miembros del proyecto
        # y enviar solo a ellos
        pass
    
    def get_connection_count(self) -&gt; int:
        &quot;&quot;&quot;Obtener nÃºmero total de conexiones&quot;&quot;&quot;
        return sum(len(connections) for connections in self.active_connections.values())
    
    def get_connected_users(self) -&gt; list:
        &quot;&quot;&quot;Obtener lista de user_ids conectados&quot;&quot;&quot;
        return list(self.active_connections.keys())

# Instancia global del manager
websocket_manager = ConnectionManager()
</code></pre>
<p><strong>Endpoint WebSocket (api/v1/endpoints/websocket.py)</strong>:</p>
<pre><code class="language-python">from fastapi import APIRouter, WebSocket, WebSocketDisconnect, Depends
from sqlalchemy.orm import Session
from app.api import deps
from app.services.websocket_service import websocket_manager
from app.core.security import decode_token
import json

router = APIRouter()

@router.websocket(&quot;/ws/{token}&quot;)
async def websocket_endpoint(
    websocket: WebSocket,
    token: str,
    db: Session = Depends(deps.get_db)
):
    &quot;&quot;&quot;
    Endpoint WebSocket para comunicaciÃ³n en tiempo real
    
    Cliente debe proveer token JWT en la URL
    &quot;&quot;&quot;
    # Validar token
    payload = decode_token(token)
    if not payload:
        await websocket.close(code=1008)  # Policy violation
        return
    
    user_id = int(payload.get(&quot;sub&quot;))
    
    # Conectar
    await websocket_manager.connect(websocket, user_id)
    
    try:
        # Enviar mensaje de bienvenida
        await websocket.send_json({
            &quot;type&quot;: &quot;connection&quot;,
            &quot;message&quot;: &quot;Conectado exitosamente&quot;,
            &quot;user_id&quot;: user_id,
            &quot;timestamp&quot;: datetime.utcnow().isoformat()
        })
        
        # Loop para recibir mensajes
        while True:
            # Recibir mensaje del cliente
            data = await websocket.receive_text()
            message_data = json.loads(data)
            
            # Procesar segÃºn tipo de mensaje
            message_type = message_data.get(&quot;type&quot;)
            
            if message_type == &quot;ping&quot;:
                # Responder pong
                await websocket.send_json({
                    &quot;type&quot;: &quot;pong&quot;,
                    &quot;timestamp&quot;: datetime.utcnow().isoformat()
                })
            
            elif message_type == &quot;broadcast&quot;:
                # Broadcast a todos
                await websocket_manager.broadcast({
                    &quot;type&quot;: &quot;message&quot;,
                    &quot;user_id&quot;: user_id,
                    &quot;content&quot;: message_data.get(&quot;content&quot;),
                    &quot;timestamp&quot;: datetime.utcnow().isoformat()
                })
            
            elif message_type == &quot;notification&quot;:
                # AquÃ­ se manejarÃ­an notificaciones especÃ­ficas
                pass
    
    except WebSocketDisconnect:
        websocket_manager.disconnect(websocket, user_id)
    except Exception as e:
        print(f&quot;Error en WebSocket para usuario {user_id}: {e}&quot;)
        websocket_manager.disconnect(websocket, user_id)
</code></pre>
<h3>8.3 Frontend: Hook de WebSocket</h3>
<p><strong>hooks/useWebSocket.ts</strong>:</p>
<pre><code class="language-typescript">import { useEffect, useRef, useState, useCallback } from 'react';

interface WebSocketMessage {
  type: string;
  [key: string]: any;
}

interface UseWebSocketOptions {
  onMessage?: (message: WebSocketMessage) =&gt; void;
  onOpen?: () =&gt; void;
  onClose?: () =&gt; void;
  onError?: (error: Event) =&gt; void;
  reconnectInterval?: number;
  maxReconnectAttempts?: number;
}

export function useWebSocket(token: string | null, options: UseWebSocketOptions = {}) {
  const {
    onMessage,
    onOpen,
    onClose,
    onError,
    reconnectInterval = 3000,
    maxReconnectAttempts = 5,
  } = options;

  const [isConnected, setIsConnected] = useState(false);
  const [reconnectCount, setReconnectCount] = useState(0);
  const ws = useRef&lt;WebSocket | null&gt;(null);
  const reconnectTimer = useRef&lt;NodeJS.Timeout | null&gt;(null);

  const connect = useCallback(() =&gt; {
    if (!token || ws.current?.readyState === WebSocket.OPEN) {
      return;
    }

    const wsUrl = `${process.env.NEXT_PUBLIC_WS_URL}/${token}`;
    console.log('ğŸ”Œ Conectando WebSocket...');
    
    ws.current = new WebSocket(wsUrl);

    ws.current.onopen = () =&gt; {
      console.log('âœ… WebSocket conectado');
      setIsConnected(true);
      setReconnectCount(0);
      onOpen?.();
    };

    ws.current.onmessage = (event) =&gt; {
      try {
        const message: WebSocketMessage = JSON.parse(event.data);
        console.log('ğŸ“¨ Mensaje recibido:', message);
        onMessage?.(message);
      } catch (error) {
        console.error('Error parseando mensaje:', error);
      }
    };

    ws.current.onclose = () =&gt; {
      console.log('ğŸ”Œ WebSocket desconectado');
      setIsConnected(false);
      onClose?.();

      // Intentar reconectar
      if (reconnectCount &lt; maxReconnectAttempts) {
        reconnectTimer.current = setTimeout(() =&gt; {
          console.log(`ğŸ”„ Intentando reconectar (${reconnectCount + 1}/${maxReconnectAttempts})...`);
          setReconnectCount(prev =&gt; prev + 1);
          connect();
        }, reconnectInterval);
      }
    };

    ws.current.onerror = (error) =&gt; {
      console.error('âŒ Error en WebSocket:', error);
      onError?.(error);
    };
  }, [token, reconnectCount, onMessage, onOpen, onClose, onError, reconnectInterval, maxReconnectAttempts]);

  // Conectar al montar o cuando cambie el token
  useEffect(() =&gt; {
    connect();

    // Cleanup al desmontar
    return () =&gt; {
      if (reconnectTimer.current) {
        clearTimeout(reconnectTimer.current);
      }
      if (ws.current) {
        ws.current.close();
      }
    };
  }, [connect]);

  // FunciÃ³n para enviar mensajes
  const sendMessage = useCallback((message: WebSocketMessage) =&gt; {
    if (ws.current?.readyState === WebSocket.OPEN) {
      ws.current.send(JSON.stringify(message));
      console.log('ğŸ“¤ Mensaje enviado:', message);
    } else {
      console.warn('âš ï¸ WebSocket no estÃ¡ conectado');
    }
  }, []);

  // FunciÃ³n para cerrar manualmente
  const disconnect = useCallback(() =&gt; {
    if (reconnectTimer.current) {
      clearTimeout(reconnectTimer.current);
    }
    ws.current?.close();
  }, []);

  // Heartbeat (ping/pong)
  useEffect(() =&gt; {
    if (!isConnected) return;

    const pingInterval = setInterval(() =&gt; {
      sendMessage({ type: 'ping' });
    }, 30000); // cada 30 segundos

    return () =&gt; clearInterval(pingInterval);
  }, [isConnected, sendMessage]);

  return {
    isConnected,
    sendMessage,
    disconnect,
    reconnect: connect,
  };
}
</code></pre>
<h3>8.4 Uso en Componentes</h3>
<p><strong>Ejemplo de uso en Dashboard</strong>:</p>
<pre><code class="language-typescript">'use client';

import { useAuth } from '@/hooks/useAuth';
import { useWebSocket } from '@/hooks/useWebSocket';
import { useEffect, useState } from 'react';
import { toast } from '@/components/ui/use-toast';

export default function Dashboard() {
  const { user } = useAuth();
  const [notifications, setNotifications] = useState&lt;any[]&gt;([]);
  
  // Obtener token (simplificado, en producciÃ³n usar estado global)
  const [token, setToken] = useState&lt;string | null&gt;(null);
  
  useEffect(() =&gt; {
    // AquÃ­ obtendrÃ­as el token del estado de autenticaciÃ³n
    // setToken(authToken);
  }, []);

  const { isConnected, sendMessage } = useWebSocket(token, {
    onMessage: (message) =&gt; {
      console.log('Mensaje recibido:', message);
      
      switch (message.type) {
        case 'notification':
          setNotifications(prev =&gt; [...prev, message]);
          toast({
            title: 'Nueva notificaciÃ³n',
            description: message.content,
          });
          break;
        
        case 'task_updated':
          // Actualizar UI con nueva informaciÃ³n de tarea
          break;
        
        case 'project_updated':
          // Actualizar UI con nueva informaciÃ³n de proyecto
          break;
      }
    },
    
    onOpen: () =&gt; {
      console.log('WebSocket conectado');
      toast({
        title: 'Conectado',
        description: 'Actualizaciones en tiempo real activadas',
      });
    },
    
    onClose: () =&gt; {
      console.log('WebSocket desconectado');
    },
  });

  return (
    &lt;div&gt;
      &lt;div className=&quot;flex items-center gap-2&quot;&gt;
        &lt;div className={`h-2 w-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-red-500'}`} /&gt;
        &lt;span&gt;{isConnected ? 'Conectado' : 'Desconectado'}&lt;/span&gt;
      &lt;/div&gt;
      
      {/* Rest of dashboard */}
    &lt;/div&gt;
  );
}
</code></pre>
<hr>
<h2>9. AUTENTICACIÃ“N Y SEGURIDAD</h2>
<h3>9.1 Flujo de AutenticaciÃ³n Completo</h3>
<pre><code>1. REGISTRO
   Usuario â†’ Frontend: Completa formulario de registro
   Frontend: Valida datos localmente
   Frontend â†’ Backend: POST /api/v1/auth/register
   Backend: Valida datos con Pydantic
   Backend: Hash de contraseÃ±a con bcrypt
   Backend: Crea usuario en BD
   Backend â†’ Frontend: Usuario creado (sin login automÃ¡tico)
   Frontend: Redirige a pÃ¡gina de login

2. LOGIN
   Usuario â†’ Frontend: Ingresa email y contraseÃ±a
   Frontend â†’ Backend: POST /api/v1/auth/login (OAuth2PasswordRequestForm)
   Backend: Busca usuario por email
   Backend: Verifica contraseÃ±a con bcrypt
   Backend: Genera JWT access token (30 min)
   Backend: Genera JWT refresh token (7 dÃ­as)
   Backend: Set-Cookie con tokens (HttpOnly, Secure, SameSite=Strict)
   Backend â†’ Frontend: Tokens en cookies + respuesta JSON
   Frontend: Guarda estado de autenticaciÃ³n
   Frontend: Redirige a dashboard

3. ACCESO A RECURSOS PROTEGIDOS
   Frontend â†’ Backend: GET /api/v1/users/me (cookie enviada automÃ¡ticamente)
   Backend: Extrae token de cookie
   Backend: Valida y decodifica JWT
   Backend: Obtiene user_id del payload
   Backend: Busca usuario en BD
   Backend: Verifica que usuario estÃ© activo
   Backend â†’ Frontend: Datos del usuario
   Frontend: Actualiza UI

4. REFRESH TOKEN (RenovaciÃ³n)
   Frontend: Detecta que access token expirÃ³
   Frontend â†’ Backend: POST /api/v1/auth/refresh (refresh token en cookie)
   Backend: Valida refresh token
   Backend: Genera nuevo access token
   Backend: Set-Cookie con nuevo access token
   Backend â†’ Frontend: Nuevo token
   Frontend: Reintenta request original

5. LOGOUT
   Usuario â†’ Frontend: Click en logout
   Frontend â†’ Backend: POST /api/v1/auth/logout
   Backend: Delete-Cookie (access_token y refresh_token)
   Backend â†’ Frontend: ConfirmaciÃ³n
   Frontend: Limpia estado de autenticaciÃ³n
   Frontend: Redirige a login
</code></pre>
<h3>9.2 Seguridad Implementada</h3>
<h4>Hashing de ContraseÃ±as</h4>
<ul>
<li><strong>Algoritmo</strong>: bcrypt</li>
<li><strong>Rounds</strong>: 12 (por defecto en passlib)</li>
<li><strong>Salting</strong>: AutomÃ¡tico en bcrypt</li>
<li><strong>Nunca</strong> almacenar contraseÃ±as en texto plano</li>
</ul>
<h4>JSON Web Tokens (JWT)</h4>
<ul>
<li><strong>Algoritmo</strong>: HS256 (HMAC-SHA256)</li>
<li><strong>Secret Key</strong>: 256 bits generado aleatoriamente</li>
<li><strong>Claims incluidos</strong>:
<ul>
<li><code>sub</code>: User ID</li>
<li><code>iat</code>: Issued At (timestamp)</li>
<li><code>exp</code>: Expiration (timestamp)</li>
<li><code>type</code>: &quot;access&quot; o &quot;refresh&quot;</li>
</ul>
</li>
</ul>
<h4>Cookies Seguras</h4>
<ul>
<li><strong>HttpOnly</strong>: true - No accesible desde JavaScript</li>
<li><strong>Secure</strong>: true en producciÃ³n - Solo HTTPS</li>
<li><strong>SameSite</strong>: Strict - Previene CSRF</li>
<li><strong>Max-Age</strong>: Basado en tipo de token</li>
</ul>
<h4>CORS (Cross-Origin Resource Sharing)</h4>
<ul>
<li>Origins permitidos configurados explÃ­citamente</li>
<li>Credentials: true para permitir cookies</li>
<li>Methods: Solo los necesarios</li>
<li>Headers: Configurados apropiadamente</li>
</ul>
<h4>ValidaciÃ³n de Entrada</h4>
<ul>
<li><strong>Backend</strong>: Pydantic schemas con validaciones</li>
<li><strong>Frontend</strong>: Zod + react-hook-form</li>
<li>ValidaciÃ³n de tipos, longitudes, formatos</li>
<li>SanitizaciÃ³n de datos</li>
</ul>
<h4>SQL Injection Prevention</h4>
<ul>
<li>SQLAlchemy ORM previene inyecciÃ³n SQL</li>
<li>Uso de parÃ¡metros preparados</li>
<li>Nunca concatenar strings en queries</li>
</ul>
<h3>9.3 Mejores PrÃ¡cticas de Seguridad</h3>
<ol>
<li>
<p><strong>Variables de Entorno</strong></p>
<ul>
<li>Nunca commitear archivos <code>.env</code></li>
<li>Usar secretos diferentes por entorno</li>
<li>Rotar secretos periÃ³dicamente</li>
</ul>
</li>
<li>
<p><strong>HTTPS en ProducciÃ³n</strong></p>
<ul>
<li>Forzar HTTPS</li>
<li>HSTS headers</li>
<li>Certificados SSL/TLS vÃ¡lidos</li>
</ul>
</li>
<li>
<p><strong>Rate Limiting</strong></p>
<ul>
<li>Limitar intentos de login</li>
<li>Prevenir brute force attacks</li>
<li>Usar herramientas como slowapi</li>
</ul>
</li>
<li>
<p><strong>Logging y Monitoreo</strong></p>
<ul>
<li>Log de intentos de autenticaciÃ³n</li>
<li>Alertas de actividad sospechosa</li>
<li>No logear informaciÃ³n sensible</li>
</ul>
</li>
<li>
<p><strong>Dependency Updates</strong></p>
<ul>
<li>Mantener dependencias actualizadas</li>
<li>Escanear vulnerabilidades (Snyk, Dependabot)</li>
<li>Aplicar parches de seguridad</li>
</ul>
</li>
</ol>
<hr>
<h2>10. MEJORES PRÃCTICAS APLICADAS</h2>
<h3>10.1 Arquitectura y DiseÃ±o</h3>
<p>âœ… <strong>Clean Architecture</strong>: SeparaciÃ³n clara en capas
âœ… <strong>SOLID Principles</strong>: CÃ³digo mantenible y extensible
âœ… <strong>DRY (Don't Repeat Yourself)</strong>: ReutilizaciÃ³n de cÃ³digo
âœ… <strong>Separation of Concerns</strong>: Cada mÃ³dulo una responsabilidad
âœ… <strong>Dependency Injection</strong>: CÃ³digo desacoplado y testeable</p>
<h3>10.2 Desarrollo</h3>
<p>âœ… <strong>Type Safety</strong>: Python type hints + TypeScript
âœ… <strong>ValidaciÃ³n de Datos</strong>: Pydantic + Zod
âœ… <strong>Error Handling</strong>: Excepciones personalizadas y manejo centralizado
âœ… <strong>Async/Await</strong>: Operaciones asÃ­ncronas para mejor rendimiento
âœ… <strong>Code Style</strong>: Black, isort, Prettier, ESLint</p>
<h3>10.3 Base de Datos</h3>
<p>âœ… <strong>ORM</strong>: SQLAlchemy para abstracciÃ³n de BD
âœ… <strong>Migraciones</strong>: Alembic para control de versiones de esquema
âœ… <strong>Relaciones</strong>: Foreign keys, constraints, Ã­ndices apropiados
âœ… <strong>Transacciones</strong>: Manejo adecuado de commits y rollbacks
âœ… <strong>Connection Pooling</strong>: ReutilizaciÃ³n eficiente de conexiones</p>
<h3>10.4 Seguridad</h3>
<p>âœ… <strong>Authentication</strong>: JWT con cookies seguras
âœ… <strong>Password Hashing</strong>: bcrypt para contraseÃ±as
âœ… <strong>CORS</strong>: Configurado apropiadamente
âœ… <strong>Input Validation</strong>: ValidaciÃ³n exhaustiva de entrada
âœ… <strong>SQL Injection Prevention</strong>: ORM con parÃ¡metros preparados</p>
<h3>10.5 Testing</h3>
<p>âœ… <strong>Unit Tests</strong>: Pruebas de componentes individuales
âœ… <strong>Integration Tests</strong>: Pruebas de flujos completos
âœ… <strong>Mocking</strong>: Mockear dependencias externas
âœ… <strong>Coverage</strong>: Medir cobertura de cÃ³digo
âœ… <strong>CI/CD</strong>: IntegraciÃ³n continua con tests automÃ¡ticos</p>
<h3>10.6 DocumentaciÃ³n</h3>
<p>âœ… <strong>API Documentation</strong>: OpenAPI/Swagger automÃ¡tico
âœ… <strong>Code Comments</strong>: Comentarios donde sea necesario
âœ… <strong>Type Hints</strong>: DocumentaciÃ³n implÃ­cita con tipos
âœ… <strong>README</strong>: Instrucciones claras de instalaciÃ³n y uso
âœ… <strong>Architecture Docs</strong>: DocumentaciÃ³n de diseÃ±o</p>
<h3>10.7 DevOps</h3>
<p>âœ… <strong>Containerization</strong>: Docker/Podman para portabilidad
âœ… <strong>Environment Variables</strong>: ConfiguraciÃ³n externa
âœ… <strong>Logging</strong>: Logs estructurados y Ãºtiles
âœ… <strong>Health Checks</strong>: Endpoints de monitoreo
âœ… <strong>Graceful Shutdown</strong>: Manejo apropiado de seÃ±ales</p>
<hr>
<h2>11. REFERENCIAS CRUZADAS ENTRE EPISODIOS</h2>
<h3>Video 1 â†’ Videos posteriores</h3>
<ul>
<li><strong>Arquitectura presentada</strong> â†’ Implementada en Videos 2-5</li>
<li><strong>Stack tecnolÃ³gico</strong> â†’ Configurado en Videos 2-3</li>
<li><strong>CaracterÃ­sticas clave</strong> â†’ Desarrolladas progresivamente</li>
</ul>
<h3>Video 2 â†’ Videos 3, 4, 5</h3>
<ul>
<li><strong>Backend bÃ¡sico</strong> â†’ Consumido por Frontend (Video 3)</li>
<li><strong>Estructura inicial</strong> â†’ Refactorizada (Video 4)</li>
<li><strong>SQLAlchemy setup</strong> â†’ Modelos creados (Video 5)</li>
</ul>
<h3>Video 3 â†’ Videos 4, 5</h3>
<ul>
<li><strong>Frontend configurado</strong> â†’ Integrado con Backend mejorado</li>
<li><strong>Cliente API</strong> â†’ Consume endpoints expandidos</li>
<li><strong>Componentes UI</strong> â†’ Utilizan datos de modelos</li>
</ul>
<h3>Video 4 â†’ Video 5</h3>
<ul>
<li><strong>Arquitectura en capas</strong> â†’ Facilita implementaciÃ³n de modelos</li>
<li><strong>Repositorios</strong> â†’ Extendidos para nuevas entidades</li>
<li><strong>Servicios</strong> â†’ Implementan lÃ³gica de modelos complejos</li>
</ul>
<h3>Video 5 â†’ Siguientes episodios</h3>
<ul>
<li><strong>Modelos completos</strong> â†’ Base para CRUD completo</li>
<li><strong>Relaciones</strong> â†’ Queries complejas y joins</li>
<li><strong>Migraciones</strong> â†’ Esquema versionado y actualizable</li>
</ul>
<h3>ProgresiÃ³n Natural del Curso</h3>
<pre><code>1. VisiÃ³n General (Video 1)
   â†“
2. Backend BÃ¡sico (Video 2)
   â†“
3. Frontend BÃ¡sico (Video 3)
   â†“
4. RefactorizaciÃ³n Profesional (Video 4)
   â†“
5. Modelos y Relaciones Complejas (Video 5)
   â†“
[Episodios Futuros]
   â†“
6. CRUD Completo para todas las entidades
7. ImplementaciÃ³n completa de WebSockets
8. Sistema de autenticaciÃ³n completo
9. Testing comprehensivo
10. Despliegue en producciÃ³n
</code></pre>
<hr>
<h2>ğŸ“š RECURSOS ADICIONALES</h2>
<h3>DocumentaciÃ³n Oficial</h3>
<ul>
<li><strong>FastAPI</strong>: https://fastapi.tiangolo.com/</li>
<li><strong>Next.js</strong>: https://nextjs.org/docs</li>
<li><strong>PostgreSQL</strong>: https://www.postgresql.org/docs/</li>
<li><strong>SQLAlchemy</strong>: https://docs.sqlalchemy.org/</li>
<li><strong>Pydantic</strong>: https://docs.pydantic.dev/</li>
<li><strong>Docker</strong>: https://docs.docker.com/</li>
</ul>
<h3>Herramientas</h3>
<ul>
<li><strong>Swagger Editor</strong>: https://editor.swagger.io/</li>
<li><strong>Postman</strong>: https://www.postman.com/</li>
<li><strong>DBeaver</strong>: https://dbeaver.io/ (cliente PostgreSQL)</li>
<li><strong>VS Code Extensions</strong>:
<ul>
<li>Python</li>
<li>Pylance</li>
<li>ES7+ React/Redux/React-Native snippets</li>
<li>Tailwind CSS IntelliSense</li>
</ul>
</li>
</ul>
<h3>Comunidad</h3>
<ul>
<li><strong>FastAPI Discord</strong>: https://discord.gg/VQjSZaeJmf</li>
<li><strong>Next.js Discord</strong>: https://nextjs.org/discord</li>
<li><strong>Stack Overflow</strong>: Etiquetas #fastapi #nextjs</li>
</ul>
<hr>
<p><em>Fin del Documento 2</em></p>
<h2>--------------------------------------------------</h2>
<hr>
<h2>DOCUMENTO 3: RESUMEN ESTRUCTURADO POR EPISODIO</h2>
<h1>DOCUMENTO 3: RESUMEN ESTRUCTURADO POR EPISODIO</h1>
<h2>Serie: AplicaciÃ³n Full Stack con FastAPI y Next.js</h2>
<h3>Canal: CÃ³digo para Principiantes</h3>
<hr>
<h2>ğŸ“‹ ÃNDICE DE EPISODIOS</h2>
<ol>
<li><a href="#episodio-1-introducci%C3%B3n-al-proyecto-full-stack">Episodio 1: IntroducciÃ³n al Proyecto Full Stack</a></li>
<li><a href="#episodio-2-preparaci%C3%B3n-del-backend-con-fastapi">Episodio 2: PreparaciÃ³n del Backend con FastAPI</a></li>
<li><a href="#episodio-3-configuraci%C3%B3n-del-frontend-con-nextjs">Episodio 3: ConfiguraciÃ³n del Frontend con Next.js</a></li>
<li><a href="#episodio-4-reorganizaci%C3%B3n-profesional-del-backend">Episodio 4: ReorganizaciÃ³n Profesional del Backend</a></li>
<li><a href="#episodio-5-creaci%C3%B3n-de-modelos-y-relaciones">Episodio 5: CreaciÃ³n de Modelos y Relaciones</a></li>
</ol>
<hr>
<h2>EPISODIO 1: IntroducciÃ³n al Proyecto Full Stack</h2>
<h3>ğŸ“Š InformaciÃ³n del Video</h3>
<ul>
<li><strong>TÃ­tulo</strong>: FastAPI y Next.js: Crea una App Full Stack Real (con WebSockets)</li>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=5oNktUuWBMY</li>
<li><strong>DuraciÃ³n</strong>: 10:13 minutos</li>
<li><strong>Vistas</strong>: 650</li>
<li><strong>Publicado</strong>: Hace 3 meses</li>
</ul>
<h3>ğŸ“ Resumen Ejecutivo</h3>
<p>Este episodio inaugural establece las bases del proyecto Full Stack, presentando la visiÃ³n general de la aplicaciÃ³n que se construirÃ¡ a lo largo de la serie. El instructor introduce el stack tecnolÃ³gico completo (FastAPI, Next.js, PostgreSQL y Podman), explica la arquitectura del sistema y destaca las caracterÃ­sticas principales que hacen de este un proyecto profesional y real, no solo un tutorial bÃ¡sico.</p>
<p>El enfoque estÃ¡ en proporcionar un roadmap claro del curso, motivar a los estudiantes mostrando el alcance del proyecto final, y establecer expectativas sobre lo que aprenderÃ¡n: desde la configuraciÃ³n bÃ¡sica hasta la implementaciÃ³n de caracterÃ­sticas avanzadas como WebSockets y autenticaciÃ³n segura con JWT.</p>
<h3>ğŸ¯ Objetivos del Episodio</h3>
<p><strong>Objetivo Principal</strong>: Presentar la visiÃ³n completa del proyecto y el plan de la serie</p>
<p><strong>Objetivos EspecÃ­ficos</strong>:</p>
<ol>
<li>âœ… Introducir el stack tecnolÃ³gico (FastAPI + Next.js + PostgreSQL + Podman)</li>
<li>âœ… Explicar la arquitectura general de la aplicaciÃ³n</li>
<li>âœ… Destacar caracterÃ­sticas clave: WebSockets y autenticaciÃ³n segura</li>
<li>âœ… Motivar el aprendizaje mostrando un proyecto real</li>
<li>âœ… Establecer el roadmap de episodios futuros</li>
</ol>
<h3>ğŸ”‘ Puntos Clave TÃ©cnicos</h3>
<h4>1. Stack TecnolÃ³gico Presentado</h4>
<p><strong>Backend: FastAPI</strong></p>
<ul>
<li>Framework Python moderno y de alto rendimiento</li>
<li>Basado en estÃ¡ndares: OpenAPI y JSON Schema</li>
<li>DocumentaciÃ³n automÃ¡tica (Swagger UI)</li>
<li>ValidaciÃ³n de datos con Pydantic</li>
<li>Soporte nativo para async/await</li>
<li><strong>Ventaja principal</strong>: Desarrollo rÃ¡pido con alta calidad de cÃ³digo</li>
</ul>
<p><strong>Frontend: Next.js</strong></p>
<ul>
<li>Framework React con Server-Side Rendering</li>
<li>Enrutamiento automÃ¡tico basado en archivos</li>
<li>OptimizaciÃ³n de performance out-of-the-box</li>
<li>Excelente experiencia de desarrollo</li>
<li><strong>Ventaja principal</strong>: SEO mejorado y carga inicial rÃ¡pida</li>
</ul>
<p><strong>Base de Datos: PostgreSQL</strong></p>
<ul>
<li>Sistema de gestiÃ³n de BD relacional robusto</li>
<li>ACID compliance para transacciones confiables</li>
<li>Extensible y con gran ecosistema</li>
<li><strong>Ventaja principal</strong>: Confiabilidad en producciÃ³n</li>
</ul>
<p><strong>ContenedorizaciÃ³n: Podman</strong></p>
<ul>
<li>Alternativa a Docker sin daemon root</li>
<li>Mayor seguridad al no requerir privilegios de root</li>
<li>Compatible con comandos de Docker</li>
<li><strong>Ventaja principal</strong>: Seguridad mejorada en desarrollo y producciÃ³n</li>
</ul>
<h4>2. Arquitectura del Sistema</h4>
<p><strong>Modelo de Tres Capas</strong>:</p>
<pre><code>[Frontend - Next.js] â† HTTP/WebSocket â†’ [Backend - FastAPI] â† SQL â†’ [DB - PostgreSQL]
</code></pre>
<ul>
<li><strong>Capa de PresentaciÃ³n</strong>: Next.js maneja UI/UX</li>
<li><strong>Capa de LÃ³gica de Negocio</strong>: FastAPI procesa requests y lÃ³gica</li>
<li><strong>Capa de Datos</strong>: PostgreSQL persiste informaciÃ³n</li>
</ul>
<p><strong>ComunicaciÃ³n</strong>:</p>
<ul>
<li>REST API para operaciones CRUD</li>
<li>WebSockets para actualizaciones en tiempo real</li>
<li>JWT en cookies HttpOnly para autenticaciÃ³n</li>
</ul>
<h4>3. CaracterÃ­sticas Destacadas</h4>
<p><strong>WebSockets para Tiempo Real</strong>:</p>
<ul>
<li>ComunicaciÃ³n bidireccional y persistente</li>
<li>Ideal para notificaciones instantÃ¡neas</li>
<li>SincronizaciÃ³n de datos entre clientes</li>
<li>Baja latencia comparado con polling</li>
</ul>
<p><strong>AutenticaciÃ³n Segura</strong>:</p>
<ul>
<li>JSON Web Tokens (JWT) para stateless auth</li>
<li>Almacenamiento en cookies HttpOnly (no accesible desde JS)</li>
<li>Secure flag para transmisiÃ³n solo por HTTPS</li>
<li>SameSite=Strict para prevenir CSRF</li>
</ul>
<p><strong>ContainerizaciÃ³n Completa</strong>:</p>
<ul>
<li>Desarrollo en contenedores = producciÃ³n sin sorpresas</li>
<li>Aislamiento de dependencias</li>
<li>FÃ¡cil escalabilidad horizontal</li>
<li>Reproducibilidad del entorno</li>
</ul>
<h3>ğŸ’¼ TecnologÃ­as Utilizadas</h3>
<table>
<thead>
<tr>
<th>CategorÃ­a</th>
<th>TecnologÃ­a</th>
<th>VersiÃ³n</th>
<th>PropÃ³sito</th>
</tr>
</thead>
<tbody>
<tr>
<td>Backend Framework</td>
<td>FastAPI</td>
<td>Latest</td>
<td>API REST asÃ­ncrona</td>
</tr>
<tr>
<td>Frontend Framework</td>
<td>Next.js</td>
<td>14+</td>
<td>AplicaciÃ³n React con SSR</td>
</tr>
<tr>
<td>Base de Datos</td>
<td>PostgreSQL</td>
<td>15+</td>
<td>Persistencia relacional</td>
</tr>
<tr>
<td>Contenedores</td>
<td>Podman/Docker</td>
<td>Latest</td>
<td>Entorno consistente</td>
</tr>
<tr>
<td>Lenguaje Backend</td>
<td>Python</td>
<td>3.11+</td>
<td>LÃ³gica del servidor</td>
</tr>
<tr>
<td>Lenguaje Frontend</td>
<td>TypeScript</td>
<td>5+</td>
<td>Type safety en cliente</td>
</tr>
<tr>
<td>ORM</td>
<td>SQLAlchemy</td>
<td>2.0</td>
<td>InteracciÃ³n con BD</td>
</tr>
<tr>
<td>ValidaciÃ³n</td>
<td>Pydantic</td>
<td>2.0+</td>
<td>Schemas y validaciÃ³n</td>
</tr>
</tbody>
</table>
<h3>âœ… Resultados Alcanzados</h3>
<p>Al finalizar este episodio, los estudiantes han logrado:</p>
<ol>
<li>
<p><strong>ComprensiÃ³n Clara del Proyecto</strong>:</p>
<ul>
<li>Entienden quÃ© se va a construir</li>
<li>Conocen las tecnologÃ­as involucradas</li>
<li>Tienen expectativas realistas del alcance</li>
</ul>
</li>
<li>
<p><strong>MotivaciÃ³n Establecida</strong>:</p>
<ul>
<li>Ven el valor de un proyecto profesional</li>
<li>Comprenden las aplicaciones prÃ¡cticas</li>
<li>EstÃ¡n preparados para el compromiso de la serie</li>
</ul>
</li>
<li>
<p><strong>Contexto TÃ©cnico</strong>:</p>
<ul>
<li>Conocen las ventajas de cada tecnologÃ­a</li>
<li>Entienden por quÃ© se eligiÃ³ este stack</li>
<li>Ven cÃ³mo las piezas encajan juntas</li>
</ul>
</li>
<li>
<p><strong>Roadmap Mental</strong>:</p>
<ul>
<li>Saben quÃ© esperar en prÃ³ximos episodios</li>
<li>Entienden la progresiÃ³n del aprendizaje</li>
<li>Pueden planificar su tiempo de estudio</li>
</ul>
</li>
</ol>
<h3>ğŸ”— ConexiÃ³n con Episodios Previos/Siguientes</h3>
<p><strong>No hay episodios previos</strong> - Este es el inicio de la serie</p>
<p><strong>Prepara para</strong>:</p>
<ul>
<li><strong>Episodio 2</strong>: ImplementaciÃ³n prÃ¡ctica del backend presentado aquÃ­</li>
<li><strong>Episodio 3</strong>: ConfiguraciÃ³n del frontend para consumir el backend</li>
<li><strong>Episodios 4-5</strong>: Refinamiento y caracterÃ­sticas avanzadas</li>
</ul>
<p><strong>Conceptos que serÃ¡n expandidos</strong>:</p>
<ul>
<li>WebSockets: ImplementaciÃ³n completa en episodios posteriores</li>
<li>AutenticaciÃ³n JWT: CÃ³digo detallado en backend y frontend</li>
<li>Arquitectura: RefactorizaciÃ³n profesional en episodio 4</li>
<li>Base de datos: Modelado completo en episodio 5</li>
</ul>
<h3>ğŸ“Œ Notas Importantes</h3>
<blockquote>
<p><strong>Para Principiantes</strong>: Este episodio es principalmente conceptual. No te preocupes si no entiendes todos los tÃ©rminos tÃ©cnicos; se explicarÃ¡n con cÃ³digo en episodios posteriores.</p>
</blockquote>
<blockquote>
<p><strong>Requisito Previo</strong>: Conocimientos bÃ¡sicos de Python y JavaScript son recomendados, pero no estrictamente necesarios.</p>
</blockquote>
<blockquote>
<p><strong>Tiempo de Compromiso</strong>: La serie completa requiere seguimiento constante y prÃ¡ctica. Reserva tiempo para codificar junto con los videos.</p>
</blockquote>
<h3>ğŸ¬ Estructura del Episodio</h3>
<pre><code>[00:00-02:00] â†’ IntroducciÃ³n y bienvenida
[02:00-04:00] â†’ PresentaciÃ³n del stack tecnolÃ³gico
[04:00-06:30] â†’ Arquitectura y diseÃ±o del sistema
[06:30-08:30] â†’ CaracterÃ­sticas principales: WebSockets y auth
[08:30-10:13] â†’ Roadmap y conclusiÃ³n
</code></pre>
<hr>
<h2>EPISODIO 2: PreparaciÃ³n del Backend con FastAPI</h2>
<h3>ğŸ“Š InformaciÃ³n del Video</h3>
<ul>
<li><strong>TÃ­tulo</strong>: FastAPI y Next.js: Preparamos el Backend | Curso App Full Stack #2</li>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=fNgmKHZ1HJU</li>
<li><strong>DuraciÃ³n</strong>: 43:31 minutos â­ (El mÃ¡s largo de la serie)</li>
<li><strong>Vistas</strong>: 538</li>
<li><strong>Publicado</strong>: Hace 3 meses</li>
</ul>
<h3>ğŸ“ Resumen Ejecutivo</h3>
<p>Este episodio marca el inicio de la implementaciÃ³n prÃ¡ctica, siendo el mÃ¡s extenso y detallado de la serie. El instructor guÃ­a paso a paso la configuraciÃ³n completa del backend con FastAPI, desde la instalaciÃ³n de dependencias hasta la creaciÃ³n de un contenedor Docker funcional. Se establece la estructura base del proyecto, se configura la conexiÃ³n a PostgreSQL, se implementan endpoints de prueba y se introduce el concepto de documentaciÃ³n automÃ¡tica con Swagger UI.</p>
<p>Es un episodio fundamental que sienta las bases tÃ©cnicas sobre las cuales se construirÃ¡ todo el backend. Se presta especial atenciÃ³n a las mejores prÃ¡cticas desde el inicio, como el uso de variables de entorno, la organizaciÃ³n modular del cÃ³digo y la configuraciÃ³n apropiada del servidor ASGI con Uvicorn.</p>
<h3>ğŸ¯ Objetivos del Episodio</h3>
<p><strong>Objetivo Principal</strong>: Configurar un backend FastAPI funcional y profesional desde cero</p>
<p><strong>Objetivos EspecÃ­ficos</strong>:</p>
<ol>
<li>âœ… Instalar Python 3.11+ y crear entorno virtual</li>
<li>âœ… Instalar FastAPI, Uvicorn y todas las dependencias necesarias</li>
<li>âœ… Crear la estructura inicial del proyecto backend</li>
<li>âœ… Configurar PostgreSQL y establecer conexiÃ³n con SQLAlchemy</li>
<li>âœ… Implementar configuraciÃ³n con variables de entorno</li>
<li>âœ… Crear la aplicaciÃ³n FastAPI con middleware CORS</li>
<li>âœ… Implementar endpoints bÃ¡sicos de prueba y health check</li>
<li>âœ… Configurar Dockerfile y docker-compose para el backend</li>
<li>âœ… Verificar funcionamiento con Swagger UI</li>
</ol>
<h3>ğŸ”‘ Puntos Clave TÃ©cnicos</h3>
<h4>1. InstalaciÃ³n y ConfiguraciÃ³n del Entorno</h4>
<p><strong>CreaciÃ³n de Entorno Virtual</strong>:</p>
<pre><code class="language-bash">python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
</code></pre>
<ul>
<li>Aislamiento de dependencias del sistema</li>
<li>Evita conflictos entre proyectos</li>
<li>Facilita deployment reproducible</li>
</ul>
<p><strong>Dependencias Principales Instaladas</strong>:</p>
<ul>
<li><code>fastapi</code>: Framework principal</li>
<li><code>uvicorn[standard]</code>: Servidor ASGI con extras</li>
<li><code>sqlalchemy</code>: ORM para PostgreSQL</li>
<li><code>psycopg2-binary</code>: Driver de PostgreSQL</li>
<li><code>alembic</code>: Migraciones de base de datos</li>
<li><code>pydantic-settings</code>: ConfiguraciÃ³n con validaciÃ³n</li>
<li><code>python-jose[cryptography]</code>: JWT</li>
<li><code>passlib[bcrypt]</code>: Hashing de contraseÃ±as</li>
<li><code>python-dotenv</code>: Manejo de .env files</li>
</ul>
<h4>2. Estructura del Proyecto Backend</h4>
<p><strong>OrganizaciÃ³n Inicial</strong>:</p>
<pre><code>backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py          # Marca como paquete Python
â”‚   â”œâ”€â”€ main.py              # Punto de entrada
â”‚   â”œâ”€â”€ config.py            # Settings centralizados
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ routes.py        # Endpoints iniciales
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ security.py      # JWT y hashing (futuro)
â”‚   â””â”€â”€ db/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ database.py      # ConexiÃ³n a BD
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env
â””â”€â”€ Dockerfile
</code></pre>
<p><strong>Razones de esta estructura</strong>:</p>
<ul>
<li>Modularidad desde el inicio</li>
<li>FÃ¡cil de entender y navegar</li>
<li>Escalable para crecer</li>
<li>Sigue convenciones de Python</li>
</ul>
<h4>3. ConfiguraciÃ³n de PostgreSQL y SQLAlchemy</h4>
<p><strong>ConexiÃ³n a Base de Datos</strong>:</p>
<pre><code class="language-python">DATABASE_URL = &quot;postgresql://usuario:contraseÃ±a@host:puerto/database&quot;

engine = create_engine(
    DATABASE_URL,
    pool_pre_ping=True,    # Verifica conexiones antes de usar
    pool_size=10,          # MÃ¡ximo 10 conexiones simultÃ¡neas
    max_overflow=20        # Hasta 20 adicionales si necesario
)
</code></pre>
<p><strong>Session Management</strong>:</p>
<pre><code class="language-python">SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()  # Siempre cerrar sesiÃ³n
</code></pre>
<p><strong>Pool de Conexiones</strong>:</p>
<ul>
<li>Reutiliza conexiones existentes</li>
<li>Mejora performance significativamente</li>
<li>Evita overhead de crear/cerrar conexiones</li>
</ul>
<h4>4. Variables de Entorno y ConfiguraciÃ³n</h4>
<p><strong>Archivo .env</strong>:</p>
<pre><code class="language-env">APP_NAME=&quot;FastAPI Full Stack&quot;
DEBUG=True
DATABASE_URL=postgresql://fastapi_user:password@localhost:5432/fullstack_db
SECRET_KEY=tu-clave-super-secreta
</code></pre>
<p><strong>Pydantic Settings</strong>:</p>
<pre><code class="language-python">from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    APP_NAME: str
    DEBUG: bool = False
    DATABASE_URL: str
    SECRET_KEY: str
    
    class Config:
        env_file = &quot;.env&quot;
</code></pre>
<p><strong>Beneficios</strong>:</p>
<ul>
<li>SeparaciÃ³n de configuraciÃ³n del cÃ³digo</li>
<li>Diferentes configs por entorno (dev/prod)</li>
<li>ValidaciÃ³n automÃ¡tica con Pydantic</li>
<li>Type hints para mejor DX</li>
</ul>
<h4>5. AplicaciÃ³n FastAPI Principal</h4>
<p><strong>CreaciÃ³n de la App</strong>:</p>
<pre><code class="language-python">app = FastAPI(
    title=&quot;FastAPI Full Stack&quot;,
    version=&quot;1.0.0&quot;,
    docs_url=&quot;/docs&quot;,      # Swagger UI
    redoc_url=&quot;/redoc&quot;     # ReDoc
)
</code></pre>
<p><strong>CORS Configuration</strong>:</p>
<pre><code class="language-python">from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=[&quot;http://localhost:3000&quot;],  # Next.js
    allow_credentials=True,
    allow_methods=[&quot;*&quot;],
    allow_headers=[&quot;*&quot;],
)
</code></pre>
<ul>
<li>Permite requests desde Next.js</li>
<li><code>allow_credentials=True</code> para cookies</li>
<li>ConfiguraciÃ³n permisiva en desarrollo</li>
</ul>
<p><strong>Health Check Endpoint</strong>:</p>
<pre><code class="language-python">@app.get(&quot;/health&quot;)
async def health_check():
    return {&quot;status&quot;: &quot;healthy&quot;, &quot;version&quot;: &quot;1.0.0&quot;}
</code></pre>
<ul>
<li>Ãštil para monitoring y load balancers</li>
<li>Verifica que el servidor estÃ© respondiendo</li>
</ul>
<h4>6. ContenedorizaciÃ³n con Docker</h4>
<p><strong>Dockerfile</strong>:</p>
<pre><code class="language-dockerfile">FROM python:3.11-slim

WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update &amp;&amp; apt-get install -y \
    gcc postgresql-client

# Instalar dependencias Python
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copiar cÃ³digo
COPY ./app ./app

EXPOSE 8000

CMD [&quot;uvicorn&quot;, &quot;app.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;, &quot;--reload&quot;]
</code></pre>
<p><strong>docker-compose.yml (parcial)</strong>:</p>
<pre><code class="language-yaml">services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: fullstack_db
    ports:
      - &quot;5432:5432&quot;
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  backend:
    build: ./backend
    ports:
      - &quot;8000:8000&quot;
    depends_on:
      - postgres
    volumes:
      - ./backend/app:/app/app  # Hot reload
</code></pre>
<p><strong>Ventajas de ContainerizaciÃ³n</strong>:</p>
<ul>
<li>Entorno idÃ©ntico en todos los sistemas</li>
<li>No contamina instalaciÃ³n local</li>
<li>FÃ¡cil de compartir y replicar</li>
<li>Preparado para producciÃ³n</li>
</ul>
<h3>ğŸ’¼ TecnologÃ­as Utilizadas</h3>
<table>
<thead>
<tr>
<th>Componente</th>
<th>TecnologÃ­a</th>
<th>PropÃ³sito EspecÃ­fico</th>
</tr>
</thead>
<tbody>
<tr>
<td>Framework</td>
<td>FastAPI 0.109+</td>
<td>API REST asÃ­ncrona</td>
</tr>
<tr>
<td>Servidor ASGI</td>
<td>Uvicorn</td>
<td>Servidor de alto rendimiento</td>
</tr>
<tr>
<td>ORM</td>
<td>SQLAlchemy 2.0</td>
<td>AbstracciÃ³n de base de datos</td>
</tr>
<tr>
<td>BD Driver</td>
<td>psycopg2</td>
<td>ConexiÃ³n a PostgreSQL</td>
</tr>
<tr>
<td>Migraciones</td>
<td>Alembic</td>
<td>Control de versiones de esquema</td>
</tr>
<tr>
<td>ValidaciÃ³n</td>
<td>Pydantic 2.5+</td>
<td>Schemas y settings</td>
</tr>
<tr>
<td>Contenedores</td>
<td>Docker/Podman</td>
<td>Entorno reproducible</td>
</tr>
<tr>
<td>Variables Entorno</td>
<td>python-dotenv</td>
<td>ConfiguraciÃ³n externa</td>
</tr>
</tbody>
</table>
<h3>âœ… Resultados Alcanzados</h3>
<p>Al finalizar este episodio, se tiene:</p>
<ol>
<li>
<p><strong>Backend Funcional</strong>:</p>
<ul>
<li>Servidor FastAPI corriendo en puerto 8000</li>
<li>DocumentaciÃ³n automÃ¡tica accesible en /docs</li>
<li>Health check endpoint respondiendo</li>
</ul>
</li>
<li>
<p><strong>Base de Datos Configurada</strong>:</p>
<ul>
<li>PostgreSQL ejecutÃ¡ndose en contenedor</li>
<li>ConexiÃ³n establecida con SQLAlchemy</li>
<li>Pool de conexiones configurado</li>
</ul>
</li>
<li>
<p><strong>Estructura Profesional</strong>:</p>
<ul>
<li>CÃ³digo organizado en mÃ³dulos</li>
<li>Variables de entorno separadas</li>
<li>ConfiguraciÃ³n centralizada con Pydantic</li>
</ul>
</li>
<li>
<p><strong>Entorno Contenerizado</strong>:</p>
<ul>
<li>Docker Compose orquestando servicios</li>
<li>VolÃºmenes para persistencia de datos</li>
<li>Hot reload para desarrollo Ã¡gil</li>
</ul>
</li>
<li>
<p><strong>Middleware Configurado</strong>:</p>
<ul>
<li>CORS listo para Next.js</li>
<li>Preparado para agregar mÃ¡s middleware</li>
</ul>
</li>
<li>
<p><strong>DocumentaciÃ³n Viva</strong>:</p>
<ul>
<li>Swagger UI generado automÃ¡ticamente</li>
<li>Esquemas Pydantic documentando API</li>
<li>ReDoc como alternativa</li>
</ul>
</li>
</ol>
<h3>ğŸ”— ConexiÃ³n con Episodios Previos/Siguientes</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li><strong>Episodio 1</strong>: Arquitectura y tecnologÃ­as presentadas</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li><strong>Episodio 3</strong>: Frontend consumirÃ¡ esta API</li>
<li><strong>Episodio 4</strong>: Esta estructura serÃ¡ refactorizada profesionalmente</li>
<li><strong>Episodio 5</strong>: Modelos SQLAlchemy se crearÃ¡n aquÃ­</li>
</ul>
<p><strong>Conceptos que se expandirÃ¡n</strong>:</p>
<ul>
<li>Endpoints bÃ¡sicos â†’ CRUD completo</li>
<li>Estructura simple â†’ Arquitectura en capas</li>
<li>Sin autenticaciÃ³n â†’ JWT completo</li>
<li>Sin modelos â†’ Modelos complejos con relaciones</li>
</ul>
<h3>ğŸ“Œ Notas Importantes</h3>
<blockquote>
<p><strong>Comando CrÃ­tico</strong>: Siempre activar el entorno virtual antes de trabajar con el proyecto.</p>
</blockquote>
<blockquote>
<p><strong>Puerto 8000</strong>: AsegÃºrate de que este puerto estÃ© libre en tu sistema.</p>
</blockquote>
<blockquote>
<p><strong>Variables de Entorno</strong>: NUNCA commitear el archivo .env al repositorio. Usar .env.example como plantilla.</p>
</blockquote>
<blockquote>
<p><strong>Hot Reload</strong>: El flag <code>--reload</code> de Uvicorn reinicia automÃ¡ticamente al detectar cambios en el cÃ³digo.</p>
</blockquote>
<blockquote>
<p><strong>PostgreSQL</strong>: Si usas PostgreSQL local en lugar de Docker, ajusta el host en DATABASE_URL a <code>localhost</code> en lugar de <code>postgres</code>.</p>
</blockquote>
<h3>ğŸ¬ Estructura del Episodio</h3>
<pre><code>[00:00-05:00] â†’ IntroducciÃ³n y repaso del ep. 1
[05:00-10:00] â†’ InstalaciÃ³n de Python, venv y FastAPI
[10:00-18:00] â†’ CreaciÃ³n de estructura del proyecto
[18:00-25:00] â†’ ConfiguraciÃ³n de PostgreSQL y SQLAlchemy
[25:00-32:00] â†’ ImplementaciÃ³n de main.py y endpoints
[32:00-38:00] â†’ Dockerfile y docker-compose
[38:00-43:31] â†’ Testing, Swagger UI y conclusiones
</code></pre>
<h3>ğŸ’¡ Tips del Instructor</h3>
<ol>
<li><strong>Sobre Uvicorn</strong>: El flag <code>--reload</code> es solo para desarrollo, nunca en producciÃ³n</li>
<li><strong>Sobre Pool de Conexiones</strong>: Ajustar <code>pool_size</code> segÃºn carga esperada</li>
<li><strong>Sobre CORS</strong>: En producciÃ³n, especificar origins exactos, no usar &quot;*&quot;</li>
<li><strong>Sobre .env</strong>: Generar SECRET_KEY con <code>openssl rand -hex 32</code></li>
<li><strong>Sobre Docker</strong>: Usar volÃºmenes nombrados para persistencia importante</li>
</ol>
<hr>
<h2>EPISODIO 3: ConfiguraciÃ³n del Frontend con Next.js</h2>
<h3>ğŸ“Š InformaciÃ³n del Video</h3>
<ul>
<li><strong>TÃ­tulo</strong>: FastAPI y NextJS: Preparamos el contenedor del Frontend | Curso App Full Stack #3</li>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=5zkla8UaiwI</li>
<li><strong>DuraciÃ³n</strong>: 28:14 minutos</li>
<li><strong>Vistas</strong>: 258</li>
<li><strong>Publicado</strong>: Hace 3 meses</li>
</ul>
<h3>ğŸ“ Resumen Ejecutivo</h3>
<p>Este episodio se enfoca completamente en el frontend, configurando Next.js con todas las herramientas modernas necesarias para una aplicaciÃ³n profesional. El instructor guÃ­a la creaciÃ³n del proyecto Next.js con App Router, la configuraciÃ³n de TypeScript para type safety, la integraciÃ³n de TailwindCSS para estilos, y la instalaciÃ³n de shadcn/ui para componentes reutilizables.</p>
<p>Se implementa un cliente API con axios configurado para comunicarse con el backend FastAPI, se estructuran los componentes de manera escalable, y se containeriza todo en Docker. El episodio termina con la aplicaciÃ³n frontend conectÃ¡ndose exitosamente al backend y lista para recibir caracterÃ­sticas.</p>
<h3>ğŸ¯ Objetivos del Episodio</h3>
<p><strong>Objetivo Principal</strong>: Configurar un frontend Next.js moderno y profesional que se comunique con el backend FastAPI</p>
<p><strong>Objetivos EspecÃ­ficos</strong>:</p>
<ol>
<li>âœ… Crear proyecto Next.js con App Router y TypeScript</li>
<li>âœ… Configurar TailwindCSS para estilos utility-first</li>
<li>âœ… Instalar y configurar shadcn/ui para componentes</li>
<li>âœ… Estructurar el proyecto con buenas prÃ¡cticas</li>
<li>âœ… Implementar cliente API con axios</li>
<li>âœ… Configurar variables de entorno para URLs</li>
<li>âœ… Crear contenedor Docker para Next.js</li>
<li>âœ… Integrar frontend y backend en docker-compose</li>
<li>âœ… Verificar comunicaciÃ³n frontend-backend</li>
</ol>
<h3>ğŸ”‘ Puntos Clave TÃ©cnicos</h3>
<h4>1. CreaciÃ³n del Proyecto Next.js</h4>
<p><strong>Comando de InicializaciÃ³n</strong>:</p>
<pre><code class="language-bash">npx create-next-app@latest frontend \
  --typescript \
  --tailwind \
  --app \
  --src-dir \
  --no-git
</code></pre>
<p><strong>Opciones Seleccionadas</strong>:</p>
<ul>
<li><code>--typescript</code>: Type safety con TypeScript</li>
<li><code>--tailwind</code>: TailwindCSS preconfigurado</li>
<li><code>--app</code>: App Router (nueva arquitectura de Next.js)</li>
<li><code>--src-dir</code>: CÃ³digo en carpeta src/</li>
<li><code>--no-git</code>: No inicializar Git (ya estÃ¡ en raÃ­z del proyecto)</li>
</ul>
<p><strong>Ventajas del App Router</strong>:</p>
<ul>
<li>Server Components por defecto (mejor performance)</li>
<li>Layouts anidados</li>
<li>Loading y error states mÃ¡s fÃ¡ciles</li>
<li>Streaming y Suspense integrados</li>
</ul>
<h4>2. TypeScript Configuration</h4>
<p><strong>tsconfig.json Configurado</strong>:</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;ES2020&quot;,
    &quot;lib&quot;: [&quot;dom&quot;, &quot;dom.iterable&quot;, &quot;esnext&quot;],
    &quot;allowJs&quot;: true,
    &quot;skipLibCheck&quot;: true,
    &quot;strict&quot;: true,
    &quot;forceConsistentCasingInFileNames&quot;: true,
    &quot;noEmit&quot;: true,
    &quot;esModuleInterop&quot;: true,
    &quot;module&quot;: &quot;esnext&quot;,
    &quot;moduleResolution&quot;: &quot;bundler&quot;,
    &quot;resolveJsonModule&quot;: true,
    &quot;isolatedModules&quot;: true,
    &quot;jsx&quot;: &quot;preserve&quot;,
    &quot;incremental&quot;: true,
    &quot;paths&quot;: {
      &quot;@/*&quot;: [&quot;./src/*&quot;]  // Path aliases
    }
  }
}
</code></pre>
<p><strong>Beneficios de TypeScript</strong>:</p>
<ul>
<li>DetecciÃ³n de errores en tiempo de desarrollo</li>
<li>IntelliSense mejorado en VSCode</li>
<li>Refactoring mÃ¡s seguro</li>
<li>DocumentaciÃ³n implÃ­cita con tipos</li>
<li>PrevenciÃ³n de bugs comunes</li>
</ul>
<h4>3. TailwindCSS y Estilos</h4>
<p><strong>tailwind.config.ts</strong>:</p>
<pre><code class="language-typescript">import type { Config } from &quot;tailwindcss&quot;

const config: Config = {
  darkMode: [&quot;class&quot;],  // Dark mode con clase
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        border: &quot;hsl(var(--border))&quot;,
        background: &quot;hsl(var(--background))&quot;,
        foreground: &quot;hsl(var(--foreground))&quot;,
        primary: { /* ... */ },
        secondary: { /* ... */ },
      },
      borderRadius: {
        lg: &quot;var(--radius)&quot;,
        md: &quot;calc(var(--radius) - 2px)&quot;,
        sm: &quot;calc(var(--radius) - 4px)&quot;,
      },
    },
  },
}
</code></pre>
<p><strong>Ventajas de Tailwind</strong>:</p>
<ul>
<li>Desarrollo rÃ¡pido con utility classes</li>
<li>No hay CSS no utilizado en producciÃ³n (tree-shaking)</li>
<li>DiseÃ±o consistente con sistema de diseÃ±o</li>
<li>Responsive design sencillo</li>
<li>Dark mode fÃ¡cil de implementar</li>
</ul>
<h4>4. Shadcn/UI Components</h4>
<p><strong>InstalaciÃ³n</strong>:</p>
<pre><code class="language-bash">npx shadcn-ui@latest init

# Instalar componentes especÃ­ficos
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add card
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add form
</code></pre>
<p><strong>CaracterÃ­sticas de shadcn/ui</strong>:</p>
<ul>
<li>Componentes copiados al proyecto (no npm package)</li>
<li>Totalmente personalizables</li>
<li>Accesibles (a11y) por defecto</li>
<li>Basados en Radix UI</li>
<li>Estilos con Tailwind</li>
</ul>
<p><strong>Ejemplo de Uso</strong>:</p>
<pre><code class="language-typescript">import { Button } from &quot;@/components/ui/button&quot;
import { Card } from &quot;@/components/ui/card&quot;

export function MyComponent() {
  return (
    &lt;Card&gt;
      &lt;Button variant=&quot;default&quot;&gt;Click me&lt;/Button&gt;
      &lt;Button variant=&quot;outline&quot;&gt;Outline&lt;/Button&gt;
    &lt;/Card&gt;
  )
}
</code></pre>
<h4>5. Estructura del Proyecto</h4>
<p><strong>OrganizaciÃ³n de Carpetas</strong>:</p>
<pre><code>frontend/src/
â”œâ”€â”€ app/                    # App Router
â”‚   â”œâ”€â”€ layout.tsx         # Root layout
â”‚   â”œâ”€â”€ page.tsx           # Home page
â”‚   â”œâ”€â”€ (auth)/            # Grupo de rutas auth
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â””â”€â”€ (protected)/       # Rutas protegidas
â”‚       â””â”€â”€ dashboard/
â”‚           â””â”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                # shadcn components
â”‚   â”œâ”€â”€ layout/            # Header, Footer, etc.
â”‚   â””â”€â”€ forms/             # Formularios
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts            # Cliente API
â”‚   â”œâ”€â”€ auth.ts           # LÃ³gica auth
â”‚   â””â”€â”€ utils.ts          # Utilidades
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â””â”€â”€ useWebSocket.ts
â”œâ”€â”€ types/
â”‚   â””â”€â”€ api.ts            # Tipos TypeScript
â””â”€â”€ styles/
    â””â”€â”€ globals.css       # Estilos globales
</code></pre>
<p><strong>Razones de esta Estructura</strong>:</p>
<ul>
<li><strong>app/</strong>: Rutas segÃºn convenciÃ³n de Next.js</li>
<li><strong>components/</strong>: ReutilizaciÃ³n de componentes</li>
<li><strong>lib/</strong>: LÃ³gica compartida y utilidades</li>
<li><strong>hooks/</strong>: Custom React hooks</li>
<li><strong>types/</strong>: Definiciones TypeScript centralizadas</li>
</ul>
<h4>6. Cliente API con Axios</h4>
<p><strong>lib/api.ts</strong>:</p>
<pre><code class="language-typescript">import axios, { AxiosInstance } from 'axios';

const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  timeout: 10000,
  withCredentials: true,  // Enviar cookies
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para manejar errores
apiClient.interceptors.response.use(
  response =&gt; response,
  error =&gt; {
    if (error.response?.status === 401) {
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export const api = {
  auth: {
    login: async (email: string, password: string) =&gt; {
      const formData = new FormData();
      formData.append('username', email);
      formData.append('password', password);
      return apiClient.post('/auth/login', formData);
    },
    // ...mÃ¡s mÃ©todos
  },
  // ...mÃ¡s endpoints
};
</code></pre>
<p><strong>CaracterÃ­sticas del Cliente</strong>:</p>
<ul>
<li><code>withCredentials: true</code> para enviar/recibir cookies</li>
<li>Interceptors para manejo global de errores</li>
<li>Timeout configurado para prevenir requests colgados</li>
<li>Redireccionamiento automÃ¡tico a login en 401</li>
</ul>
<h4>7. Variables de Entorno</h4>
<p><strong>.env.local</strong>:</p>
<pre><code class="language-env">NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
</code></pre>
<p><strong>Uso en CÃ³digo</strong>:</p>
<pre><code class="language-typescript">const apiUrl = process.env.NEXT_PUBLIC_API_URL;
</code></pre>
<p><strong>Nota Importante</strong>:</p>
<ul>
<li>Prefijo <code>NEXT_PUBLIC_</code> para variables accesibles en el cliente</li>
<li>Sin prefijo solo estÃ¡n disponibles en server-side code</li>
</ul>
<h4>8. ContainerizaciÃ³n del Frontend</h4>
<p><strong>Dockerfile (multi-stage)</strong>:</p>
<pre><code class="language-dockerfile"># Stage 1: Dependencies
FROM node:20-alpine AS deps
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci

# Stage 2: Builder
FROM node:20-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# Stage 3: Runner
FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV production
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
EXPOSE 3000
CMD [&quot;node&quot;, &quot;server.js&quot;]
</code></pre>
<p><strong>next.config.js</strong>:</p>
<pre><code class="language-javascript">const nextConfig = {
  output: 'standalone',  // Para Docker
  images: {
    domains: ['localhost'],
  },
}
</code></pre>
<p><strong>docker-compose.yml Actualizado</strong>:</p>
<pre><code class="language-yaml">services:
  postgres:
    # ... (mismo que antes)
  
  backend:
    # ... (mismo que antes)
  
  frontend:
    build: ./frontend
    container_name: fullstack_frontend
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
    ports:
      - &quot;3000:3000&quot;
    depends_on:
      - backend
    volumes:
      - ./frontend/src:/app/src  # Hot reload
</code></pre>
<h3>ğŸ’¼ TecnologÃ­as Utilizadas</h3>
<table>
<thead>
<tr>
<th>Componente</th>
<th>TecnologÃ­a</th>
<th>PropÃ³sito</th>
</tr>
</thead>
<tbody>
<tr>
<td>Framework</td>
<td>Next.js 14</td>
<td>AplicaciÃ³n React con SSR</td>
</tr>
<tr>
<td>Lenguaje</td>
<td>TypeScript 5</td>
<td>Type safety</td>
</tr>
<tr>
<td>Estilos</td>
<td>TailwindCSS 3</td>
<td>Utility-first CSS</td>
</tr>
<tr>
<td>Componentes UI</td>
<td>shadcn/ui</td>
<td>Componentes preconstruidos</td>
</tr>
<tr>
<td>HTTP Client</td>
<td>Axios</td>
<td>Requests a API</td>
</tr>
<tr>
<td>ValidaciÃ³n Forms</td>
<td>Zod + react-hook-form</td>
<td>Formularios robustos</td>
</tr>
<tr>
<td>Contenedores</td>
<td>Docker</td>
<td>Entorno consistente</td>
</tr>
</tbody>
</table>
<h3>âœ… Resultados Alcanzados</h3>
<p>Al finalizar este episodio:</p>
<ol>
<li>
<p><strong>Frontend Funcional</strong>:</p>
<ul>
<li>Next.js corriendo en puerto 3000</li>
<li>App Router configurado</li>
<li>TypeScript funcionando</li>
</ul>
</li>
<li>
<p><strong>Estilos Configurados</strong>:</p>
<ul>
<li>TailwindCSS listo para usar</li>
<li>Sistema de diseÃ±o con variables CSS</li>
<li>Dark mode preparado</li>
</ul>
</li>
<li>
<p><strong>Componentes UI</strong>:</p>
<ul>
<li>shadcn/ui instalado</li>
<li>Botones, inputs, cards, etc. disponibles</li>
<li>Personalizables y accesibles</li>
</ul>
</li>
<li>
<p><strong>ComunicaciÃ³n con Backend</strong>:</p>
<ul>
<li>Cliente API configurado con axios</li>
<li>Variables de entorno para URLs</li>
<li>Interceptors para manejo de errores</li>
</ul>
</li>
<li>
<p><strong>Estructura Escalable</strong>:</p>
<ul>
<li>Carpetas organizadas lÃ³gicamente</li>
<li>SeparaciÃ³n de concerns</li>
<li>FÃ¡cil de navegar y extender</li>
</ul>
</li>
<li>
<p><strong>Containerizado</strong>:</p>
<ul>
<li>Dockerfile multi-stage optimizado</li>
<li>Integrado en docker-compose</li>
<li>Hot reload para desarrollo</li>
</ul>
</li>
</ol>
<h3>ğŸ”— ConexiÃ³n con Episodios Previos/Siguientes</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li><strong>Episodio 1</strong>: Arquitectura general</li>
<li><strong>Episodio 2</strong>: Backend FastAPI funcionando</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li><strong>Episodio 4-5</strong>: Frontend consumirÃ¡ nuevos endpoints</li>
<li><strong>Episodios futuros</strong>: ImplementaciÃ³n de features (auth, CRUD, WebSockets)</li>
</ul>
<p><strong>Conceptos que se usarÃ¡n</strong>:</p>
<ul>
<li>Cliente API â†’ ConsumirÃ¡ todos los endpoints del backend</li>
<li>Estructura de componentes â†’ Se llenarÃ¡ con funcionalidad</li>
<li>Hooks personalizados â†’ useAuth, useWebSocket, etc.</li>
</ul>
<h3>ğŸ“Œ Notas Importantes</h3>
<blockquote>
<p><strong>App Router vs Pages Router</strong>: Este proyecto usa App Router (recomendado por Next.js). Es diferente a tutoriales antiguos.</p>
</blockquote>
<blockquote>
<p><strong>Puerto 3000</strong>: AsegÃºrate de que estÃ© libre en tu sistema.</p>
</blockquote>
<blockquote>
<p><strong>NEXT_PUBLIC_ Prefix</strong>: Variables sin este prefijo no estarÃ¡n disponibles en el cliente.</p>
</blockquote>
<blockquote>
<p><strong>Hot Reload</strong>: Los cambios en src/ se reflejan automÃ¡ticamente gracias al volumen de Docker.</p>
</blockquote>
<blockquote>
<p><strong>Build Time</strong>: El primer build puede tardar varios minutos mientras descarga dependencias.</p>
</blockquote>
<h3>ğŸ¬ Estructura del Episodio</h3>
<pre><code>[00:00-03:00] â†’ IntroducciÃ³n y repaso
[03:00-08:00] â†’ Crear proyecto Next.js y configuraciÃ³n inicial
[08:00-12:00] â†’ Configurar TypeScript y TailwindCSS
[12:00-18:00] â†’ Instalar shadcn/ui y estructurar componentes
[18:00-22:00] â†’ Implementar cliente API
[22:00-26:00] â†’ ContainerizaciÃ³n con Docker
[26:00-28:14] â†’ Pruebas y conclusiÃ³n
</code></pre>
<h3>ğŸ’¡ Tips del Instructor</h3>
<ol>
<li><strong>Sobre shadcn/ui</strong>: Los componentes se copian al proyecto, asÃ­ que puedes modificarlos libremente</li>
<li><strong>Sobre TypeScript</strong>: Usar <code>interface</code> para objetos pÃºblicos, <code>type</code> para uniones y aliases</li>
<li><strong>Sobre Tailwind</strong>: Usar el plugin de VSCode para autocompletado de clases</li>
<li><strong>Sobre API Client</strong>: Centralizar todas las llamadas en lib/api.ts facilita mantenimiento</li>
<li><strong>Sobre Hot Reload</strong>: Si no funciona, reiniciar el contenedor resuelve la mayorÃ­a de problemas</li>
</ol>
<hr>
<h2>EPISODIO 4: ReorganizaciÃ³n Profesional del Backend</h2>
<h3>ğŸ“Š InformaciÃ³n del Video</h3>
<ul>
<li><strong>TÃ­tulo</strong>: FastAPI y NextJS: Reorganizamos profesionalmente el Backend | Curso App Full Stack #4</li>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=4c1Tw2rb5cE</li>
<li><strong>DuraciÃ³n</strong>: 16:14 minutos</li>
<li><strong>Vistas</strong>: 142</li>
<li><strong>Publicado</strong>: Hace 2 meses</li>
</ul>
<h3>ğŸ“ Resumen Ejecutivo</h3>
<p>Este episodio es crucial para la evoluciÃ³n del proyecto hacia cÃ³digo de producciÃ³n. El instructor refactoriza completamente el backend, transformÃ¡ndolo de una estructura bÃ¡sica a una arquitectura profesional en capas. Se implementan patrones de diseÃ±o fundamentales como Repository Pattern y Service Layer, se introducen excepciones personalizadas, y se establece un sistema robusto de inyecciÃ³n de dependencias.</p>
<p>Aunque mÃ¡s corto que episodios anteriores, este es denso en conceptos de arquitectura de software. El enfoque no estÃ¡ tanto en escribir mucho cÃ³digo nuevo, sino en reorganizar el existente de manera que sea mantenible, testeable y escalable. Es un episodio que separa proyectos de tutorial de aplicaciones reales.</p>
<h3>ğŸ¯ Objetivos del Episodio</h3>
<p><strong>Objetivo Principal</strong>: Transformar el backend bÃ¡sico en una arquitectura profesional y escalable</p>
<p><strong>Objetivos EspecÃ­ficos</strong>:</p>
<ol>
<li>âœ… Implementar arquitectura en capas (API â†’ Services â†’ Repositories â†’ Models)</li>
<li>âœ… Crear patrÃ³n Repository con CRUD genÃ©rico</li>
<li>âœ… Implementar Service Layer para lÃ³gica de negocio</li>
<li>âœ… Definir excepciones personalizadas</li>
<li>âœ… Mejorar sistema de dependencias (deps.py)</li>
<li>âœ… Versionar la API (prefijo /api/v1)</li>
<li>âœ… Refactorizar endpoints para usar nueva arquitectura</li>
<li>âœ… Preparar estructura para crecer sin fricciÃ³n</li>
</ol>
<h3>ğŸ”‘ Puntos Clave TÃ©cnicos</h3>
<h4>1. Arquitectura en Capas Implementada</h4>
<p><strong>SeparaciÃ³n de Responsabilidades</strong>:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API LAYER (api/v1/endpoints/)        â”‚
â”‚   â€¢ Recibe requests HTTP                â”‚
â”‚   â€¢ Valida datos con Pydantic          â”‚
â”‚   â€¢ Llama a servicios                   â”‚
â”‚   â€¢ Serializa respuestas                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Depends
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SERVICE LAYER (services/)             â”‚
â”‚   â€¢ LÃ³gica de negocio                   â”‚
â”‚   â€¢ Validaciones complejas              â”‚
â”‚   â€¢ Orquesta repositorios               â”‚
â”‚   â€¢ Maneja transacciones                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Usa
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   REPOSITORY LAYER (repositories/)      â”‚
â”‚   â€¢ Acceso a datos (CRUD)              â”‚
â”‚   â€¢ Queries a base de datos            â”‚
â”‚   â€¢ Abstrae SQLAlchemy                  â”‚
â”‚   â€¢ Sin lÃ³gica de negocio              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Opera sobre
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MODEL LAYER (models/)                 â”‚
â”‚   â€¢ DefiniciÃ³n de tablas                â”‚
â”‚   â€¢ Relaciones entre entidades          â”‚
â”‚   â€¢ Constraints y validaciones BD       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Beneficios de esta Arquitectura</strong>:</p>
<ul>
<li>Cada capa tiene responsabilidad Ãºnica (SRP)</li>
<li>Testing mÃ¡s fÃ¡cil (mockear cada capa)</li>
<li>Cambios localizados (modificar una capa sin afectar otras)</li>
<li>ReutilizaciÃ³n de cÃ³digo</li>
<li>Escalabilidad vertical y horizontal</li>
</ul>
<h4>2. Repository Pattern (PatrÃ³n Repositorio)</h4>
<p><strong>BaseRepository GenÃ©rico</strong>:</p>
<pre><code class="language-python">from typing import TypeVar, Generic, Type, Optional, List
from sqlalchemy.orm import Session

ModelType = TypeVar(&quot;ModelType&quot;)

class BaseRepository(Generic[ModelType]):
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -&gt; Optional[ModelType]:
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(self, db: Session, skip: int = 0, limit: int = 100) -&gt; List[ModelType]:
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def create(self, db: Session, *, obj_in: dict) -&gt; ModelType:
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(self, db: Session, *, db_obj: ModelType, obj_in: dict) -&gt; ModelType:
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -&gt; Optional[ModelType]:
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
</code></pre>
<p><strong>UserRepository EspecÃ­fico</strong>:</p>
<pre><code class="language-python">from app.models.user import User

class UserRepository(BaseRepository[User]):
    def __init__(self):
        super().__init__(User)
    
    def get_by_email(self, db: Session, *, email: str) -&gt; Optional[User]:
        return db.query(User).filter(User.email == email).first()
    
    def get_by_username(self, db: Session, *, username: str) -&gt; Optional[User]:
        return db.query(User).filter(User.username == username).first()

user_repository = UserRepository()  # Instancia global
</code></pre>
<p><strong>Ventajas del Repository Pattern</strong>:</p>
<ul>
<li>CRUD genÃ©rico reutilizable</li>
<li>FÃ¡cil de mockear para testing</li>
<li>Abstrae detalles de SQLAlchemy</li>
<li>Queries especÃ­ficas en repositorios especializados</li>
<li>Cambiar ORM afecta solo repositorios</li>
</ul>
<h4>3. Service Layer (Capa de Servicios)</h4>
<p><strong>UserService con LÃ³gica de Negocio</strong>:</p>
<pre><code class="language-python">class UserService:
    def __init__(self):
        self.repo = user_repository
    
    def create_user(self, db: Session, user_in: UserCreate) -&gt; User:
        # ValidaciÃ³n: email Ãºnico
        if self.repo.get_by_email(db, email=user_in.email):
            raise UserAlreadyExistsException(&quot;Email ya registrado&quot;)
        
        # ValidaciÃ³n: username Ãºnico
        if self.repo.get_by_username(db, username=user_in.username):
            raise UserAlreadyExistsException(&quot;Username ya existe&quot;)
        
        # Hash de contraseÃ±a
        hashed_password = get_password_hash(user_in.password)
        
        # Crear usuario
        user_data = user_in.dict(exclude={'password'})
        user_data['hashed_password'] = hashed_password
        
        return self.repo.create(db, obj_in=user_data)
    
    def authenticate(self, db: Session, *, email: str, password: str) -&gt; Optional[User]:
        user = self.repo.get_by_email(db, email=email)
        if not user:
            return None
        if not verify_password(password, user.hashed_password):
            return None
        return user

user_service = UserService()  # Instancia global
</code></pre>
<p><strong>Responsabilidades del Service Layer</strong>:</p>
<ul>
<li>Implementar reglas de negocio</li>
<li>Coordinar mÃºltiples repositorios</li>
<li>Validaciones complejas</li>
<li>TransformaciÃ³n de datos</li>
<li>Manejo de transacciones</li>
<li><strong>No</strong> acceder directamente a la BD</li>
</ul>
<h4>4. Excepciones Personalizadas</h4>
<p><strong>core/exceptions.py</strong>:</p>
<pre><code class="language-python">from fastapi import HTTPException, status

class BaseAPIException(HTTPException):
    def __init__(self, detail: str, status_code: int = 400):
        super().__init__(status_code=status_code, detail=detail)

class UserAlreadyExistsException(BaseAPIException):
    def __init__(self, detail: str = &quot;El usuario ya existe&quot;):
        super().__init__(detail, status_code=status.HTTP_409_CONFLICT)

class UserNotFoundException(BaseAPIException):
    def __init__(self, detail: str = &quot;Usuario no encontrado&quot;):
        super().__init__(detail, status_code=status.HTTP_404_NOT_FOUND)

class InvalidCredentialsException(BaseAPIException):
    def __init__(self, detail: str = &quot;Credenciales invÃ¡lidas&quot;):
        super().__init__(detail, status_code=status.HTTP_401_UNAUTHORIZED)
</code></pre>
<p><strong>Ventajas</strong>:</p>
<ul>
<li>Errores consistentes en toda la API</li>
<li>CÃ³digos de estado HTTP apropiados</li>
<li>Mensajes descriptivos</li>
<li>FÃ¡cil de extender</li>
</ul>
<h4>5. Sistema de Dependencias Mejorado</h4>
<p><strong>api/deps.py Refactorizado</strong>:</p>
<pre><code class="language-python">from fastapi import Depends, HTTPException, status, Cookie
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from app.db.session import SessionLocal
from app.models.user import User
from app.services.user_service import user_service
from app.core.security import decode_token

oauth2_scheme = OAuth2PasswordBearer(tokenUrl=&quot;/api/v1/auth/login&quot;, auto_error=False)

def get_db() -&gt; Generator:
    &quot;&quot;&quot;Dependency de base de datos&quot;&quot;&quot;
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

async def get_current_user(
    db: Session = Depends(get_db),
    token: Optional[str] = Depends(oauth2_scheme),
    access_token: Optional[str] = Cookie(None)
) -&gt; User:
    &quot;&quot;&quot;Obtener usuario actual desde JWT&quot;&quot;&quot;
    # Priorizar cookie sobre header
    token_to_decode = access_token or token
    
    if not token_to_decode:
        raise HTTPException(status_code=401, detail=&quot;No autenticado&quot;)
    
    payload = decode_token(token_to_decode)
    if not payload:
        raise HTTPException(status_code=401, detail=&quot;Token invÃ¡lido&quot;)
    
    user_id = int(payload.get(&quot;sub&quot;))
    user = user_service.get_user(db, user_id=user_id)
    
    if not user:
        raise HTTPException(status_code=401, detail=&quot;Usuario no encontrado&quot;)
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -&gt; User:
    &quot;&quot;&quot;Verificar usuario activo&quot;&quot;&quot;
    if not current_user.is_active:
        raise HTTPException(status_code=400, detail=&quot;Usuario inactivo&quot;)
    return current_user
</code></pre>
<p><strong>ComposiciÃ³n de Dependencias</strong>:</p>
<ul>
<li><code>get_current_active_user</code> depende de <code>get_current_user</code></li>
<li><code>get_current_user</code> depende de <code>get_db</code></li>
<li>FastAPI resuelve automÃ¡ticamente el Ã¡rbol de dependencias</li>
</ul>
<h4>6. Versionado de API</h4>
<p><strong>Estructura Versionada</strong>:</p>
<pre><code>app/api/
â”œâ”€â”€ deps.py
â””â”€â”€ v1/
    â”œâ”€â”€ router.py          # Agrega todos los routers
    â””â”€â”€ endpoints/
        â”œâ”€â”€ auth.py        # POST /api/v1/auth/login
        â”œâ”€â”€ users.py       # GET /api/v1/users/
        â”œâ”€â”€ projects.py    # GET /api/v1/projects/
        â””â”€â”€ tasks.py       # GET /api/v1/tasks/
</code></pre>
<p><strong>Router Principal Versionado</strong>:</p>
<pre><code class="language-python"># app/api/v1/router.py
from fastapi import APIRouter
from app.api.v1.endpoints import auth, users, projects

api_router = APIRouter()

api_router.include_router(auth.router, prefix=&quot;/auth&quot;, tags=[&quot;authentication&quot;])
api_router.include_router(users.router, prefix=&quot;/users&quot;, tags=[&quot;users&quot;])
api_router.include_router(projects.router, prefix=&quot;/projects&quot;, tags=[&quot;projects&quot;])
</code></pre>
<p><strong>En main.py</strong>:</p>
<pre><code class="language-python">app.include_router(api_router, prefix=&quot;/api/v1&quot;)
</code></pre>
<p><strong>Beneficios del Versionado</strong>:</p>
<ul>
<li>Cambios breaking en v2 sin afectar v1</li>
<li>Clientes pueden migrar gradualmente</li>
<li>Deprecar versiones antiguas de forma controlada</li>
<li>Profesionalismo y estÃ¡ndares de API</li>
</ul>
<h4>7. Endpoints Refactorizados</h4>
<p><strong>Antes (Video 2)</strong>:</p>
<pre><code class="language-python">@app.post(&quot;/register&quot;)
def register(user_in: UserCreate, db: Session = Depends(get_db)):
    # ValidaciÃ³n inline
    if db.query(User).filter(User.email == user_in.email).first():
        raise HTTPException(400, &quot;Email ya existe&quot;)
    # Hash inline
    hashed = pwd_context.hash(user_in.password)
    # CreaciÃ³n inline
    user = User(**user_in.dict(), hashed_password=hashed)
    db.add(user)
    db.commit()
    return user
</code></pre>
<p><strong>DespuÃ©s (Video 4)</strong>:</p>
<pre><code class="language-python">@router.post(&quot;/register&quot;, response_model=UserResponse, status_code=201)
def register(
    user_in: UserCreate,
    db: Session = Depends(deps.get_db)
):
    &quot;&quot;&quot;Registrar nuevo usuario&quot;&quot;&quot;
    return auth_service.register_user(db, user_in=user_in)
</code></pre>
<p><strong>Mejoras Evidentes</strong>:</p>
<ul>
<li>Endpoint limpio y conciso</li>
<li>Toda la lÃ³gica en el servicio</li>
<li>FÃ¡cil de testear</li>
<li>Exceptions manejadas centralmente</li>
<li>Type hints y response_model</li>
</ul>
<h3>ğŸ’¼ TecnologÃ­as y Patrones Utilizados</h3>
<table>
<thead>
<tr>
<th>PatrÃ³n/Concepto</th>
<th>ImplementaciÃ³n</th>
<th>Beneficio Principal</th>
</tr>
</thead>
<tbody>
<tr>
<td>Repository Pattern</td>
<td>BaseRepository genÃ©rico</td>
<td>ReutilizaciÃ³n CRUD</td>
</tr>
<tr>
<td>Service Layer</td>
<td>UserService, AuthService</td>
<td>LÃ³gica de negocio centralizada</td>
</tr>
<tr>
<td>Dependency Injection</td>
<td>FastAPI Depends</td>
<td>CÃ³digo desacoplado</td>
</tr>
<tr>
<td>Exception Handling</td>
<td>Excepciones personalizadas</td>
<td>Errores consistentes</td>
</tr>
<tr>
<td>API Versioning</td>
<td>/api/v1/ prefix</td>
<td>EvoluciÃ³n sin breaking changes</td>
</tr>
<tr>
<td>Generic Types</td>
<td>TypeVar en repositories</td>
<td>Type safety con flexibilidad</td>
</tr>
</tbody>
</table>
<h3>âœ… Resultados Alcanzados</h3>
<p>Al finalizar este episodio:</p>
<ol>
<li>
<p><strong>Arquitectura Profesional</strong>:</p>
<ul>
<li>4 capas bien definidas</li>
<li>SeparaciÃ³n clara de responsabilidades</li>
<li>CÃ³digo mantenible y escalable</li>
</ul>
</li>
<li>
<p><strong>Repository Pattern</strong>:</p>
<ul>
<li>CRUD genÃ©rico funcionando</li>
<li>Repositorios especÃ­ficos por entidad</li>
<li>AbstracciÃ³n completa de SQLAlchemy</li>
</ul>
</li>
<li>
<p><strong>Service Layer</strong>:</p>
<ul>
<li>LÃ³gica de negocio centralizada</li>
<li>Validaciones complejas</li>
<li>Servicios reutilizables</li>
</ul>
</li>
<li>
<p><strong>Manejo de Errores</strong>:</p>
<ul>
<li>Excepciones personalizadas</li>
<li>CÃ³digos HTTP apropiados</li>
<li>Mensajes de error consistentes</li>
</ul>
</li>
<li>
<p><strong>API Versionada</strong>:</p>
<ul>
<li>Estructura para versiones futuras</li>
<li>DocumentaciÃ³n organizada por versiÃ³n</li>
<li>EvoluciÃ³n controlada</li>
</ul>
</li>
<li>
<p><strong>Testing Facilitado</strong>:</p>
<ul>
<li>Cada capa puede testearse independientemente</li>
<li>Mocking sencillo con interfaces claras</li>
<li>Cobertura de cÃ³digo mÃ¡s fÃ¡cil</li>
</ul>
</li>
</ol>
<h3>ğŸ”— ConexiÃ³n con Episodios Previos/Siguientes</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li><strong>Episodio 2</strong>: Estructura bÃ¡sica que se refactoriza</li>
</ul>
<p><strong>Mejora</strong>:</p>
<ul>
<li><strong>Episodio 3</strong>: Frontend ahora consume API mÃ¡s robusta</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li><strong>Episodio 5</strong>: Modelos complejos usan repositorios y servicios</li>
<li><strong>Episodios futuros</strong>: CRUD completo con arquitectura sÃ³lida</li>
</ul>
<p><strong>TransformaciÃ³n Clave</strong>:</p>
<pre><code>Episodio 2: main.py con todo inline
            â†“ RefactorizaciÃ³n
Episodio 4: API â†’ Service â†’ Repository â†’ Model
</code></pre>
<h3>ğŸ“Œ Notas Importantes</h3>
<blockquote>
<p><strong>Refactoring vs Rewriting</strong>: Este episodio refactoriza, no reescribe. El comportamiento externo sigue igual.</p>
</blockquote>
<blockquote>
<p><strong>Backward Compatibility</strong>: Los endpoints mantienen sus URLs (solo agregan prefijo /api/v1/).</p>
</blockquote>
<blockquote>
<p><strong>No Premature Optimization</strong>: Esta arquitectura es necesaria ahora que el proyecto crece, no desde el inicio.</p>
</blockquote>
<blockquote>
<p><strong>Testing</strong>: Aunque no se muestra en este episodio, esta arquitectura facilita enormemente el testing.</p>
</blockquote>
<blockquote>
<p><strong>Migraciones</strong>: No es necesario correr migraciones ya que no cambiaron los modelos, solo la estructura del cÃ³digo.</p>
</blockquote>
<h3>ğŸ¬ Estructura del Episodio</h3>
<pre><code>[00:00-02:00] â†’ IntroducciÃ³n y problemas de arquitectura actual
[02:00-05:00] â†’ DiseÃ±o de nueva arquitectura en capas
[05:00-08:00] â†’ ImplementaciÃ³n de Repository Pattern
[08:00-11:00] â†’ CreaciÃ³n de Service Layer
[11:00-14:00] â†’ RefactorizaciÃ³n de endpoints
[14:00-16:14] â†’ Testing y conclusiÃ³n
</code></pre>
<h3>ğŸ’¡ Tips del Instructor</h3>
<ol>
<li><strong>Sobre Refactoring</strong>: Hacer en pasos pequeÃ±os, probando despuÃ©s de cada cambio</li>
<li><strong>Sobre Repositories</strong>: Empezar con CRUD genÃ©rico, agregar mÃ©todos especÃ­ficos segÃºn necesidad</li>
<li><strong>Sobre Services</strong>: Un servicio por entidad principal (UserService, ProjectService, etc.)</li>
<li><strong>Sobre Exceptions</strong>: Crear solo las que realmente necesitas, no todas las posibles</li>
<li><strong>Sobre Testing</strong>: Esta arquitectura permite testear lÃ³gica de negocio sin levantar el servidor</li>
</ol>
<hr>
<h2>EPISODIO 5: CreaciÃ³n de Modelos y Relaciones</h2>
<h3>ğŸ“Š InformaciÃ³n del Video</h3>
<ul>
<li><strong>TÃ­tulo</strong>: FastAPI y NextJS: Creamos los modelos con sus relaciones | Curso App Full Stack #5</li>
<li><strong>URL</strong>: https://www.youtube.com/watch?v=z1Q8dcP5jWI</li>
<li><strong>DuraciÃ³n</strong>: 22:06 minutos</li>
<li><strong>Vistas</strong>: 221</li>
<li><strong>Publicado</strong>: Hace 2 meses</li>
</ul>
<h3>ğŸ“ Resumen Ejecutivo</h3>
<p>Este episodio se sumerge en el modelado completo de la base de datos, implementando un esquema relacional robusto con SQLAlchemy. El instructor diseÃ±a modelos complejos con diferentes tipos de relaciones (1:1, 1:N, N:M), configura cascadas y comportamientos de eliminaciÃ³n apropiados, e implementa caracterÃ­sticas avanzadas como timestamps automÃ¡ticos y enums para estados.</p>
<p>Se hace especial Ã©nfasis en las mejores prÃ¡cticas de diseÃ±o de bases de datos: normalizaciÃ³n, indices, foreign keys con comportamiento explÃ­cito, y la separaciÃ³n entre modelos ORM (SQLAlchemy) y esquemas de validaciÃ³n (Pydantic). El episodio culmina con la configuraciÃ³n completa de Alembic para migraciones y la aplicaciÃ³n exitosa del esquema en PostgreSQL.</p>
<h3>ğŸ¯ Objetivos del Episodio</h3>
<p><strong>Objetivo Principal</strong>: DiseÃ±ar e implementar un esquema completo de base de datos con relaciones complejas</p>
<p><strong>Objetivos EspecÃ­ficos</strong>:</p>
<ol>
<li>âœ… DiseÃ±ar esquema ER (Entidad-RelaciÃ³n) completo</li>
<li>âœ… Crear modelo base con timestamps automÃ¡ticos</li>
<li>âœ… Implementar modelo User completo</li>
<li>âœ… Implementar modelo Project con relaciÃ³n 1:N a User</li>
<li>âœ… Implementar modelo Task con relaciones mÃºltiples</li>
<li>âœ… Implementar modelo Tag con relaciÃ³n N:M a Task</li>
<li>âœ… Configurar Alembic para migraciones</li>
<li>âœ… Crear esquemas Pydantic correspondientes</li>
<li>âœ… Aplicar migraciones en PostgreSQL</li>
</ol>
<h3>ğŸ”‘ Puntos Clave TÃ©cnicos</h3>
<h4>1. DiseÃ±o del Esquema de Base de Datos</h4>
<p><strong>Entidades Principales</strong>:</p>
<ul>
<li><strong>User</strong>: Usuarios del sistema</li>
<li><strong>Project</strong>: Proyectos creados por usuarios</li>
<li><strong>Task</strong>: Tareas dentro de proyectos</li>
<li><strong>Tag</strong>: Etiquetas para categorizar tareas</li>
</ul>
<p><strong>Relaciones DiseÃ±adas</strong>:</p>
<pre><code>User (1) â”€â”€&lt; Project (N)     [Un usuario tiene muchos proyectos]
Project (1) â”€â”€&lt; Task (N)     [Un proyecto tiene muchas tareas]
User (1) â”€â”€&lt; Task (N)        [Un usuario tiene tareas asignadas - opcional]
Task (N) &gt;&lt;â”€â”€ Tag (M)        [Muchas tareas tienen muchos tags]
</code></pre>
<p><strong>Decisiones de DiseÃ±o</strong>:</p>
<ul>
<li>User como &quot;owner&quot; de Projects (no puede ser nulo)</li>
<li>Task asignada a User es opcional (puede ser NULL)</li>
<li>Cascadas apropiadas para mantener integridad referencial</li>
<li>Indices en foreign keys para performance</li>
</ul>
<h4>2. Modelo Base con Timestamps</h4>
<p><strong>models/base.py</strong>:</p>
<pre><code class="language-python">from datetime import datetime
from sqlalchemy import Column, Integer, DateTime
from sqlalchemy.ext.declarative import declared_attr
from app.db.base import Base

class TimestampMixin:
    &quot;&quot;&quot;Mixin para timestamps automÃ¡ticos&quot;&quot;&quot;
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(
        DateTime, 
        default=datetime.utcnow, 
        onupdate=datetime.utcnow, 
        nullable=False
    )

class BaseModel(Base, TimestampMixin):
    &quot;&quot;&quot;Clase base para todos los modelos&quot;&quot;&quot;
    __abstract__ = True
    
    id = Column(Integer, primary_key=True, index=True, autoincrement=True)
    
    @declared_attr
    def __tablename__(cls) -&gt; str:
        return cls.__name__.lower()
</code></pre>
<p><strong>Beneficios del Modelo Base</strong>:</p>
<ul>
<li>DRY: <code>id</code>, <code>created_at</code>, <code>updated_at</code> en todos los modelos automÃ¡ticamente</li>
<li><code>datetime.utcnow</code> sin <code>()</code> para lazy evaluation</li>
<li><code>onupdate</code> actualiza <code>updated_at</code> en cada UPDATE</li>
<li><code>__abstract__ = True</code> evita crear tabla para BaseModel</li>
<li><code>declared_attr</code> para generar <code>__tablename__</code> dinÃ¡micamente</li>
</ul>
<h4>3. Modelo User Completo</h4>
<p><strong>models/user.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import Boolean, Column, String
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class User(BaseModel):
    __tablename__ = &quot;users&quot;
    
    # Campos bÃ¡sicos
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(255), unique=True, index=True, nullable=False)
    full_name = Column(String(100), nullable=True)
    hashed_password = Column(String(255), nullable=False)
    
    # Estados booleanos
    is_active = Column(Boolean, default=True)
    is_superuser = Column(Boolean, default=False)
    is_verified = Column(Boolean, default=False)
    
    # Relaciones
    projects = relationship(
        &quot;Project&quot;, 
        back_populates=&quot;owner&quot;,
        cascade=&quot;all, delete-orphan&quot;,
        lazy=&quot;dynamic&quot;
    )
    
    assigned_tasks = relationship(
        &quot;Task&quot;,
        back_populates=&quot;assignee&quot;,
        foreign_keys=&quot;[Task.assigned_to_id]&quot;,
        lazy=&quot;dynamic&quot;
    )
</code></pre>
<p><strong>CaracterÃ­sticas Importantes</strong>:</p>
<ul>
<li><code>unique=True</code> en username y email</li>
<li><code>index=True</code> en campos de bÃºsqueda frecuente</li>
<li><code>cascade=&quot;all, delete-orphan&quot;</code> elimina proyectos si se elimina usuario</li>
<li><code>lazy=&quot;dynamic&quot;</code> para cargar relaciones bajo demanda</li>
<li><code>foreign_keys</code> explÃ­cito cuando hay ambigÃ¼edad</li>
</ul>
<p><strong>Esquema Pydantic Correspondiente</strong>:</p>
<pre><code class="language-python">from pydantic import BaseModel, EmailStr, Field

class UserBase(BaseModel):
    email: EmailStr
    username: str = Field(..., min_length=3, max_length=50)
    full_name: Optional[str] = None

class UserCreate(UserBase):
    password: str = Field(..., min_length=8)

class User(UserBase):
    id: int
    is_active: bool
    is_superuser: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True  # Antes orm_mode
</code></pre>
<h4>4. RelaciÃ³n 1:N (Project pertenece a User)</h4>
<p><strong>models/project.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import Boolean, Column, String, Text, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class Project(BaseModel):
    __tablename__ = &quot;projects&quot;
    
    name = Column(String(100), nullable=False, index=True)
    description = Column(Text, nullable=True)
    is_active = Column(Boolean, default=True)
    
    # Foreign Key a User
    owner_id = Column(
        Integer, 
        ForeignKey(&quot;users.id&quot;, ondelete=&quot;CASCADE&quot;),
        nullable=False,
        index=True
    )
    
    # Relaciones
    owner = relationship(&quot;User&quot;, back_populates=&quot;projects&quot;)
    tasks = relationship(
        &quot;Task&quot;,
        back_populates=&quot;project&quot;,
        cascade=&quot;all, delete-orphan&quot;,
        lazy=&quot;dynamic&quot;
    )
</code></pre>
<p><strong>Aspectos Clave</strong>:</p>
<ul>
<li><code>ForeignKey(&quot;users.id&quot;, ondelete=&quot;CASCADE&quot;)</code>
<ul>
<li>Si se elimina el usuario, se eliminan sus proyectos</li>
<li>Integridad referencial a nivel de BD</li>
</ul>
</li>
<li><code>nullable=False</code> en <code>owner_id</code>
<ul>
<li>Proyecto DEBE tener un owner</li>
<li>No puede existir proyecto huÃ©rfano</li>
</ul>
</li>
<li><code>index=True</code> en foreign keys
<ul>
<li>Acelera queries <code>WHERE owner_id = X</code></li>
<li>Crucial para performance</li>
</ul>
</li>
</ul>
<h4>5. Modelo Task con Relaciones MÃºltiples y Enums</h4>
<p><strong>models/task.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import Column, String, Text, Integer, ForeignKey, Enum, Date
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel

class TaskStatus(str, enum.Enum):
    TODO = &quot;todo&quot;
    IN_PROGRESS = &quot;in_progress&quot;
    IN_REVIEW = &quot;in_review&quot;
    DONE = &quot;done&quot;
    CANCELLED = &quot;cancelled&quot;

class TaskPriority(str, enum.Enum):
    LOW = &quot;low&quot;
    MEDIUM = &quot;medium&quot;
    HIGH = &quot;high&quot;
    URGENT = &quot;urgent&quot;

class Task(BaseModel):
    __tablename__ = &quot;tasks&quot;
    
    title = Column(String(200), nullable=False, index=True)
    description = Column(Text, nullable=True)
    status = Column(Enum(TaskStatus), default=TaskStatus.TODO, nullable=False, index=True)
    priority = Column(Enum(TaskPriority), default=TaskPriority.MEDIUM, nullable=False)
    due_date = Column(Date, nullable=True)
    
    # FK a Project (requerido)
    project_id = Column(
        Integer,
        ForeignKey(&quot;projects.id&quot;, ondelete=&quot;CASCADE&quot;),
        nullable=False,
        index=True
    )
    
    # FK a User (opcional)
    assigned_to_id = Column(
        Integer,
        ForeignKey(&quot;users.id&quot;, ondelete=&quot;SET NULL&quot;),
        nullable=True,
        index=True
    )
    
    # Relaciones
    project = relationship(&quot;Project&quot;, back_populates=&quot;tasks&quot;)
    assignee = relationship(&quot;User&quot;, back_populates=&quot;assigned_tasks&quot;, foreign_keys=[assigned_to_id])
    tags = relationship(&quot;Tag&quot;, secondary=&quot;task_tags&quot;, back_populates=&quot;tasks&quot;, lazy=&quot;dynamic&quot;)
</code></pre>
<p><strong>CaracterÃ­sticas Avanzadas</strong>:</p>
<ul>
<li><strong>Enums</strong>: Valores restringidos a nivel de BD
<ul>
<li><code>str, enum.Enum</code> para compatibilidad Pydantic</li>
<li>Previene datos invÃ¡lidos</li>
<li>Mejor que strings libres</li>
</ul>
</li>
<li><strong>ondelete Diferenciados</strong>:
<ul>
<li><code>CASCADE</code> para project: eliminar task si se elimina proyecto</li>
<li><code>SET NULL</code> para assignee: dejar sin asignar si se elimina usuario</li>
</ul>
</li>
<li><strong>Ãndice en status</strong>: Queries frecuentes por estado</li>
<li><strong>RelaciÃ³n N:M</strong> con tags via tabla intermedia</li>
</ul>
<h4>6. RelaciÃ³n N:M (Task â†” Tag)</h4>
<p><strong>models/tag.py</strong>:</p>
<pre><code class="language-python">from sqlalchemy import Column, String, Integer, ForeignKey, Table
from sqlalchemy.orm import relationship
from app.models.base import BaseModel, Base

# Tabla intermedia (association table)
task_tags = Table(
    'task_tags',
    Base.metadata,
    Column('task_id', Integer, ForeignKey('tasks.id', ondelete=&quot;CASCADE&quot;), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete=&quot;CASCADE&quot;), primary_key=True)
)

class Tag(BaseModel):
    __tablename__ = &quot;tags&quot;
    
    name = Column(String(50), unique=True, nullable=False, index=True)
    color = Column(String(7), default=&quot;#808080&quot;)  # Hex color
    
    # RelaciÃ³n N:M
    tasks = relationship(
        &quot;Task&quot;,
        secondary=task_tags,
        back_populates=&quot;tags&quot;,
        lazy=&quot;dynamic&quot;
    )
</code></pre>
<p><strong>RelaciÃ³n N:M Explicada</strong>:</p>
<ul>
<li><strong>Tabla Intermedia</strong>: <code>task_tags</code> sin modelo ORM
<ul>
<li>Solo une IDs de tasks y tags</li>
<li>Primary key compuesta (task_id, tag_id)</li>
<li>Cascadas en ambas direcciones</li>
</ul>
</li>
<li><strong>secondary</strong>: SQLAlchemy maneja automÃ¡ticamente la tabla intermedia</li>
<li><strong>Uso</strong>:<pre><code class="language-python">task.tags.append(tag)  # Agregar tag a task
task.tags.remove(tag)  # Quitar tag de task
tags_of_task = task.tags.all()  # Obtener tags de task
tasks_with_tag = tag.tasks.all()  # Obtener tasks con tag
</code></pre>
</li>
</ul>
<h4>7. Migraciones con Alembic</h4>
<p><strong>ConfiguraciÃ³n de Alembic</strong>:</p>
<pre><code class="language-bash"># Inicializar Alembic
alembic init alembic
</code></pre>
<p><strong>alembic/env.py (configurado)</strong>:</p>
<pre><code class="language-python">from app.core.config import settings
from app.db.base import Base
# Importar TODOS los modelos para detecciÃ³n automÃ¡tica
from app.models import user, project, task, tag

config.set_main_option(&quot;sqlalchemy.url&quot;, settings.DATABASE_URL)
target_metadata = Base.metadata

def run_migrations_online():
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix=&quot;sqlalchemy.&quot;,
        poolclass=pool.NullPool,
    )
    with connectable.connect() as connection:
        context.configure(connection=connection, target_metadata=target_metadata)
        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<p><strong>Comandos de Alembic</strong>:</p>
<pre><code class="language-bash"># Crear migraciÃ³n automÃ¡tica
alembic revision --autogenerate -m &quot;Create all tables&quot;

# Revisar migraciÃ³n generada
# alembic/versions/001_create_all_tables.py

# Aplicar migraciones
alembic upgrade head

# Ver estado actual
alembic current

# Ver historial
alembic history

# Revertir Ãºltima migraciÃ³n
alembic downgrade -1

# Revertir todo
alembic downgrade base
</code></pre>
<p><strong>MigraciÃ³n Generada (simplificado)</strong>:</p>
<pre><code class="language-python">def upgrade():
    op.create_table(
        'users',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('username', sa.String(50), nullable=False),
        sa.Column('email', sa.String(255), nullable=False),
        # ... mÃ¡s columnas
        sa.PrimaryKeyConstraint('id'),
        sa.UniqueConstraint('email'),
        sa.UniqueConstraint('username')
    )
    op.create_index('ix_users_email', 'users', ['email'])
    
    op.create_table(
        'projects',
        # ... definiciÃ³n
        sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ondelete='CASCADE')
    )
    
    # ... mÃ¡s tablas

def downgrade():
    op.drop_table('task_tags')
    op.drop_table('tasks')
    op.drop_table('tags')
    op.drop_table('projects')
    op.drop_table('users')
</code></pre>
<h3>ğŸ’¼ TecnologÃ­as y Conceptos Utilizados</h3>
<table>
<thead>
<tr>
<th>Concepto</th>
<th>ImplementaciÃ³n</th>
<th>Beneficio</th>
</tr>
</thead>
<tbody>
<tr>
<td>SQLAlchemy ORM</td>
<td>Modelos declarativos</td>
<td>AbstracciÃ³n de SQL</td>
</tr>
<tr>
<td>Alembic</td>
<td>Sistema de migraciones</td>
<td>Versionado de esquema</td>
</tr>
<tr>
<td>Pydantic Schemas</td>
<td>ValidaciÃ³n de I/O</td>
<td>Type safety</td>
</tr>
<tr>
<td>Enums</td>
<td>TaskStatus, TaskPriority</td>
<td>Valores restringidos</td>
</tr>
<tr>
<td>Timestamps</td>
<td>created_at, updated_at</td>
<td>AuditorÃ­a automÃ¡tica</td>
</tr>
<tr>
<td>Cascadas</td>
<td>ondelete behaviors</td>
<td>Integridad referencial</td>
</tr>
<tr>
<td>Ãndices</td>
<td>index=True en campos clave</td>
<td>Performance de queries</td>
</tr>
<tr>
<td>Relaciones 1:N</td>
<td>Userâ†’Projects, Projectâ†’Tasks</td>
<td>Modelado jerÃ¡rquico</td>
</tr>
<tr>
<td>Relaciones N:M</td>
<td>Taskâ†”Tag</td>
<td>ClasificaciÃ³n flexible</td>
</tr>
</tbody>
</table>
<h3>âœ… Resultados Alcanzados</h3>
<p>Al finalizar este episodio:</p>
<ol>
<li>
<p><strong>Esquema de BD Completo</strong>:</p>
<ul>
<li>4 tablas principales (users, projects, tasks, tags)</li>
<li>1 tabla intermedia (task_tags)</li>
<li>Todas las relaciones configuradas</li>
</ul>
</li>
<li>
<p><strong>Modelos SQLAlchemy</strong>:</p>
<ul>
<li>Modelo base reutilizable</li>
<li>Timestamps automÃ¡ticos</li>
<li>Relaciones bidireccionales</li>
<li>Cascadas y comportamientos configurados</li>
</ul>
</li>
<li>
<p><strong>Esquemas Pydantic</strong>:</p>
<ul>
<li>Schemas de creaciÃ³n (Create)</li>
<li>Schemas de actualizaciÃ³n (Update)</li>
<li>Schemas de respuesta (Response)</li>
<li>Validaciones con Field()</li>
</ul>
</li>
<li>
<p><strong>Sistema de Migraciones</strong>:</p>
<ul>
<li>Alembic configurado</li>
<li>MigraciÃ³n inicial creada</li>
<li>Esquema aplicado en PostgreSQL</li>
</ul>
</li>
<li>
<p><strong>Features Avanzadas</strong>:</p>
<ul>
<li>Enums para estados</li>
<li>Relaciones opcionales y requeridas</li>
<li>Tabla intermedia para N:M</li>
<li>Ãndices para performance</li>
</ul>
</li>
<li>
<p><strong>Integridad de Datos</strong>:</p>
<ul>
<li>Foreign keys con constraints</li>
<li>Unique constraints</li>
<li>NOT NULL donde corresponde</li>
<li>Cascadas para mantener consistencia</li>
</ul>
</li>
</ol>
<h3>ğŸ”— ConexiÃ³n con Episodios Previos/Siguientes</h3>
<p><strong>Depende de</strong>:</p>
<ul>
<li><strong>Episodio 2</strong>: ConfiguraciÃ³n de SQLAlchemy</li>
<li><strong>Episodio 4</strong>: Repositorios preparados para estos modelos</li>
</ul>
<p><strong>Utiliza</strong>:</p>
<ul>
<li><strong>Arquitectura del Ep. 4</strong>: Estos modelos usan los repositorios y servicios</li>
</ul>
<p><strong>Prepara para</strong>:</p>
<ul>
<li><strong>Episodios futuros</strong>: CRUD completo con estos modelos</li>
<li><strong>Endpoints</strong>: API para proyectos, tareas y tags</li>
<li><strong>Frontend</strong>: UI para gestionar todas estas entidades</li>
</ul>
<p><strong>EvoluciÃ³n del Proyecto</strong>:</p>
<pre><code>Ep 2: ConfiguraciÃ³n SQLAlchemy bÃ¡sica
Ep 4: Arquitectura en capas
Ep 5: Modelos complejos + Migraciones
      â†“
PrÃ³ximo: CRUD completo + WebSockets
</code></pre>
<h3>ğŸ“Œ Notas Importantes</h3>
<blockquote>
<p><strong>Importar Modelos</strong>: En <code>alembic/env.py</code>, importar TODOS los modelos para que Alembic los detecte en autogenerate.</p>
</blockquote>
<blockquote>
<p><strong>Revisar Migraciones</strong>: SIEMPRE revisar migraciones autogeneradas antes de aplicarlas. Alembic puede equivocarse.</p>
</blockquote>
<blockquote>
<p><strong>Orden de CreaciÃ³n</strong>: Las migraciones crean tablas en orden correcto respetando foreign keys (primero users, luego projects, luego tasks).</p>
</blockquote>
<blockquote>
<p><strong>Cascadas</strong>: <code>ondelete=&quot;CASCADE&quot;</code> vs <code>ondelete=&quot;SET NULL&quot;</code> tienen implicaciones importantes. Elegir segÃºn la semÃ¡ntica del negocio.</p>
</blockquote>
<blockquote>
<p><strong>Enums</strong>: SQLAlchemy crea un tipo ENUM en PostgreSQL. Cambiar enums requiere migraciÃ³n cuidadosa.</p>
</blockquote>
<blockquote>
<p><strong>lazy=&quot;dynamic&quot;</strong>: Retorna query en lugar de lista. Ãštil para relaciones con muchos registros.</p>
</blockquote>
<h3>ğŸ¬ Estructura del Episodio</h3>
<pre><code>[00:00-03:00] â†’ IntroducciÃ³n y diseÃ±o del esquema ER
[03:00-07:00] â†’ ImplementaciÃ³n del modelo base y User
[07:00-10:00] â†’ Modelo Project con relaciÃ³n 1:N
[10:00-14:00] â†’ Modelo Task con relaciones mÃºltiples y enums
[14:00-17:00] â†’ Modelo Tag y relaciÃ³n N:M
[17:00-20:00] â†’ ConfiguraciÃ³n de Alembic y creaciÃ³n de migraciÃ³n
[20:00-22:06] â†’ Aplicar migraciones y verificaciÃ³n en PostgreSQL
</code></pre>
<h3>ğŸ’¡ Tips del Instructor</h3>
<ol>
<li>
<p><strong>Sobre DiseÃ±o de Esquema</strong>: Dibuja el diagrama ER antes de codificar. Ayuda a visualizar relaciones.</p>
</li>
<li>
<p><strong>Sobre Migraciones</strong>: Usa mensajes descriptivos. SerÃ¡s tÃº en el futuro quien los lea.</p>
</li>
<li>
<p><strong>Sobre Enums</strong>: Define enums en el modelo SQLAlchemy. Pydantic los importa automÃ¡ticamente.</p>
</li>
<li>
<p><strong>Sobre Relaciones</strong>: <code>back_populates</code> debe coincidir en ambos modelos o fallarÃ¡.</p>
</li>
<li>
<p><strong>Sobre Ãndices</strong>: Indexar foreign keys es crucial. PostgreSQL no lo hace automÃ¡ticamente.</p>
</li>
<li>
<p><strong>Sobre Timestamps</strong>: Siempre usar UTC (<code>datetime.utcnow</code>). Convertir a timezone local en el frontend.</p>
</li>
<li>
<p><strong>Sobre Cascadas</strong>: Documentar decisiones de <code>ondelete</code> en comentarios. No siempre es obvio por quÃ© se eligiÃ³ CASCADE vs SET NULL.</p>
</li>
</ol>
<hr>
<h2>ğŸ“Š RESUMEN COMPARATIVO DE LA SERIE</h2>
<h3>DuraciÃ³n y Popularidad</h3>
<table>
<thead>
<tr>
<th>Episodio</th>
<th>DuraciÃ³n</th>
<th>Vistas</th>
<th>Me Gusta</th>
<th>Complejidad</th>
<th>Enfoque Principal</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10:13</td>
<td>650</td>
<td>55</td>
<td>â˜…â˜†â˜†â˜†â˜†</td>
<td>Conceptual</td>
</tr>
<tr>
<td>2</td>
<td>43:31 â­</td>
<td>538</td>
<td>33</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>ImplementaciÃ³n Backend</td>
</tr>
<tr>
<td>3</td>
<td>28:14</td>
<td>258</td>
<td>18</td>
<td>â˜…â˜…â˜…â˜†â˜†</td>
<td>ImplementaciÃ³n Frontend</td>
</tr>
<tr>
<td>4</td>
<td>16:14</td>
<td>142</td>
<td>10</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>Arquitectura Avanzada</td>
</tr>
<tr>
<td>5</td>
<td>22:06</td>
<td>221</td>
<td>15</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>Modelado de Datos</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>~2h</strong></td>
<td><strong>1,809</strong></td>
<td><strong>131</strong></td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<h3>ProgresiÃ³n del Conocimiento</h3>
<pre><code>Episodio 1: CONCEPTOS
â†“ (comprensiÃ³n general)

Episodio 2: BACKEND BÃSICO
â†“ (implementaciÃ³n inicial)

Episodio 3: FRONTEND BÃSICO
â†“ (aplicaciÃ³n funcionando end-to-end)

Episodio 4: REFACTORING PROFESIONAL
â†“ (cÃ³digo de calidad producciÃ³n)

Episodio 5: DATOS COMPLEJOS
â†“ (modelado avanzado)

[Episodios Futuros]: FEATURES COMPLETAS
</code></pre>
<h3>Stack TecnolÃ³gico Final</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FULL STACK COMPLETO               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frontend:                                   â”‚
â”‚  â€¢ Next.js 14 (App Router)                 â”‚
â”‚  â€¢ TypeScript 5                             â”‚
â”‚  â€¢ TailwindCSS 3                            â”‚
â”‚  â€¢ shadcn/ui                                â”‚
â”‚  â€¢ axios                                    â”‚
â”‚                                             â”‚
â”‚ Backend:                                    â”‚
â”‚  â€¢ FastAPI 0.109+                          â”‚
â”‚  â€¢ Python 3.11+                             â”‚
â”‚  â€¢ SQLAlchemy 2.0                           â”‚
â”‚  â€¢ Alembic                                  â”‚
â”‚  â€¢ Pydantic 2.5+                            â”‚
â”‚  â€¢ JWT (python-jose)                        â”‚
â”‚  â€¢ bcrypt (passlib)                         â”‚
â”‚                                             â”‚
â”‚ Base de Datos:                              â”‚
â”‚  â€¢ PostgreSQL 15                            â”‚
â”‚                                             â”‚
â”‚ DevOps:                                     â”‚
â”‚  â€¢ Docker/Podman                            â”‚
â”‚  â€¢ docker-compose                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3>ConclusiÃ³n de la Serie (hasta ahora)</h3>
<p>Estos 5 episodios establecen una base sÃ³lida y profesional para una aplicaciÃ³n Full Stack moderna. La progresiÃ³n es lÃ³gica y bien estructurada:</p>
<ol>
<li><strong>VisiÃ³n</strong> â†’ Sabes QUÃ‰ vas a construir</li>
<li><strong>Backend</strong> â†’ Tienes un servidor funcionando</li>
<li><strong>Frontend</strong> â†’ Tienes una UI que consume la API</li>
<li><strong>Arquitectura</strong> â†’ CÃ³digo profesional y escalable</li>
<li><strong>Datos</strong> â†’ Modelo de datos robusto</li>
</ol>
<p>Los prÃ³ximos episodios (anticipados) cubrirÃ­an:</p>
<ul>
<li>CRUD completo para todas las entidades</li>
<li>AutenticaciÃ³n completa (JWT, cookies, refresh tokens)</li>
<li>WebSockets implementados</li>
<li>Testing comprehensivo</li>
<li>Despliegue en producciÃ³n</li>
</ul>
<p><strong>Valor de la Serie</strong>: Este no es un tutorial bÃ¡sico. Es una guÃ­a completa para construir aplicaciones profesionales con stack moderno, siguiendo mejores prÃ¡cticas desde el inicio.</p>
<hr>
<p><em>Fin del Documento 3</em></p>
<h2>--------------------------------------------------</h2>
<hr>
<h2>DOCUMENTO 4: GUÃA DE IMPLEMENTACIÃ“N PRÃCTICA</h2>
<h1>DOCUMENTO 4: GUÃA DE IMPLEMENTACIÃ“N PRÃCTICA</h1>
<h2>AplicaciÃ³n Full Stack con FastAPI y Next.js</h2>
<h3>GuÃ­a Paso a Paso para Replicar el Proyecto</h3>
<hr>
<h2>ğŸ“‹ TABLA DE CONTENIDOS</h2>
<ol>
<li><a href="#requisitos-previos-y-herramientas">Requisitos Previos y Herramientas</a></li>
<li><a href="#instalaci%C3%B3n-y-configuraci%C3%B3n-del-entorno">InstalaciÃ³n y ConfiguraciÃ³n del Entorno</a></li>
<li><a href="#configuraci%C3%B3n-del-backend-fastapi">ConfiguraciÃ³n del Backend (FastAPI)</a></li>
<li><a href="#configuraci%C3%B3n-del-frontend-nextjs">ConfiguraciÃ³n del Frontend (Next.js)</a></li>
<li><a href="#configuraci%C3%B3n-de-la-base-de-datos">ConfiguraciÃ³n de la Base de Datos</a></li>
<li><a href="#estructura-completa-de-archivos">Estructura Completa de Archivos</a></li>
<li><a href="#c%C3%B3digo-completo-por-m%C3%B3dulos">CÃ³digo Completo por MÃ³dulos</a></li>
<li><a href="#comandos-de-terminal-necesarios">Comandos de Terminal Necesarios</a></li>
<li><a href="#checklist-de-verificaci%C3%B3n">Checklist de VerificaciÃ³n</a></li>
<li><a href="#troubleshooting-com%C3%BAn">Troubleshooting ComÃºn</a></li>
</ol>
<hr>
<h2>1. REQUISITOS PREVIOS Y HERRAMIENTAS</h2>
<h3>ğŸ”§ Software Necesario</h3>
<h4>Obligatorio</h4>
<table>
<thead>
<tr>
<th>Herramienta</th>
<th>VersiÃ³n MÃ­nima</th>
<th>PropÃ³sito</th>
<th>Descarga</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Python</strong></td>
<td>3.11+</td>
<td>Backend con FastAPI</td>
<td>https://www.python.org/downloads/</td>
</tr>
<tr>
<td><strong>Node.js</strong></td>
<td>18+ LTS</td>
<td>Frontend con Next.js</td>
<td>https://nodejs.org/</td>
</tr>
<tr>
<td><strong>Docker</strong></td>
<td>20+</td>
<td>ContenedorizaciÃ³n</td>
<td>https://www.docker.com/</td>
</tr>
<tr>
<td><strong>Git</strong></td>
<td>2.30+</td>
<td>Control de versiones</td>
<td>https://git-scm.com/</td>
</tr>
</tbody>
</table>
<h4>Alternativas a Docker</h4>
<table>
<thead>
<tr>
<th>Herramienta</th>
<th>Ventaja</th>
<th>Descarga</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Podman</strong></td>
<td>No requiere daemon root</td>
<td>https://podman.io/</td>
</tr>
<tr>
<td><strong>PostgreSQL Local</strong></td>
<td>Sin contenedores</td>
<td>https://www.postgresql.org/download/</td>
</tr>
</tbody>
</table>
<h4>Editores de CÃ³digo Recomendados</h4>
<table>
<thead>
<tr>
<th>Editor</th>
<th>Ventajas</th>
<th>Extensiones Recomendadas</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VSCode</strong></td>
<td>Ecosistema rico, gratis</td>
<td>Python, Pylance, ESLint, Prettier, Tailwind CSS IntelliSense</td>
</tr>
<tr>
<td><strong>PyCharm</strong></td>
<td>Excelente para Python</td>
<td>N/A (integrado)</td>
</tr>
<tr>
<td><strong>WebStorm</strong></td>
<td>Excelente para Next.js</td>
<td>N/A (integrado)</td>
</tr>
</tbody>
</table>
<h3>ğŸ“š Conocimientos Previos Recomendados</h3>
<p><strong>Nivel MÃ­nimo</strong>: Intermedio</p>
<p><strong>Backend</strong>:</p>
<ul>
<li>âœ… Python bÃ¡sico (funciones, clases, decoradores)</li>
<li>âœ… Conceptos de API REST (GET, POST, PUT, DELETE)</li>
<li>âœ… SQL bÃ¡sico (SELECT, INSERT, UPDATE, DELETE)</li>
<li>â­ Async/await en Python (deseable)</li>
<li>â­ ORM (SQLAlchemy) (deseable)</li>
</ul>
<p><strong>Frontend</strong>:</p>
<ul>
<li>âœ… JavaScript/TypeScript bÃ¡sico</li>
<li>âœ… React fundamentals (components, hooks)</li>
<li>âœ… CSS bÃ¡sico</li>
<li>â­ Next.js App Router (deseable)</li>
<li>â­ TailwindCSS (deseable)</li>
</ul>
<p><strong>DevOps</strong>:</p>
<ul>
<li>âœ… Terminal/LÃ­nea de comandos</li>
<li>âœ… Conceptos bÃ¡sicos de Docker</li>
<li>â­ docker-compose (deseable)</li>
</ul>
<h3>ğŸŒ Recursos de Aprendizaje</h3>
<p>Si necesitas repasar algÃºn concepto:</p>
<ul>
<li><strong>Python Async</strong>: https://docs.python.org/3/library/asyncio.html</li>
<li><strong>FastAPI Tutorial</strong>: https://fastapi.tiangolo.com/tutorial/</li>
<li><strong>Next.js Learn</strong>: https://nextjs.org/learn</li>
<li><strong>SQLAlchemy Docs</strong>: https://docs.sqlalchemy.org/</li>
<li><strong>Docker Get Started</strong>: https://docs.docker.com/get-started/</li>
</ul>
<hr>
<h2>2. INSTALACIÃ“N Y CONFIGURACIÃ“N DEL ENTORNO</h2>
<h3>ğŸš€ Paso 1: Verificar Instalaciones</h3>
<p>Abre una terminal y verifica que todo estÃ© instalado:</p>
<pre><code class="language-bash"># Verificar Python
python --version
# Debe mostrar: Python 3.11.x o superior

# Verificar pip
pip --version

# Verificar Node.js
node --version
# Debe mostrar: v18.x.x o superior

# Verificar npm
npm --version

# Verificar Docker
docker --version
docker-compose --version

# Verificar Git
git --version
</code></pre>
<p><strong>Â¿Algo falta?</strong> Instala desde los links de la secciÃ³n anterior.</p>
<h3>ğŸš€ Paso 2: Crear Estructura del Proyecto</h3>
<pre><code class="language-bash"># Crear directorio principal
mkdir fastapi-nextjs-fullstack
cd fastapi-nextjs-fullstack

# Inicializar repositorio Git
git init

# Crear .gitignore
touch .gitignore
</code></pre>
<p><strong>Contenido de <code>.gitignore</code></strong>:</p>
<pre><code class="language-gitignore"># Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
.env
*.db
*.log

# Node
node_modules/
.next/
out/
.env.local
.env.production.local
.turbo

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Database
*.sql
postgres_data/

# Docker
*.log
</code></pre>
<h3>ğŸš€ Paso 3: Crear Directorios del Proyecto</h3>
<pre><code class="language-bash"># Crear estructura base
mkdir -p backend/app/{api/v1/endpoints,core,db,models,repositories,schemas,services}
mkdir -p frontend/src/{app,components/ui,lib,hooks,types}
mkdir -p postgres_data

# Ãrbol resultante:
# .
# â”œâ”€â”€ backend/
# â”‚   â””â”€â”€ app/
# â”œâ”€â”€ frontend/
# â”‚   â””â”€â”€ src/
# â”œâ”€â”€ postgres_data/
# â””â”€â”€ .gitignore
</code></pre>
<hr>
<h2>3. CONFIGURACIÃ“N DEL BACKEND (FASTAPI)</h2>
<h3>ğŸ“¦ Paso 1: Crear Entorno Virtual de Python</h3>
<pre><code class="language-bash">cd backend

# Crear entorno virtual
python -m venv venv

# Activar entorno virtual
# En Linux/Mac:
source venv/bin/activate
# En Windows:
venv\Scripts\activate

# Tu terminal ahora deberÃ­a mostrar (venv) al inicio
</code></pre>
<p><strong>âš ï¸ IMPORTANTE</strong>: Siempre activa el entorno virtual antes de trabajar con el backend.</p>
<h3>ğŸ“¦ Paso 2: Instalar Dependencias de Python</h3>
<p>Crear <code>requirements.txt</code>:</p>
<pre><code class="language-txt"># Framework
fastapi==0.109.0
uvicorn[standard]==0.27.0

# Base de datos
sqlalchemy==2.0.25
alembic==1.13.1
psycopg2-binary==2.9.9

# ValidaciÃ³n y configuraciÃ³n
pydantic==2.5.3
pydantic-settings==2.1.0
python-dotenv==1.0.0

# AutenticaciÃ³n
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# WebSockets
websockets==12.0

# CORS
python-cors==1.0.0

# Utilidades
python-dateutil==2.8.2
</code></pre>
<p>Instalar:</p>
<pre><code class="language-bash">pip install -r requirements.txt

# Verificar instalaciÃ³n
pip list
</code></pre>
<h3>ğŸ“¦ Paso 3: Configurar Variables de Entorno</h3>
<p>Crear <code>backend/.env</code>:</p>
<pre><code class="language-env"># AplicaciÃ³n
APP_NAME=&quot;FastAPI Full Stack Application&quot;
DEBUG=True
VERSION=&quot;1.0.0&quot;

# Base de datos
DATABASE_URL=postgresql://fastapi_user:SecurePassword123@localhost:5432/fullstack_db

# Seguridad
SECRET_KEY=your-super-secret-key-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS
ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# Servidor
HOST=0.0.0.0
PORT=8000
</code></pre>
<p><strong>ğŸ” Generar SECRET_KEY Seguro</strong>:</p>
<pre><code class="language-bash"># Usar Python para generar clave aleatoria
python -c &quot;import secrets; print(secrets.token_urlsafe(32))&quot;

# O usar openssl
openssl rand -hex 32
</code></pre>
<h3>ğŸ“¦ Paso 4: Estructura de Archivos del Backend</h3>
<p>Crear todos los archivos Python necesarios:</p>
<pre><code class="language-bash"># Desde backend/

# Archivos de paquete (__init__.py)
touch app/__init__.py
touch app/api/__init__.py
touch app/api/v1/__init__.py
touch app/api/v1/endpoints/__init__.py
touch app/core/__init__.py
touch app/db/__init__.py
touch app/models/__init__.py
touch app/repositories/__init__.py
touch app/schemas/__init__.py
touch app/services/__init__.py

# Archivos principales
touch app/main.py
touch app/core/config.py
touch app/core/security.py
touch app/db/base.py
touch app/db/session.py
touch app/api/deps.py
touch app/api/v1/router.py

# Modelos
touch app/models/base.py
touch app/models/user.py
touch app/models/project.py
touch app/models/task.py
touch app/models/tag.py

# Schemas
touch app/schemas/user.py
touch app/schemas/project.py
touch app/schemas/task.py
touch app/schemas/tag.py
touch app/schemas/token.py

# Repositories
touch app/repositories/base.py
touch app/repositories/user.py
touch app/repositories/project.py

# Services
touch app/services/user_service.py
touch app/services/auth_service.py

# Endpoints
touch app/api/v1/endpoints/auth.py
touch app/api/v1/endpoints/users.py
touch app/api/v1/endpoints/health.py

# Dockerfile
touch Dockerfile
</code></pre>
<h3>ğŸ“¦ Paso 5: Configurar Alembic</h3>
<pre><code class="language-bash"># Desde backend/ con venv activado
alembic init alembic

# Esto crea:
# alembic/
# â”œâ”€â”€ env.py
# â”œâ”€â”€ script.py.mako
# â””â”€â”€ versions/
# alembic.ini
</code></pre>
<p>Modificar <code>alembic.ini</code>:</p>
<pre><code class="language-ini"># LÃ­nea ~40: Comentar sqlalchemy.url
# sqlalchemy.url = driver://user:pass@localhost/dbname

# La URL se obtendrÃ¡ dinÃ¡micamente de .env
</code></pre>
<hr>
<h2>4. CONFIGURACIÃ“N DEL FRONTEND (NEXT.JS)</h2>
<h3>ğŸ“¦ Paso 1: Crear Proyecto Next.js</h3>
<pre><code class="language-bash"># Desde la raÃ­z del proyecto
cd ..  # Salir de backend/

# Crear proyecto Next.js
npx create-next-app@latest frontend \
  --typescript \
  --tailwind \
  --app \
  --src-dir \
  --no-git \
  --import-alias &quot;@/*&quot;

# Opciones interactivas (si las pide):
# âœ” Use ESLint? â†’ Yes
# âœ” Use Turbopack? â†’ No
# âœ” Customize default import alias? â†’ No
</code></pre>
<h3>ğŸ“¦ Paso 2: Instalar Dependencias Adicionales</h3>
<pre><code class="language-bash">cd frontend

# Cliente HTTP
npm install axios

# ValidaciÃ³n de formularios
npm install react-hook-form zod @hookform/resolvers

# shadcn/ui (componentes UI)
npx shadcn-ui@latest init

# ConfiguraciÃ³n interactiva de shadcn:
# âœ” Style â†’ Default
# âœ” Base color â†’ Slate
# âœ” CSS variables â†’ Yes

# Instalar componentes shadcn especÃ­ficos
npx shadcn-ui@latest add button
npx shadcn-ui@latest add input
npx shadcn-ui@latest add card
npx shadcn-ui@latest add form
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add dropdown-menu
npx shadcn-ui@latest add toast
npx shadcn-ui@latest add select
npx shadcn-ui@latest add label
</code></pre>
<h3>ğŸ“¦ Paso 3: Configurar Variables de Entorno</h3>
<p>Crear <code>frontend/.env.local</code>:</p>
<pre><code class="language-env"># API Backend
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws

# AplicaciÃ³n
NEXT_PUBLIC_APP_NAME=&quot;Full Stack App&quot;
</code></pre>
<p><strong>âš ï¸ Nota</strong>: Prefijo <code>NEXT_PUBLIC_</code> es obligatorio para variables accesibles en el cliente.</p>
<h3>ğŸ“¦ Paso 4: Configurar Next.js</h3>
<p>Modificar <code>frontend/next.config.js</code>:</p>
<pre><code class="language-javascript">/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone',  // Para Docker
  images: {
    domains: ['localhost'],  // Permitir imÃ¡genes de localhost
  },
  eslint: {
    ignoreDuringBuilds: false,
  },
  typescript: {
    ignoreBuildErrors: false,
  },
}

module.exports = nextConfig
</code></pre>
<h3>ğŸ“¦ Paso 5: Estructura de Archivos del Frontend</h3>
<pre><code class="language-bash"># Desde frontend/

# Crear estructura de carpetas adicionales
mkdir -p src/components/layout
mkdir -p src/components/forms
mkdir -p src/lib
mkdir -p src/hooks
mkdir -p src/types
mkdir -p src/app/(auth)/login
mkdir -p src/app/(auth)/register
mkdir -p src/app/(protected)/dashboard

# Crear archivos principales
touch src/lib/api.ts
touch src/lib/auth.ts
touch src/lib/utils.ts
touch src/hooks/useAuth.ts
touch src/types/api.ts
touch src/components/layout/Header.tsx
touch src/components/layout/Footer.tsx
</code></pre>
<hr>
<h2>5. CONFIGURACIÃ“N DE LA BASE DE DATOS</h2>
<h3>ğŸ˜ OpciÃ³n A: PostgreSQL con Docker (Recomendado)</h3>
<p>Crear <code>docker-compose.yml</code> en la raÃ­z del proyecto:</p>
<pre><code class="language-yaml">version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: fullstack_postgres
    environment:
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: SecurePassword123
      POSTGRES_DB: fullstack_db
    ports:
      - &quot;5432:5432&quot;
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U fastapi_user -d fullstack_db&quot;]
      interval: 10s
      timeout: 5s
      retries: 5

  backend:
    build: ./backend
    container_name: fullstack_backend
    environment:
      DATABASE_URL: postgresql://fastapi_user:SecurePassword123@postgres:5432/fullstack_db
    env_file:
      - ./backend/.env
    ports:
      - &quot;8000:8000&quot;
    volumes:
      - ./backend/app:/app/app
    depends_on:
      postgres:
        condition: service_healthy
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  frontend:
    build: ./frontend
    container_name: fullstack_frontend
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8000/api/v1
    ports:
      - &quot;3000:3000&quot;
    volumes:
      - ./frontend/src:/app/src
    depends_on:
      - backend
    command: npm run dev

volumes:
  postgres_data:
</code></pre>
<p><strong>Iniciar servicios</strong>:</p>
<pre><code class="language-bash"># Desde la raÃ­z del proyecto
docker-compose up -d postgres

# Verificar que PostgreSQL estÃ© corriendo
docker-compose ps

# Ver logs
docker-compose logs -f postgres
</code></pre>
<h3>ğŸ˜ OpciÃ³n B: PostgreSQL Local (Sin Docker)</h3>
<p><strong>InstalaciÃ³n</strong>:</p>
<pre><code class="language-bash"># Ubuntu/Debian
sudo apt update
sudo apt install postgresql postgresql-contrib

# macOS (con Homebrew)
brew install postgresql@15
brew services start postgresql@15

# Windows: Descargar desde postgresql.org
</code></pre>
<p><strong>Crear base de datos</strong>:</p>
<pre><code class="language-bash"># Conectarse a PostgreSQL
psql postgres

# Dentro de psql:
CREATE USER fastapi_user WITH PASSWORD 'SecurePassword123';
CREATE DATABASE fullstack_db OWNER fastapi_user;
GRANT ALL PRIVILEGES ON DATABASE fullstack_db TO fastapi_user;
\q
</code></pre>
<p><strong>Actualizar <code>backend/.env</code></strong>:</p>
<pre><code class="language-env">DATABASE_URL=postgresql://fastapi_user:SecurePassword123@localhost:5432/fullstack_db
</code></pre>
<hr>
<h2>6. ESTRUCTURA COMPLETA DE ARCHIVOS</h2>
<h3>ğŸ“ Vista Completa del Proyecto</h3>
<pre><code>fastapi-nextjs-fullstack/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ alembic/                    # Migraciones de BD
â”‚   â”‚   â”œâ”€â”€ versions/
â”‚   â”‚   â”œâ”€â”€ env.py
â”‚   â”‚   â””â”€â”€ script.py.mako
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py                 # â­ Punto de entrada
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py             # â­ Dependencias
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ router.py       # â­ Router principal v1
â”‚   â”‚   â”‚       â””â”€â”€ endpoints/
â”‚   â”‚   â”‚           â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚           â”œâ”€â”€ auth.py     # Login, register
â”‚   â”‚   â”‚           â”œâ”€â”€ users.py    # CRUD usuarios
â”‚   â”‚   â”‚           â””â”€â”€ health.py   # Health check
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py           # â­ ConfiguraciÃ³n
â”‚   â”‚   â”‚   â””â”€â”€ security.py         # â­ JWT, hashing
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py             # Base declarativa
â”‚   â”‚   â”‚   â””â”€â”€ session.py          # â­ SessionLocal
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py             # â­ BaseModel
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py             # â­ Modelo User
â”‚   â”‚   â”‚   â”œâ”€â”€ project.py          # Modelo Project
â”‚   â”‚   â”‚   â”œâ”€â”€ task.py             # Modelo Task
â”‚   â”‚   â”‚   â””â”€â”€ tag.py              # Modelo Tag
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py             # â­ BaseRepository
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py             # UserRepository
â”‚   â”‚   â”‚   â””â”€â”€ project.py          # ProjectRepository
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py             # â­ UserCreate, UserResponse
â”‚   â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â”‚   â”œâ”€â”€ task.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tag.py
â”‚   â”‚   â”‚   â””â”€â”€ token.py            # â­ Token schemas
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ user_service.py     # â­ LÃ³gica de negocio User
â”‚   â”‚       â””â”€â”€ auth_service.py     # â­ LÃ³gica de autenticaciÃ³n
â”‚   â”œâ”€â”€ tests/                      # Tests (futuro)
â”‚   â”œâ”€â”€ .env                        # âš ï¸ NO commitear
â”‚   â”œâ”€â”€ .env.example                # Template de .env
â”‚   â”œâ”€â”€ requirements.txt            # â­ Dependencias Python
â”‚   â”œâ”€â”€ Dockerfile                  # â­ Imagen Docker backend
â”‚   â”œâ”€â”€ alembic.ini                 # Config Alembic
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx          # â­ Root layout
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx            # â­ Home page
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/             # Grupo de rutas
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ (protected)/        # Rutas protegidas
â”‚   â”‚   â”‚       â””â”€â”€ dashboard/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                 # â­ shadcn components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ forms/
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts              # â­ Cliente API axios
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # Helpers de auth
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts            # Utilidades
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts          # â­ Hook de autenticaciÃ³n
â”‚   â”‚   â”‚   â””â”€â”€ useWebSocket.ts
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ api.ts              # â­ Tipos TypeScript
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â””â”€â”€ globals.css         # â­ Estilos globales
â”‚   â”œâ”€â”€ .env.local                  # âš ï¸ NO commitear
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ next.config.js              # â­ Config Next.js
â”‚   â”œâ”€â”€ tailwind.config.ts          # â­ Config Tailwind
â”‚   â”œâ”€â”€ tsconfig.json               # â­ Config TypeScript
â”‚   â”œâ”€â”€ package.json                # â­ Dependencias Node
â”‚   â”œâ”€â”€ Dockerfile                  # â­ Imagen Docker frontend
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ postgres_data/                  # âš ï¸ NO commitear (volumen Docker)
â”œâ”€â”€ docker-compose.yml              # â­ OrquestaciÃ³n de servicios
â”œâ”€â”€ .gitignore                      # â­ Archivos ignorados por Git
â””â”€â”€ README.md                       # â­ DocumentaciÃ³n principal
</code></pre>
<p><strong>Leyenda</strong>:</p>
<ul>
<li>â­ Archivo crÃ­tico/principal</li>
<li>âš ï¸ No debe estar en Git</li>
<li>ğŸ“ Carpeta</li>
</ul>
<hr>
<h2>7. CÃ“DIGO COMPLETO POR MÃ“DULOS</h2>
<h3>ğŸ BACKEND - CÃ³digo Python</h3>
<h4>7.1. ConfiguraciÃ³n Principal</h4>
<p><strong><code>backend/app/core/config.py</code></strong>:</p>
<pre><code class="language-python">from pydantic_settings import BaseSettings
from typing import List

class Settings(BaseSettings):
    # AplicaciÃ³n
    APP_NAME: str = &quot;FastAPI Full Stack&quot;
    DEBUG: bool = False
    VERSION: str = &quot;1.0.0&quot;
    
    # Base de datos
    DATABASE_URL: str
    
    # Seguridad
    SECRET_KEY: str
    ALGORITHM: str = &quot;HS256&quot;
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # CORS
    ALLOWED_ORIGINS: List[str] = [&quot;http://localhost:3000&quot;]
    
    # Servidor
    HOST: str = &quot;0.0.0.0&quot;
    PORT: int = 8000
    
    class Config:
        env_file = &quot;.env&quot;
        case_sensitive = True

settings = Settings()
</code></pre>
<h4>7.2. Seguridad y AutenticaciÃ³n</h4>
<p><strong><code>backend/app/core/security.py</code></strong>:</p>
<pre><code class="language-python">from datetime import datetime, timedelta
from typing import Optional
from jose import JWTError, jwt
from passlib.context import CryptContext
from app.core.config import settings

pwd_context = CryptContext(schemes=[&quot;bcrypt&quot;], deprecated=&quot;auto&quot;)

def verify_password(plain_password: str, hashed_password: str) -&gt; bool:
    &quot;&quot;&quot;Verificar contraseÃ±a&quot;&quot;&quot;
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -&gt; str:
    &quot;&quot;&quot;Hashear contraseÃ±a&quot;&quot;&quot;
    return pwd_context.hash(password)

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -&gt; str:
    &quot;&quot;&quot;Crear JWT access token&quot;&quot;&quot;
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(
            minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES
        )
    to_encode.update({&quot;exp&quot;: expire})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def decode_token(token: str) -&gt; Optional[dict]:
    &quot;&quot;&quot;Decodificar JWT token&quot;&quot;&quot;
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        return payload
    except JWTError:
        return None
</code></pre>
<h4>7.3. Base de Datos</h4>
<p><strong><code>backend/app/db/base.py</code></strong>:</p>
<pre><code class="language-python">from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()
</code></pre>
<p><strong><code>backend/app/db/session.py</code></strong>:</p>
<pre><code class="language-python">from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

engine = create_engine(
    settings.DATABASE_URL,
    pool_pre_ping=True,
    pool_size=10,
    max_overflow=20
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def get_db():
    &quot;&quot;&quot;Dependency para obtener sesiÃ³n de BD&quot;&quot;&quot;
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
</code></pre>
<h4>7.4. Modelos SQLAlchemy</h4>
<p><strong><code>backend/app/models/base.py</code></strong>:</p>
<pre><code class="language-python">from datetime import datetime
from sqlalchemy import Column, Integer, DateTime
from sqlalchemy.ext.declarative import declared_attr
from app.db.base import Base

class TimestampMixin:
    &quot;&quot;&quot;Mixin para timestamps automÃ¡ticos&quot;&quot;&quot;
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(
        DateTime, 
        default=datetime.utcnow, 
        onupdate=datetime.utcnow, 
        nullable=False
    )

class BaseModel(Base, TimestampMixin):
    &quot;&quot;&quot;Clase base para todos los modelos&quot;&quot;&quot;
    __abstract__ = True
    
    id = Column(Integer, primary_key=True, index=True, autoincrement=True)
    
    @declared_attr
    def __tablename__(cls) -&gt; str:
        return cls.__name__.lower()
</code></pre>
<p><strong><code>backend/app/models/user.py</code></strong>:</p>
<pre><code class="language-python">from sqlalchemy import Boolean, Column, String
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class User(BaseModel):
    __tablename__ = &quot;users&quot;
    
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(255), unique=True, index=True, nullable=False)
    full_name = Column(String(100), nullable=True)
    hashed_password = Column(String(255), nullable=False)
    
    is_active = Column(Boolean, default=True)
    is_superuser = Column(Boolean, default=False)
    is_verified = Column(Boolean, default=False)
    
    # Relaciones
    projects = relationship(
        &quot;Project&quot;, 
        back_populates=&quot;owner&quot;,
        cascade=&quot;all, delete-orphan&quot;,
        lazy=&quot;dynamic&quot;
    )
    
    assigned_tasks = relationship(
        &quot;Task&quot;,
        back_populates=&quot;assignee&quot;,
        foreign_keys=&quot;[Task.assigned_to_id]&quot;,
        lazy=&quot;dynamic&quot;
    )
</code></pre>
<p><strong><code>backend/app/models/project.py</code></strong>:</p>
<pre><code class="language-python">from sqlalchemy import Boolean, Column, String, Text, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.models.base import BaseModel

class Project(BaseModel):
    __tablename__ = &quot;projects&quot;
    
    name = Column(String(100), nullable=False, index=True)
    description = Column(Text, nullable=True)
    is_active = Column(Boolean, default=True)
    
    owner_id = Column(
        Integer, 
        ForeignKey(&quot;users.id&quot;, ondelete=&quot;CASCADE&quot;),
        nullable=False,
        index=True
    )
    
    # Relaciones
    owner = relationship(&quot;User&quot;, back_populates=&quot;projects&quot;)
    tasks = relationship(
        &quot;Task&quot;,
        back_populates=&quot;project&quot;,
        cascade=&quot;all, delete-orphan&quot;,
        lazy=&quot;dynamic&quot;
    )
</code></pre>
<p><strong><code>backend/app/models/task.py</code></strong>:</p>
<pre><code class="language-python">from sqlalchemy import Column, String, Text, Integer, ForeignKey, Enum, Date
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel

class TaskStatus(str, enum.Enum):
    TODO = &quot;todo&quot;
    IN_PROGRESS = &quot;in_progress&quot;
    IN_REVIEW = &quot;in_review&quot;
    DONE = &quot;done&quot;
    CANCELLED = &quot;cancelled&quot;

class TaskPriority(str, enum.Enum):
    LOW = &quot;low&quot;
    MEDIUM = &quot;medium&quot;
    HIGH = &quot;high&quot;
    URGENT = &quot;urgent&quot;

class Task(BaseModel):
    __tablename__ = &quot;tasks&quot;
    
    title = Column(String(200), nullable=False, index=True)
    description = Column(Text, nullable=True)
    status = Column(Enum(TaskStatus), default=TaskStatus.TODO, nullable=False, index=True)
    priority = Column(Enum(TaskPriority), default=TaskPriority.MEDIUM, nullable=False)
    due_date = Column(Date, nullable=True)
    
    project_id = Column(
        Integer,
        ForeignKey(&quot;projects.id&quot;, ondelete=&quot;CASCADE&quot;),
        nullable=False,
        index=True
    )
    
    assigned_to_id = Column(
        Integer,
        ForeignKey(&quot;users.id&quot;, ondelete=&quot;SET NULL&quot;),
        nullable=True,
        index=True
    )
    
    # Relaciones
    project = relationship(&quot;Project&quot;, back_populates=&quot;tasks&quot;)
    assignee = relationship(&quot;User&quot;, back_populates=&quot;assigned_tasks&quot;, foreign_keys=[assigned_to_id])
    tags = relationship(&quot;Tag&quot;, secondary=&quot;task_tags&quot;, back_populates=&quot;tasks&quot;, lazy=&quot;dynamic&quot;)
</code></pre>
<p><strong><code>backend/app/models/tag.py</code></strong>:</p>
<pre><code class="language-python">from sqlalchemy import Column, String, Integer, ForeignKey, Table
from sqlalchemy.orm import relationship
from app.models.base import BaseModel, Base

task_tags = Table(
    'task_tags',
    Base.metadata,
    Column('task_id', Integer, ForeignKey('tasks.id', ondelete=&quot;CASCADE&quot;), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete=&quot;CASCADE&quot;), primary_key=True)
)

class Tag(BaseModel):
    __tablename__ = &quot;tags&quot;
    
    name = Column(String(50), unique=True, nullable=False, index=True)
    color = Column(String(7), default=&quot;#808080&quot;)
    
    tasks = relationship(
        &quot;Task&quot;,
        secondary=task_tags,
        back_populates=&quot;tags&quot;,
        lazy=&quot;dynamic&quot;
    )
</code></pre>
<h4>7.5. Schemas Pydantic</h4>
<p><strong><code>backend/app/schemas/user.py</code></strong>:</p>
<pre><code class="language-python">from pydantic import BaseModel, EmailStr, Field
from typing import Optional
from datetime import datetime

class UserBase(BaseModel):
    email: EmailStr
    username: str = Field(..., min_length=3, max_length=50)
    full_name: Optional[str] = None

class UserCreate(UserBase):
    password: str = Field(..., min_length=8)

class UserUpdate(BaseModel):
    email: Optional[EmailStr] = None
    full_name: Optional[str] = None
    password: Optional[str] = None

class UserResponse(UserBase):
    id: int
    is_active: bool
    is_superuser: bool
    is_verified: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class UserInDB(UserResponse):
    hashed_password: str
</code></pre>
<p><strong><code>backend/app/schemas/token.py</code></strong>:</p>
<pre><code class="language-python">from pydantic import BaseModel
from typing import Optional

class Token(BaseModel):
    access_token: str
    token_type: str = &quot;bearer&quot;

class TokenPayload(BaseModel):
    sub: Optional[int] = None
</code></pre>
<h4>7.6. Repositories</h4>
<p><strong><code>backend/app/repositories/base.py</code></strong>:</p>
<pre><code class="language-python">from typing import TypeVar, Generic, Type, Optional, List
from sqlalchemy.orm import Session
from app.models.base import BaseModel

ModelType = TypeVar(&quot;ModelType&quot;, bound=BaseModel)

class BaseRepository(Generic[ModelType]):
    def __init__(self, model: Type[ModelType]):
        self.model = model
    
    def get(self, db: Session, id: int) -&gt; Optional[ModelType]:
        return db.query(self.model).filter(self.model.id == id).first()
    
    def get_multi(
        self, db: Session, *, skip: int = 0, limit: int = 100
    ) -&gt; List[ModelType]:
        return db.query(self.model).offset(skip).limit(limit).all()
    
    def create(self, db: Session, *, obj_in: dict) -&gt; ModelType:
        db_obj = self.model(**obj_in)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def update(
        self, db: Session, *, db_obj: ModelType, obj_in: dict
    ) -&gt; ModelType:
        for field, value in obj_in.items():
            setattr(db_obj, field, value)
        db.add(db_obj)
        db.commit()
        db.refresh(db_obj)
        return db_obj
    
    def delete(self, db: Session, *, id: int) -&gt; Optional[ModelType]:
        obj = db.query(self.model).get(id)
        if obj:
            db.delete(obj)
            db.commit()
        return obj
</code></pre>
<p><strong><code>backend/app/repositories/user.py</code></strong>:</p>
<pre><code class="language-python">from typing import Optional
from sqlalchemy.orm import Session
from app.models.user import User
from app.repositories.base import BaseRepository

class UserRepository(BaseRepository[User]):
    def __init__(self):
        super().__init__(User)
    
    def get_by_email(self, db: Session, *, email: str) -&gt; Optional[User]:
        return db.query(User).filter(User.email == email).first()
    
    def get_by_username(self, db: Session, *, username: str) -&gt; Optional[User]:
        return db.query(User).filter(User.username == username).first()

user_repository = UserRepository()
</code></pre>
<h4>7.7. Services</h4>
<p><strong><code>backend/app/services/auth_service.py</code></strong>:</p>
<pre><code class="language-python">from typing import Optional
from sqlalchemy.orm import Session
from fastapi import HTTPException, status
from app.schemas.user import UserCreate, UserResponse
from app.schemas.token import Token
from app.repositories.user import user_repository
from app.core.security import (
    verify_password,
    get_password_hash,
    create_access_token
)
from datetime import timedelta
from app.core.config import settings

class AuthService:
    def register_user(self, db: Session, user_in: UserCreate) -&gt; UserResponse:
        &quot;&quot;&quot;Registrar nuevo usuario&quot;&quot;&quot;
        # Verificar email Ãºnico
        if user_repository.get_by_email(db, email=user_in.email):
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail=&quot;Email ya registrado&quot;
            )
        
        # Verificar username Ãºnico
        if user_repository.get_by_username(db, username=user_in.username):
            raise HTTPException(
                status_code=status.HTTP_409_CONFLICT,
                detail=&quot;Username ya existe&quot;
            )
        
        # Hash de contraseÃ±a
        hashed_password = get_password_hash(user_in.password)
        
        # Crear usuario
        user_data = user_in.dict(exclude={'password'})
        user_data['hashed_password'] = hashed_password
        
        user = user_repository.create(db, obj_in=user_data)
        return UserResponse.from_orm(user)
    
    def authenticate(
        self, db: Session, *, email: str, password: str
    ) -&gt; Optional[Token]:
        &quot;&quot;&quot;Autenticar usuario y retornar token&quot;&quot;&quot;
        user = user_repository.get_by_email(db, email=email)
        
        if not user:
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=&quot;Credenciales invÃ¡lidas&quot;
            )
        
        if not verify_password(password, user.hashed_password):
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail=&quot;Credenciales invÃ¡lidas&quot;
            )
        
        if not user.is_active:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=&quot;Usuario inactivo&quot;
            )
        
        # Crear token
        access_token_expires = timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
        access_token = create_access_token(
            data={&quot;sub&quot;: str(user.id)},
            expires_delta=access_token_expires
        )
        
        return Token(access_token=access_token, token_type=&quot;bearer&quot;)

auth_service = AuthService()
</code></pre>
<h4>7.8. Dependencias</h4>
<p><strong><code>backend/app/api/deps.py</code></strong>:</p>
<pre><code class="language-python">from typing import Generator, Optional
from fastapi import Depends, HTTPException, status, Cookie
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.models.user import User
from app.repositories.user import user_repository
from app.core.security import decode_token

oauth2_scheme = OAuth2PasswordBearer(tokenUrl=&quot;/api/v1/auth/login&quot;, auto_error=False)

async def get_current_user(
    db: Session = Depends(get_db),
    token: Optional[str] = Depends(oauth2_scheme),
    access_token: Optional[str] = Cookie(None)
) -&gt; User:
    &quot;&quot;&quot;Obtener usuario actual desde JWT&quot;&quot;&quot;
    # Priorizar cookie sobre header
    token_to_decode = access_token or token
    
    if not token_to_decode:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=&quot;No autenticado&quot;
        )
    
    payload = decode_token(token_to_decode)
    if not payload:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=&quot;Token invÃ¡lido&quot;
        )
    
    user_id = int(payload.get(&quot;sub&quot;))
    user = user_repository.get(db, id=user_id)
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=&quot;Usuario no encontrado&quot;
        )
    
    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user),
) -&gt; User:
    &quot;&quot;&quot;Verificar usuario activo&quot;&quot;&quot;
    if not current_user.is_active:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=&quot;Usuario inactivo&quot;
        )
    return current_user
</code></pre>
<h4>7.9. Endpoints</h4>
<p><strong><code>backend/app/api/v1/endpoints/auth.py</code></strong>:</p>
<pre><code class="language-python">from fastapi import APIRouter, Depends, status, Response
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session
from app.schemas.user import UserCreate, UserResponse
from app.schemas.token import Token
from app.services.auth_service import auth_service
from app.api.deps import get_db

router = APIRouter()

@router.post(&quot;/register&quot;, response_model=UserResponse, status_code=status.HTTP_201_CREATED)
def register(
    user_in: UserCreate,
    db: Session = Depends(get_db)
):
    &quot;&quot;&quot;Registrar nuevo usuario&quot;&quot;&quot;
    return auth_service.register_user(db, user_in=user_in)

@router.post(&quot;/login&quot;, response_model=Token)
def login(
    response: Response,
    form_data: OAuth2PasswordRequestForm = Depends(),
    db: Session = Depends(get_db)
):
    &quot;&quot;&quot;Login y obtener token&quot;&quot;&quot;
    token = auth_service.authenticate(
        db,
        email=form_data.username,  # OAuth2 usa 'username', nosotros lo tratamos como email
        password=form_data.password
    )
    
    # Establecer token en cookie HttpOnly
    response.set_cookie(
        key=&quot;access_token&quot;,
        value=token.access_token,
        httponly=True,
        secure=False,  # True en producciÃ³n con HTTPS
        samesite=&quot;lax&quot;,
        max_age=1800  # 30 minutos
    )
    
    return token

@router.post(&quot;/logout&quot;)
def logout(response: Response):
    &quot;&quot;&quot;Logout (eliminar cookie)&quot;&quot;&quot;
    response.delete_cookie(key=&quot;access_token&quot;)
    return {&quot;message&quot;: &quot;Logout exitoso&quot;}
</code></pre>
<p><strong><code>backend/app/api/v1/endpoints/users.py</code></strong>:</p>
<pre><code class="language-python">from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.schemas.user import UserResponse
from app.api.deps import get_db, get_current_active_user
from app.models.user import User

router = APIRouter()

@router.get(&quot;/me&quot;, response_model=UserResponse)
def get_current_user_info(
    current_user: User = Depends(get_current_active_user)
):
    &quot;&quot;&quot;Obtener informaciÃ³n del usuario actual&quot;&quot;&quot;
    return current_user
</code></pre>
<p><strong><code>backend/app/api/v1/endpoints/health.py</code></strong>:</p>
<pre><code class="language-python">from fastapi import APIRouter
from app.core.config import settings

router = APIRouter()

@router.get(&quot;/health&quot;)
def health_check():
    &quot;&quot;&quot;Health check endpoint&quot;&quot;&quot;
    return {
        &quot;status&quot;: &quot;healthy&quot;,
        &quot;app_name&quot;: settings.APP_NAME,
        &quot;version&quot;: settings.VERSION
    }
</code></pre>
<h4>7.10. Router y Main</h4>
<p><strong><code>backend/app/api/v1/router.py</code></strong>:</p>
<pre><code class="language-python">from fastapi import APIRouter
from app.api.v1.endpoints import auth, users, health

api_router = APIRouter()

api_router.include_router(health.router, tags=[&quot;health&quot;])
api_router.include_router(auth.router, prefix=&quot;/auth&quot;, tags=[&quot;authentication&quot;])
api_router.include_router(users.router, prefix=&quot;/users&quot;, tags=[&quot;users&quot;])
</code></pre>
<p><strong><code>backend/app/main.py</code></strong>:</p>
<pre><code class="language-python">from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api.v1.router import api_router

app = FastAPI(
    title=settings.APP_NAME,
    version=settings.VERSION,
    docs_url=&quot;/docs&quot;,
    redoc_url=&quot;/redoc&quot;
)

# CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=[&quot;*&quot;],
    allow_headers=[&quot;*&quot;],
)

# Incluir router versionado
app.include_router(api_router, prefix=&quot;/api/v1&quot;)

@app.get(&quot;/&quot;)
def root():
    return {
        &quot;message&quot;: &quot;FastAPI Full Stack API&quot;,
        &quot;docs&quot;: &quot;/docs&quot;,
        &quot;version&quot;: settings.VERSION
    }
</code></pre>
<h4>7.11. Docker</h4>
<p><strong><code>backend/Dockerfile</code></strong>:</p>
<pre><code class="language-dockerfile">FROM python:3.11-slim

WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update &amp;&amp; apt-get install -y \
    gcc \
    postgresql-client \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# Copiar requirements e instalar
COPY requirements.txt .
RUN pip install --no-cache-dir --upgrade pip &amp;&amp; \
    pip install --no-cache-dir -r requirements.txt

# Copiar cÃ³digo
COPY ./app ./app
COPY alembic.ini .
COPY ./alembic ./alembic

EXPOSE 8000

# Comando por defecto (puede sobrescribirse en docker-compose)
CMD [&quot;uvicorn&quot;, &quot;app.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;]
</code></pre>
<h4>7.12. Alembic</h4>
<p><strong><code>alembic/env.py</code></strong> (modificado):</p>
<pre><code class="language-python">from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context

# Importar settings y Base
from app.core.config import settings
from app.db.base import Base

# Importar TODOS los modelos
from app.models import user, project, task, tag

# Configurar URL de BD
config = context.config
config.set_main_option(&quot;sqlalchemy.url&quot;, settings.DATABASE_URL)

if config.config_file_name is not None:
    fileConfig(config.config_file_name)

target_metadata = Base.metadata

def run_migrations_offline():
    url = config.get_main_option(&quot;sqlalchemy.url&quot;)
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={&quot;paramstyle&quot;: &quot;named&quot;},
    )

    with context.begin_transaction():
        context.run_migrations()

def run_migrations_online():
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix=&quot;sqlalchemy.&quot;,
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
</code></pre>
<h3>âš›ï¸ FRONTEND - CÃ³digo TypeScript/React</h3>
<h4>7.13. Cliente API</h4>
<p><strong><code>frontend/src/lib/api.ts</code></strong>:</p>
<pre><code class="language-typescript">import axios, { AxiosInstance, AxiosError } from 'axios';

const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  timeout: 10000,
  withCredentials: true,  // Importante para cookies
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para manejo de errores
apiClient.interceptors.response.use(
  response =&gt; response,
  (error: AxiosError) =&gt; {
    if (error.response?.status === 401) {
      // Redirigir a login
      if (typeof window !== 'undefined') {
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);

// API Methods
export const api = {
  auth: {
    register: async (data: { email: string; username: string; password: string }) =&gt; {
      return apiClient.post('/auth/register', data);
    },
    login: async (email: string, password: string) =&gt; {
      const formData = new FormData();
      formData.append('username', email);  // OAuth2 expects 'username'
      formData.append('password', password);
      return apiClient.post('/auth/login', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
    },
    logout: async () =&gt; {
      return apiClient.post('/auth/logout');
    },
    getCurrentUser: async () =&gt; {
      return apiClient.get('/users/me');
    },
  },
  // Agregar mÃ¡s endpoints segÃºn necesidad
};

export default apiClient;
</code></pre>
<h4>7.14. Tipos TypeScript</h4>
<p><strong><code>frontend/src/types/api.ts</code></strong>:</p>
<pre><code class="language-typescript">export interface User {
  id: number;
  email: string;
  username: string;
  full_name?: string;
  is_active: boolean;
  is_superuser: boolean;
  is_verified: boolean;
  created_at: string;
  updated_at: string;
}

export interface LoginCredentials {
  email: string;
  password: string;
}

export interface RegisterData {
  email: string;
  username: string;
  password: string;
  full_name?: string;
}

export interface Token {
  access_token: string;
  token_type: string;
}
</code></pre>
<h4>7.15. Hook de AutenticaciÃ³n</h4>
<p><strong><code>frontend/src/hooks/useAuth.ts</code></strong>:</p>
<pre><code class="language-typescript">'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { api } from '@/lib/api';
import { User, LoginCredentials, RegisterData } from '@/types/api';

export function useAuth() {
  const [user, setUser] = useState&lt;User | null&gt;(null);
  const [loading, setLoading] = useState(true);
  const router = useRouter();

  useEffect(() =&gt; {
    checkAuth();
  }, []);

  const checkAuth = async () =&gt; {
    try {
      const response = await api.auth.getCurrentUser();
      setUser(response.data);
    } catch (error) {
      setUser(null);
    } finally {
      setLoading(false);
    }
  };

  const login = async (credentials: LoginCredentials) =&gt; {
    try {
      await api.auth.login(credentials.email, credentials.password);
      await checkAuth();
      router.push('/dashboard');
    } catch (error) {
      throw error;
    }
  };

  const register = async (data: RegisterData) =&gt; {
    try {
      await api.auth.register(data);
      // Auto-login despuÃ©s de registro
      await login({ email: data.email, password: data.password });
    } catch (error) {
      throw error;
    }
  };

  const logout = async () =&gt; {
    try {
      await api.auth.logout();
      setUser(null);
      router.push('/login');
    } catch (error) {
      console.error('Logout error:', error);
    }
  };

  return {
    user,
    loading,
    login,
    register,
    logout,
    checkAuth,
  };
}
</code></pre>
<h4>7.16. Layouts</h4>
<p><strong><code>frontend/src/app/layout.tsx</code></strong>:</p>
<pre><code class="language-typescript">import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Full Stack App',
  description: 'FastAPI + Next.js Full Stack Application',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    &lt;html lang=&quot;es&quot;&gt;
      &lt;body className={inter.className}&gt;
        {children}
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<h4>7.17. PÃ¡gina de Login</h4>
<p><strong><code>frontend/src/app/(auth)/login/page.tsx</code></strong>:</p>
<pre><code class="language-typescript">'use client';

import { useState } from 'react';
import { useAuth } from '@/hooks/useAuth';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';

export default function LoginPage() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const { login } = useAuth();

  const handleSubmit = async (e: React.FormEvent) =&gt; {
    e.preventDefault();
    setError('');
    
    try {
      await login({ email, password });
    } catch (err: any) {
      setError(err.response?.data?.detail || 'Error al iniciar sesiÃ³n');
    }
  };

  return (
    &lt;div className=&quot;flex min-h-screen items-center justify-center&quot;&gt;
      &lt;Card className=&quot;w-full max-w-md&quot;&gt;
        &lt;CardHeader&gt;
          &lt;CardTitle&gt;Iniciar SesiÃ³n&lt;/CardTitle&gt;
        &lt;/CardHeader&gt;
        &lt;CardContent&gt;
          &lt;form onSubmit={handleSubmit} className=&quot;space-y-4&quot;&gt;
            {error &amp;&amp; (
              &lt;div className=&quot;bg-red-50 text-red-600 p-3 rounded-md text-sm&quot;&gt;
                {error}
              &lt;/div&gt;
            )}
            
            &lt;div&gt;
              &lt;Input
                type=&quot;email&quot;
                placeholder=&quot;Email&quot;
                value={email}
                onChange={(e) =&gt; setEmail(e.target.value)}
                required
              /&gt;
            &lt;/div&gt;
            
            &lt;div&gt;
              &lt;Input
                type=&quot;password&quot;
                placeholder=&quot;ContraseÃ±a&quot;
                value={password}
                onChange={(e) =&gt; setPassword(e.target.value)}
                required
              /&gt;
            &lt;/div&gt;
            
            &lt;Button type=&quot;submit&quot; className=&quot;w-full&quot;&gt;
              Iniciar SesiÃ³n
            &lt;/Button&gt;
          &lt;/form&gt;
        &lt;/CardContent&gt;
      &lt;/Card&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h4>7.18. Frontend Dockerfile</h4>
<p><strong><code>frontend/Dockerfile</code></strong>:</p>
<pre><code class="language-dockerfile">FROM node:20-alpine AS deps
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci

FROM node:20-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV production
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

EXPOSE 3000
ENV PORT 3000

CMD [&quot;node&quot;, &quot;server.js&quot;]
</code></pre>
<hr>
<h2>8. COMANDOS DE TERMINAL NECESARIOS</h2>
<h3>ğŸ”§ Comandos de ConfiguraciÃ³n Inicial</h3>
<pre><code class="language-bash"># 1. Clonar o crear proyecto
git init fastapi-nextjs-fullstack
cd fastapi-nextjs-fullstack

# 2. Backend: Crear entorno virtual
cd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# 3. Backend: Instalar dependencias
pip install -r requirements.txt

# 4. Backend: Configurar Alembic
alembic init alembic

# 5. Frontend: Crear proyecto Next.js
cd ..
npx create-next-app@latest frontend --typescript --tailwind --app --src-dir

# 6. Frontend: Instalar dependencias adicionales
cd frontend
npm install axios react-hook-form zod @hookform/resolvers
npx shadcn-ui@latest init
npx shadcn-ui@latest add button input card form dialog
</code></pre>
<h3>ğŸ˜ Comandos de Base de Datos</h3>
<pre><code class="language-bash"># Con Docker
docker-compose up -d postgres
docker-compose logs -f postgres

# Conectarse a PostgreSQL en Docker
docker exec -it fullstack_postgres psql -U fastapi_user -d fullstack_db

# Sin Docker (local)
psql postgres
CREATE USER fastapi_user WITH PASSWORD 'SecurePassword123';
CREATE DATABASE fullstack_db OWNER fastapi_user;
\q

# Verificar conexiÃ³n
psql -U fastapi_user -d fullstack_db -h localhost

# Dentro de psql:
\dt          # Listar tablas
\d users     # Describir tabla users
\q           # Salir
</code></pre>
<h3>ğŸ”„ Comandos de Migraciones (Alembic)</h3>
<pre><code class="language-bash"># Desde backend/ con venv activado

# Crear migraciÃ³n automÃ¡tica
alembic revision --autogenerate -m &quot;Mensaje descriptivo&quot;

# Ejemplos:
alembic revision --autogenerate -m &quot;Create initial tables&quot;
alembic revision --autogenerate -m &quot;Add is_verified to users&quot;

# Aplicar migraciones
alembic upgrade head

# Ver estado actual
alembic current

# Ver historial
alembic history

# Revertir Ãºltima migraciÃ³n
alembic downgrade -1

# Revertir a revisiÃ³n especÃ­fica
alembic downgrade &lt;revision_id&gt;

# Revertir todo
alembic downgrade base
</code></pre>
<h3>ğŸš€ Comandos para Iniciar Servicios</h3>
<h4>OpciÃ³n A: Con Docker Compose (Recomendado)</h4>
<pre><code class="language-bash"># Desde la raÃ­z del proyecto

# Iniciar todos los servicios
docker-compose up

# Iniciar en segundo plano
docker-compose up -d

# Ver logs
docker-compose logs -f

# Ver logs de un servicio especÃ­fico
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f postgres

# Detener servicios
docker-compose down

# Detener y eliminar volÃºmenes (âš ï¸ ELIMINA DATOS)
docker-compose down -v

# Reconstruir imÃ¡genes
docker-compose build

# Reconstruir e iniciar
docker-compose up --build
</code></pre>
<h4>OpciÃ³n B: Sin Docker (Local)</h4>
<p><strong>Terminal 1 - Backend</strong>:</p>
<pre><code class="language-bash">cd backend
source venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# El backend estarÃ¡ en: http://localhost:8000
# Docs en: http://localhost:8000/docs
</code></pre>
<p><strong>Terminal 2 - Frontend</strong>:</p>
<pre><code class="language-bash">cd frontend
npm run dev

# El frontend estarÃ¡ en: http://localhost:3000
</code></pre>
<p><strong>Terminal 3 - PostgreSQL</strong> (si no estÃ¡ como servicio):</p>
<pre><code class="language-bash"># macOS con Homebrew
brew services start postgresql@15

# Linux (Debian/Ubuntu)
sudo service postgresql start
</code></pre>
<h3>ğŸ§ª Comandos de Testing y Desarrollo</h3>
<pre><code class="language-bash"># Backend: Formatear cÃ³digo con Black
cd backend
pip install black
black app/

# Backend: Linting con flake8
pip install flake8
flake8 app/

# Backend: Type checking con mypy
pip install mypy
mypy app/

# Frontend: Linting
cd frontend
npm run lint

# Frontend: Formatear con Prettier
npm run format  # (si estÃ¡ configurado)

# Frontend: Build de producciÃ³n
npm run build

# Frontend: Iniciar build de producciÃ³n
npm start
</code></pre>
<h3>ğŸ“Š Comandos de Docker Ãštiles</h3>
<pre><code class="language-bash"># Ver contenedores corriendo
docker ps

# Ver todos los contenedores
docker ps -a

# Ver logs de contenedor
docker logs fullstack_backend
docker logs -f fullstack_backend  # Seguir logs

# Entrar a contenedor
docker exec -it fullstack_backend /bin/bash
docker exec -it fullstack_postgres /bin/bash

# Ver imÃ¡genes
docker images

# Eliminar contenedor
docker rm fullstack_backend

# Eliminar imagen
docker rmi &lt;image_id&gt;

# Limpiar recursos no utilizados
docker system prune

# Ver uso de espacio
docker system df

# Reiniciar contenedor
docker restart fullstack_backend
</code></pre>
<h3>ğŸ” Comandos de Debugging</h3>
<pre><code class="language-bash"># Backend: Verificar configuraciÃ³n
cd backend
source venv/bin/activate
python -c &quot;from app.core.config import settings; print(settings.DATABASE_URL)&quot;

# Backend: Probar conexiÃ³n a BD
python -c &quot;from app.db.session import engine; engine.connect(); print('âœ“ ConexiÃ³n exitosa')&quot;

# Backend: Shell interactivo
python
&gt;&gt;&gt; from app.db.session import SessionLocal
&gt;&gt;&gt; from app.models.user import User
&gt;&gt;&gt; db = SessionLocal()
&gt;&gt;&gt; users = db.query(User).all()
&gt;&gt;&gt; print(users)

# PostgreSQL: Verificar datos
docker exec -it fullstack_postgres psql -U fastapi_user -d fullstack_db -c &quot;SELECT * FROM users;&quot;

# Frontend: Verificar variables de entorno
cd frontend
npm run build
# Las variables NEXT_PUBLIC_* se mostrarÃ¡n si hay errores
</code></pre>
<hr>
<h2>9. CHECKLIST DE VERIFICACIÃ“N</h2>
<h3>âœ… Fase 1: InstalaciÃ³n de Herramientas</h3>
<ul>
<li>[ ] Python 3.11+ instalado (<code>python --version</code>)</li>
<li>[ ] pip actualizado (<code>pip install --upgrade pip</code>)</li>
<li>[ ] Node.js 18+ instalado (<code>node --version</code>)</li>
<li>[ ] npm actualizado (<code>npm install -g npm@latest</code>)</li>
<li>[ ] Docker instalado y corriendo (<code>docker --version</code>, <code>docker ps</code>)</li>
<li>[ ] docker-compose instalado (<code>docker-compose --version</code>)</li>
<li>[ ] Git instalado (<code>git --version</code>)</li>
<li>[ ] Editor de cÃ³digo configurado (VSCode con extensiones recomendadas)</li>
</ul>
<h3>âœ… Fase 2: ConfiguraciÃ³n del Proyecto</h3>
<ul>
<li>[ ] Repositorio Git inicializado</li>
<li>[ ] <code>.gitignore</code> creado con contenido apropiado</li>
<li>[ ] Estructura de carpetas creada (<code>backend/</code>, <code>frontend/</code>)</li>
<li>[ ] <code>backend/.env</code> configurado con variables correctas</li>
<li>[ ] <code>frontend/.env.local</code> configurado</li>
<li>[ ] <code>docker-compose.yml</code> creado en raÃ­z</li>
</ul>
<h3>âœ… Fase 3: Backend (FastAPI)</h3>
<ul>
<li>[ ] Entorno virtual creado y activado</li>
<li>[ ] Dependencias instaladas (<code>pip list</code> muestra paquetes)</li>
<li>[ ] <code>requirements.txt</code> creado con todas las dependencias</li>
<li>[ ] Estructura de carpetas backend creada correctamente</li>
<li>[ ] Archivos <code>__init__.py</code> en todos los paquetes</li>
<li>[ ] <code>app/main.py</code> implementado</li>
<li>[ ] <code>app/core/config.py</code> con Settings configurado</li>
<li>[ ] <code>app/core/security.py</code> con funciones JWT</li>
<li>[ ] <code>app/db/session.py</code> con engine y SessionLocal</li>
<li>[ ] Modelos SQLAlchemy creados (<code>user.py</code>, <code>project.py</code>, etc.)</li>
<li>[ ] Schemas Pydantic creados</li>
<li>[ ] Repositorios implementados (BaseRepository, UserRepository)</li>
<li>[ ] Servicios implementados (AuthService, UserService)</li>
<li>[ ] Endpoints creados (<code>auth.py</code>, <code>users.py</code>, <code>health.py</code>)</li>
<li>[ ] Router v1 configurado</li>
<li>[ ] CORS middleware configurado</li>
<li>[ ] Alembic inicializado</li>
<li>[ ] <code>alembic/env.py</code> modificado correctamente</li>
<li>[ ] Dockerfile backend creado</li>
</ul>
<h3>âœ… Fase 4: Base de Datos</h3>
<ul>
<li>[ ] PostgreSQL corriendo (Docker o local)</li>
<li>[ ] Base de datos <code>fullstack_db</code> creada</li>
<li>[ ] Usuario <code>fastapi_user</code> creado con permisos</li>
<li>[ ] ConexiÃ³n desde backend exitosa</li>
<li>[ ] Primera migraciÃ³n creada (<code>alembic revision --autogenerate</code>)</li>
<li>[ ] Migraciones aplicadas (<code>alembic upgrade head</code>)</li>
<li>[ ] Tablas creadas en PostgreSQL (verificar con <code>\dt</code> en psql)</li>
<li>[ ] Relaciones entre tablas correctas</li>
</ul>
<h3>âœ… Fase 5: Frontend (Next.js)</h3>
<ul>
<li>[ ] Proyecto Next.js creado</li>
<li>[ ] TypeScript configurado</li>
<li>[ ] TailwindCSS funcionando</li>
<li>[ ] shadcn/ui inicializado</li>
<li>[ ] Componentes UI instalados (button, input, card, etc.)</li>
<li>[ ] <code>src/lib/api.ts</code> implementado</li>
<li>[ ] <code>src/types/api.ts</code> con interfaces TypeScript</li>
<li>[ ] <code>src/hooks/useAuth.ts</code> implementado</li>
<li>[ ] Layout principal creado</li>
<li>[ ] PÃ¡gina de login implementada</li>
<li>[ ] PÃ¡gina de registro implementada (opcional)</li>
<li>[ ] <code>next.config.js</code> configurado</li>
<li>[ ] Dockerfile frontend creado</li>
</ul>
<h3>âœ… Fase 6: IntegraciÃ³n</h3>
<ul>
<li>[ ] <code>docker-compose.yml</code> completo con los 3 servicios</li>
<li>[ ] Backend responde en <code>http://localhost:8000</code></li>
<li>[ ] Frontend responde en <code>http://localhost:3000</code></li>
<li>[ ] Swagger UI accesible en <code>http://localhost:8000/docs</code></li>
<li>[ ] Frontend puede hacer requests al backend</li>
<li>[ ] CORS configurado correctamente</li>
<li>[ ] Cookies funcionando entre frontend y backend</li>
</ul>
<h3>âœ… Fase 7: Funcionalidad</h3>
<ul>
<li>[ ] Endpoint <code>/api/v1/health</code> responde correctamente</li>
<li>[ ] Registro de usuario funciona (<code>POST /api/v1/auth/register</code>)</li>
<li>[ ] Login funciona (<code>POST /api/v1/auth/login</code>)</li>
<li>[ ] Token JWT se crea y almacena en cookie</li>
<li>[ ] Endpoint protegido <code>/api/v1/users/me</code> requiere autenticaciÃ³n</li>
<li>[ ] Usuario autenticado puede acceder a <code>/api/v1/users/me</code></li>
<li>[ ] Logout funciona y elimina cookie</li>
<li>[ ] Frontend muestra errores apropiadamente</li>
<li>[ ] RedirecciÃ³n a login cuando no autenticado</li>
</ul>
<h3>âœ… Fase 8: Pruebas Manuales</h3>
<ul>
<li>[ ] Crear usuario desde Swagger UI</li>
<li>[ ] Login con usuario creado</li>
<li>[ ] Verificar token en cookie (DevTools â†’ Application â†’ Cookies)</li>
<li>[ ] Acceder a endpoint protegido con token</li>
<li>[ ] Logout y verificar que cookie se elimina</li>
<li>[ ] Repetir proceso desde frontend</li>
<li>[ ] Verificar datos en PostgreSQL</li>
</ul>
<h3>âœ… Fase 9: OptimizaciÃ³n y Limpieza</h3>
<ul>
<li>[ ] Eliminar cÃ³digo de prueba/debug</li>
<li>[ ] Revisar que no hay credenciales en cÃ³digo</li>
<li>[ ] <code>.env</code> y <code>.env.local</code> en <code>.gitignore</code></li>
<li>[ ] DocumentaciÃ³n actualizada (<code>README.md</code>)</li>
<li>[ ] Comentarios en cÃ³digo complejo</li>
<li>[ ] Variables de entorno documentadas en <code>.env.example</code></li>
</ul>
<h3>âœ… Fase 10: PreparaciÃ³n para ProducciÃ³n</h3>
<ul>
<li>[ ] <code>DEBUG=False</code> en producciÃ³n</li>
<li>[ ] <code>SECRET_KEY</code> fuerte y Ãºnico</li>
<li>[ ] CORS restringido a dominios especÃ­ficos</li>
<li>[ ] HTTPS habilitado (para cookies <code>Secure</code>)</li>
<li>[ ] Database backup configurado</li>
<li>[ ] Logs configurados apropiadamente</li>
<li>[ ] Health checks configurados</li>
<li>[ ] Rate limiting considerado</li>
<li>[ ] Monitoring y alertas (opcional)</li>
</ul>
<hr>
<h2>10. TROUBLESHOOTING COMÃšN</h2>
<h3>ğŸ› Problemas de Backend</h3>
<h4>Problema 1: &quot;ModuleNotFoundError: No module named 'app'&quot;</h4>
<p><strong>Causa</strong>: Python no encuentra el paquete <code>app</code>.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash"># Asegurarse de estar en backend/
cd backend

# Verificar que exista app/__init__.py
ls app/__init__.py

# Ejecutar desde backend/ (no desde app/)
uvicorn app.main:app --reload
</code></pre>
<h4>Problema 2: &quot;sqlalchemy.exc.OperationalError: could not connect to server&quot;</h4>
<p><strong>Causa</strong>: PostgreSQL no estÃ¡ corriendo o credenciales incorrectas.</p>
<p><strong>Soluciones</strong>:</p>
<pre><code class="language-bash"># Verificar que PostgreSQL estÃ© corriendo
docker ps | grep postgres

# Si no estÃ¡ corriendo:
docker-compose up -d postgres

# Verificar logs:
docker-compose logs postgres

# Verificar variables de entorno:
cat backend/.env

# Probar conexiÃ³n manual:
psql -U fastapi_user -d fullstack_db -h localhost
</code></pre>
<h4>Problema 3: &quot;alembic.util.exc.CommandError: Target database is not up to date&quot;</h4>
<p><strong>Causa</strong>: Migraciones no aplicadas.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash">cd backend
source venv/bin/activate
alembic upgrade head
</code></pre>
<h4>Problema 4: &quot;fastapi.exceptions.ValidationError&quot; en endpoints</h4>
<p><strong>Causa</strong>: Schema Pydantic no coincide con datos enviados.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<ul>
<li>Verificar el schema en la documentaciÃ³n Swagger (<code>/docs</code>)</li>
<li>Asegurarse de enviar todos los campos requeridos</li>
<li>Revisar tipos de datos (string vs int, etc.)</li>
</ul>
<h4>Problema 5: &quot;CORS policy: No 'Access-Control-Allow-Origin'&quot;</h4>
<p><strong>Causa</strong>: CORS no configurado correctamente.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-python"># En app/main.py, verificar:
app.add_middleware(
    CORSMiddleware,
    allow_origins=[&quot;http://localhost:3000&quot;],  # â† Verificar URL
    allow_credentials=True,                    # â† Debe ser True para cookies
    allow_methods=[&quot;*&quot;],
    allow_headers=[&quot;*&quot;],
)
</code></pre>
<h4>Problema 6: &quot;401 Unauthorized&quot; en endpoints protegidos</h4>
<p><strong>Causa</strong>: Token no enviado o invÃ¡lido.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash"># Verificar que cookie se creÃ³ en login
# DevTools â†’ Network â†’ Request a /api/v1/auth/login â†’ Response Headers
# Debe tener: Set-Cookie: access_token=...

# Verificar que cookie se envÃ­a en requests subsecuentes
# DevTools â†’ Network â†’ Request a /api/v1/users/me â†’ Request Headers
# Debe tener: Cookie: access_token=...

# Si no aparece, verificar withCredentials en axios:
# src/lib/api.ts debe tener:
# withCredentials: true
</code></pre>
<h3>ğŸ› Problemas de Frontend</h3>
<h4>Problema 7: &quot;Error: Invalid hook call&quot;</h4>
<p><strong>Causa</strong>: Hook usado fuera de componente o versiÃ³n React incompatible.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<ul>
<li>Asegurarse de que hooks estÃ¡n dentro de componentes funcionales</li>
<li>Agregar <code>'use client'</code> al inicio del archivo si usa hooks</li>
</ul>
<pre><code class="language-typescript">'use client';  // â† Agregar esto

import { useState } from 'react';
</code></pre>
<h4>Problema 8: &quot;Module not found: Can't resolve '@/components/ui/button'&quot;</h4>
<p><strong>Causa</strong>: shadcn/ui no instalado o path alias mal configurado.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash"># Instalar componente:
npx shadcn-ui@latest add button

# Verificar tsconfig.json tenga:
{
  &quot;compilerOptions&quot;: {
    &quot;paths&quot;: {
      &quot;@/*&quot;: [&quot;./src/*&quot;]
    }
  }
}
</code></pre>
<h4>Problema 9: &quot;Hydration failed&quot; en Next.js</h4>
<p><strong>Causa</strong>: HTML del servidor no coincide con el cliente.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<ul>
<li>No usar <code>localStorage</code> o <code>window</code> directamente en render</li>
<li>Usar <code>useEffect</code> para cÃ³digo que solo debe correr en cliente:</li>
</ul>
<pre><code class="language-typescript">useEffect(() =&gt; {
  // CÃ³digo que usa window o localStorage
}, []);
</code></pre>
<h4>Problema 10: &quot;TypeError: Cannot read property 'map' of undefined&quot;</h4>
<p><strong>Causa</strong>: Intentar mapear un array que aÃºn no se cargÃ³.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-typescript">// Agregar verificaciÃ³n:
{data &amp;&amp; data.map(item =&gt; (
  &lt;div key={item.id}&gt;{item.name}&lt;/div&gt;
))}

// O usar optional chaining:
{data?.map(item =&gt; (
  &lt;div key={item.id}&gt;{item.name}&lt;/div&gt;
))}
</code></pre>
<h3>ğŸ› Problemas de Docker</h3>
<h4>Problema 11: &quot;ERROR: Couldn't connect to Docker daemon&quot;</h4>
<p><strong>Causa</strong>: Docker no estÃ¡ corriendo.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash"># Windows/Mac: Iniciar Docker Desktop

# Linux: Iniciar servicio Docker
sudo systemctl start docker

# Verificar:
docker ps
</code></pre>
<h4>Problema 12: &quot;Port 5432 is already allocated&quot;</h4>
<p><strong>Causa</strong>: PostgreSQL local usando el puerto.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash"># OpciÃ³n 1: Detener PostgreSQL local
sudo service postgresql stop  # Linux
brew services stop postgresql  # Mac

# OpciÃ³n 2: Cambiar puerto en docker-compose.yml
services:
  postgres:
    ports:
      - &quot;5433:5432&quot;  # â† Puerto externo diferente

# Actualizar DATABASE_URL en .env:
DATABASE_URL=postgresql://...@localhost:5433/fullstack_db
</code></pre>
<h4>Problema 13: &quot;Cannot start service: driver failed&quot;</h4>
<p><strong>Causa</strong>: Contenedor anterior no eliminado o volumen corrupto.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash"># Detener y eliminar todo:
docker-compose down -v

# Eliminar contenedores manualmente:
docker rm -f fullstack_backend fullstack_frontend fullstack_postgres

# Eliminar volÃºmenes:
docker volume rm $(docker volume ls -q)

# Reiniciar:
docker-compose up --build
</code></pre>
<h3>ğŸ› Problemas de AutenticaciÃ³n</h3>
<h4>Problema 14: &quot;Cookie no se guarda en el navegador&quot;</h4>
<p><strong>Causa</strong>: <code>SameSite</code> o <code>Secure</code> mal configurados.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-python"># En app/api/v1/endpoints/auth.py:
response.set_cookie(
    key=&quot;access_token&quot;,
    value=token.access_token,
    httponly=True,
    secure=False,      # â† False en desarrollo (localhost), True en producciÃ³n con HTTPS
    samesite=&quot;lax&quot;,    # â† &quot;lax&quot; o &quot;none&quot; (no &quot;strict&quot; para requests cross-origin)
    max_age=1800
)
</code></pre>
<h4>Problema 15: &quot;Token expired&quot;</h4>
<p><strong>Causa</strong>: Token JWT expirÃ³.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-python"># Aumentar tiempo de expiraciÃ³n en .env:
ACCESS_TOKEN_EXPIRE_MINUTES=60  # 1 hora

# Implementar refresh tokens (avanzado)
</code></pre>
<h3>ğŸ› Problemas de MigraciÃ³n</h3>
<h4>Problema 16: &quot;Target database is not up to date&quot;</h4>
<p><strong>Causa</strong>: Modelo cambiÃ³ pero no se creÃ³ migraciÃ³n.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash">alembic revision --autogenerate -m &quot;Describe cambios&quot;
alembic upgrade head
</code></pre>
<h4>Problema 17: &quot;Can't locate revision identified by 'xxxxx'&quot;</h4>
<p><strong>Causa</strong>: MigraciÃ³n faltante o corrupta.</p>
<p><strong>SoluciÃ³n</strong>:</p>
<pre><code class="language-bash"># Ver historial:
alembic history

# Si falta migraciÃ³n, recrear desde scratch:
alembic downgrade base
rm alembic/versions/*.py
alembic revision --autogenerate -m &quot;Initial migration&quot;
alembic upgrade head
</code></pre>
<h3>ğŸ› Problemas de Performance</h3>
<h4>Problema 18: &quot;Backend responde muy lento&quot;</h4>
<p><strong>Causas y Soluciones</strong>:</p>
<ol>
<li><strong>Sin Ã­ndices en BD</strong>:</li>
</ol>
<pre><code class="language-python"># Agregar index=True en modelos:
email = Column(String, unique=True, index=True)
</code></pre>
<ol start="2">
<li><strong>N+1 queries</strong>:</li>
</ol>
<pre><code class="language-python"># Usar eager loading:
from sqlalchemy.orm import joinedload

users = db.query(User).options(joinedload(User.projects)).all()
</code></pre>
<ol start="3">
<li><strong>Pool de conexiones pequeÃ±o</strong>:</li>
</ol>
<pre><code class="language-python"># En app/db/session.py:
engine = create_engine(
    settings.DATABASE_URL,
    pool_size=20,      # â† Aumentar
    max_overflow=40    # â† Aumentar
)
</code></pre>
<hr>
<h2>ğŸ“š RECURSOS ADICIONALES</h2>
<h3>DocumentaciÃ³n Oficial</h3>
<ul>
<li><strong>FastAPI</strong>: https://fastapi.tiangolo.com/</li>
<li><strong>Next.js</strong>: https://nextjs.org/docs</li>
<li><strong>SQLAlchemy</strong>: https://docs.sqlalchemy.org/</li>
<li><strong>Pydantic</strong>: https://docs.pydantic.dev/</li>
<li><strong>TailwindCSS</strong>: https://tailwindcss.com/docs</li>
<li><strong>shadcn/ui</strong>: https://ui.shadcn.com/</li>
</ul>
<h3>Comunidad y Soporte</h3>
<ul>
<li><strong>FastAPI Discord</strong>: https://discord.gg/fastapi</li>
<li><strong>Next.js Discord</strong>: https://nextjs.org/discord</li>
<li><strong>Stack Overflow</strong>: Etiquetar preguntas con <code>fastapi</code>, <code>next.js</code>, <code>sqlalchemy</code></li>
</ul>
<h3>Tutoriales y Cursos</h3>
<ul>
<li><strong>FastAPI Official Tutorial</strong>: https://fastapi.tiangolo.com/tutorial/</li>
<li><strong>Next.js Learn</strong>: https://nextjs.org/learn</li>
<li><strong>Full Stack FastAPI PostgreSQL</strong>: https://github.com/tiangolo/full-stack-fastapi-postgresql</li>
</ul>
<h3>Herramientas Ãštiles</h3>
<ul>
<li><strong>Postman</strong>: Probar APIs - https://www.postman.com/</li>
<li><strong>pgAdmin</strong>: GUI para PostgreSQL - https://www.pgadmin.org/</li>
<li><strong>DB Browser for SQLite</strong>: Para desarrollo rÃ¡pido - https://sqlitebrowser.org/</li>
</ul>
<hr>
<h2>ğŸ‰ CONCLUSIÃ“N</h2>
<p>Â¡Felicidades! Si completaste todos los pasos, ahora tienes:</p>
<p>âœ… Un backend FastAPI profesional con:</p>
<ul>
<li>Arquitectura en capas escalable</li>
<li>AutenticaciÃ³n JWT segura</li>
<li>Migraciones de base de datos</li>
<li>DocumentaciÃ³n automÃ¡tica</li>
</ul>
<p>âœ… Un frontend Next.js moderno con:</p>
<ul>
<li>TypeScript para type safety</li>
<li>TailwindCSS para estilos</li>
<li>Componentes UI reutilizables</li>
<li>Hooks personalizados</li>
</ul>
<p>âœ… Una aplicaciÃ³n Full Stack completa con:</p>
<ul>
<li>ComunicaciÃ³n segura backend-frontend</li>
<li>AutenticaciÃ³n con cookies HttpOnly</li>
<li>Base de datos relacional robusta</li>
<li>Todo containerizado con Docker</li>
</ul>
<h3>ğŸš€ PrÃ³ximos Pasos Recomendados</h3>
<ol>
<li><strong>Implementar CRUD Completo</strong>: Para proyectos, tareas y tags</li>
<li><strong>Agregar WebSockets</strong>: Para notificaciones en tiempo real</li>
<li><strong>Testing</strong>: Unitarios y de integraciÃ³n</li>
<li><strong>CI/CD</strong>: GitHub Actions o GitLab CI</li>
<li><strong>Deploy</strong>: En AWS, Google Cloud, Heroku, Railway, etc.</li>
<li><strong>Monitoring</strong>: Sentry, Prometheus, Grafana</li>
<li><strong>Features Avanzadas</strong>: BÃºsqueda, filtros, paginaciÃ³n, carga de archivos</li>
</ol>
<p><strong>Â¡El proyecto estÃ¡ listo para crecer!</strong> ğŸŒŸ</p>
<hr>
<p><em>Fin del Documento 4</em></p>
<hr>

  </article>
</div>

  </main>
  <hr class="fleuron" />

<footer>
    <p>Arise with IA | IA para Aprender &copy; 2025</p>
</footer>


  
  
  <script>
  (function() {
    'use strict';
    
    // ============================================
    // 1. Scroll Header Shrink Effect (OPTIMIZADO)
    // ============================================
    const header = document.querySelector('header');
    let ticking = false;
    
    window.addEventListener('scroll', function() {
      if (!ticking) {
        window.requestAnimationFrame(function() {
          header.classList.toggle('shrink', window.scrollY > 50);
          ticking = false;
        });
        ticking = true;
      }
    });
    
    // ============================================
    // 2. Format Dates in Spanish
    // ============================================
    function formatDates() {
      const timeElements = document.querySelectorAll('time.post-date');
      const meses = [
        'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
        'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
      ];
      
      timeElements.forEach(function(timeEl) {
        const dateStr = timeEl.textContent.trim();
        const date = new Date(dateStr);
        
        if (!isNaN(date.getTime())) {
          const day = date.getDate();
          const month = meses[date.getMonth()];
          const year = date.getFullYear();
          
          timeEl.textContent = day + ' de ' + month + ' de ' + year;
          timeEl.setAttribute('datetime', dateStr);
        }
      });
    }
    
    // ============================================
    // 3. Table of Contents (TOC) - OPTIMIZADO
    // ============================================
    function initTableOfContents() {
      // Buscar artÃ­culo
      const article = document.querySelector('article');
      if (!article) return;
      
      // Buscar encabezados (h2, h3, h4)
      const headings = article.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) {
        // Ocultar elementos del TOC si no hay encabezados
        const tocElements = document.querySelectorAll('#toc-bar, #toc-solo-trigger, #toc-wrapper');
        tocElements.forEach(el => el && (el.style.display = 'none'));
        return;
      }
      
      // Generar HTML del Ã­ndice
      let html = '<ul>';
      headings.forEach(function(heading, index) {
        // Generar ID si no existe
        if (!heading.id) {
          const text = heading.textContent.trim();
          const slug = text
            .toLowerCase()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .replace(/[^a-z0-9\s]+/g, '')
            .replace(/\s+/g, '-')
            .replace(/^-+|-+$/g, '');
          heading.id = slug || 'seccion-' + (index + 1);
        }
        
        // IndentaciÃ³n segÃºn nivel
        const level = parseInt(heading.tagName[1]);
        const style = level === 3 ? ' style="padding-left: 1.5em"' : 
                     level === 4 ? ' style="padding-left: 3em"' : '';
        
        html += '<li' + style + '><a href="#' + heading.id + '">' + 
                heading.textContent.trim() + '</a></li>';
      });
      html += '</ul>';
      
      // Insertar en popup (mobile)
      const popupContent = document.getElementById('toc-popup-content');
      if (popupContent) popupContent.innerHTML = html;
      
      // Insertar en sidebar (desktop)
      const tocWrapper = document.getElementById('toc-wrapper');
      if (tocWrapper) {
        let nav = tocWrapper.querySelector('nav');
        if (!nav) {
          nav = document.createElement('nav');
          tocWrapper.appendChild(nav);
        }
        nav.innerHTML = html;
      }
      
      // Configurar popup modal
      const popup = document.getElementById('toc-popup');
      const triggers = document.querySelectorAll('.toc-trigger');
      const btnClose = document.getElementById('toc-popup-close');
      
      if (popup && triggers.length > 0) {
        // FunciÃ³n para cerrar popup con animaciÃ³n
        function closePopup() {
          popup.setAttribute('closing', '');
          popup.addEventListener('animationend', function handleAnimationEnd() {
            popup.removeAttribute('closing');
            popup.close();
            document.documentElement.classList.remove('overflow-hidden');
            document.body.classList.remove('overflow-hidden');
            popup.removeEventListener('animationend', handleAnimationEnd);
          });
        }
        
        // Abrir popup (OPTIMIZADO)
        triggers.forEach(function(trigger) {
          trigger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            document.documentElement.classList.add('overflow-hidden');
            document.body.classList.add('overflow-hidden');
            popup.showModal();
          });
        });
        
        // Cerrar popup (FIX)
        if (btnClose) {
          btnClose.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            closePopup();
          });
        }
        
        // Click en backdrop (SIMPLIFICADO)
        popup.addEventListener('click', function(e) {
          if (e.target === popup) {
            closePopup();
          }
        });
        
        // ESC key
        popup.addEventListener('cancel', function(e) {
          e.preventDefault();
          closePopup();
        });
        
        // Manejar resize (cerrar popup en desktop)
        window.addEventListener('resize', function() {
          if (window.innerWidth >= 1200 && popup.open) {
            popup.close();
            document.documentElement.classList.remove('overflow-hidden');
            document.body.classList.remove('overflow-hidden');
          }
        });
      }
      
      // BotÃ³n flotante con IntersectionObserver
      const tocBar = document.getElementById('toc-bar');
      const soloTrigger = document.getElementById('toc-solo-trigger');
      
      if (tocBar && soloTrigger) {
        const observer = new IntersectionObserver(
          function(entries) {
            entries.forEach(function(entry) {
              tocBar.classList.toggle('invisible', entry.isIntersecting);
            });
          },
          { rootMargin: '-48px 0px 0px 0px' }
        );
        observer.observe(soloTrigger);
      }
      
      // Smooth scroll y scroll spy
      const tocLinks = document.querySelectorAll('#toc-popup-content a, #toc-wrapper a');
      const linkMap = new Map();
      
      // Crear mapa de IDs a enlaces
      tocLinks.forEach(function(link) {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          const id = href.substring(1);
          if (!linkMap.has(id)) {
            linkMap.set(id, []);
          }
          linkMap.get(id).push(link);
          
          // Smooth scroll
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById(id);
            if (target) {
              const offset = 100;
              const targetPosition = target.getBoundingClientRect().top + 
                                   window.pageYOffset - offset;
              window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
              });
              history.pushState(null, null, '#' + id);
              if (popup && popup.open) {
                closePopup();
              }
            }
          });
        }
      });
      
      // Scroll spy con IntersectionObserver
      const scrollObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            
            // Remover clase active de todos
            tocLinks.forEach(function(link) {
              link.classList.remove('active');
            });
            
            // Agregar clase active a los enlaces correspondientes
            const activeLinks = linkMap.get(id);
            if (activeLinks) {
              activeLinks.forEach(function(link) {
                link.classList.add('active');
              });
            }
          }
        });
      }, {
        rootMargin: '-100px 0px -66%',
        threshold: 0
      });
      
      // Observar todos los encabezados
      headings.forEach(function(heading) {
        if (heading.id) {
          scrollObserver.observe(heading);
        }
      });
    }
    
    // ============================================
    // InicializaciÃ³n
    // ============================================
    function init() {
      formatDates();
      initTableOfContents();
    }
    
    // Ejecutar cuando el DOM estÃ© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
  })();
  </script>

</body>
</html>
